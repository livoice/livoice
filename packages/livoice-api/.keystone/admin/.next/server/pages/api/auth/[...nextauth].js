"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/auth/[...nextauth]";
exports.ids = ["pages/api/auth/[...nextauth]"];
exports.modules = {

/***/ "@keystone-6/cloudinary":
/*!*****************************************!*\
  !*** external "@keystone-6/cloudinary" ***!
  \*****************************************/
/***/ ((module) => {

module.exports = require("@keystone-6/cloudinary");

/***/ }),

/***/ "@keystone-6/core":
/*!***********************************!*\
  !*** external "@keystone-6/core" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("@keystone-6/core");

/***/ }),

/***/ "@keystone-6/core/access":
/*!******************************************!*\
  !*** external "@keystone-6/core/access" ***!
  \******************************************/
/***/ ((module) => {

module.exports = require("@keystone-6/core/access");

/***/ }),

/***/ "@keystone-6/core/context":
/*!*******************************************!*\
  !*** external "@keystone-6/core/context" ***!
  \*******************************************/
/***/ ((module) => {

module.exports = require("@keystone-6/core/context");

/***/ }),

/***/ "@keystone-6/core/fields":
/*!******************************************!*\
  !*** external "@keystone-6/core/fields" ***!
  \******************************************/
/***/ ((module) => {

module.exports = require("@keystone-6/core/fields");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "dotenv":
/*!*************************!*\
  !*** external "dotenv" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("dotenv");

/***/ }),

/***/ "envalid":
/*!**************************!*\
  !*** external "envalid" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("envalid");

/***/ }),

/***/ "express":
/*!**************************!*\
  !*** external "express" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("express");

/***/ }),

/***/ "free-email-domains":
/*!*************************************!*\
  !*** external "free-email-domains" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("free-email-domains");

/***/ }),

/***/ "lodash/pick":
/*!******************************!*\
  !*** external "lodash/pick" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("lodash/pick");

/***/ }),

/***/ "next-auth":
/*!****************************!*\
  !*** external "next-auth" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("next-auth");

/***/ }),

/***/ "next-auth/providers/google":
/*!*********************************************!*\
  !*** external "next-auth/providers/google" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/google");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "(api)/../../../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/../../../../node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/../../../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/../../../../node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_auth_nextauth_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/auth/[...nextauth].ts */ \"(api)/./pages/api/auth/[...nextauth].ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_nextauth_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_nextauth_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/auth/[...nextauth]\",\n        pathname: \"/api/auth/[...nextauth]\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_auth_nextauth_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1yb3V0ZS1sb2FkZXIvaW5kZXguanM/a2luZD1QQUdFU19BUEkmcGFnZT0lMkZhcGklMkZhdXRoJTJGJTVCLi4ubmV4dGF1dGglNUQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUM4RDtBQUM5RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsd0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHdEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovLy8/ZDUxNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvWy4uLm5leHRhdXRoXVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F1dGgvWy4uLm5leHRhdXRoXVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/auth/[...nextauth].ts":
/*!*****************************************!*\
  !*** ./pages/api/auth/[...nextauth].ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* reexport safe */ _admin_pages_api_auth_nextauth___WEBPACK_IMPORTED_MODULE_0__[\"default\"])\n/* harmony export */ });\n/* harmony import */ var _admin_pages_api_auth_nextauth___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../admin/pages/api/auth/[...nextauth] */ \"(api)/../../admin/pages/api/auth/[...nextauth].ts\");\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTJFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFnZXMvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS50cz8yZThiIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGRlZmF1bHQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vYWRtaW4vcGFnZXMvYXBpL2F1dGgvWy4uLm5leHRhdXRoXVwiIl0sIm5hbWVzIjpbImRlZmF1bHQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/auth/[...nextauth].ts\n");

/***/ }),

/***/ "(api)/../../admin/pages/api/auth/[...nextauth].ts":
/*!***************************************************!*\
  !*** ../../admin/pages/api/auth/[...nextauth].ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"next-auth\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../auth */ \"(api)/../../auth.ts\");\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (next_auth__WEBPACK_IMPORTED_MODULE_0___default()(_auth__WEBPACK_IMPORTED_MODULE_1__.nextAuthOptions));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vYWRtaW4vcGFnZXMvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQWlDO0FBQ2tCO0FBRW5ELGlFQUFlQSxnREFBUUEsQ0FBQ0Msa0RBQWVBLENBQUNBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vYWRtaW4vcGFnZXMvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS50cz8yMDQyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOZXh0QXV0aCBmcm9tICduZXh0LWF1dGgnO1xuaW1wb3J0IHsgbmV4dEF1dGhPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vYXV0aCc7XG5cbmV4cG9ydCBkZWZhdWx0IE5leHRBdXRoKG5leHRBdXRoT3B0aW9ucyk7XG4iXSwibmFtZXMiOlsiTmV4dEF1dGgiLCJuZXh0QXV0aE9wdGlvbnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../admin/pages/api/auth/[...nextauth].ts\n");

/***/ }),

/***/ "(api)/../../auth.ts":
/*!*********************!*\
  !*** ../../auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   nextAuthOptions: () => (/* binding */ nextAuthOptions),\n/* harmony export */   nextAuthSessionStrategy: () => (/* binding */ nextAuthSessionStrategy)\n/* harmony export */ });\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var free_email_domains__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! free-email-domains */ \"free-email-domains\");\n/* harmony import */ var free_email_domains__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(free_email_domains__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth */ \"next-auth\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _config_env__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config/env */ \"(api)/../../config/env.ts\");\n/* harmony import */ var _context_keystoneContext__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./context/keystoneContext */ \"(api)/../../context/keystoneContext.ts\");\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n/* harmony import */ var _lib_auth_extractUserData__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./lib/auth/extractUserData */ \"(api)/../../lib/auth/extractUserData.ts\");\n/* harmony import */ var _lib_auth_providers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./lib/auth/providers */ \"(api)/../../lib/auth/providers.ts\");\n\n\n\n\n\n\n\n\nconst freeEmailDomainSet = new Set(free_email_domains__WEBPACK_IMPORTED_MODULE_1___default().map((domain)=>domain.toLowerCase()));\nconst extractDomain = (email)=>{\n    if (!email) return null;\n    const [, domain] = email.toLowerCase().split(\"@\");\n    return domain || null;\n};\nconst isSecureCookies = _config_env__WEBPACK_IMPORTED_MODULE_3__[\"default\"].NEXTAUTH_URL.startsWith(\"https://\");\nconst cookiePrefix = isSecureCookies ? \"__Secure-\" : \"\";\nconst cookiesMappingConfig = {\n    sessionToken: `${cookiePrefix}next-auth.session-token`,\n    callbackUrl: `${cookiePrefix}next-auth.callback-url`,\n    csrfToken: `${cookiePrefix}next-auth.csrf-token`,\n    pkceCodeVerifier: `${cookiePrefix}next-auth.pkce.code_verifier`,\n    state: `${cookiePrefix}next-auth.state`,\n    nonce: `${cookiePrefix}next-auth.nonce`\n};\nconst cookies = Object.fromEntries(Object.entries(cookiesMappingConfig).map(([key, name])=>[\n        key,\n        {\n            name,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: isSecureCookies,\n                domain: _config_env__WEBPACK_IMPORTED_MODULE_3__[\"default\"].COOKIE_DOMAIN\n            }\n        }\n    ]));\nconst nextAuthOptions = {\n    providers: _lib_auth_providers__WEBPACK_IMPORTED_MODULE_7__[\"default\"],\n    cookies,\n    secret: _config_env__WEBPACK_IMPORTED_MODULE_3__[\"default\"].SESSION_SECRET,\n    pages: {\n        error: \"/api/auth/error\"\n    },\n    callbacks: {\n        async signIn ({ user, account, profile }) {\n            const sudoContext = (await (0,_context_keystoneContext__WEBPACK_IMPORTED_MODULE_4__.getKeystoneContext)()).sudo();\n            if (!account) throw new Error(\"Missing account param\");\n            const { providerAccountId, provider } = account;\n            const email = user.email?.toLowerCase();\n            if (!email) return false;\n            const domain = extractDomain(email);\n            const nowIso = new Date().toISOString();\n            const extractedData = (0,_lib_auth_extractUserData__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(provider, {\n                user,\n                profile\n            });\n            const existingUsers = await sudoContext.query.User.findMany({\n                where: {\n                    email: {\n                        equals: email\n                    }\n                },\n                query: \"id org { id } project { id }\"\n            });\n            const baseUserData = {\n                email,\n                firstName: extractedData.firstName ?? \"\",\n                lastName: extractedData.lastName ?? \"\",\n                avatarSocialUrl: extractedData.pictureUrl ?? \"\",\n                role: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_5__.UserRole.USER,\n                providerAccountId,\n                provider: provider,\n                rawAuth: {\n                    user: user,\n                    profile: profile,\n                    account: account\n                }\n            };\n            let matchedOrgId = null;\n            if (domain && !freeEmailDomainSet.has(domain)) {\n                const orgs = await sudoContext.query.Organization.findMany({\n                    query: \"id autojoinDomains\"\n                });\n                const matchedOrg = orgs.find((candidate)=>{\n                    const domains = Array.isArray(candidate.autojoinDomains) ? candidate.autojoinDomains : [];\n                    return domains.map((value)=>value?.toLowerCase?.() || \"\").includes(domain);\n                });\n                matchedOrgId = matchedOrg?.id ?? null;\n            }\n            let projectToConnect = null;\n            if (matchedOrgId) {\n                const candidateProjects = await sudoContext.query.Project.findMany({\n                    where: {\n                        org: {\n                            id: {\n                                equals: matchedOrgId\n                            }\n                        }\n                    },\n                    take: 1,\n                    query: \"id\"\n                });\n                const primaryProject = candidateProjects?.[0];\n                if (!primaryProject?.id) {\n                    throw new Error(\"Auto-join target organization does not have a project configured.\");\n                }\n                projectToConnect = {\n                    id: primaryProject.id\n                };\n            }\n            if (existingUsers.length > 0) {\n                const existingUser = existingUsers[0];\n                const { role: _, ...userDataWithoutRole } = baseUserData;\n                await sudoContext.db.User.updateOne({\n                    where: {\n                        id: existingUser.id\n                    },\n                    data: {\n                        ...userDataWithoutRole,\n                        provisionedAt: nowIso,\n                        ...matchedOrgId && !existingUser.org?.id ? {\n                            org: {\n                                connect: {\n                                    id: matchedOrgId\n                                }\n                            }\n                        } : {},\n                        ...projectToConnect && !existingUser.project?.id ? {\n                            project: {\n                                connect: projectToConnect\n                            }\n                        } : {}\n                    },\n                    query: \"id\"\n                });\n                return true;\n            }\n            const created = await sudoContext.db.User.createOne({\n                data: {\n                    ...baseUserData,\n                    provisionedAt: nowIso,\n                    ...matchedOrgId ? {\n                        org: {\n                            connect: {\n                                id: matchedOrgId\n                            }\n                        }\n                    } : {},\n                    ...projectToConnect ? {\n                        project: {\n                            connect: projectToConnect\n                        }\n                    } : {}\n                },\n                query: \"id\"\n            });\n            return !!created?.id;\n        },\n        async jwt ({ token, user, account, profile }) {\n            if (!account) return token;\n            const extracted = (0,_lib_auth_extractUserData__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(account.provider, {\n                user,\n                profile\n            });\n            const normalizedEmail = typeof extracted.email === \"string\" ? extracted.email.toLowerCase() : null;\n            return {\n                ...token,\n                userData: {\n                    ...extracted,\n                    email: normalizedEmail ?? extracted.email ?? null\n                }\n            };\n        },\n        async session ({ session, token }) {\n            const userData = token.userData ?? {};\n            const normalizedEmail = typeof userData?.email === \"string\" ? userData.email.toLowerCase() : null;\n            if (!normalizedEmail) {\n                throw new Error(\"Invalid session: no email found\");\n            }\n            const sudoContext = (await (0,_context_keystoneContext__WEBPACK_IMPORTED_MODULE_4__.getKeystoneContext)()).sudo();\n            const dbUser = await sudoContext.query.User.findMany({\n                where: {\n                    email: {\n                        equals: normalizedEmail\n                    }\n                },\n                query: \"id email org { id } project { id } role providerAccountId isActive seenAt avatarUrl displayName\"\n            });\n            if (!dbUser || dbUser.length === 0) {\n                throw new Error(\"User not found in database\");\n            }\n            const user = dbUser[0];\n            const isDeactivated = !user.isActive;\n            const seenAt = new Date().toISOString();\n            await sudoContext.db.User.updateOne({\n                where: {\n                    id: user.id\n                },\n                data: {\n                    seenAt\n                },\n                query: \"id\"\n            });\n            const emailDomain = extractDomain(user?.email ?? normalizedEmail);\n            const isAutojoinDomainAllowed = !!(emailDomain && !freeEmailDomainSet.has(emailDomain));\n            // Default to USER if role is not set\n            const userRole = user?.role || _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_5__.UserRole.USER;\n            return {\n                ...session,\n                id: user?.id,\n                email: normalizedEmail,\n                firstName: userData?.firstName,\n                lastName: userData?.lastName,\n                avatarUrl: user?.avatarUrl || null,\n                displayName: user?.displayName || null,\n                providerAccountId: user?.providerAccountId || null,\n                orgId: user?.org?.id || null,\n                projectId: user?.project?.id || null,\n                role: userRole,\n                emailDomain,\n                isAutojoinDomainAllowed,\n                isActive: user.isActive ?? true\n            };\n        },\n        async redirect ({ url, baseUrl }) {\n            // If this is an error redirect, we can modify it to include additional parameters\n            if (url.includes(\"/api/auth/error\")) {\n                // The error page will handle displaying the email from the error context\n                return url;\n            }\n            if (!url.startsWith(_config_env__WEBPACK_IMPORTED_MODULE_3__[\"default\"].APP_URL) && !url.startsWith(baseUrl)) return baseUrl;\n            return url;\n        }\n    }\n};\nconst nextAuthSessionStrategy = {\n    async get ({ context }) {\n        const { req, res } = context;\n        const { headers } = req ?? {};\n        if (!headers?.cookie || !res) return;\n        const nextAuthSession = await (0,next_auth__WEBPACK_IMPORTED_MODULE_2__.getServerSession)({\n            headers,\n            cookies: (0,cookie__WEBPACK_IMPORTED_MODULE_0__.parse)(headers.cookie)\n        }, res, nextAuthOptions);\n        if (!nextAuthSession) return;\n        // Should we verify user line in examples?\n        // const user = await context.sudo().db.User.findOne({ where: { email: nextAuthSession.email } });\n        // if (!user) return;\n        return nextAuthSession;\n    },\n    // we don't need these as next-auth handle start and end for us\n    async start () {\n    /* empty */ },\n    async end () {\n    /* empty */ }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQ2tJLFFBQVFDLE1BQU07UUFBRSxHQUNqREYsS0FDQTFGO1FBRUYsSUFBSSxDQUFDNkYsaUJBQWlCO1FBRXRCLDBDQUEwQztRQUMxQyxrR0FBa0c7UUFDbEcscUJBQXFCO1FBRXJCLE9BQU9BO0lBQ1Q7SUFFQSwrREFBK0Q7SUFDL0QsTUFBTUM7SUFDSixTQUFTLEdBQ1g7SUFDQSxNQUFNQztJQUNKLFNBQVMsR0FDWDtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vYXV0aC50cz8xNzMxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVHlwZUluZm8gfSBmcm9tICcua2V5c3RvbmUvdHlwZXMnO1xuaW1wb3J0IHsgSlNPTlZhbHVlLCBTZXNzaW9uU3RyYXRlZ3kgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL3R5cGVzJztcbmltcG9ydCB7IHBhcnNlIGFzIHBhcnNlQ29va2llcyB9IGZyb20gJ2Nvb2tpZSc7XG5pbXBvcnQgZnJlZUVtYWlsRG9tYWlucyBmcm9tICdmcmVlLWVtYWlsLWRvbWFpbnMnO1xuaW1wb3J0IHsgZ2V0U2VydmVyU2Vzc2lvbiwgTmV4dEF1dGhPcHRpb25zIH0gZnJvbSAnbmV4dC1hdXRoJztcbmltcG9ydCBlbnYgZnJvbSAnLi9jb25maWcvZW52JztcbmltcG9ydCB7IGdldEtleXN0b25lQ29udGV4dCB9IGZyb20gJy4vY29udGV4dC9rZXlzdG9uZUNvbnRleHQnO1xuaW1wb3J0IHsgVXNlclJvbGUgfSBmcm9tICcuL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5pbXBvcnQgZXh0cmFjdFVzZXJEYXRhIGZyb20gJy4vbGliL2F1dGgvZXh0cmFjdFVzZXJEYXRhJztcbmltcG9ydCBwcm92aWRlcnMgZnJvbSAnLi9saWIvYXV0aC9wcm92aWRlcnMnO1xuXG5jb25zdCBmcmVlRW1haWxEb21haW5TZXQgPSBuZXcgU2V0PHN0cmluZz4oKGZyZWVFbWFpbERvbWFpbnMgYXMgc3RyaW5nW10pLm1hcChkb21haW4gPT4gZG9tYWluLnRvTG93ZXJDYXNlKCkpKTtcblxuY29uc3QgZXh0cmFjdERvbWFpbiA9IChlbWFpbD86IHN0cmluZyB8IG51bGwpID0+IHtcbiAgaWYgKCFlbWFpbCkgcmV0dXJuIG51bGw7XG4gIGNvbnN0IFssIGRvbWFpbl0gPSBlbWFpbC50b0xvd2VyQ2FzZSgpLnNwbGl0KCdAJyk7XG4gIHJldHVybiBkb21haW4gfHwgbnVsbDtcbn07XG5cbnR5cGUgUHJvdmlkZXJUeXBlID0gJ2dvb2dsZSc7XG5cbnR5cGUgVXNlckl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVXNlciddWydpdGVtJ107XG50eXBlIE9yZ2FuaXphdGlvbkl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnT3JnYW5pemF0aW9uJ11bJ2l0ZW0nXTtcbnR5cGUgUHJvamVjdEl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnUHJvamVjdCddWydpdGVtJ107XG5cbmV4cG9ydCB0eXBlIFNlc3Npb24gPSB7XG4gIGlkOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIGZpcnN0TmFtZT86IHN0cmluZztcbiAgbGFzdE5hbWU/OiBzdHJpbmc7XG4gIGF2YXRhclVybD86IHN0cmluZyB8IG51bGw7XG4gIGRpc3BsYXlOYW1lPzogc3RyaW5nIHwgbnVsbDtcbiAgcm9sZTogVXNlclJvbGU7XG4gIG9yZ0lkOiBzdHJpbmcgfCBudWxsO1xuICBwcm9qZWN0SWQ6IHN0cmluZyB8IG51bGw7XG4gIHByb3ZpZGVyQWNjb3VudElkOiBzdHJpbmcgfCBudWxsO1xuICBlbWFpbERvbWFpbjogc3RyaW5nIHwgbnVsbDtcbiAgaXNBdXRvam9pbkRvbWFpbkFsbG93ZWQ6IGJvb2xlYW47XG4gIGlzQWN0aXZlOiBib29sZWFuO1xufTtcblxuY29uc3QgaXNTZWN1cmVDb29raWVzID0gZW52Lk5FWFRBVVRIX1VSTC5zdGFydHNXaXRoKCdodHRwczovLycpO1xuY29uc3QgY29va2llUHJlZml4ID0gaXNTZWN1cmVDb29raWVzID8gJ19fU2VjdXJlLScgOiAnJztcblxuY29uc3QgY29va2llc01hcHBpbmdDb25maWcgPSB7XG4gIHNlc3Npb25Ub2tlbjogYCR7Y29va2llUHJlZml4fW5leHQtYXV0aC5zZXNzaW9uLXRva2VuYCxcbiAgY2FsbGJhY2tVcmw6IGAke2Nvb2tpZVByZWZpeH1uZXh0LWF1dGguY2FsbGJhY2stdXJsYCxcbiAgY3NyZlRva2VuOiBgJHtjb29raWVQcmVmaXh9bmV4dC1hdXRoLmNzcmYtdG9rZW5gLFxuICBwa2NlQ29kZVZlcmlmaWVyOiBgJHtjb29raWVQcmVmaXh9bmV4dC1hdXRoLnBrY2UuY29kZV92ZXJpZmllcmAsXG4gIHN0YXRlOiBgJHtjb29raWVQcmVmaXh9bmV4dC1hdXRoLnN0YXRlYCxcbiAgbm9uY2U6IGAke2Nvb2tpZVByZWZpeH1uZXh0LWF1dGgubm9uY2VgXG59O1xuXG5jb25zdCBjb29raWVzOiBOZXh0QXV0aE9wdGlvbnNbJ2Nvb2tpZXMnXSA9IE9iamVjdC5mcm9tRW50cmllcyhcbiAgT2JqZWN0LmVudHJpZXMoY29va2llc01hcHBpbmdDb25maWcpLm1hcCgoW2tleSwgbmFtZV0pID0+IFtcbiAgICBrZXksXG4gICAge1xuICAgICAgbmFtZSxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICAgIHNhbWVTaXRlOiAnbGF4JyxcbiAgICAgICAgcGF0aDogJy8nLFxuICAgICAgICBzZWN1cmU6IGlzU2VjdXJlQ29va2llcyxcbiAgICAgICAgZG9tYWluOiBlbnYuQ09PS0lFX0RPTUFJTlxuICAgICAgfVxuICAgIH1cbiAgXSlcbik7XG5cbmV4cG9ydCBjb25zdCBuZXh0QXV0aE9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcbiAgcHJvdmlkZXJzLFxuICBjb29raWVzLFxuICBzZWNyZXQ6IGVudi5TRVNTSU9OX1NFQ1JFVCxcbiAgcGFnZXM6IHtcbiAgICBlcnJvcjogJy9hcGkvYXV0aC9lcnJvcidcbiAgfSxcbiAgY2FsbGJhY2tzOiB7XG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciwgYWNjb3VudCwgcHJvZmlsZSB9KSB7XG4gICAgICBjb25zdCBzdWRvQ29udGV4dCA9IChhd2FpdCBnZXRLZXlzdG9uZUNvbnRleHQoKSkuc3VkbygpO1xuXG4gICAgICBpZiAoIWFjY291bnQpIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBhY2NvdW50IHBhcmFtJyk7XG4gICAgICBjb25zdCB7IHByb3ZpZGVyQWNjb3VudElkLCBwcm92aWRlciB9ID0gYWNjb3VudDtcblxuICAgICAgY29uc3QgZW1haWwgPSB1c2VyLmVtYWlsPy50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKCFlbWFpbCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBjb25zdCBkb21haW4gPSBleHRyYWN0RG9tYWluKGVtYWlsKTtcbiAgICAgIGNvbnN0IG5vd0lzbyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgIGNvbnN0IGV4dHJhY3RlZERhdGEgPSBleHRyYWN0VXNlckRhdGEocHJvdmlkZXIsIHsgdXNlciwgcHJvZmlsZSB9KSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcblxuICAgICAgY29uc3QgZXhpc3RpbmdVc2VycyA9IChhd2FpdCBzdWRvQ29udGV4dC5xdWVyeS5Vc2VyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgZW1haWw6IHsgZXF1YWxzOiBlbWFpbCB9IH0sXG4gICAgICAgIHF1ZXJ5OiAnaWQgb3JnIHsgaWQgfSBwcm9qZWN0IHsgaWQgfSdcbiAgICAgIH0pKSBhcyAoUGljazxVc2VySXRlbSwgJ2lkJz4gJiB7XG4gICAgICAgIG9yZzogUGljazxPcmdhbml6YXRpb25JdGVtLCAnaWQnPiB8IG51bGw7XG4gICAgICAgIHByb2plY3Q6IFBpY2s8UHJvamVjdEl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgIH0pW107XG5cbiAgICAgIGNvbnN0IGJhc2VVc2VyRGF0YSA9IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIGZpcnN0TmFtZTogZXh0cmFjdGVkRGF0YS5maXJzdE5hbWUgPz8gJycsXG4gICAgICAgIGxhc3ROYW1lOiBleHRyYWN0ZWREYXRhLmxhc3ROYW1lID8/ICcnLFxuICAgICAgICBhdmF0YXJTb2NpYWxVcmw6IGV4dHJhY3RlZERhdGEucGljdHVyZVVybCA/PyAnJyxcbiAgICAgICAgcm9sZTogVXNlclJvbGUuVVNFUixcbiAgICAgICAgcHJvdmlkZXJBY2NvdW50SWQsXG4gICAgICAgIHByb3ZpZGVyOiBwcm92aWRlciBhcyBQcm92aWRlclR5cGUsXG4gICAgICAgIHJhd0F1dGg6IHtcbiAgICAgICAgICB1c2VyOiB1c2VyIGFzIHVua25vd24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gICAgICAgICAgcHJvZmlsZTogcHJvZmlsZSBhcyB1bmtub3duIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgICAgIGFjY291bnQ6IGFjY291bnQgYXMgdW5rbm93biBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICAgICAgICB9IGFzIEpTT05WYWx1ZVxuICAgICAgfSBzYXRpc2ZpZXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cbiAgICAgIGxldCBtYXRjaGVkT3JnSWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgaWYgKGRvbWFpbiAmJiAhZnJlZUVtYWlsRG9tYWluU2V0Lmhhcyhkb21haW4pKSB7XG4gICAgICAgIGNvbnN0IG9yZ3MgPSAoYXdhaXQgc3Vkb0NvbnRleHQucXVlcnkuT3JnYW5pemF0aW9uLmZpbmRNYW55KHtcbiAgICAgICAgICBxdWVyeTogJ2lkIGF1dG9qb2luRG9tYWlucydcbiAgICAgICAgfSkpIGFzIChQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+ICYgeyBhdXRvam9pbkRvbWFpbnM6IHVua25vd24gfSlbXTtcbiAgICAgICAgY29uc3QgbWF0Y2hlZE9yZyA9IG9yZ3MuZmluZChjYW5kaWRhdGUgPT4ge1xuICAgICAgICAgIGNvbnN0IGRvbWFpbnMgPSBBcnJheS5pc0FycmF5KGNhbmRpZGF0ZS5hdXRvam9pbkRvbWFpbnMpID8gKGNhbmRpZGF0ZS5hdXRvam9pbkRvbWFpbnMgYXMgc3RyaW5nW10pIDogW107XG4gICAgICAgICAgcmV0dXJuIGRvbWFpbnMubWFwKHZhbHVlID0+IHZhbHVlPy50b0xvd2VyQ2FzZT8uKCkgfHwgJycpLmluY2x1ZGVzKGRvbWFpbik7XG4gICAgICAgIH0pO1xuICAgICAgICBtYXRjaGVkT3JnSWQgPSBtYXRjaGVkT3JnPy5pZCA/PyBudWxsO1xuICAgICAgfVxuXG4gICAgICBsZXQgcHJvamVjdFRvQ29ubmVjdDogeyBpZDogc3RyaW5nIH0gfCBudWxsID0gbnVsbDtcbiAgICAgIGlmIChtYXRjaGVkT3JnSWQpIHtcbiAgICAgICAgY29uc3QgY2FuZGlkYXRlUHJvamVjdHMgPSAoYXdhaXQgc3Vkb0NvbnRleHQucXVlcnkuUHJvamVjdC5maW5kTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHsgb3JnOiB7IGlkOiB7IGVxdWFsczogbWF0Y2hlZE9yZ0lkIH0gfSB9LFxuICAgICAgICAgIHRha2U6IDEsXG4gICAgICAgICAgcXVlcnk6ICdpZCdcbiAgICAgICAgfSkpIGFzIFBpY2s8UHJvamVjdEl0ZW0sICdpZCc+W107XG4gICAgICAgIGNvbnN0IHByaW1hcnlQcm9qZWN0ID0gY2FuZGlkYXRlUHJvamVjdHM/LlswXTtcbiAgICAgICAgaWYgKCFwcmltYXJ5UHJvamVjdD8uaWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dG8tam9pbiB0YXJnZXQgb3JnYW5pemF0aW9uIGRvZXMgbm90IGhhdmUgYSBwcm9qZWN0IGNvbmZpZ3VyZWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcHJvamVjdFRvQ29ubmVjdCA9IHsgaWQ6IHByaW1hcnlQcm9qZWN0LmlkIH07XG4gICAgICB9XG5cbiAgICAgIGlmIChleGlzdGluZ1VzZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gZXhpc3RpbmdVc2Vyc1swXSBhcyBQaWNrPFVzZXJJdGVtLCAnaWQnPiAmIHtcbiAgICAgICAgICBvcmc6IFBpY2s8T3JnYW5pemF0aW9uSXRlbSwgJ2lkJz4gfCBudWxsO1xuICAgICAgICAgIHByb2plY3Q6IFBpY2s8UHJvamVjdEl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgeyByb2xlOiBfLCAuLi51c2VyRGF0YVdpdGhvdXRSb2xlIH0gPSBiYXNlVXNlckRhdGE7XG4gICAgICAgIGF3YWl0IHN1ZG9Db250ZXh0LmRiLlVzZXIudXBkYXRlT25lKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogZXhpc3RpbmdVc2VyLmlkIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgLi4udXNlckRhdGFXaXRob3V0Um9sZSxcbiAgICAgICAgICAgIHByb3Zpc2lvbmVkQXQ6IG5vd0lzbyxcbiAgICAgICAgICAgIC4uLihtYXRjaGVkT3JnSWQgJiYgIWV4aXN0aW5nVXNlci5vcmc/LmlkID8geyBvcmc6IHsgY29ubmVjdDogeyBpZDogbWF0Y2hlZE9yZ0lkIH0gfSB9IDoge30pLFxuICAgICAgICAgICAgLi4uKHByb2plY3RUb0Nvbm5lY3QgJiYgIWV4aXN0aW5nVXNlci5wcm9qZWN0Py5pZCA/IHsgcHJvamVjdDogeyBjb25uZWN0OiBwcm9qZWN0VG9Db25uZWN0IH0gfSA6IHt9KVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcXVlcnk6ICdpZCdcbiAgICAgICAgfSBhcyBQYXJhbWV0ZXJzPHR5cGVvZiBzdWRvQ29udGV4dC5kYi5Vc2VyLnVwZGF0ZU9uZT5bMF0gJiB7IHF1ZXJ5OiBzdHJpbmcgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNyZWF0ZWQgPSBhd2FpdCBzdWRvQ29udGV4dC5kYi5Vc2VyLmNyZWF0ZU9uZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAuLi5iYXNlVXNlckRhdGEsXG4gICAgICAgICAgcHJvdmlzaW9uZWRBdDogbm93SXNvLFxuICAgICAgICAgIC4uLihtYXRjaGVkT3JnSWQgPyB7IG9yZzogeyBjb25uZWN0OiB7IGlkOiBtYXRjaGVkT3JnSWQgfSB9IH0gOiB7fSksXG4gICAgICAgICAgLi4uKHByb2plY3RUb0Nvbm5lY3QgPyB7IHByb2plY3Q6IHsgY29ubmVjdDogcHJvamVjdFRvQ29ubmVjdCB9IH0gOiB7fSlcbiAgICAgICAgfSxcbiAgICAgICAgcXVlcnk6ICdpZCdcbiAgICAgIH0gYXMgUGFyYW1ldGVyczx0eXBlb2Ygc3Vkb0NvbnRleHQuZGIuVXNlci5jcmVhdGVPbmU+WzBdICYgeyBxdWVyeTogc3RyaW5nIH0pO1xuXG4gICAgICByZXR1cm4gISFjcmVhdGVkPy5pZDtcbiAgICB9LFxuXG4gICAgYXN5bmMgand0KHsgdG9rZW4sIHVzZXIsIGFjY291bnQsIHByb2ZpbGUgfSkge1xuICAgICAgaWYgKCFhY2NvdW50KSByZXR1cm4gdG9rZW47XG5cbiAgICAgIGNvbnN0IGV4dHJhY3RlZCA9IGV4dHJhY3RVc2VyRGF0YShhY2NvdW50LnByb3ZpZGVyLCB7IHVzZXIsIHByb2ZpbGUgfSkgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgICBjb25zdCBub3JtYWxpemVkRW1haWwgPSB0eXBlb2YgZXh0cmFjdGVkLmVtYWlsID09PSAnc3RyaW5nJyA/IGV4dHJhY3RlZC5lbWFpbC50b0xvd2VyQ2FzZSgpIDogbnVsbDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4udG9rZW4sXG4gICAgICAgIHVzZXJEYXRhOiB7XG4gICAgICAgICAgLi4uZXh0cmFjdGVkLFxuICAgICAgICAgIGVtYWlsOiBub3JtYWxpemVkRW1haWwgPz8gZXh0cmFjdGVkLmVtYWlsID8/IG51bGxcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgYXN5bmMgc2Vzc2lvbih7IHNlc3Npb24sIHRva2VuIH0pIHtcbiAgICAgIHR5cGUgVXNlckRhdGEgPSB7XG4gICAgICAgIGVtYWlsPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgZmlyc3ROYW1lPzogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgbGFzdE5hbWU/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0gKHRva2VuLnVzZXJEYXRhIGFzIFVzZXJEYXRhIHwgdW5kZWZpbmVkKSA/PyB7fTtcblxuICAgICAgY29uc3Qgbm9ybWFsaXplZEVtYWlsID0gdHlwZW9mIHVzZXJEYXRhPy5lbWFpbCA9PT0gJ3N0cmluZycgPyB1c2VyRGF0YS5lbWFpbC50b0xvd2VyQ2FzZSgpIDogbnVsbDtcbiAgICAgIGlmICghbm9ybWFsaXplZEVtYWlsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzZXNzaW9uOiBubyBlbWFpbCBmb3VuZCcpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdWRvQ29udGV4dCA9IChhd2FpdCBnZXRLZXlzdG9uZUNvbnRleHQoKSkuc3VkbygpO1xuXG4gICAgICBjb25zdCBkYlVzZXIgPSAoYXdhaXQgc3Vkb0NvbnRleHQucXVlcnkuVXNlci5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGVtYWlsOiB7IGVxdWFsczogbm9ybWFsaXplZEVtYWlsIH0gfSxcbiAgICAgICAgcXVlcnk6ICdpZCBlbWFpbCBvcmcgeyBpZCB9IHByb2plY3QgeyBpZCB9IHJvbGUgcHJvdmlkZXJBY2NvdW50SWQgaXNBY3RpdmUgc2VlbkF0IGF2YXRhclVybCBkaXNwbGF5TmFtZSdcbiAgICAgIH0pKSBhcyAoUGljazxVc2VySXRlbSwgJ2lkJyB8ICdlbWFpbCcgfCAncm9sZScgfCAncHJvdmlkZXJBY2NvdW50SWQnIHwgJ2lzQWN0aXZlJyB8ICdzZWVuQXQnPiAmIHtcbiAgICAgICAgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgcHJvamVjdDogUGljazxQcm9qZWN0SXRlbSwgJ2lkJz4gfCBudWxsO1xuICAgICAgICBhdmF0YXJVcmw/OiBzdHJpbmcgfCBudWxsO1xuICAgICAgICBkaXNwbGF5TmFtZT86IHN0cmluZyB8IG51bGw7XG4gICAgICB9KVtdO1xuXG4gICAgICBpZiAoIWRiVXNlciB8fCBkYlVzZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQgaW4gZGF0YWJhc2UnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlciA9IGRiVXNlclswXTtcblxuICAgICAgY29uc3QgaXNEZWFjdGl2YXRlZCA9ICF1c2VyLmlzQWN0aXZlO1xuXG4gICAgICBjb25zdCBzZWVuQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICBhd2FpdCBzdWRvQ29udGV4dC5kYi5Vc2VyLnVwZGF0ZU9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB1c2VyLmlkIH0sXG4gICAgICAgIGRhdGE6IHsgc2VlbkF0IH0sXG4gICAgICAgIHF1ZXJ5OiAnaWQnXG4gICAgICB9IGFzIFBhcmFtZXRlcnM8dHlwZW9mIHN1ZG9Db250ZXh0LmRiLlVzZXIudXBkYXRlT25lPlswXSAmIHsgcXVlcnk6IHN0cmluZyB9KTtcblxuICAgICAgY29uc3QgZW1haWxEb21haW4gPSBleHRyYWN0RG9tYWluKHVzZXI/LmVtYWlsID8/IG5vcm1hbGl6ZWRFbWFpbCk7XG4gICAgICBjb25zdCBpc0F1dG9qb2luRG9tYWluQWxsb3dlZCA9ICEhKGVtYWlsRG9tYWluICYmICFmcmVlRW1haWxEb21haW5TZXQuaGFzKGVtYWlsRG9tYWluKSk7XG5cbiAgICAgIC8vIERlZmF1bHQgdG8gVVNFUiBpZiByb2xlIGlzIG5vdCBzZXRcbiAgICAgIGNvbnN0IHVzZXJSb2xlOiBVc2VyUm9sZSA9ICh1c2VyPy5yb2xlIGFzIFVzZXJSb2xlKSB8fCBVc2VyUm9sZS5VU0VSO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5zZXNzaW9uLFxuICAgICAgICBpZDogdXNlcj8uaWQsXG4gICAgICAgIGVtYWlsOiBub3JtYWxpemVkRW1haWwsXG4gICAgICAgIGZpcnN0TmFtZTogdXNlckRhdGE/LmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHVzZXJEYXRhPy5sYXN0TmFtZSxcbiAgICAgICAgYXZhdGFyVXJsOiB1c2VyPy5hdmF0YXJVcmwgfHwgbnVsbCxcbiAgICAgICAgZGlzcGxheU5hbWU6IHVzZXI/LmRpc3BsYXlOYW1lIHx8IG51bGwsXG4gICAgICAgIHByb3ZpZGVyQWNjb3VudElkOiB1c2VyPy5wcm92aWRlckFjY291bnRJZCB8fCBudWxsLFxuICAgICAgICBvcmdJZDogdXNlcj8ub3JnPy5pZCB8fCBudWxsLFxuICAgICAgICBwcm9qZWN0SWQ6IHVzZXI/LnByb2plY3Q/LmlkIHx8IG51bGwsXG4gICAgICAgIHJvbGU6IHVzZXJSb2xlLFxuICAgICAgICBlbWFpbERvbWFpbixcbiAgICAgICAgaXNBdXRvam9pbkRvbWFpbkFsbG93ZWQsXG4gICAgICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlID8/IHRydWVcbiAgICAgIH07XG4gICAgfSxcblxuICAgIGFzeW5jIHJlZGlyZWN0KHsgdXJsLCBiYXNlVXJsIH0pIHtcbiAgICAgIC8vIElmIHRoaXMgaXMgYW4gZXJyb3IgcmVkaXJlY3QsIHdlIGNhbiBtb2RpZnkgaXQgdG8gaW5jbHVkZSBhZGRpdGlvbmFsIHBhcmFtZXRlcnNcbiAgICAgIGlmICh1cmwuaW5jbHVkZXMoJy9hcGkvYXV0aC9lcnJvcicpKSB7XG4gICAgICAgIC8vIFRoZSBlcnJvciBwYWdlIHdpbGwgaGFuZGxlIGRpc3BsYXlpbmcgdGhlIGVtYWlsIGZyb20gdGhlIGVycm9yIGNvbnRleHRcbiAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgIH1cblxuICAgICAgaWYgKCF1cmwuc3RhcnRzV2l0aChlbnYuQVBQX1VSTCkgJiYgIXVybC5zdGFydHNXaXRoKGJhc2VVcmwpKSByZXR1cm4gYmFzZVVybDtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgbmV4dEF1dGhTZXNzaW9uU3RyYXRlZ3k6IFNlc3Npb25TdHJhdGVneTxTZXNzaW9uLCBUeXBlSW5mbzxTZXNzaW9uPj4gPSB7XG4gIGFzeW5jIGdldCh7IGNvbnRleHQgfSkge1xuICAgIGNvbnN0IHsgcmVxLCByZXMgfSA9IGNvbnRleHQ7XG4gICAgY29uc3QgeyBoZWFkZXJzIH0gPSByZXEgPz8ge307XG5cbiAgICBpZiAoIWhlYWRlcnM/LmNvb2tpZSB8fCAhcmVzKSByZXR1cm47XG5cbiAgICBjb25zdCBuZXh0QXV0aFNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uPE5leHRBdXRoT3B0aW9ucywgU2Vzc2lvbj4oXG4gICAgICB7IGhlYWRlcnMsIGNvb2tpZXM6IHBhcnNlQ29va2llcyhoZWFkZXJzLmNvb2tpZSkgfSBhcyBhbnksXG4gICAgICByZXMsXG4gICAgICBuZXh0QXV0aE9wdGlvbnNcbiAgICApO1xuICAgIGlmICghbmV4dEF1dGhTZXNzaW9uKSByZXR1cm47XG5cbiAgICAvLyBTaG91bGQgd2UgdmVyaWZ5IHVzZXIgbGluZSBpbiBleGFtcGxlcz9cbiAgICAvLyBjb25zdCB1c2VyID0gYXdhaXQgY29udGV4dC5zdWRvKCkuZGIuVXNlci5maW5kT25lKHsgd2hlcmU6IHsgZW1haWw6IG5leHRBdXRoU2Vzc2lvbi5lbWFpbCB9IH0pO1xuICAgIC8vIGlmICghdXNlcikgcmV0dXJuO1xuXG4gICAgcmV0dXJuIG5leHRBdXRoU2Vzc2lvbjtcbiAgfSxcblxuICAvLyB3ZSBkb24ndCBuZWVkIHRoZXNlIGFzIG5leHQtYXV0aCBoYW5kbGUgc3RhcnQgYW5kIGVuZCBmb3IgdXNcbiAgYXN5bmMgc3RhcnQoKSB7XG4gICAgLyogZW1wdHkgKi9cbiAgfSxcbiAgYXN5bmMgZW5kKCkge1xuICAgIC8qIGVtcHR5ICovXG4gIH1cbn07XG4iXSwibmFtZXMiOlsicGFyc2UiLCJwYXJzZUNvb2tpZXMiLCJmcmVlRW1haWxEb21haW5zIiwiZ2V0U2VydmVyU2Vzc2lvbiIsImVudiIsImdldEtleXN0b25lQ29udGV4dCIsIlVzZXJSb2xlIiwiZXh0cmFjdFVzZXJEYXRhIiwicHJvdmlkZXJzIiwiZnJlZUVtYWlsRG9tYWluU2V0IiwiU2V0IiwibWFwIiwiZG9tYWluIiwidG9Mb3dlckNhc2UiLCJleHRyYWN0RG9tYWluIiwiZW1haWwiLCJzcGxpdCIsImlzU2VjdXJlQ29va2llcyIsIk5FWFRBVVRIX1VSTCIsInN0YXJ0c1dpdGgiLCJjb29raWVQcmVmaXgiLCJjb29raWVzTWFwcGluZ0NvbmZpZyIsInNlc3Npb25Ub2tlbiIsImNhbGxiYWNrVXJsIiwiY3NyZlRva2VuIiwicGtjZUNvZGVWZXJpZmllciIsInN0YXRlIiwibm9uY2UiLCJjb29raWVzIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJlbnRyaWVzIiwia2V5IiwibmFtZSIsIm9wdGlvbnMiLCJodHRwT25seSIsInNhbWVTaXRlIiwicGF0aCIsInNlY3VyZSIsIkNPT0tJRV9ET01BSU4iLCJuZXh0QXV0aE9wdGlvbnMiLCJzZWNyZXQiLCJTRVNTSU9OX1NFQ1JFVCIsInBhZ2VzIiwiZXJyb3IiLCJjYWxsYmFja3MiLCJzaWduSW4iLCJ1c2VyIiwiYWNjb3VudCIsInByb2ZpbGUiLCJzdWRvQ29udGV4dCIsInN1ZG8iLCJFcnJvciIsInByb3ZpZGVyQWNjb3VudElkIiwicHJvdmlkZXIiLCJub3dJc28iLCJEYXRlIiwidG9JU09TdHJpbmciLCJleHRyYWN0ZWREYXRhIiwiZXhpc3RpbmdVc2VycyIsInF1ZXJ5IiwiVXNlciIsImZpbmRNYW55Iiwid2hlcmUiLCJlcXVhbHMiLCJiYXNlVXNlckRhdGEiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImF2YXRhclNvY2lhbFVybCIsInBpY3R1cmVVcmwiLCJyb2xlIiwiVVNFUiIsInJhd0F1dGgiLCJtYXRjaGVkT3JnSWQiLCJoYXMiLCJvcmdzIiwiT3JnYW5pemF0aW9uIiwibWF0Y2hlZE9yZyIsImZpbmQiLCJjYW5kaWRhdGUiLCJkb21haW5zIiwiQXJyYXkiLCJpc0FycmF5IiwiYXV0b2pvaW5Eb21haW5zIiwidmFsdWUiLCJpbmNsdWRlcyIsImlkIiwicHJvamVjdFRvQ29ubmVjdCIsImNhbmRpZGF0ZVByb2plY3RzIiwiUHJvamVjdCIsIm9yZyIsInRha2UiLCJwcmltYXJ5UHJvamVjdCIsImxlbmd0aCIsImV4aXN0aW5nVXNlciIsIl8iLCJ1c2VyRGF0YVdpdGhvdXRSb2xlIiwiZGIiLCJ1cGRhdGVPbmUiLCJkYXRhIiwicHJvdmlzaW9uZWRBdCIsImNvbm5lY3QiLCJwcm9qZWN0IiwiY3JlYXRlZCIsImNyZWF0ZU9uZSIsImp3dCIsInRva2VuIiwiZXh0cmFjdGVkIiwibm9ybWFsaXplZEVtYWlsIiwidXNlckRhdGEiLCJzZXNzaW9uIiwiZGJVc2VyIiwiaXNEZWFjdGl2YXRlZCIsImlzQWN0aXZlIiwic2VlbkF0IiwiZW1haWxEb21haW4iLCJpc0F1dG9qb2luRG9tYWluQWxsb3dlZCIsInVzZXJSb2xlIiwiYXZhdGFyVXJsIiwiZGlzcGxheU5hbWUiLCJvcmdJZCIsInByb2plY3RJZCIsInJlZGlyZWN0IiwidXJsIiwiYmFzZVVybCIsIkFQUF9VUkwiLCJuZXh0QXV0aFNlc3Npb25TdHJhdGVneSIsImdldCIsImNvbnRleHQiLCJyZXEiLCJyZXMiLCJoZWFkZXJzIiwiY29va2llIiwibmV4dEF1dGhTZXNzaW9uIiwic3RhcnQiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../auth.ts\n");

/***/ }),

/***/ "(api)/../../config/env.ts":
/*!***************************!*\
  !*** ../../config/env.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! dotenv */ \"dotenv\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(dotenv__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var envalid__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! envalid */ \"envalid\");\n/* harmony import */ var envalid__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(envalid__WEBPACK_IMPORTED_MODULE_1__);\n\ndotenv__WEBPACK_IMPORTED_MODULE_0___default().config();\n\nconst DEFAULT_PORT = 3000;\nconst DEFAULT_APP_URL = \"http://localhost:3000\";\nconst DEFAULT_BASE_URL = `http://localhost:${DEFAULT_PORT}`;\nconst DEFAULT_ALLOWED_ORIGINS = [\n    DEFAULT_APP_URL,\n    DEFAULT_BASE_URL\n].join(\",\");\nconst env = (0,envalid__WEBPACK_IMPORTED_MODULE_1__.cleanEnv)(process.env, {\n    NODE_ENV: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)({\n        choices: [\n            \"development\",\n            \"production\"\n        ],\n        default: \"development\"\n    }),\n    DATABASE_URL: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.url)(),\n    /**\n   * The secret used to encrypt session data and magic links using @hapi/iron.\n   * Please use a 32-char or more password.\n   */ SESSION_SECRET: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    APP_URL: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.url)({\n        default: DEFAULT_APP_URL\n    }),\n    BASE_URL: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.url)({\n        default: DEFAULT_BASE_URL\n    }),\n    NEXTAUTH_URL: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.url)(),\n    ALLOWED_ORIGINS: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)({\n        default: DEFAULT_ALLOWED_ORIGINS\n    }),\n    COOKIE_DOMAIN: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)({\n        default: \"localhost\"\n    }),\n    DATABASE_PROVIDER: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)({\n        choices: [\n            \"sqlite\",\n            \"postgresql\",\n            \"mysql\"\n        ],\n        default: \"sqlite\"\n    }),\n    OPENAI_API_KEY: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    OPENAI_MODEL: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)({\n        default: \"gpt-4o-mini\"\n    }),\n    OPENAI_EMBEDDING_MODEL: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)({\n        default: \"text-embedding-3-small\"\n    }),\n    GOOGLE_CLIENT_ID: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    GOOGLE_CLIENT_SECRET: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    CLOUDINARY_CLOUD_NAME: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    CLOUDINARY_API_KEY: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    CLOUDINARY_API_SECRET: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)(),\n    CLOUDINARY_API_FOLDER: (0,envalid__WEBPACK_IMPORTED_MODULE_1__.str)()\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (env);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vY29uZmlnL2Vudi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUE0QjtBQUM1QkEsb0RBQWE7QUFFZ0M7QUFFN0MsTUFBTUssZUFBZTtBQUNyQixNQUFNQyxrQkFBa0I7QUFDeEIsTUFBTUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUVGLGFBQWEsQ0FBQztBQUMzRCxNQUFNRywwQkFBMEI7SUFBQ0Y7SUFBaUJDO0NBQWlCLENBQUNFLElBQUksQ0FBQztBQUV6RSxNQUFNQyxNQUFNUixpREFBUUEsQ0FBQ1MsUUFBUUQsR0FBRyxFQUFFO0lBQ2hDRSxVQUFVVCw0Q0FBR0EsQ0FBQztRQUFFVSxTQUFTO1lBQUM7WUFBZTtTQUFhO1FBQUVDLFNBQVM7SUFBYztJQUMvRUMsY0FBY1gsNENBQUdBO0lBQ2pCOzs7R0FHQyxHQUNEWSxnQkFBZ0JiLDRDQUFHQTtJQUNuQmMsU0FBU2IsNENBQUdBLENBQUM7UUFBRVUsU0FBU1I7SUFBZ0I7SUFDeENZLFVBQVVkLDRDQUFHQSxDQUFDO1FBQUVVLFNBQVNQO0lBQWlCO0lBQzFDWSxjQUFjZiw0Q0FBR0E7SUFDakJnQixpQkFBaUJqQiw0Q0FBR0EsQ0FBQztRQUFFVyxTQUFTTjtJQUF3QjtJQUV4RGEsZUFBZWxCLDRDQUFHQSxDQUFDO1FBQUVXLFNBQVM7SUFBWTtJQUUxQ1EsbUJBQW1CbkIsNENBQUdBLENBQUM7UUFBRVUsU0FBUztZQUFDO1lBQVU7WUFBYztTQUFRO1FBQUVDLFNBQVM7SUFBUztJQUV2RlMsZ0JBQWdCcEIsNENBQUdBO0lBQ25CcUIsY0FBY3JCLDRDQUFHQSxDQUFDO1FBQUVXLFNBQVM7SUFBYztJQUMzQ1csd0JBQXdCdEIsNENBQUdBLENBQUM7UUFBRVcsU0FBUztJQUF5QjtJQUVoRVksa0JBQWtCdkIsNENBQUdBO0lBQ3JCd0Isc0JBQXNCeEIsNENBQUdBO0lBRXpCeUIsdUJBQXVCekIsNENBQUdBO0lBQzFCMEIsb0JBQW9CMUIsNENBQUdBO0lBQ3ZCMkIsdUJBQXVCM0IsNENBQUdBO0lBQzFCNEIsdUJBQXVCNUIsNENBQUdBO0FBQzVCO0FBRUEsaUVBQWVPLEdBQUdBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vY29uZmlnL2Vudi50cz8zOWNmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkb3RlbnYgZnJvbSAnZG90ZW52JztcbmRvdGVudi5jb25maWcoKTtcblxuaW1wb3J0IHsgY2xlYW5FbnYsIHN0ciwgdXJsIH0gZnJvbSAnZW52YWxpZCc7XG5cbmNvbnN0IERFRkFVTFRfUE9SVCA9IDMwMDA7XG5jb25zdCBERUZBVUxUX0FQUF9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbmNvbnN0IERFRkFVTFRfQkFTRV9VUkwgPSBgaHR0cDovL2xvY2FsaG9zdDoke0RFRkFVTFRfUE9SVH1gO1xuY29uc3QgREVGQVVMVF9BTExPV0VEX09SSUdJTlMgPSBbREVGQVVMVF9BUFBfVVJMLCBERUZBVUxUX0JBU0VfVVJMXS5qb2luKCcsJyk7XG5cbmNvbnN0IGVudiA9IGNsZWFuRW52KHByb2Nlc3MuZW52LCB7XG4gIE5PREVfRU5WOiBzdHIoeyBjaG9pY2VzOiBbJ2RldmVsb3BtZW50JywgJ3Byb2R1Y3Rpb24nXSwgZGVmYXVsdDogJ2RldmVsb3BtZW50JyB9KSxcbiAgREFUQUJBU0VfVVJMOiB1cmwoKSxcbiAgLyoqXG4gICAqIFRoZSBzZWNyZXQgdXNlZCB0byBlbmNyeXB0IHNlc3Npb24gZGF0YSBhbmQgbWFnaWMgbGlua3MgdXNpbmcgQGhhcGkvaXJvbi5cbiAgICogUGxlYXNlIHVzZSBhIDMyLWNoYXIgb3IgbW9yZSBwYXNzd29yZC5cbiAgICovXG4gIFNFU1NJT05fU0VDUkVUOiBzdHIoKSxcbiAgQVBQX1VSTDogdXJsKHsgZGVmYXVsdDogREVGQVVMVF9BUFBfVVJMIH0pLFxuICBCQVNFX1VSTDogdXJsKHsgZGVmYXVsdDogREVGQVVMVF9CQVNFX1VSTCB9KSxcbiAgTkVYVEFVVEhfVVJMOiB1cmwoKSwgLy8gbXVzdCBiZSBzZXQgaW4gLmVudiAtIHRoZSBucG0gcGFja2FnZSByZWFkcyBmcm9tIHRoZXJlXG4gIEFMTE9XRURfT1JJR0lOUzogc3RyKHsgZGVmYXVsdDogREVGQVVMVF9BTExPV0VEX09SSUdJTlMgfSksXG5cbiAgQ09PS0lFX0RPTUFJTjogc3RyKHsgZGVmYXVsdDogJ2xvY2FsaG9zdCcgfSksXG5cbiAgREFUQUJBU0VfUFJPVklERVI6IHN0cih7IGNob2ljZXM6IFsnc3FsaXRlJywgJ3Bvc3RncmVzcWwnLCAnbXlzcWwnXSwgZGVmYXVsdDogJ3NxbGl0ZScgfSksXG5cbiAgT1BFTkFJX0FQSV9LRVk6IHN0cigpLFxuICBPUEVOQUlfTU9ERUw6IHN0cih7IGRlZmF1bHQ6ICdncHQtNG8tbWluaScgfSksXG4gIE9QRU5BSV9FTUJFRERJTkdfTU9ERUw6IHN0cih7IGRlZmF1bHQ6ICd0ZXh0LWVtYmVkZGluZy0zLXNtYWxsJyB9KSxcblxuICBHT09HTEVfQ0xJRU5UX0lEOiBzdHIoKSxcbiAgR09PR0xFX0NMSUVOVF9TRUNSRVQ6IHN0cigpLFxuXG4gIENMT1VESU5BUllfQ0xPVURfTkFNRTogc3RyKCksXG4gIENMT1VESU5BUllfQVBJX0tFWTogc3RyKCksXG4gIENMT1VESU5BUllfQVBJX1NFQ1JFVDogc3RyKCksXG4gIENMT1VESU5BUllfQVBJX0ZPTERFUjogc3RyKClcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBlbnY7XG4iXSwibmFtZXMiOlsiZG90ZW52IiwiY29uZmlnIiwiY2xlYW5FbnYiLCJzdHIiLCJ1cmwiLCJERUZBVUxUX1BPUlQiLCJERUZBVUxUX0FQUF9VUkwiLCJERUZBVUxUX0JBU0VfVVJMIiwiREVGQVVMVF9BTExPV0VEX09SSUdJTlMiLCJqb2luIiwiZW52IiwicHJvY2VzcyIsIk5PREVfRU5WIiwiY2hvaWNlcyIsImRlZmF1bHQiLCJEQVRBQkFTRV9VUkwiLCJTRVNTSU9OX1NFQ1JFVCIsIkFQUF9VUkwiLCJCQVNFX1VSTCIsIk5FWFRBVVRIX1VSTCIsIkFMTE9XRURfT1JJR0lOUyIsIkNPT0tJRV9ET01BSU4iLCJEQVRBQkFTRV9QUk9WSURFUiIsIk9QRU5BSV9BUElfS0VZIiwiT1BFTkFJX01PREVMIiwiT1BFTkFJX0VNQkVERElOR19NT0RFTCIsIkdPT0dMRV9DTElFTlRfSUQiLCJHT09HTEVfQ0xJRU5UX1NFQ1JFVCIsIkNMT1VESU5BUllfQ0xPVURfTkFNRSIsIkNMT1VESU5BUllfQVBJX0tFWSIsIkNMT1VESU5BUllfQVBJX1NFQ1JFVCIsIkNMT1VESU5BUllfQVBJX0ZPTERFUiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../config/env.ts\n");

/***/ }),

/***/ "(api)/../../context/keystoneContext.ts":
/*!****************************************!*\
  !*** ../../context/keystoneContext.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getKeystoneContext: () => (/* binding */ getKeystoneContext)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core_context__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core/context */ \"@keystone-6/core/context\");\n/* harmony import */ var _keystone_6_core_context__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_context__WEBPACK_IMPORTED_MODULE_0__);\n\nlet _keystoneContext = globalThis._keystoneContext;\nconst getKeystoneContext = async ()=>{\n    _keystoneContext = _keystoneContext || (0,_keystone_6_core_context__WEBPACK_IMPORTED_MODULE_0__.getContext)((await __webpack_require__.e(/*! import() */ \"_api_keystone_ts\").then(__webpack_require__.bind(__webpack_require__, /*! ../keystone */ \"(api)/../../keystone.ts\"))).default, await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! @prisma/client */ \"@prisma/client\", 23)));\n    if (true) {\n        globalThis._keystoneContext = _keystoneContext;\n    }\n    return _keystoneContext;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vY29udGV4dC9rZXlzdG9uZUNvbnRleHQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXNEO0FBR3RELElBQUlDLG1CQUE0QixXQUFvQkEsZ0JBQWdCO0FBQzdELE1BQU1FLHFCQUFxQjtJQUNoQ0YsbUJBQ0VBLG9CQUFvQkQsb0VBQVVBLENBQUMsQ0FBQyxNQUFNLDJKQUFvQixFQUFHSSxPQUFPLEVBQUUsTUFBTSxrSUFBTztJQUNyRixJQUFJQyxJQUF5QixFQUFjO1FBQ3hDSCxXQUFtQkQsZ0JBQWdCLEdBQUdBO0lBQ3pDO0lBQ0EsT0FBT0E7QUFDVCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL2NvbnRleHQva2V5c3RvbmVDb250ZXh0LnRzPzk1ZmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0Q29udGV4dCB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUvY29udGV4dCc7XG5pbXBvcnQgeyBDb250ZXh0IH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcblxubGV0IF9rZXlzdG9uZUNvbnRleHQ6IENvbnRleHQgPSAoZ2xvYmFsVGhpcyBhcyBhbnkpLl9rZXlzdG9uZUNvbnRleHQ7XG5leHBvcnQgY29uc3QgZ2V0S2V5c3RvbmVDb250ZXh0ID0gYXN5bmMgKCkgPT4ge1xuICBfa2V5c3RvbmVDb250ZXh0ID1cbiAgICBfa2V5c3RvbmVDb250ZXh0IHx8IGdldENvbnRleHQoKGF3YWl0IGltcG9ydCgnLi4va2V5c3RvbmUnKSkuZGVmYXVsdCwgYXdhaXQgaW1wb3J0KCdAcHJpc21hL2NsaWVudCcpKTtcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAoZ2xvYmFsVGhpcyBhcyBhbnkpLl9rZXlzdG9uZUNvbnRleHQgPSBfa2V5c3RvbmVDb250ZXh0O1xuICB9XG4gIHJldHVybiBfa2V5c3RvbmVDb250ZXh0O1xufTtcbiJdLCJuYW1lcyI6WyJnZXRDb250ZXh0IiwiX2tleXN0b25lQ29udGV4dCIsImdsb2JhbFRoaXMiLCJnZXRLZXlzdG9uZUNvbnRleHQiLCJkZWZhdWx0IiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../context/keystoneContext.ts\n");

/***/ }),

/***/ "(api)/../../domains/auth/google.ts":
/*!************************************!*\
  !*** ../../domains/auth/google.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getInformationFromProfile: () => (/* binding */ getInformationFromProfile)\n/* harmony export */ });\nconst getInformationFromProfile = ({ profile })=>({\n        email: profile.email,\n        firstName: profile.given_name,\n        lastName: profile.family_name,\n        pictureUrl: profile.picture\n    });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hdXRoL2dvb2dsZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBRU8sTUFBTUEsNEJBQTRCLENBQUMsRUFBRUMsT0FBTyxFQUE4QixHQUFNO1FBQ3JGQyxPQUFPRCxRQUFRQyxLQUFLO1FBQ3BCQyxXQUFXRixRQUFRRyxVQUFVO1FBQzdCQyxVQUFVSixRQUFRSyxXQUFXO1FBQzdCQyxZQUFZTixRQUFRTyxPQUFPO0lBQzdCLEdBQUciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vZG9tYWlucy9hdXRoL2dvb2dsZS50cz82ZGFhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZVByb2ZpbGUgfSBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2dvb2dsZSc7XG5cbmV4cG9ydCBjb25zdCBnZXRJbmZvcm1hdGlvbkZyb21Qcm9maWxlID0gKHsgcHJvZmlsZSB9OiB7IHByb2ZpbGU6IEdvb2dsZVByb2ZpbGUgfSkgPT4gKHtcbiAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gIGZpcnN0TmFtZTogcHJvZmlsZS5naXZlbl9uYW1lLFxuICBsYXN0TmFtZTogcHJvZmlsZS5mYW1pbHlfbmFtZSxcbiAgcGljdHVyZVVybDogcHJvZmlsZS5waWN0dXJlXG59KTtcbiJdLCJuYW1lcyI6WyJnZXRJbmZvcm1hdGlvbkZyb21Qcm9maWxlIiwicHJvZmlsZSIsImVtYWlsIiwiZmlyc3ROYW1lIiwiZ2l2ZW5fbmFtZSIsImxhc3ROYW1lIiwiZmFtaWx5X25hbWUiLCJwaWN0dXJlVXJsIiwicGljdHVyZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../domains/auth/google.ts\n");

/***/ }),

/***/ "(api)/../../domains/auth/userRole.ts":
/*!**************************************!*\
  !*** ../../domains/auth/userRole.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UserRole: () => (/* binding */ UserRole),\n/* harmony export */   canEditOrgData: () => (/* binding */ canEditOrgData),\n/* harmony export */   canEditProjectData: () => (/* binding */ canEditProjectData),\n/* harmony export */   canEditUserByRole: () => (/* binding */ canEditUserByRole),\n/* harmony export */   filterByUserOrg: () => (/* binding */ filterByUserOrg),\n/* harmony export */   filterByUserProject: () => (/* binding */ filterByUserProject),\n/* harmony export */   filterPoliciesByUserProject: () => (/* binding */ filterPoliciesByUserProject),\n/* harmony export */   filterTimeTypesByUserProject: () => (/* binding */ filterTimeTypesByUserProject),\n/* harmony export */   hasRole: () => (/* binding */ hasRole),\n/* harmony export */   isAnyAdmin: () => (/* binding */ isAnyAdmin),\n/* harmony export */   isAuthenticated: () => (/* binding */ isAuthenticated),\n/* harmony export */   isGod: () => (/* binding */ isGod),\n/* harmony export */   isOrgAdmin: () => (/* binding */ isOrgAdmin),\n/* harmony export */   isOrgAdminOrAbove: () => (/* binding */ isOrgAdminOrAbove),\n/* harmony export */   isOrgScoped: () => (/* binding */ isOrgScoped),\n/* harmony export */   isProjectAdmin: () => (/* binding */ isProjectAdmin),\n/* harmony export */   isSelf: () => (/* binding */ isSelf),\n/* harmony export */   roleHierarchy: () => (/* binding */ roleHierarchy)\n/* harmony export */ });\nvar UserRole;\n(function(UserRole) {\n    UserRole[\"USER\"] = \"USER\";\n    UserRole[\"PROJECT_ADMIN\"] = \"PROJECT_ADMIN\";\n    UserRole[\"ORG_ADMIN\"] = \"ORG_ADMIN\";\n    UserRole[\"ORG_OWNER\"] = \"ORG_OWNER\";\n    UserRole[\"GOD\"] = \"GOD\";\n})(UserRole || (UserRole = {}));\nconst roleHierarchy = {\n    [\"USER\"]: 0,\n    [\"PROJECT_ADMIN\"]: 1,\n    [\"ORG_ADMIN\"]: 2,\n    [\"ORG_OWNER\"]: 3,\n    [\"GOD\"]: 4\n};\nconst isAuthenticated = ({ session })=>!!session?.email;\nconst hasRole = (roles)=>({ session })=>{\n        if (!session?.role) return false;\n        return roles.includes(session?.role);\n    };\n// Semantic helper functions for common role checks\nconst isGod = hasRole([\n    \"GOD\"\n]);\nconst isOrgAdmin = hasRole([\n    \"ORG_ADMIN\",\n    \"ORG_OWNER\"\n]);\nconst isProjectAdmin = hasRole([\n    \"PROJECT_ADMIN\"\n]);\nconst isOrgAdminOrAbove = hasRole([\n    \"GOD\",\n    \"ORG_ADMIN\",\n    \"ORG_OWNER\"\n]);\nconst isAnyAdmin = hasRole([\n    \"GOD\",\n    \"ORG_ADMIN\",\n    \"ORG_OWNER\",\n    \"PROJECT_ADMIN\"\n]);\nconst isOrgScoped = async ({ session })=>{\n    if (isGod({\n        session\n    })) return true;\n    if (!session?.orgId) return false;\n    return {\n        org: {\n            id: {\n                equals: session.orgId\n            }\n        }\n    };\n};\nconst isSelf = async ({ session })=>{\n    if (!session?.id) return false;\n    return {\n        id: {\n            equals: session.id\n        }\n    };\n};\nconst canEditOrgData = ({ session })=>isGod({\n        session\n    }) || isOrgAdmin({\n        session\n    });\nconst canEditProjectData = ({ session })=>isGod({\n        session\n    }) || isOrgAdmin({\n        session\n    }) || isProjectAdmin({\n        session\n    });\nconst filterByUserProject = async ({ session })=>{\n    if (!session?.projectId) return false;\n    return {\n        project: {\n            id: {\n                equals: session.projectId\n            }\n        }\n    };\n};\nconst filterByUserOrg = async ({ session })=>{\n    if (!session?.orgId) return false;\n    return {\n        org: {\n            id: {\n                equals: session.orgId\n            }\n        }\n    };\n};\nconst filterTimeTypesByUserProject = async ({ session })=>{\n    if (!session?.orgId || !session?.projectId) return false;\n    return {\n        org: {\n            id: {\n                equals: session.orgId\n            }\n        },\n        timePolicies: {\n            some: {\n                projects: {\n                    some: {\n                        id: {\n                            equals: session.projectId\n                        }\n                    }\n                }\n            }\n        }\n    };\n};\nconst filterPoliciesByUserProject = async ({ session })=>{\n    if (!session?.orgId || !session?.projectId) return false;\n    return {\n        org: {\n            id: {\n                equals: session.orgId\n            }\n        },\n        projects: {\n            some: {\n                id: {\n                    equals: session.projectId\n                }\n            }\n        }\n    };\n};\n/**\n * Check if a user can edit another user based on role hierarchy\n * - PROJECT_ADMIN can only edit USER or PROJECT_ADMIN\n * - ORG_ADMIN can only edit USER, PROJECT_ADMIN, ORG_ADMIN\n * - ORG_OWNER can only edit USER, PROJECT_ADMIN, ORG_ADMIN, ORG_OWNER\n * - GOD can edit anyone\n */ const canEditUserByRole = (editorRole, targetRole)=>{\n    if (!editorRole || !targetRole) return false;\n    // GOD can edit anyone\n    if (editorRole === \"GOD\") return true;\n    const editorLevel = roleHierarchy[editorRole] ?? -1;\n    const targetLevel = roleHierarchy[targetRole] ?? Number.MAX_SAFE_INTEGER;\n    // Editor can only edit users with equal or lower role level\n    return targetLevel <= editorLevel;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hdXRoL3VzZXJSb2xlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7VUFHWUE7Ozs7OztHQUFBQSxhQUFBQTtBQVFMLE1BQU1DLGdCQUEwQztJQUNyRCxRQUFlLEVBQUU7SUFDakIsaUJBQXdCLEVBQUU7SUFDMUIsYUFBb0IsRUFBRTtJQUN0QixhQUFvQixFQUFFO0lBQ3RCLE9BQWMsRUFBRTtBQUNsQixFQUFFO0FBS0ssTUFBTUMsa0JBQWtCLENBQUMsRUFBRUMsT0FBTyxFQUF3QixHQUFLLENBQUMsQ0FBQ0EsU0FBU0MsTUFBTTtBQUVoRixNQUFNQyxVQUNYLENBQUNDLFFBQ0QsQ0FBQyxFQUFFSCxPQUFPLEVBQXdCO1FBQ2hDLElBQUksQ0FBQ0EsU0FBU0ksTUFBTSxPQUFPO1FBQzNCLE9BQU9ELE1BQU1FLFFBQVEsQ0FBQ0wsU0FBU0k7SUFDakMsRUFBRTtBQUVKLG1EQUFtRDtBQUM1QyxNQUFNRSxRQUFRSixRQUFROztDQUFjLEVBQUU7QUFDdEMsTUFBTUssYUFBYUwsUUFBUTs7O0NBQXdDLEVBQUU7QUFDckUsTUFBTU0saUJBQWlCTixRQUFROztDQUF3QixFQUFFO0FBQ3pELE1BQU1PLG9CQUFvQlAsUUFBUTs7OztDQUFzRCxFQUFFO0FBQzFGLE1BQU1RLGFBQWFSLFFBQVE7Ozs7O0NBQThFLEVBQUU7QUFFM0csTUFBTVMsY0FBYyxPQUFPLEVBQUVYLE9BQU8sRUFBa0I7SUFDM0QsSUFBSU0sTUFBTTtRQUFFTjtJQUFRLElBQUksT0FBTztJQUMvQixJQUFJLENBQUNBLFNBQVNZLE9BQU8sT0FBTztJQUM1QixPQUFPO1FBQUVDLEtBQUs7WUFBRUMsSUFBSTtnQkFBRUMsUUFBUWYsUUFBUVksS0FBSztZQUFDO1FBQUU7SUFBRTtBQUNsRCxFQUFFO0FBRUssTUFBTUksU0FBUyxPQUFPLEVBQUVoQixPQUFPLEVBQXdCO0lBQzVELElBQUksQ0FBQ0EsU0FBU2MsSUFBSSxPQUFPO0lBQ3pCLE9BQU87UUFBRUEsSUFBSTtZQUFFQyxRQUFRZixRQUFRYyxFQUFFO1FBQUM7SUFBRTtBQUN0QyxFQUFFO0FBRUssTUFBTUcsaUJBQWlCLENBQUMsRUFBRWpCLE9BQU8sRUFBd0IsR0FBS00sTUFBTTtRQUFFTjtJQUFRLE1BQU1PLFdBQVc7UUFBRVA7SUFBUSxHQUFHO0FBRTVHLE1BQU1rQixxQkFBcUIsQ0FBQyxFQUFFbEIsT0FBTyxFQUF3QixHQUNsRU0sTUFBTTtRQUFFTjtJQUFRLE1BQU1PLFdBQVc7UUFBRVA7SUFBUSxNQUFNUSxlQUFlO1FBQUVSO0lBQVEsR0FBRztBQUV4RSxNQUFNbUIsc0JBQXNCLE9BQU8sRUFBRW5CLE9BQU8sRUFBa0I7SUFDbkUsSUFBSSxDQUFDQSxTQUFTb0IsV0FBVyxPQUFPO0lBQ2hDLE9BQU87UUFBRUMsU0FBUztZQUFFUCxJQUFJO2dCQUFFQyxRQUFRZixRQUFRb0IsU0FBUztZQUFDO1FBQUU7SUFBRTtBQUMxRCxFQUFFO0FBRUssTUFBTUUsa0JBQWtCLE9BQU8sRUFBRXRCLE9BQU8sRUFBa0I7SUFDL0QsSUFBSSxDQUFDQSxTQUFTWSxPQUFPLE9BQU87SUFDNUIsT0FBTztRQUFFQyxLQUFLO1lBQUVDLElBQUk7Z0JBQUVDLFFBQVFmLFFBQVFZLEtBQUs7WUFBQztRQUFFO0lBQUU7QUFDbEQsRUFBRTtBQUVLLE1BQU1XLCtCQUErQixPQUFPLEVBQUV2QixPQUFPLEVBQWtCO0lBQzVFLElBQUksQ0FBQ0EsU0FBU1ksU0FBUyxDQUFDWixTQUFTb0IsV0FBVyxPQUFPO0lBQ25ELE9BQU87UUFDTFAsS0FBSztZQUFFQyxJQUFJO2dCQUFFQyxRQUFRZixRQUFRWSxLQUFLO1lBQUM7UUFBRTtRQUNyQ1ksY0FBYztZQUNaQyxNQUFNO2dCQUNKQyxVQUFVO29CQUNSRCxNQUFNO3dCQUNKWCxJQUFJOzRCQUFFQyxRQUFRZixRQUFRb0IsU0FBUzt3QkFBQztvQkFDbEM7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRixFQUFFO0FBRUssTUFBTU8sOEJBQThCLE9BQU8sRUFBRTNCLE9BQU8sRUFBa0I7SUFDM0UsSUFBSSxDQUFDQSxTQUFTWSxTQUFTLENBQUNaLFNBQVNvQixXQUFXLE9BQU87SUFDbkQsT0FBTztRQUNMUCxLQUFLO1lBQUVDLElBQUk7Z0JBQUVDLFFBQVFmLFFBQVFZLEtBQUs7WUFBQztRQUFFO1FBQ3JDYyxVQUFVO1lBQ1JELE1BQU07Z0JBQ0pYLElBQUk7b0JBQUVDLFFBQVFmLFFBQVFvQixTQUFTO2dCQUFDO1lBQ2xDO1FBQ0Y7SUFDRjtBQUNGLEVBQUU7QUFFRjs7Ozs7O0NBTUMsR0FDTSxNQUFNUSxvQkFBb0IsQ0FDL0JDLFlBQ0FDO0lBRUEsSUFBSSxDQUFDRCxjQUFjLENBQUNDLFlBQVksT0FBTztJQUV2QyxzQkFBc0I7SUFDdEIsSUFBSUQsc0JBQTZCLE9BQU87SUFFeEMsTUFBTUUsY0FBY2pDLGFBQWEsQ0FBQytCLFdBQVcsSUFBSSxDQUFDO0lBQ2xELE1BQU1HLGNBQWNsQyxhQUFhLENBQUNnQyxXQUFXLElBQUlHLE9BQU9DLGdCQUFnQjtJQUV4RSw0REFBNEQ7SUFDNUQsT0FBT0YsZUFBZUQ7QUFDeEIsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9kb21haW5zL2F1dGgvdXNlclJvbGUudHM/OTg3MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnLi4vLi4vYXV0aCc7XG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi4vLi4vdHlwZXMvVXNlcic7XG5cbmV4cG9ydCBlbnVtIFVzZXJSb2xlIHtcbiAgVVNFUiA9ICdVU0VSJyxcbiAgUFJPSkVDVF9BRE1JTiA9ICdQUk9KRUNUX0FETUlOJyxcbiAgT1JHX0FETUlOID0gJ09SR19BRE1JTicsXG4gIE9SR19PV05FUiA9ICdPUkdfT1dORVInLFxuICBHT0QgPSAnR09EJ1xufVxuXG5leHBvcnQgY29uc3Qgcm9sZUhpZXJhcmNoeTogUmVjb3JkPFVzZXJSb2xlLCBudW1iZXI+ID0ge1xuICBbVXNlclJvbGUuVVNFUl06IDAsXG4gIFtVc2VyUm9sZS5QUk9KRUNUX0FETUlOXTogMSxcbiAgW1VzZXJSb2xlLk9SR19BRE1JTl06IDIsXG4gIFtVc2VyUm9sZS5PUkdfT1dORVJdOiAzLFxuICBbVXNlclJvbGUuR09EXTogNFxufTtcblxudHlwZSBTZXNzaW9uT3JVc2VyQ29udGV4dCA9IHsgc2Vzc2lvbj86IFNlc3Npb24gfCBVc2VyIHwgbnVsbCB9O1xudHlwZSBTZXNzaW9uQ29udGV4dCA9IHsgc2Vzc2lvbj86IFNlc3Npb24gfCBudWxsIH07XG5cbmV4cG9ydCBjb25zdCBpc0F1dGhlbnRpY2F0ZWQgPSAoeyBzZXNzaW9uIH06IFNlc3Npb25PclVzZXJDb250ZXh0KSA9PiAhIXNlc3Npb24/LmVtYWlsO1xuXG5leHBvcnQgY29uc3QgaGFzUm9sZSA9XG4gIChyb2xlczogVXNlclJvbGVbXSkgPT5cbiAgKHsgc2Vzc2lvbiB9OiBTZXNzaW9uT3JVc2VyQ29udGV4dCkgPT4ge1xuICAgIGlmICghc2Vzc2lvbj8ucm9sZSkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiByb2xlcy5pbmNsdWRlcyhzZXNzaW9uPy5yb2xlKTtcbiAgfTtcblxuLy8gU2VtYW50aWMgaGVscGVyIGZ1bmN0aW9ucyBmb3IgY29tbW9uIHJvbGUgY2hlY2tzXG5leHBvcnQgY29uc3QgaXNHb2QgPSBoYXNSb2xlKFtVc2VyUm9sZS5HT0RdKTtcbmV4cG9ydCBjb25zdCBpc09yZ0FkbWluID0gaGFzUm9sZShbVXNlclJvbGUuT1JHX0FETUlOLCBVc2VyUm9sZS5PUkdfT1dORVJdKTtcbmV4cG9ydCBjb25zdCBpc1Byb2plY3RBZG1pbiA9IGhhc1JvbGUoW1VzZXJSb2xlLlBST0pFQ1RfQURNSU5dKTtcbmV4cG9ydCBjb25zdCBpc09yZ0FkbWluT3JBYm92ZSA9IGhhc1JvbGUoW1VzZXJSb2xlLkdPRCwgVXNlclJvbGUuT1JHX0FETUlOLCBVc2VyUm9sZS5PUkdfT1dORVJdKTtcbmV4cG9ydCBjb25zdCBpc0FueUFkbWluID0gaGFzUm9sZShbVXNlclJvbGUuR09ELCBVc2VyUm9sZS5PUkdfQURNSU4sIFVzZXJSb2xlLk9SR19PV05FUiwgVXNlclJvbGUuUFJPSkVDVF9BRE1JTl0pO1xuXG5leHBvcnQgY29uc3QgaXNPcmdTY29wZWQgPSBhc3luYyAoeyBzZXNzaW9uIH06IFNlc3Npb25Db250ZXh0KSA9PiB7XG4gIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB0cnVlO1xuICBpZiAoIXNlc3Npb24/Lm9yZ0lkKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiB7IG9yZzogeyBpZDogeyBlcXVhbHM6IHNlc3Npb24ub3JnSWQgfSB9IH07XG59O1xuXG5leHBvcnQgY29uc3QgaXNTZWxmID0gYXN5bmMgKHsgc2Vzc2lvbiB9OiBTZXNzaW9uT3JVc2VyQ29udGV4dCkgPT4ge1xuICBpZiAoIXNlc3Npb24/LmlkKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiB7IGlkOiB7IGVxdWFsczogc2Vzc2lvbi5pZCB9IH07XG59O1xuXG5leHBvcnQgY29uc3QgY2FuRWRpdE9yZ0RhdGEgPSAoeyBzZXNzaW9uIH06IFNlc3Npb25PclVzZXJDb250ZXh0KSA9PiBpc0dvZCh7IHNlc3Npb24gfSkgfHwgaXNPcmdBZG1pbih7IHNlc3Npb24gfSk7XG5cbmV4cG9ydCBjb25zdCBjYW5FZGl0UHJvamVjdERhdGEgPSAoeyBzZXNzaW9uIH06IFNlc3Npb25PclVzZXJDb250ZXh0KSA9PlxuICBpc0dvZCh7IHNlc3Npb24gfSkgfHwgaXNPcmdBZG1pbih7IHNlc3Npb24gfSkgfHwgaXNQcm9qZWN0QWRtaW4oeyBzZXNzaW9uIH0pO1xuXG5leHBvcnQgY29uc3QgZmlsdGVyQnlVc2VyUHJvamVjdCA9IGFzeW5jICh7IHNlc3Npb24gfTogU2Vzc2lvbkNvbnRleHQpID0+IHtcbiAgaWYgKCFzZXNzaW9uPy5wcm9qZWN0SWQpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIHsgcHJvamVjdDogeyBpZDogeyBlcXVhbHM6IHNlc3Npb24ucHJvamVjdElkIH0gfSB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGZpbHRlckJ5VXNlck9yZyA9IGFzeW5jICh7IHNlc3Npb24gfTogU2Vzc2lvbkNvbnRleHQpID0+IHtcbiAgaWYgKCFzZXNzaW9uPy5vcmdJZCkgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4geyBvcmc6IHsgaWQ6IHsgZXF1YWxzOiBzZXNzaW9uLm9yZ0lkIH0gfSB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGZpbHRlclRpbWVUeXBlc0J5VXNlclByb2plY3QgPSBhc3luYyAoeyBzZXNzaW9uIH06IFNlc3Npb25Db250ZXh0KSA9PiB7XG4gIGlmICghc2Vzc2lvbj8ub3JnSWQgfHwgIXNlc3Npb24/LnByb2plY3RJZCkgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4ge1xuICAgIG9yZzogeyBpZDogeyBlcXVhbHM6IHNlc3Npb24ub3JnSWQgfSB9LFxuICAgIHRpbWVQb2xpY2llczoge1xuICAgICAgc29tZToge1xuICAgICAgICBwcm9qZWN0czoge1xuICAgICAgICAgIHNvbWU6IHtcbiAgICAgICAgICAgIGlkOiB7IGVxdWFsczogc2Vzc2lvbi5wcm9qZWN0SWQgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBmaWx0ZXJQb2xpY2llc0J5VXNlclByb2plY3QgPSBhc3luYyAoeyBzZXNzaW9uIH06IFNlc3Npb25Db250ZXh0KSA9PiB7XG4gIGlmICghc2Vzc2lvbj8ub3JnSWQgfHwgIXNlc3Npb24/LnByb2plY3RJZCkgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4ge1xuICAgIG9yZzogeyBpZDogeyBlcXVhbHM6IHNlc3Npb24ub3JnSWQgfSB9LFxuICAgIHByb2plY3RzOiB7XG4gICAgICBzb21lOiB7XG4gICAgICAgIGlkOiB7IGVxdWFsczogc2Vzc2lvbi5wcm9qZWN0SWQgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbn07XG5cbi8qKlxuICogQ2hlY2sgaWYgYSB1c2VyIGNhbiBlZGl0IGFub3RoZXIgdXNlciBiYXNlZCBvbiByb2xlIGhpZXJhcmNoeVxuICogLSBQUk9KRUNUX0FETUlOIGNhbiBvbmx5IGVkaXQgVVNFUiBvciBQUk9KRUNUX0FETUlOXG4gKiAtIE9SR19BRE1JTiBjYW4gb25seSBlZGl0IFVTRVIsIFBST0pFQ1RfQURNSU4sIE9SR19BRE1JTlxuICogLSBPUkdfT1dORVIgY2FuIG9ubHkgZWRpdCBVU0VSLCBQUk9KRUNUX0FETUlOLCBPUkdfQURNSU4sIE9SR19PV05FUlxuICogLSBHT0QgY2FuIGVkaXQgYW55b25lXG4gKi9cbmV4cG9ydCBjb25zdCBjYW5FZGl0VXNlckJ5Um9sZSA9IChcbiAgZWRpdG9yUm9sZTogVXNlclJvbGUgfCBudWxsIHwgdW5kZWZpbmVkLFxuICB0YXJnZXRSb2xlOiBVc2VyUm9sZSB8IG51bGwgfCB1bmRlZmluZWRcbik6IGJvb2xlYW4gPT4ge1xuICBpZiAoIWVkaXRvclJvbGUgfHwgIXRhcmdldFJvbGUpIHJldHVybiBmYWxzZTtcblxuICAvLyBHT0QgY2FuIGVkaXQgYW55b25lXG4gIGlmIChlZGl0b3JSb2xlID09PSBVc2VyUm9sZS5HT0QpIHJldHVybiB0cnVlO1xuXG4gIGNvbnN0IGVkaXRvckxldmVsID0gcm9sZUhpZXJhcmNoeVtlZGl0b3JSb2xlXSA/PyAtMTtcbiAgY29uc3QgdGFyZ2V0TGV2ZWwgPSByb2xlSGllcmFyY2h5W3RhcmdldFJvbGVdID8/IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSO1xuXG4gIC8vIEVkaXRvciBjYW4gb25seSBlZGl0IHVzZXJzIHdpdGggZXF1YWwgb3IgbG93ZXIgcm9sZSBsZXZlbFxuICByZXR1cm4gdGFyZ2V0TGV2ZWwgPD0gZWRpdG9yTGV2ZWw7XG59O1xuIl0sIm5hbWVzIjpbIlVzZXJSb2xlIiwicm9sZUhpZXJhcmNoeSIsImlzQXV0aGVudGljYXRlZCIsInNlc3Npb24iLCJlbWFpbCIsImhhc1JvbGUiLCJyb2xlcyIsInJvbGUiLCJpbmNsdWRlcyIsImlzR29kIiwiaXNPcmdBZG1pbiIsImlzUHJvamVjdEFkbWluIiwiaXNPcmdBZG1pbk9yQWJvdmUiLCJpc0FueUFkbWluIiwiaXNPcmdTY29wZWQiLCJvcmdJZCIsIm9yZyIsImlkIiwiZXF1YWxzIiwiaXNTZWxmIiwiY2FuRWRpdE9yZ0RhdGEiLCJjYW5FZGl0UHJvamVjdERhdGEiLCJmaWx0ZXJCeVVzZXJQcm9qZWN0IiwicHJvamVjdElkIiwicHJvamVjdCIsImZpbHRlckJ5VXNlck9yZyIsImZpbHRlclRpbWVUeXBlc0J5VXNlclByb2plY3QiLCJ0aW1lUG9saWNpZXMiLCJzb21lIiwicHJvamVjdHMiLCJmaWx0ZXJQb2xpY2llc0J5VXNlclByb2plY3QiLCJjYW5FZGl0VXNlckJ5Um9sZSIsImVkaXRvclJvbGUiLCJ0YXJnZXRSb2xlIiwiZWRpdG9yTGV2ZWwiLCJ0YXJnZXRMZXZlbCIsIk51bWJlciIsIk1BWF9TQUZFX0lOVEVHRVIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../domains/auth/userRole.ts\n");

/***/ }),

/***/ "(api)/../../lib/auth/extractUserData.ts":
/*!*****************************************!*\
  !*** ../../lib/auth/extractUserData.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var lodash_pick__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash/pick */ \"lodash/pick\");\n/* harmony import */ var lodash_pick__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash_pick__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _domains_auth_google__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../domains/auth/google */ \"(api)/../../domains/auth/google.ts\");\n\n\nconst extractUserData = (provider, { user, profile })=>{\n    const handler = {\n        google: ()=>(0,_domains_auth_google__WEBPACK_IMPORTED_MODULE_1__.getInformationFromProfile)({\n                profile: profile\n            }),\n        credentials: ()=>lodash_pick__WEBPACK_IMPORTED_MODULE_0___default()(user, [\n                \"email\",\n                \"firstName\",\n                \"lastName\"\n            ])\n    }[provider];\n    if (!handler) throw new Error(`Unknown provider: ${provider}`);\n    const userData = handler();\n    return {\n        ...userData\n    };\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (extractUserData);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vbGliL2F1dGgvZXh0cmFjdFVzZXJEYXRhLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBOEI7QUFLd0M7QUFFdEUsTUFBTUUsa0JBQWtCLENBQUNDLFVBQTBCLEVBQUVDLElBQUksRUFBRUMsT0FBTyxFQUE2QztJQUM3RyxNQUFNQyxVQUFVO1FBQ2RDLFFBQVEsSUFBTU4sK0VBQXlCQSxDQUFDO2dCQUFFSSxTQUFTQTtZQUF5QjtRQUM1RUcsYUFBYSxJQUFNUixrREFBSUEsQ0FBQ0ksTUFBTTtnQkFBQztnQkFBUztnQkFBYTthQUFXO0lBQ2xFLENBQUMsQ0FBQ0QsU0FBUztJQUVYLElBQUksQ0FBQ0csU0FBUyxNQUFNLElBQUlHLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRU4sU0FBUyxDQUFDO0lBRTdELE1BQU1PLFdBQVdKO0lBQ2pCLE9BQU87UUFBRSxHQUFHSSxRQUFRO0lBQUM7QUFDdkI7QUFFQSxpRUFBZVIsZUFBZUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9saWIvYXV0aC9leHRyYWN0VXNlckRhdGEudHM/N2UyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwaWNrIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IERlZmF1bHRVc2VyLCBQcm9maWxlIH0gZnJvbSAnbmV4dC1hdXRoJztcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycyc7XG5pbXBvcnQgeyBHb29nbGVQcm9maWxlIH0gZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycy9nb29nbGUnO1xuaW1wb3J0IHsgU2Vzc2lvbiB9IGZyb20gJy4uLy4uL2F1dGgnO1xuaW1wb3J0IHsgZ2V0SW5mb3JtYXRpb25Gcm9tUHJvZmlsZSB9IGZyb20gJy4uLy4uL2RvbWFpbnMvYXV0aC9nb29nbGUnO1xuXG5jb25zdCBleHRyYWN0VXNlckRhdGEgPSAocHJvdmlkZXI6IFByb3ZpZGVyWydpZCddLCB7IHVzZXIsIHByb2ZpbGUgfTogeyB1c2VyPzogRGVmYXVsdFVzZXI7IHByb2ZpbGU/OiBQcm9maWxlIH0pID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBnb29nbGU6ICgpID0+IGdldEluZm9ybWF0aW9uRnJvbVByb2ZpbGUoeyBwcm9maWxlOiBwcm9maWxlIGFzIEdvb2dsZVByb2ZpbGUgfSksXG4gICAgY3JlZGVudGlhbHM6ICgpID0+IHBpY2sodXNlciwgWydlbWFpbCcsICdmaXJzdE5hbWUnLCAnbGFzdE5hbWUnXSlcbiAgfVtwcm92aWRlcl07XG5cbiAgaWYgKCFoYW5kbGVyKSB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcHJvdmlkZXI6ICR7cHJvdmlkZXJ9YCk7XG5cbiAgY29uc3QgdXNlckRhdGEgPSBoYW5kbGVyKCk7XG4gIHJldHVybiB7IC4uLnVzZXJEYXRhIH0gYXMgU2Vzc2lvbjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGV4dHJhY3RVc2VyRGF0YTtcbiJdLCJuYW1lcyI6WyJwaWNrIiwiZ2V0SW5mb3JtYXRpb25Gcm9tUHJvZmlsZSIsImV4dHJhY3RVc2VyRGF0YSIsInByb3ZpZGVyIiwidXNlciIsInByb2ZpbGUiLCJoYW5kbGVyIiwiZ29vZ2xlIiwiY3JlZGVudGlhbHMiLCJFcnJvciIsInVzZXJEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../lib/auth/extractUserData.ts\n");

/***/ }),

/***/ "(api)/../../lib/auth/providers.ts":
/*!***********************************!*\
  !*** ../../lib/auth/providers.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _config_env__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../config/env */ \"(api)/../../config/env.ts\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/google */ \"next-auth/providers/google\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst providers = [\n    next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1___default()({\n        clientId: _config_env__WEBPACK_IMPORTED_MODULE_0__[\"default\"].GOOGLE_CLIENT_ID,\n        clientSecret: _config_env__WEBPACK_IMPORTED_MODULE_0__[\"default\"].GOOGLE_CLIENT_SECRET\n    })\n];\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (providers);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vbGliL2F1dGgvcHJvdmlkZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBbUM7QUFDYTtBQUVoRCxNQUFNRSxZQUFZO0lBQ2hCRCxpRUFBTUEsQ0FBQztRQUNMRSxVQUFVSCxvRUFBb0I7UUFDOUJLLGNBQWNMLHdFQUF3QjtJQUN4QztDQUNEO0FBRUQsaUVBQWVFLFNBQVNBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vbGliL2F1dGgvcHJvdmlkZXJzLnRzPzI4YzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGVudiBmcm9tICcuLi8uLi9jb25maWcvZW52JztcbmltcG9ydCBHb29nbGUgZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycy9nb29nbGUnO1xuXG5jb25zdCBwcm92aWRlcnMgPSBbXG4gIEdvb2dsZSh7XG4gICAgY2xpZW50SWQ6IGVudi5HT09HTEVfQ0xJRU5UX0lELFxuICAgIGNsaWVudFNlY3JldDogZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUXG4gIH0pXG5dO1xuXG5leHBvcnQgZGVmYXVsdCBwcm92aWRlcnM7XG4iXSwibmFtZXMiOlsiZW52IiwiR29vZ2xlIiwicHJvdmlkZXJzIiwiY2xpZW50SWQiLCJHT09HTEVfQ0xJRU5UX0lEIiwiY2xpZW50U2VjcmV0IiwiR09PR0xFX0NMSUVOVF9TRUNSRVQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../lib/auth/providers.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/../../../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();