"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_api_keystone_ts";
exports.ids = ["_api_keystone_ts"];
exports.modules = {

/***/ "(api)/../../domains/allowance/baseAllowance.ts":
/*!************************************************!*\
  !*** ../../domains/allowance/baseAllowance.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   calculateBaseAllocation: () => (/* binding */ calculateBaseAllocation),\n/* harmony export */   calculateBaseAllocationForTimePolicy: () => (/* binding */ calculateBaseAllocationForTimePolicy),\n/* harmony export */   createYearPeriod: () => (/* binding */ createYearPeriod),\n/* harmony export */   fetchTimePolicyAllocationTimeline: () => (/* binding */ fetchTimePolicyAllocationTimeline)\n/* harmony export */ });\nconst MS_PER_DAY = 1000 * 60 * 60 * 24;\nconst MIN_DATE = new Date(-8640000000000000);\nconst MAX_DATE = new Date(8640000000000000);\nconst toDate = (value)=>{\n    if (value instanceof Date) return value;\n    if (typeof value === \"string\" || typeof value === \"number\") return new Date(value);\n    throw new Error(\"Unable to convert value to Date\");\n};\nconst differenceInDays = (start, end)=>Math.max(0, (end.getTime() - start.getTime()) / MS_PER_DAY);\nconst clampRange = (rangeStart, rangeEnd, clampStart, clampEnd)=>{\n    const start = new Date(Math.max(rangeStart.getTime(), clampStart.getTime()));\n    const end = new Date(Math.min(rangeEnd.getTime(), clampEnd.getTime()));\n    if (start.getTime() >= end.getTime()) return null;\n    return {\n        start,\n        end\n    };\n};\nconst sortByEffectiveAt = (records)=>[\n        ...records\n    ].sort((a, b)=>a.effectiveAt.getTime() - b.effectiveAt.getTime());\nconst createYearPeriod = (year)=>({\n        unit: \"YEAR\",\n        start: new Date(Date.UTC(year, 0, 1)),\n        end: new Date(Date.UTC(year + 1, 0, 1)),\n        label: `${year}`\n    });\nconst fetchTimePolicyAllocationTimeline = async (context, timePolicyId)=>{\n    const items = await context.sudo().db.TimePolicyAllocation.findMany({\n        where: {\n            timePolicy: {\n                id: {\n                    equals: timePolicyId\n                }\n            }\n        },\n        orderBy: {\n            effectiveAt: \"asc\"\n        },\n        query: \"id effectiveAt allocation carryoverLimit overdraftLimit\"\n    });\n    return items.map((item)=>({\n            id: item.id,\n            effectiveAt: toDate(item.effectiveAt),\n            allocation: item.allocation ?? 0,\n            carryoverLimit: item.carryoverLimit ?? 0,\n            overdraftLimit: item.overdraftLimit ?? 0\n        }));\n};\nconst calculateBaseAllocation = ({ allocations, period, userStartDate })=>{\n    const sorted = sortByEffectiveAt(allocations);\n    const periodDays = differenceInDays(period.start, period.end);\n    if (!sorted.length || periodDays <= 0) return {\n        amount: 0,\n        breakdown: [],\n        periodDays,\n        activeTimePolicyAllocation: null\n    };\n    const employmentStart = userStartDate ?? MIN_DATE;\n    const breakdown = sorted.map((current, index, arr)=>{\n        const next = arr[index + 1];\n        const segmentStart = current.effectiveAt;\n        const segmentEnd = next?.effectiveAt ?? MAX_DATE;\n        const periodClamped = clampRange(segmentStart, segmentEnd, period.start, period.end);\n        if (!periodClamped) return null;\n        const employmentClamped = clampRange(periodClamped.start, periodClamped.end, employmentStart, period.end);\n        if (!employmentClamped) return null;\n        const daysInSegment = differenceInDays(employmentClamped.start, employmentClamped.end);\n        if (daysInSegment <= 0) return null;\n        const portionOfPeriod = daysInSegment / periodDays;\n        const contribution = current.allocation * portionOfPeriod;\n        return {\n            timePolicyAllocationId: current.id,\n            effectiveAt: current.effectiveAt,\n            from: employmentClamped.start,\n            to: employmentClamped.end,\n            daysInSegment,\n            portionOfPeriod,\n            allocationRate: current.allocation,\n            contribution\n        };\n    }).filter((segment)=>Boolean(segment));\n    const amount = breakdown.reduce((sum, seg)=>sum + seg.contribution, 0);\n    const activeTimePolicyAllocation = getActiveTimePolicyAllocation(sorted, period.end);\n    return {\n        amount,\n        breakdown,\n        periodDays,\n        activeTimePolicyAllocation\n    };\n};\nconst getActiveTimePolicyAllocation = (records, periodEnd)=>[\n        ...records\n    ].reverse().find((record)=>record.effectiveAt.getTime() <= periodEnd.getTime()) ?? null;\nconst calculateBaseAllocationForTimePolicy = async ({ context, timePolicyId, period, userStartDate })=>{\n    const allocations = await fetchTimePolicyAllocationTimeline(context, timePolicyId);\n    return calculateBaseAllocation({\n        allocations,\n        period,\n        userStartDate\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvYmFzZUFsbG93YW5jZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBU0EsTUFBTUEsYUFBYSxPQUFPLEtBQUssS0FBSztBQUNwQyxNQUFNQyxXQUFXLElBQUlDLEtBQUssQ0FBQztBQUMzQixNQUFNQyxXQUFXLElBQUlELEtBQUs7QUFFMUIsTUFBTUUsU0FBUyxDQUFDQztJQUNkLElBQUlBLGlCQUFpQkgsTUFBTSxPQUFPRztJQUNsQyxJQUFJLE9BQU9BLFVBQVUsWUFBWSxPQUFPQSxVQUFVLFVBQVUsT0FBTyxJQUFJSCxLQUFLRztJQUM1RSxNQUFNLElBQUlDLE1BQU07QUFDbEI7QUFFQSxNQUFNQyxtQkFBbUIsQ0FBQ0MsT0FBYUMsTUFBY0MsS0FBS0MsR0FBRyxDQUFDLEdBQUcsQ0FBQ0YsSUFBSUcsT0FBTyxLQUFLSixNQUFNSSxPQUFPLEVBQUMsSUFBS1o7QUFFckcsTUFBTWEsYUFBYSxDQUFDQyxZQUFrQkMsVUFBZ0JDLFlBQWtCQztJQUN0RSxNQUFNVCxRQUFRLElBQUlOLEtBQUtRLEtBQUtDLEdBQUcsQ0FBQ0csV0FBV0YsT0FBTyxJQUFJSSxXQUFXSixPQUFPO0lBQ3hFLE1BQU1ILE1BQU0sSUFBSVAsS0FBS1EsS0FBS1EsR0FBRyxDQUFDSCxTQUFTSCxPQUFPLElBQUlLLFNBQVNMLE9BQU87SUFDbEUsSUFBSUosTUFBTUksT0FBTyxNQUFNSCxJQUFJRyxPQUFPLElBQUksT0FBTztJQUM3QyxPQUFPO1FBQUVKO1FBQU9DO0lBQUk7QUFDdEI7QUFFQSxNQUFNVSxvQkFBb0IsQ0FBQ0MsVUFDekI7V0FBSUE7S0FBUSxDQUFDQyxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTUQsRUFBRUUsV0FBVyxDQUFDWixPQUFPLEtBQUtXLEVBQUVDLFdBQVcsQ0FBQ1osT0FBTztBQUV0RSxNQUFNYSxtQkFBbUIsQ0FBQ0MsT0FBb0M7UUFDbkVDLE1BQU07UUFDTm5CLE9BQU8sSUFBSU4sS0FBS0EsS0FBSzBCLEdB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QUFPLEdBQUdDLElBQUksQ0FBQ0MsQ0FBQUEsU0FBVUEsT0FBTzdELFdBQVcsQ0FBQ1osT0FBTyxNQUFNc0UsVUFBVXRFLE9BQU8sT0FBTztBQUV6RixNQUFNMEUsdUNBQXVDLE9BQU8sRUFDekR2RCxPQUFPLEVBQ1BDLFlBQVksRUFDWm1CLE1BQU0sRUFDTkMsYUFBYSxFQUNPO0lBQ3BCLE1BQU1GLGNBQWMsTUFBTXBCLGtDQUFrQ0MsU0FBU0M7SUFDckUsT0FBT2lCLHdCQUF3QjtRQUFFQztRQUFhQztRQUFRQztJQUFjO0FBQ3RFLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvYmFzZUFsbG93YW5jZS50cz8xZWE5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQ29udGV4dCB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQge1xuICB0eXBlIEFsbG9jYXRpb25QZXJpb2QsXG4gIHR5cGUgQmFzZUFsbG9jYXRpb25JbnB1dCxcbiAgdHlwZSBCYXNlQWxsb2NhdGlvblJlc3VsdCxcbiAgdHlwZSBCYXNlQWxsb2NhdGlvblNlZ21lbnQsXG4gIHR5cGUgVGltZVBvbGljeUFsbG9jYXRpb25SZWNvcmRcbn0gZnJvbSAnLi90eXBlcyc7XG5cbmNvbnN0IE1TX1BFUl9EQVkgPSAxMDAwICogNjAgKiA2MCAqIDI0O1xuY29uc3QgTUlOX0RBVEUgPSBuZXcgRGF0ZSgtODY0MDAwMDAwMDAwMDAwMCk7XG5jb25zdCBNQVhfREFURSA9IG5ldyBEYXRlKDg2NDAwMDAwMDAwMDAwMDApO1xuXG5jb25zdCB0b0RhdGUgPSAodmFsdWU6IHVua25vd24pOiBEYXRlID0+IHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIHZhbHVlO1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSByZXR1cm4gbmV3IERhdGUodmFsdWUpO1xuICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBjb252ZXJ0IHZhbHVlIHRvIERhdGUnKTtcbn07XG5cbmNvbnN0IGRpZmZlcmVuY2VJbkRheXMgPSAoc3RhcnQ6IERhdGUsIGVuZDogRGF0ZSkgPT4gTWF0aC5tYXgoMCwgKGVuZC5nZXRUaW1lKCkgLSBzdGFydC5nZXRUaW1lKCkpIC8gTVNfUEVSX0RBWSk7XG5cbmNvbnN0IGNsYW1wUmFuZ2UgPSAocmFuZ2VTdGFydDogRGF0ZSwgcmFuZ2VFbmQ6IERhdGUsIGNsYW1wU3RhcnQ6IERhdGUsIGNsYW1wRW5kOiBEYXRlKSA9PiB7XG4gIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoTWF0aC5tYXgocmFuZ2VTdGFydC5nZXRUaW1lKCksIGNsYW1wU3RhcnQuZ2V0VGltZSgpKSk7XG4gIGNvbnN0IGVuZCA9IG5ldyBEYXRlKE1hdGgubWluKHJhbmdlRW5kLmdldFRpbWUoKSwgY2xhbXBFbmQuZ2V0VGltZSgpKSk7XG4gIGlmIChzdGFydC5nZXRUaW1lKCkgPj0gZW5kLmdldFRpbWUoKSkgcmV0dXJuIG51bGw7XG4gIHJldHVybiB7IHN0YXJ0LCBlbmQgfTtcbn07XG5cbmNvbnN0IHNvcnRCeUVmZmVjdGl2ZUF0ID0gKHJlY29yZHM6IFRpbWVQb2xpY3lBbGxvY2F0aW9uUmVjb3JkW10pID0+XG4gIFsuLi5yZWNvcmRzXS5zb3J0KChhLCBiKSA9PiBhLmVmZmVjdGl2ZUF0LmdldFRpbWUoKSAtIGIuZWZmZWN0aXZlQXQuZ2V0VGltZSgpKTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVllYXJQZXJpb2QgPSAoeWVhcjogbnVtYmVyKTogQWxsb2NhdGlvblBlcmlvZCA9PiAoe1xuICB1bml0OiAnWUVBUicsXG4gIHN0YXJ0OiBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyLCAwLCAxKSksXG4gIGVuZDogbmV3IERhdGUoRGF0ZS5VVEMoeWVhciArIDEsIDAsIDEpKSxcbiAgbGFiZWw6IGAke3llYXJ9YFxufSk7XG5cbmV4cG9ydCBjb25zdCBmZXRjaFRpbWVQb2xpY3lBbGxvY2F0aW9uVGltZWxpbmUgPSBhc3luYyAoXG4gIGNvbnRleHQ6IENvbnRleHQsXG4gIHRpbWVQb2xpY3lJZDogc3RyaW5nXG4pOiBQcm9taXNlPFRpbWVQb2xpY3lBbGxvY2F0aW9uUmVjb3JkW10+ID0+IHtcbiAgY29uc3QgaXRlbXMgPSBhd2FpdCBjb250ZXh0LnN1ZG8oKS5kYi5UaW1lUG9saWN5QWxsb2NhdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHsgdGltZVBvbGljeTogeyBpZDogeyBlcXVhbHM6IHRpbWVQb2xpY3lJZCB9IH0gfSxcbiAgICBvcmRlckJ5OiB7IGVmZmVjdGl2ZUF0OiAnYXNjJyB9LFxuICAgIHF1ZXJ5OiAnaWQgZWZmZWN0aXZlQXQgYWxsb2NhdGlvbiBjYXJyeW92ZXJMaW1pdCBvdmVyZHJhZnRMaW1pdCdcbiAgfSk7XG5cbiAgcmV0dXJuIGl0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgaWQ6IGl0ZW0uaWQsXG4gICAgZWZmZWN0aXZlQXQ6IHRvRGF0ZShpdGVtLmVmZmVjdGl2ZUF0KSxcbiAgICBhbGxvY2F0aW9uOiBpdGVtLmFsbG9jYXRpb24gPz8gMCxcbiAgICBjYXJyeW92ZXJMaW1pdDogaXRlbS5jYXJyeW92ZXJMaW1pdCA/PyAwLFxuICAgIG92ZXJkcmFmdExpbWl0OiBpdGVtLm92ZXJkcmFmdExpbWl0ID8/IDBcbiAgfSkpO1xufTtcblxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uID0gKHtcbiAgYWxsb2NhdGlvbnMsXG4gIHBlcmlvZCxcbiAgdXNlclN0YXJ0RGF0ZVxufToge1xuICBhbGxvY2F0aW9uczogVGltZVBvbGljeUFsbG9jYXRpb25SZWNvcmRbXTtcbiAgcGVyaW9kOiBBbGxvY2F0aW9uUGVyaW9kO1xuICB1c2VyU3RhcnREYXRlPzogRGF0ZSB8IG51bGw7XG59KTogQmFzZUFsbG9jYXRpb25SZXN1bHQgPT4ge1xuICBjb25zdCBzb3J0ZWQgPSBzb3J0QnlFZmZlY3RpdmVBdChhbGxvY2F0aW9ucyk7XG4gIGNvbnN0IHBlcmlvZERheXMgPSBkaWZmZXJlbmNlSW5EYXlzKHBlcmlvZC5zdGFydCwgcGVyaW9kLmVuZCk7XG4gIGlmICghc29ydGVkLmxlbmd0aCB8fCBwZXJpb2REYXlzIDw9IDApXG4gICAgcmV0dXJuIHsgYW1vdW50OiAwLCBicmVha2Rvd246IFtdLCBwZXJpb2REYXlzLCBhY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbjogbnVsbCB9O1xuXG4gIGNvbnN0IGVtcGxveW1lbnRTdGFydCA9IHVzZXJTdGFydERhdGUgPz8gTUlOX0RBVEU7XG5cbiAgY29uc3QgYnJlYWtkb3duID0gc29ydGVkXG4gICAgLm1hcCgoY3VycmVudCwgaW5kZXgsIGFycikgPT4ge1xuICAgICAgY29uc3QgbmV4dCA9IGFycltpbmRleCArIDFdO1xuICAgICAgY29uc3Qgc2VnbWVudFN0YXJ0ID0gY3VycmVudC5lZmZlY3RpdmVBdDtcbiAgICAgIGNvbnN0IHNlZ21lbnRFbmQgPSBuZXh0Py5lZmZlY3RpdmVBdCA/PyBNQVhfREFURTtcblxuICAgICAgY29uc3QgcGVyaW9kQ2xhbXBlZCA9IGNsYW1wUmFuZ2Uoc2VnbWVudFN0YXJ0LCBzZWdtZW50RW5kLCBwZXJpb2Quc3RhcnQsIHBlcmlvZC5lbmQpO1xuICAgICAgaWYgKCFwZXJpb2RDbGFtcGVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3QgZW1wbG95bWVudENsYW1wZWQgPSBjbGFtcFJhbmdlKHBlcmlvZENsYW1wZWQuc3RhcnQsIHBlcmlvZENsYW1wZWQuZW5kLCBlbXBsb3ltZW50U3RhcnQsIHBlcmlvZC5lbmQpO1xuICAgICAgaWYgKCFlbXBsb3ltZW50Q2xhbXBlZCkgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IGRheXNJblNlZ21lbnQgPSBkaWZmZXJlbmNlSW5EYXlzKGVtcGxveW1lbnRDbGFtcGVkLnN0YXJ0LCBlbXBsb3ltZW50Q2xhbXBlZC5lbmQpO1xuICAgICAgaWYgKGRheXNJblNlZ21lbnQgPD0gMCkgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IHBvcnRpb25PZlBlcmlvZCA9IGRheXNJblNlZ21lbnQgLyBwZXJpb2REYXlzO1xuICAgICAgY29uc3QgY29udHJpYnV0aW9uID0gY3VycmVudC5hbGxvY2F0aW9uICogcG9ydGlvbk9mUGVyaW9kO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbklkOiBjdXJyZW50LmlkLFxuICAgICAgICBlZmZlY3RpdmVBdDogY3VycmVudC5lZmZlY3RpdmVBdCxcbiAgICAgICAgZnJvbTogZW1wbG95bWVudENsYW1wZWQuc3RhcnQsXG4gICAgICAgIHRvOiBlbXBsb3ltZW50Q2xhbXBlZC5lbmQsXG4gICAgICAgIGRheXNJblNlZ21lbnQsXG4gICAgICAgIHBvcnRpb25PZlBlcmlvZCxcbiAgICAgICAgYWxsb2NhdGlvblJhdGU6IGN1cnJlbnQuYWxsb2NhdGlvbixcbiAgICAgICAgY29udHJpYnV0aW9uXG4gICAgICB9O1xuICAgIH0pXG4gICAgLmZpbHRlcigoc2VnbWVudCk6IHNlZ21lbnQgaXMgQmFzZUFsbG9jYXRpb25TZWdtZW50ID0+IEJvb2xlYW4oc2VnbWVudCkpO1xuXG4gIGNvbnN0IGFtb3VudCA9IGJyZWFrZG93bi5yZWR1Y2UoKHN1bSwgc2VnKSA9PiBzdW0gKyBzZWcuY29udHJpYnV0aW9uLCAwKTtcbiAgY29uc3QgYWN0aXZlVGltZVBvbGljeUFsbG9jYXRpb24gPSBnZXRBY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbihzb3J0ZWQsIHBlcmlvZC5lbmQpO1xuXG4gIHJldHVybiB7IGFtb3VudCwgYnJlYWtkb3duLCBwZXJpb2REYXlzLCBhY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbiB9O1xufTtcblxuY29uc3QgZ2V0QWN0aXZlVGltZVBvbGljeUFsbG9jYXRpb24gPSAocmVjb3JkczogVGltZVBvbGljeUFsbG9jYXRpb25SZWNvcmRbXSwgcGVyaW9kRW5kOiBEYXRlKSA9PlxuICBbLi4ucmVjb3Jkc10ucmV2ZXJzZSgpLmZpbmQocmVjb3JkID0+IHJlY29yZC5lZmZlY3RpdmVBdC5nZXRUaW1lKCkgPD0gcGVyaW9kRW5kLmdldFRpbWUoKSkgPz8gbnVsbDtcblxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uRm9yVGltZVBvbGljeSA9IGFzeW5jICh7XG4gIGNvbnRleHQsXG4gIHRpbWVQb2xpY3lJZCxcbiAgcGVyaW9kLFxuICB1c2VyU3RhcnREYXRlXG59OiBCYXNlQWxsb2NhdGlvbklucHV0KTogUHJvbWlzZTxCYXNlQWxsb2NhdGlvblJlc3VsdD4gPT4ge1xuICBjb25zdCBhbGxvY2F0aW9ucyA9IGF3YWl0IGZldGNoVGltZVBvbGljeUFsbG9jYXRpb25UaW1lbGluZShjb250ZXh0LCB0aW1lUG9saWN5SWQpO1xuICByZXR1cm4gY2FsY3VsYXRlQmFzZUFsbG9jYXRpb24oeyBhbGxvY2F0aW9ucywgcGVyaW9kLCB1c2VyU3RhcnREYXRlIH0pO1xufTtcbiJdLCJuYW1lcyI6WyJNU19QRVJfREFZIiwiTUlOX0RBVEUiLCJEYXRlIiwiTUFYX0RBVEUiLCJ0b0RhdGUiLCJ2YWx1ZSIsIkVycm9yIiwiZGlmZmVyZW5jZUluRGF5cyIsInN0YXJ0IiwiZW5kIiwiTWF0aCIsIm1heCIsImdldFRpbWUiLCJjbGFtcFJhbmdlIiwicmFuZ2VTdGFydCIsInJhbmdlRW5kIiwiY2xhbXBTdGFydCIsImNsYW1wRW5kIiwibWluIiwic29ydEJ5RWZmZWN0aXZlQXQiLCJyZWNvcmRzIiwic29ydCIsImEiLCJiIiwiZWZmZWN0aXZlQXQiLCJjcmVhdGVZZWFyUGVyaW9kIiwieWVhciIsInVuaXQiLCJVVEMiLCJsYWJlbCIsImZldGNoVGltZVBvbGljeUFsbG9jYXRpb25UaW1lbGluZSIsImNvbnRleHQiLCJ0aW1lUG9saWN5SWQiLCJpdGVtcyIsInN1ZG8iLCJkYiIsIlRpbWVQb2xpY3lBbGxvY2F0aW9uIiwiZmluZE1hbnkiLCJ3aGVyZSIsInRpbWVQb2xpY3kiLCJpZCIsImVxdWFscyIsIm9yZGVyQnkiLCJxdWVyeSIsIm1hcCIsIml0ZW0iLCJhbGxvY2F0aW9uIiwiY2FycnlvdmVyTGltaXQiLCJvdmVyZHJhZnRMaW1pdCIsImNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uIiwiYWxsb2NhdGlvbnMiLCJwZXJpb2QiLCJ1c2VyU3RhcnREYXRlIiwic29ydGVkIiwicGVyaW9kRGF5cyIsImxlbmd0aCIsImFtb3VudCIsImJyZWFrZG93biIsImFjdGl2ZVRpbWVQb2xpY3lBbGxvY2F0aW9uIiwiZW1wbG95bWVudFN0YXJ0IiwiY3VycmVudCIsImluZGV4IiwiYXJyIiwibmV4dCIsInNlZ21lbnRTdGFydCIsInNlZ21lbnRFbmQiLCJwZXJpb2RDbGFtcGVkIiwiZW1wbG95bWVudENsYW1wZWQiLCJkYXlzSW5TZWdtZW50IiwicG9ydGlvbk9mUGVyaW9kIiwiY29udHJpYnV0aW9uIiwidGltZVBvbGljeUFsbG9jYXRpb25JZCIsImZyb20iLCJ0byIsImFsbG9jYXRpb25SYXRlIiwiZmlsdGVyIiwic2VnbWVudCIsIkJvb2xlYW4iLCJyZWR1Y2UiLCJzdW0iLCJzZWciLCJnZXRBY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbiIsInBlcmlvZEVuZCIsInJldmVyc2UiLCJmaW5kIiwicmVjb3JkIiwiY2FsY3VsYXRlQmFzZUFsbG9jYXRpb25Gb3JUaW1lUG9saWN5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../domains/allowance/baseAllowance.ts\n");

/***/ }),

/***/ "(api)/../../domains/allowance/carryover.ts":
/*!********************************************!*\
  !*** ../../domains/allowance/carryover.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureCarryoverForYear: () => (/* binding */ ensureCarryoverForYear),\n/* harmony export */   ensureCarryoverUpToYear: () => (/* binding */ ensureCarryoverUpToYear)\n/* harmony export */ });\n/* harmony import */ var _baseAllowance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./baseAllowance */ \"(api)/../../domains/allowance/baseAllowance.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"(api)/../../domains/allowance/utils.ts\");\n\n\nconst ensureCarryoverForYear = async ({ context, userId, timePolicyId, year, userStartDate })=>{\n    const sudo = context.sudo();\n    const { start, end, yearEnd, nextYearStart } = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getYearBounds)(year);\n    const existingOut = await sudo.db.UserAllocation.findMany({\n        where: {\n            user: {\n                id: {\n                    equals: userId\n                }\n            },\n            timePolicy: {\n                id: {\n                    equals: timePolicyId\n                }\n            },\n            type: {\n                equals: \"CARRYOVER_OUT\"\n            },\n            effectiveAt: {\n                gte: start.toISOString(),\n                lt: end.toISOString()\n            }\n        },\n        take: 1,\n        query: \"id\"\n    });\n    if (existingOut.length > 0) return existingOut[0];\n    const period = (0,_baseAllowance__WEBPACK_IMPORTED_MODULE_0__.createYearPeriod)(year);\n    const baseResult = await (0,_baseAllowance__WEBPACK_IMPORTED_MODULE_0__.calculateBaseAllocationForTimePolicy)({\n        context: sudo,\n        timePolicyId,\n        period,\n        userStartDate\n    });\n    const carryoverRule = baseResult.activeTimePolicyAllocation;\n    if (!carryoverRule) return null;\n    const adjustments = await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.sumAdjustmentEvents)({\n        context: sudo,\n        userId,\n        timePolicyId,\n        start,\n        end,\n        types: [\n            \"MANUAL\",\n            \"POLICY_CHANGE_RETRO\"\n        ]\n    });\n    const usage = await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.sumUsageForYear)({\n        context: sudo,\n        userId,\n        timePolicyId,\n        start,\n        end\n    });\n    const balance = baseResult.amount + adjustments - usage;\n    const leftover = Math.max(balance, 0);\n    const carryoverLimit = Math.max(carryoverRule.carryoverLimit ?? 0, 0);\n    const carry = Math.min(leftover, carryoverLimit);\n    const notesOut = `Carryover out for ${year}`;\n    const createdBy = context.session?.id ? {\n        connect: {\n            id: String(context.session.id)\n        }\n    } : undefined;\n    const outEvent = await sudo.db.UserAllocation.createOne({\n        data: {\n            user: {\n                connect: {\n                    id: userId\n                }\n            },\n            timePolicy: {\n                connect: {\n                    id: timePolicyId\n                }\n            },\n            timePolicyAllocation: carryoverRule?.id ? {\n                connect: {\n                    id: carryoverRule.id\n                }\n            } : undefined,\n            type: \"CARRYOVER_OUT\",\n            amount: leftover > 0 ? -leftover : 0,\n            effectiveAt: yearEnd.toISOString(),\n            notes: notesOut,\n            createdBy\n        },\n        query: \"id\"\n    });\n    if (carry > 0) {\n        const notesIn = `Carryover in from ${year}`;\n        await sudo.db.UserAllocation.createOne({\n            data: {\n                user: {\n                    connect: {\n                        id: userId\n                    }\n                },\n                timePolicy: {\n                    connect: {\n                        id: timePolicyId\n                    }\n                },\n                timePolicyAllocation: carryoverRule?.id ? {\n                    connect: {\n                        id: carryoverRule.id\n                    }\n                } : undefined,\n                type: \"CARRYOVER_IN\",\n                amount: carry,\n                effectiveAt: nextYearStart.toISOString(),\n                notes: notesIn,\n                createdBy\n            }\n        });\n    }\n    return outEvent;\n};\nconst ensureCarryoverUpToYear = async ({ context, userId, timePolicyId, targetYear })=>{\n    const sudo = context.sudo();\n    const userStartDate = await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getUserStartDate)(sudo, userId);\n    const lastProcessedYear = await getLastCarryoverYear(sudo, userId, timePolicyId);\n    const baselineYear = userStartDate?.getUTCFullYear() ?? targetYear - 1;\n    const startYear = Number.isFinite(lastProcessedYear) ? lastProcessedYear + 1 : baselineYear;\n    for(let year = startYear; year < targetYear; year += 1){\n        await ensureCarryoverForYear({\n            context,\n            userId,\n            timePolicyId,\n            year,\n            userStartDate\n        });\n    }\n};\nconst getLastCarryoverYear = async (context, userId, timePolicyId)=>{\n    const events = await context.db.UserAllocation.findMany({\n        where: {\n            user: {\n                id: {\n                    equals: userId\n                }\n            },\n            timePolicy: {\n                id: {\n                    equals: timePolicyId\n                }\n            },\n            type: {\n                equals: \"CARRYOVER_OUT\"\n            }\n        },\n        orderBy: {\n            effectiveAt: \"desc\"\n        },\n        take: 1,\n        query: \"effectiveAt\"\n    });\n    if (!events.length) return undefined;\n    return (0,_utils__WEBPACK_IMPORTED_MODULE_1__.toDate)(events[0].effectiveAt).getUTCFullYear();\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvY2FycnlvdmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDeUY7QUFDZTtBQWlCakcsTUFBTU8seUJBQXlCLE9BQU8sRUFDM0NDLE9BQU8sRUFDUEMsTUFBTSxFQUNOQyxZQUFZLEVBQ1pDLElBQUksRUFDSkMsYUFBYSxFQUNTO0lBQ3RCLE1BQU1DLE9BQU9MLFFBQVFLLElBQUk7SUFDekIsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLEdBQUcsRUFBRUMsT0FBTyxFQUFFQyxhQUFhLEVBQUUsR0FBR2QscURBQWFBLENBQUNRO0lBRTdELE1BQU1PLGNBQWMsTUFBTUwsS0FBS00sRUFBRSxDQUFDQyxjQUFjLENBQUNDLFFBQVEsQ0FBQztRQUN4REMsT0FBTztZQUNMQyxNQUFNO2dCQUFFQyxJQUFJO29CQUFFQyxRQUFRaEI7Z0JBQU87WUFBRTtZQUMvQmlCLFlBQVk7Z0JBQUVGLElBQUk7b0JBQUVDLFFBQVFmO2dCQUFhO1lBQUU7WUFDM0NpQixNQUFNO2dCQUFFRixRQUFRO1lBQWdCO1lBQ2hDRyxhQUFhO2dCQUNYQyxLQUFLZixNQUFNZ0IsV0FBVztnQkFDdEJDLElBQUloQixJQUFJZSxXQUFXO1lBQ3JCO1FBQ0Y7UUFDQUUsTUFBTTtRQUNOQyxPQUFPO0lBQ1Q7SUFDQSxJQUFJZixZQUFZZ0IsTUFBTSxHQUFHLEdBQUcsT0FBT2hCLFdBQVcsQ0FBQyxFQUFFO0lBRWpELE1BQU1pQixTQUFTbEMsZ0VBQWdCQSxDQUFDVTtJQUNoQyxNQUFNeUIsYUFBYSxNQUFNcEMsb0ZBQW9DQSxDQUFDO1FBQzVEUSxTQUFTSztRQUNUSDtRQUNBeUI7UUFDQXZCO0lBQ0Y7SUFDQSxNQUFNeUIsZ0JBQWdCRCxXQUFXRSwwQkFBMEI7SUFDM0QsSUFBSSxDQUFDRCxlQUFlLE9BQU87SUFFM0IsTUFBTUUsY0FBYyxNQUFNbkMsMkRBQW1CQSxDQUFDO1FBQzVDSSxTQUFTSztRQUNUSjtRQUNBQztRQUNBSTtRQUNBQztRQUNBeUIsT0FB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QyxJQUFJO29CQUFFQyxRQUFRaEI7Z0JBQU87WUFBRTtZQUMvQmlCLFlBQVk7Z0JBQUVGLElBQUk7b0JBQUVDLFFBQVFmO2dCQUFhO1lBQUU7WUFDM0NpQixNQUFNO2dCQUFFRixRQUFRO1lBQWdCO1FBQ2xDO1FBQ0ErQyxTQUFTO1lBQUU1QyxhQUFhO1FBQU87UUFDL0JJLE1BQU07UUFDTkMsT0FBTztJQUNUO0lBRUEsSUFBSSxDQUFDc0MsT0FBT3JDLE1BQU0sRUFBRSxPQUFPcUI7SUFDM0IsT0FBT2pELDhDQUFNQSxDQUFDaUUsTUFBTSxDQUFDLEVBQUUsQ0FBQzNDLFdBQVcsRUFBRXVDLGNBQWM7QUFDckQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvY2FycnlvdmVyLnRzPzhmMzQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDb250ZXh0IH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcbmltcG9ydCB7IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uRm9yVGltZVBvbGljeSwgY3JlYXRlWWVhclBlcmlvZCB9IGZyb20gJy4vYmFzZUFsbG93YW5jZSc7XG5pbXBvcnQgeyBnZXRVc2VyU3RhcnREYXRlLCBnZXRZZWFyQm91bmRzLCBzdW1BZGp1c3RtZW50RXZlbnRzLCBzdW1Vc2FnZUZvclllYXIsIHRvRGF0ZSB9IGZyb20gJy4vdXRpbHMnO1xuXG50eXBlIEVuc3VyZUNhcnJ5b3ZlclBhcmFtcyA9IHtcbiAgY29udGV4dDogQ29udGV4dDtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHRpbWVQb2xpY3lJZDogc3RyaW5nO1xuICB5ZWFyOiBudW1iZXI7XG4gIHVzZXJTdGFydERhdGU/OiBEYXRlIHwgbnVsbDtcbn07XG5cbnR5cGUgRW5zdXJlQ2FycnlvdmVyVXBUb1llYXJQYXJhbXMgPSB7XG4gIGNvbnRleHQ6IENvbnRleHQ7XG4gIHVzZXJJZDogc3RyaW5nO1xuICB0aW1lUG9saWN5SWQ6IHN0cmluZztcbiAgdGFyZ2V0WWVhcjogbnVtYmVyO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuc3VyZUNhcnJ5b3ZlckZvclllYXIgPSBhc3luYyAoe1xuICBjb250ZXh0LFxuICB1c2VySWQsXG4gIHRpbWVQb2xpY3lJZCxcbiAgeWVhcixcbiAgdXNlclN0YXJ0RGF0ZVxufTogRW5zdXJlQ2FycnlvdmVyUGFyYW1zKSA9PiB7XG4gIGNvbnN0IHN1ZG8gPSBjb250ZXh0LnN1ZG8oKTtcbiAgY29uc3QgeyBzdGFydCwgZW5kLCB5ZWFyRW5kLCBuZXh0WWVhclN0YXJ0IH0gPSBnZXRZZWFyQm91bmRzKHllYXIpO1xuXG4gIGNvbnN0IGV4aXN0aW5nT3V0ID0gYXdhaXQgc3Vkby5kYi5Vc2VyQWxsb2NhdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXI6IHsgaWQ6IHsgZXF1YWxzOiB1c2VySWQgfSB9LFxuICAgICAgdGltZVBvbGljeTogeyBpZDogeyBlcXVhbHM6IHRpbWVQb2xpY3lJZCB9IH0sXG4gICAgICB0eXBlOiB7IGVxdWFsczogJ0NBUlJZT1ZFUl9PVVQnIH0sXG4gICAgICBlZmZlY3RpdmVBdDoge1xuICAgICAgICBndGU6IHN0YXJ0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGx0OiBlbmQudG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgIH0sXG4gICAgdGFrZTogMSxcbiAgICBxdWVyeTogJ2lkJ1xuICB9KTtcbiAgaWYgKGV4aXN0aW5nT3V0Lmxlbmd0aCA+IDApIHJldHVybiBleGlzdGluZ091dFswXTtcblxuICBjb25zdCBwZXJpb2QgPSBjcmVhdGVZZWFyUGVyaW9kKHllYXIpO1xuICBjb25zdCBiYXNlUmVzdWx0ID0gYXdhaXQgY2FsY3VsYXRlQmFzZUFsbG9jYXRpb25Gb3JUaW1lUG9saWN5KHtcbiAgICBjb250ZXh0OiBzdWRvLFxuICAgIHRpbWVQb2xpY3lJZCxcbiAgICBwZXJpb2QsXG4gICAgdXNlclN0YXJ0RGF0ZVxuICB9KTtcbiAgY29uc3QgY2FycnlvdmVyUnVsZSA9IGJhc2VSZXN1bHQuYWN0aXZlVGltZVBvbGljeUFsbG9jYXRpb247XG4gIGlmICghY2FycnlvdmVyUnVsZSkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgYWRqdXN0bWVudHMgPSBhd2FpdCBzdW1BZGp1c3RtZW50RXZlbnRzKHtcbiAgICBjb250ZXh0OiBzdWRvLFxuICAgIHVzZXJJZCxcbiAgICB0aW1lUG9saWN5SWQsXG4gICAgc3RhcnQsXG4gICAgZW5kLFxuICAgIHR5cGVzOiBbJ01BTlVBTCcsICdQT0xJQ1lfQ0hBTkdFX1JFVFJPJ11cbiAgfSk7XG5cbiAgY29uc3QgdXNhZ2UgPSBhd2FpdCBzdW1Vc2FnZUZvclllYXIoe1xuICAgIGNvbnRleHQ6IHN1ZG8sXG4gICAgdXNlcklkLFxuICAgIHRpbWVQb2xpY3lJZCxcbiAgICBzdGFydCxcbiAgICBlbmRcbiAgfSk7XG5cbiAgY29uc3QgYmFsYW5jZSA9IGJhc2VSZXN1bHQuYW1vdW50ICsgYWRqdXN0bWVudHMgLSB1c2FnZTtcbiAgY29uc3QgbGVmdG92ZXIgPSBNYXRoLm1heChiYWxhbmNlLCAwKTtcbiAgY29uc3QgY2FycnlvdmVyTGltaXQgPSBNYXRoLm1heChjYXJyeW92ZXJSdWxlLmNhcnJ5b3ZlckxpbWl0ID8/IDAsIDApO1xuICBjb25zdCBjYXJyeSA9IE1hdGgubWluKGxlZnRvdmVyLCBjYXJyeW92ZXJMaW1pdCk7XG5cbiAgY29uc3Qgbm90ZXNPdXQgPSBgQ2FycnlvdmVyIG91dCBmb3IgJHt5ZWFyfWA7XG4gIGNvbnN0IGNyZWF0ZWRCeSA9IGNvbnRleHQuc2Vzc2lvbj8uaWQgPyB7IGNvbm5lY3Q6IHsgaWQ6IFN0cmluZyhjb250ZXh0LnNlc3Npb24uaWQpIH0gfSA6IHVuZGVmaW5lZDtcblxuICBjb25zdCBvdXRFdmVudCA9IGF3YWl0IHN1ZG8uZGIuVXNlckFsbG9jYXRpb24uY3JlYXRlT25lKHtcbiAgICBkYXRhOiB7XG4gICAgICB1c2VyOiB7IGNvbm5lY3Q6IHsgaWQ6IHVzZXJJZCB9IH0sXG4gICAgICB0aW1lUG9saWN5OiB7IGNvbm5lY3Q6IHsgaWQ6IHRpbWVQb2xpY3lJZCB9IH0sXG4gICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbjogY2FycnlvdmVyUnVsZT8uaWQgPyB7IGNvbm5lY3Q6IHsgaWQ6IGNhcnJ5b3ZlclJ1bGUuaWQgfSB9IDogdW5kZWZpbmVkLFxuICAgICAgdHlwZTogJ0NBUlJZT1ZFUl9PVVQnLFxuICAgICAgYW1vdW50OiBsZWZ0b3ZlciA+IDAgPyAtbGVmdG92ZXIgOiAwLFxuICAgICAgZWZmZWN0aXZlQXQ6IHllYXJFbmQudG9JU09TdHJpbmcoKSxcbiAgICAgIG5vdGVzOiBub3Rlc091dCxcbiAgICAgIGNyZWF0ZWRCeVxuICAgIH0sXG4gICAgcXVlcnk6ICdpZCdcbiAgfSk7XG5cbiAgaWYgKGNhcnJ5ID4gMCkge1xuICAgIGNvbnN0IG5vdGVzSW4gPSBgQ2FycnlvdmVyIGluIGZyb20gJHt5ZWFyfWA7XG4gICAgYXdhaXQgc3Vkby5kYi5Vc2VyQWxsb2NhdGlvbi5jcmVhdGVPbmUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB1c2VyOiB7IGNvbm5lY3Q6IHsgaWQ6IHVzZXJJZCB9IH0sXG4gICAgICAgIHRpbWVQb2xpY3k6IHsgY29ubmVjdDogeyBpZDogdGltZVBvbGljeUlkIH0gfSxcbiAgICAgICAgdGltZVBvbGljeUFsbG9jYXRpb246IGNhcnJ5b3ZlclJ1bGU/LmlkID8geyBjb25uZWN0OiB7IGlkOiBjYXJyeW92ZXJSdWxlLmlkIH0gfSA6IHVuZGVmaW5lZCxcbiAgICAgICAgdHlwZTogJ0NBUlJZT1ZFUl9JTicsXG4gICAgICAgIGFtb3VudDogY2FycnksXG4gICAgICAgIGVmZmVjdGl2ZUF0OiBuZXh0WWVhclN0YXJ0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG5vdGVzOiBub3Rlc0luLFxuICAgICAgICBjcmVhdGVkQnlcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBvdXRFdmVudDtcbn07XG5cbmV4cG9ydCBjb25zdCBlbnN1cmVDYXJyeW92ZXJVcFRvWWVhciA9IGFzeW5jICh7XG4gIGNvbnRleHQsXG4gIHVzZXJJZCxcbiAgdGltZVBvbGljeUlkLFxuICB0YXJnZXRZZWFyXG59OiBFbnN1cmVDYXJyeW92ZXJVcFRvWWVhclBhcmFtcykgPT4ge1xuICBjb25zdCBzdWRvID0gY29udGV4dC5zdWRvKCk7XG4gIGNvbnN0IHVzZXJTdGFydERhdGUgPSBhd2FpdCBnZXRVc2VyU3RhcnREYXRlKHN1ZG8sIHVzZXJJZCk7XG4gIGNvbnN0IGxhc3RQcm9jZXNzZWRZZWFyID0gYXdhaXQgZ2V0TGFzdENhcnJ5b3ZlclllYXIoc3VkbywgdXNlcklkLCB0aW1lUG9saWN5SWQpO1xuICBjb25zdCBiYXNlbGluZVllYXIgPSB1c2VyU3RhcnREYXRlPy5nZXRVVENGdWxsWWVhcigpID8/IHRhcmdldFllYXIgLSAxO1xuICBjb25zdCBzdGFydFllYXIgPSBOdW1iZXIuaXNGaW5pdGUobGFzdFByb2Nlc3NlZFllYXIpID8gKGxhc3RQcm9jZXNzZWRZZWFyIGFzIG51bWJlcikgKyAxIDogYmFzZWxpbmVZZWFyO1xuXG4gIGZvciAobGV0IHllYXIgPSBzdGFydFllYXI7IHllYXIgPCB0YXJnZXRZZWFyOyB5ZWFyICs9IDEpIHtcbiAgICBhd2FpdCBlbnN1cmVDYXJyeW92ZXJGb3JZZWFyKHtcbiAgICAgIGNvbnRleHQsXG4gICAgICB1c2VySWQsXG4gICAgICB0aW1lUG9saWN5SWQsXG4gICAgICB5ZWFyLFxuICAgICAgdXNlclN0YXJ0RGF0ZVxuICAgIH0pO1xuICB9XG59O1xuXG5jb25zdCBnZXRMYXN0Q2FycnlvdmVyWWVhciA9IGFzeW5jIChjb250ZXh0OiBDb250ZXh0LCB1c2VySWQ6IHN0cmluZywgdGltZVBvbGljeUlkOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZXZlbnRzID0gYXdhaXQgY29udGV4dC5kYi5Vc2VyQWxsb2NhdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXI6IHsgaWQ6IHsgZXF1YWxzOiB1c2VySWQgfSB9LFxuICAgICAgdGltZVBvbGljeTogeyBpZDogeyBlcXVhbHM6IHRpbWVQb2xpY3lJZCB9IH0sXG4gICAgICB0eXBlOiB7IGVxdWFsczogJ0NBUlJZT1ZFUl9PVVQnIH1cbiAgICB9LFxuICAgIG9yZGVyQnk6IHsgZWZmZWN0aXZlQXQ6ICdkZXNjJyB9LFxuICAgIHRha2U6IDEsXG4gICAgcXVlcnk6ICdlZmZlY3RpdmVBdCdcbiAgfSk7XG5cbiAgaWYgKCFldmVudHMubGVuZ3RoKSByZXR1cm4gdW5kZWZpbmVkO1xuICByZXR1cm4gdG9EYXRlKGV2ZW50c1swXS5lZmZlY3RpdmVBdCkuZ2V0VVRDRnVsbFllYXIoKTtcbn07XG4iXSwibmFtZXMiOlsiY2FsY3VsYXRlQmFzZUFsbG9jYXRpb25Gb3JUaW1lUG9saWN5IiwiY3JlYXRlWWVhclBlcmlvZCIsImdldFVzZXJTdGFydERhdGUiLCJnZXRZZWFyQm91bmRzIiwic3VtQWRqdXN0bWVudEV2ZW50cyIsInN1bVVzYWdlRm9yWWVhciIsInRvRGF0ZSIsImVuc3VyZUNhcnJ5b3ZlckZvclllYXIiLCJjb250ZXh0IiwidXNlcklkIiwidGltZVBvbGljeUlkIiwieWVhciIsInVzZXJTdGFydERhdGUiLCJzdWRvIiwic3RhcnQiLCJlbmQiLCJ5ZWFyRW5kIiwibmV4dFllYXJTdGFydCIsImV4aXN0aW5nT3V0IiwiZGIiLCJVc2VyQWxsb2NhdGlvbiIsImZpbmRNYW55Iiwid2hlcmUiLCJ1c2VyIiwiaWQiLCJlcXVhbHMiLCJ0aW1lUG9saWN5IiwidHlwZSIsImVmZmVjdGl2ZUF0IiwiZ3RlIiwidG9JU09TdHJpbmciLCJsdCIsInRha2UiLCJxdWVyeSIsImxlbmd0aCIsInBlcmlvZCIsImJhc2VSZXN1bHQiLCJjYXJyeW92ZXJSdWxlIiwiYWN0aXZlVGltZVBvbGljeUFsbG9jYXRpb24iLCJhZGp1c3RtZW50cyIsInR5cGVzIiwidXNhZ2UiLCJiYWxhbmNlIiwiYW1vdW50IiwibGVmdG92ZXIiLCJNYXRoIiwibWF4IiwiY2FycnlvdmVyTGltaXQiLCJjYXJyeSIsIm1pbiIsIm5vdGVzT3V0IiwiY3JlYXRlZEJ5Iiwic2Vzc2lvbiIsImNvbm5lY3QiLCJTdHJpbmciLCJ1bmRlZmluZWQiLCJvdXRFdmVudCIsImNyZWF0ZU9uZSIsImRhdGEiLCJ0aW1lUG9saWN5QWxsb2NhdGlvbiIsIm5vdGVzIiwibm90ZXNJbiIsImVuc3VyZUNhcnJ5b3ZlclVwVG9ZZWFyIiwidGFyZ2V0WWVhciIsImxhc3RQcm9jZXNzZWRZZWFyIiwiZ2V0TGFzdENhcnJ5b3ZlclllYXIiLCJiYXNlbGluZVllYXIiLCJnZXRVVENGdWxsWWVhciIsInN0YXJ0WWVhciIsIk51bWJlciIsImlzRmluaXRlIiwiZXZlbnRzIiwib3JkZXJCeSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../domains/allowance/carryover.ts\n");

/***/ }),

/***/ "(api)/../../domains/allowance/index.ts":
/*!****************************************!*\
  !*** ../../domains/allowance/index.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyRetroPolicyChange: () => (/* reexport safe */ _retroChanges__WEBPACK_IMPORTED_MODULE_2__.applyRetroPolicyChange),\n/* harmony export */   calculateBaseAllocation: () => (/* reexport safe */ _baseAllowance__WEBPACK_IMPORTED_MODULE_0__.calculateBaseAllocation),\n/* harmony export */   calculateBaseAllocationForTimePolicy: () => (/* reexport safe */ _baseAllowance__WEBPACK_IMPORTED_MODULE_0__.calculateBaseAllocationForTimePolicy),\n/* harmony export */   calculateBaseAllowanceForPolicy: () => (/* reexport safe */ _baseAllowance__WEBPACK_IMPORTED_MODULE_0__.calculateBaseAllocationForTimePolicy),\n/* harmony export */   createYearPeriod: () => (/* reexport safe */ _baseAllowance__WEBPACK_IMPORTED_MODULE_0__.createYearPeriod),\n/* harmony export */   ensureCarryoverForYear: () => (/* reexport safe */ _carryover__WEBPACK_IMPORTED_MODULE_1__.ensureCarryoverForYear),\n/* harmony export */   ensureCarryoverUpToYear: () => (/* reexport safe */ _carryover__WEBPACK_IMPORTED_MODULE_1__.ensureCarryoverUpToYear),\n/* harmony export */   fetchTimePolicyAllocationTimeline: () => (/* reexport safe */ _baseAllowance__WEBPACK_IMPORTED_MODULE_0__.fetchTimePolicyAllocationTimeline)\n/* harmony export */ });\n/* harmony import */ var _baseAllowance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./baseAllowance */ \"(api)/../../domains/allowance/baseAllowance.ts\");\n/* harmony import */ var _carryover__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./carryover */ \"(api)/../../domains/allowance/carryover.ts\");\n/* harmony import */ var _retroChanges__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./retroChanges */ \"(api)/../../domains/allowance/retroChanges.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./types */ \"(api)/../../domains/allowance/types.ts\");\n/* harmony reexport (unknown) */ var __WEBPACK_REEXPORT_OBJECT__ = {};\n/* harmony reexport (unknown) */ for(const __WEBPACK_IMPORT_KEY__ in _types__WEBPACK_IMPORTED_MODULE_3__) if([\"default\",\"calculateBaseAllocation\",\"calculateBaseAllocationForTimePolicy\",\"createYearPeriod\",\"fetchTimePolicyAllocationTimeline\",\"ensureCarryoverForYear\",\"ensureCarryoverUpToYear\",\"applyRetroPolicyChange\",\"calculateBaseAllowanceForPolicy\"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) __WEBPACK_REEXPORT_OBJECT__[__WEBPACK_IMPORT_KEY__] = () => _types__WEBPACK_IMPORTED_MODULE_3__[__WEBPACK_IMPORT_KEY__]\n/* harmony reexport (unknown) */ __webpack_require__.d(__webpack_exports__, __WEBPACK_REEXPORT_OBJECT__);\n\n\n\n\n// Backward-compatible aliases for old code\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS3lCO0FBQ3FEO0FBQ3RCO0FBQ2hDO0FBRXhCLDJDQUEyQztBQUMrRCIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9kb21haW5zL2FsbG93YW5jZS9pbmRleC50cz9mNGY5Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7XG4gIGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uLFxuICBjYWxjdWxhdGVCYXNlQWxsb2NhdGlvbkZvclRpbWVQb2xpY3ksXG4gIGNyZWF0ZVllYXJQZXJpb2QsXG4gIGZldGNoVGltZVBvbGljeUFsbG9jYXRpb25UaW1lbGluZVxufSBmcm9tICcuL2Jhc2VBbGxvd2FuY2UnO1xuZXhwb3J0IHsgZW5zdXJlQ2FycnlvdmVyRm9yWWVhciwgZW5zdXJlQ2FycnlvdmVyVXBUb1llYXIgfSBmcm9tICcuL2NhcnJ5b3Zlcic7XG5leHBvcnQgeyBhcHBseVJldHJvUG9saWN5Q2hhbmdlIH0gZnJvbSAnLi9yZXRyb0NoYW5nZXMnO1xuZXhwb3J0ICogZnJvbSAnLi90eXBlcyc7XG5cbi8vIEJhY2t3YXJkLWNvbXBhdGlibGUgYWxpYXNlcyBmb3Igb2xkIGNvZGVcbmV4cG9ydCB7IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uRm9yVGltZVBvbGljeSBhcyBjYWxjdWxhdGVCYXNlQWxsb3dhbmNlRm9yUG9saWN5IH0gZnJvbSAnLi9iYXNlQWxsb3dhbmNlJztcbiJdLCJuYW1lcyI6WyJjYWxjdWxhdGVCYXNlQWxsb2NhdGlvbiIsImNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uRm9yVGltZVBvbGljeSIsImNyZWF0ZVllYXJQZXJpb2QiLCJmZXRjaFRpbWVQb2xpY3lBbGxvY2F0aW9uVGltZWxpbmUiLCJlbnN1cmVDYXJyeW92ZXJGb3JZZWFyIiwiZW5zdXJlQ2FycnlvdmVyVXBUb1llYXIiLCJhcHBseVJldHJvUG9saWN5Q2hhbmdlIiwiY2FsY3VsYXRlQmFzZUFsbG93YW5jZUZvclBvbGljeSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../domains/allowance/index.ts\n");

/***/ }),

/***/ "(api)/../../domains/allowance/retroChanges.ts":
/*!***********************************************!*\
  !*** ../../domains/allowance/retroChanges.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   applyRetroPolicyChange: () => (/* binding */ applyRetroPolicyChange)\n/* harmony export */ });\n/* harmony import */ var _baseAllowance__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./baseAllowance */ \"(api)/../../domains/allowance/baseAllowance.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"(api)/../../domains/allowance/utils.ts\");\n\n\nconst applyRetroPolicyChange = async ({ context, timePolicyId, timePolicyAllocationId, userIds, year })=>{\n    if (!userIds.length) return;\n    const sudo = context.sudo();\n    const allocations = await (0,_baseAllowance__WEBPACK_IMPORTED_MODULE_0__.fetchTimePolicyAllocationTimeline)(sudo, timePolicyId);\n    const targetAllocation = allocations.find((item)=>item.id === timePolicyAllocationId);\n    if (!targetAllocation) {\n        throw new Error(\"Time policy allocation version not found for retro change.\");\n    }\n    const retroEffectiveAt = new Date(Date.UTC(year, 0, 1));\n    const retroTimeline = allocations.map((item)=>item.id === timePolicyAllocationId ? {\n            ...item,\n            effectiveAt: retroEffectiveAt\n        } : item);\n    const period = (0,_baseAllowance__WEBPACK_IMPORTED_MODULE_0__.createYearPeriod)(year);\n    const createdBy = context.session?.id ? {\n        connect: {\n            id: String(context.session.id)\n        }\n    } : undefined;\n    for (const userId of userIds){\n        const userStartDate = await (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getUserStartDate)(sudo, userId);\n        const original = (0,_baseAllowance__WEBPACK_IMPORTED_MODULE_0__.calculateBaseAllocation)({\n            allocations,\n            period,\n            userStartDate\n        });\n        const retro = (0,_baseAllowance__WEBPACK_IMPORTED_MODULE_0__.calculateBaseAllocation)({\n            allocations: retroTimeline,\n            period,\n            userStartDate\n        });\n        const delta = retro.amount - original.amount;\n        if (Math.abs(delta) < 1e-6) continue;\n        await sudo.db.UserAllocation.createOne({\n            data: {\n                user: {\n                    connect: {\n                        id: userId\n                    }\n                },\n                timePolicy: {\n                    connect: {\n                        id: timePolicyId\n                    }\n                },\n                timePolicyAllocation: {\n                    connect: {\n                        id: timePolicyAllocationId\n                    }\n                },\n                type: \"POLICY_CHANGE_RETRO\",\n                amount: delta,\n                effectiveAt: new Date().toISOString(),\n                notes: `Retro policy change adjustment for ${year}`,\n                createdBy\n            }\n        });\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvcmV0cm9DaGFuZ2VzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUt5QjtBQUMwQjtBQVU1QyxNQUFNSSx5QkFBeUIsT0FBTyxFQUMzQ0MsT0FBTyxFQUNQQyxZQUFZLEVBQ1pDLHNCQUFzQixFQUN0QkMsT0FBTyxFQUNQQyxJQUFJLEVBQ2M7SUFDbEIsSUFBSSxDQUFDRCxRQUFRRSxNQUFNLEVBQUU7SUFFckIsTUFBTUMsT0FBT04sUUFBUU0sSUFBSTtJQUN6QixNQUFNQyxjQUFjLE1BQU1WLGlGQUFpQ0EsQ0FBQ1MsTUFBTUw7SUFDbEUsTUFBTU8sbUJBQW1CRCxZQUFZRSxJQUFJLENBQUNDLENBQUFBLE9BQVFBLEtBQUtDLEVBQUUsS0FBS1Q7SUFDOUQsSUFBSSxDQUFDTSxrQkFBa0I7UUFDckIsTUFBTSxJQUFJSSxNQUFNO0lBQ2xCO0lBRUEsTUFBTUMsbUJBQW1CLElBQUlDLEtBQUtBLEtBQUtDLEdBQUcsQ0FBQ1gsTUFBTSxHQUFHO0lBQ3BELE1BQU1ZLGdCQUFnQlQsWUFBWVUsR0FBRyxDQUFDUCxDQUFBQSxPQUNwQ0EsS0FBS0MsRUFBRSxLQUFLVCx5QkFBeUI7WUFBRSxHQUFHUSxJQUFJO1lBQUVRLGFBQWFMO1FBQWlCLElBQUlIO0lBR3BGLE1BQU1TLFNBQVN2QixnRUFBZ0JBLENBQUNRO0lBQ2hDLE1BQU1nQixZQUFZcEIsUUFBUXFCLE9BQU8sRUFBRVYsS0FBSztRQUFFVyxTQUFTO1lBQUVYLElBQUlZLE9BQU92QixRQUFRcUIsT0FBTyxDQUFDVixFQUFFO1FBQUU7SUFBRSxJQUFJYTtJQUUxRixLQUFLLE1BQU1DLFVBQVV0QixRQUFTO1FBQzVCLE1BQU11QixnQkFBZ0IsTUFBTTVCLHdEQUFnQkEsQ0FBQ1EsTUFBTW1CO1FBQ25ELE1BQU1FLFdBQVdoQyx1RUFBdUJBLENBQUM7WUFBRVk7WUFBYVk7WUFBUU87UUFBYztRQUM5RSxNQUFNRSxRQUFRakMsdUVBQXVCQSxDQUFDO1lBQUVZLGFBQWFTO1lBQWVHO1lBQVFPO1FBQWM7UUFDMUYsTUFBTUcsUUFBUUQsTUFBTUUsTUFBTSxHQUFHSCxTQUFTRyxNQUFNO1FBQzVDLElBQUlDLEtBQUtDLEdBQUcsQ0FBQ0gsU0FBUyxNQUFNO1FBRTVCLE1BQU12QixLQUFLMkIsRUFBRSxDQUFDQyxjQUFjLENBQUNDLFNBQVMsQ0FBQztZQUNyQ0MsTUFBTTtnQkFDSkMsTUFBTTtvQkFBRWYsU0FBUzt3QkFBRVgsSUFBSWM7b0JBQU87Z0JBQUU7Z0JBQ2hDYSxZQUFZO29CQUFFaEIsU0FBUzt3QkFBRVgsSUFBSVY7b0JBQWE7Z0JBQUU7Z0JBQzVDc0Msc0JBQXNCO29CQUFFakIsU0FBUzt3QkFBRVgsSUFBSVQ7b0JBQXVCO2dCQUFFO2dCQUNoRXNDLE1BQU07Z0JBQ05WLFFBQVFEO2dCQUNSWCxhQUFhLElBQUlKLE9BQU8yQixXQUFXO2dCQUNuQ0MsT0FBTyxDQUFDLG1DQUFtQyxFQUFFdEMsS0FBSyxDQUFDO2dCQUNuRGdCO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9kb21haW5zL2FsbG93YW5jZS9yZXRyb0NoYW5nZXMudHM/MGIyNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IENvbnRleHQgfSBmcm9tICcua2V5c3RvbmUvdHlwZXMnO1xuaW1wb3J0IHtcbiAgY2FsY3VsYXRlQmFzZUFsbG9jYXRpb24sXG4gIGNyZWF0ZVllYXJQZXJpb2QsXG4gIGZldGNoVGltZVBvbGljeUFsbG9jYXRpb25UaW1lbGluZVxufSBmcm9tICcuL2Jhc2VBbGxvd2FuY2UnO1xuaW1wb3J0IHsgZ2V0VXNlclN0YXJ0RGF0ZSwgdG9EYXRlIH0gZnJvbSAnLi91dGlscyc7XG5cbnR5cGUgUmV0cm9DaGFuZ2VQYXJhbXMgPSB7XG4gIGNvbnRleHQ6IENvbnRleHQ7XG4gIHRpbWVQb2xpY3lJZDogc3RyaW5nO1xuICB0aW1lUG9saWN5QWxsb2NhdGlvbklkOiBzdHJpbmc7XG4gIHVzZXJJZHM6IHN0cmluZ1tdO1xuICB5ZWFyOiBudW1iZXI7XG59O1xuXG5leHBvcnQgY29uc3QgYXBwbHlSZXRyb1BvbGljeUNoYW5nZSA9IGFzeW5jICh7XG4gIGNvbnRleHQsXG4gIHRpbWVQb2xpY3lJZCxcbiAgdGltZVBvbGljeUFsbG9jYXRpb25JZCxcbiAgdXNlcklkcyxcbiAgeWVhclxufTogUmV0cm9DaGFuZ2VQYXJhbXMpID0+IHtcbiAgaWYgKCF1c2VySWRzLmxlbmd0aCkgcmV0dXJuO1xuXG4gIGNvbnN0IHN1ZG8gPSBjb250ZXh0LnN1ZG8oKTtcbiAgY29uc3QgYWxsb2NhdGlvbnMgPSBhd2FpdCBmZXRjaFRpbWVQb2xpY3lBbGxvY2F0aW9uVGltZWxpbmUoc3VkbywgdGltZVBvbGljeUlkKTtcbiAgY29uc3QgdGFyZ2V0QWxsb2NhdGlvbiA9IGFsbG9jYXRpb25zLmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSB0aW1lUG9saWN5QWxsb2NhdGlvbklkKTtcbiAgaWYgKCF0YXJnZXRBbGxvY2F0aW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaW1lIHBvbGljeSBhbGxvY2F0aW9uIHZlcnNpb24gbm90IGZvdW5kIGZvciByZXRybyBjaGFuZ2UuJyk7XG4gIH1cblxuICBjb25zdCByZXRyb0VmZmVjdGl2ZUF0ID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgMCwgMSkpO1xuICBjb25zdCByZXRyb1RpbWVsaW5lID0gYWxsb2NhdGlvbnMubWFwKGl0ZW0gPT5cbiAgICBpdGVtLmlkID09PSB0aW1lUG9saWN5QWxsb2NhdGlvbklkID8geyAuLi5pdGVtLCBlZmZlY3RpdmVBdDogcmV0cm9FZmZlY3RpdmVBdCB9IDogaXRlbVxuICApO1xuXG4gIGNvbnN0IHBlcmlvZCA9IGNyZWF0ZVllYXJQZXJpb2QoeWVhcik7XG4gIGNvbnN0IGNyZWF0ZWRCeSA9IGNvbnRleHQuc2Vzc2lvbj8uaWQgPyB7IGNvbm5lY3Q6IHsgaWQ6IFN0cmluZyhjb250ZXh0LnNlc3Npb24uaWQpIH0gfSA6IHVuZGVmaW5lZDtcblxuICBmb3IgKGNvbnN0IHVzZXJJZCBvZiB1c2VySWRzKSB7XG4gICAgY29uc3QgdXNlclN0YXJ0RGF0ZSA9IGF3YWl0IGdldFVzZXJTdGFydERhdGUoc3VkbywgdXNlcklkKTtcbiAgICBjb25zdCBvcmlnaW5hbCA9IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uKHsgYWxsb2NhdGlvbnMsIHBlcmlvZCwgdXNlclN0YXJ0RGF0ZSB9KTtcbiAgICBjb25zdCByZXRybyA9IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uKHsgYWxsb2NhdGlvbnM6IHJldHJvVGltZWxpbmUsIHBlcmlvZCwgdXNlclN0YXJ0RGF0ZSB9KTtcbiAgICBjb25zdCBkZWx0YSA9IHJldHJvLmFtb3VudCAtIG9yaWdpbmFsLmFtb3VudDtcbiAgICBpZiAoTWF0aC5hYnMoZGVsdGEpIDwgMWUtNikgY29udGludWU7XG5cbiAgICBhd2FpdCBzdWRvLmRiLlVzZXJBbGxvY2F0aW9uLmNyZWF0ZU9uZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHVzZXI6IHsgY29ubmVjdDogeyBpZDogdXNlcklkIH0gfSxcbiAgICAgICAgdGltZVBvbGljeTogeyBjb25uZWN0OiB7IGlkOiB0aW1lUG9saWN5SWQgfSB9LFxuICAgICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbjogeyBjb25uZWN0OiB7IGlkOiB0aW1lUG9saWN5QWxsb2NhdGlvbklkIH0gfSxcbiAgICAgICAgdHlwZTogJ1BPTElDWV9DSEFOR0VfUkVUUk8nLFxuICAgICAgICBhbW91bnQ6IGRlbHRhLFxuICAgICAgICBlZmZlY3RpdmVBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBub3RlczogYFJldHJvIHBvbGljeSBjaGFuZ2UgYWRqdXN0bWVudCBmb3IgJHt5ZWFyfWAsXG4gICAgICAgIGNyZWF0ZWRCeVxuICAgICAgfVxuICAgIH0pO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbImNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uIiwiY3JlYXRlWWVhclBlcmlvZCIsImZldGNoVGltZVBvbGljeUFsbG9jYXRpb25UaW1lbGluZSIsImdldFVzZXJTdGFydERhdGUiLCJhcHBseVJldHJvUG9saWN5Q2hhbmdlIiwiY29udGV4dCIsInRpbWVQb2xpY3lJZCIsInRpbWVQb2xpY3lBbGxvY2F0aW9uSWQiLCJ1c2VySWRzIiwieWVhciIsImxlbmd0aCIsInN1ZG8iLCJhbGxvY2F0aW9ucyIsInRhcmdldEFsbG9jYXRpb24iLCJmaW5kIiwiaXRlbSIsImlkIiwiRXJyb3IiLCJyZXRyb0VmZmVjdGl2ZUF0IiwiRGF0ZSIsIlVUQyIsInJldHJvVGltZWxpbmUiLCJtYXAiLCJlZmZlY3RpdmVBdCIsInBlcmlvZCIsImNyZWF0ZWRCeSIsInNlc3Npb24iLCJjb25uZWN0IiwiU3RyaW5nIiwidW5kZWZpbmVkIiwidXNlcklkIiwidXNlclN0YXJ0RGF0ZSIsIm9yaWdpbmFsIiwicmV0cm8iLCJkZWx0YSIsImFtb3VudCIsIk1hdGgiLCJhYnMiLCJkYiIsIlVzZXJBbGxvY2F0aW9uIiwiY3JlYXRlT25lIiwiZGF0YSIsInVzZXIiLCJ0aW1lUG9saWN5IiwidGltZVBvbGljeUFsbG9jYXRpb24iLCJ0eXBlIiwidG9JU09TdHJpbmciLCJub3RlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../domains/allowance/retroChanges.ts\n");

/***/ }),

/***/ "(api)/../../domains/allowance/types.ts":
/*!****************************************!*\
  !*** ../../domains/allowance/types.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy9hbGxvd2FuY2UvdHlwZXMudHMiLCJtYXBwaW5ncyI6IjtBQTBDRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9kb21haW5zL2FsbG93YW5jZS90eXBlcy50cz85YWI4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQ29udGV4dCB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5cbmV4cG9ydCB0eXBlIEFsbG9jYXRpb25QZXJpb2RVbml0ID0gJ1lFQVInIHwgJ1FVQVJURVInIHwgJ01PTlRIJyB8ICdXRUVLJztcblxuZXhwb3J0IHR5cGUgQWxsb2NhdGlvblBlcmlvZCA9IHtcbiAgdW5pdDogQWxsb2NhdGlvblBlcmlvZFVuaXQ7XG4gIHN0YXJ0OiBEYXRlO1xuICBlbmQ6IERhdGU7XG4gIGxhYmVsPzogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgVGltZVBvbGljeUFsbG9jYXRpb25SZWNvcmQgPSB7XG4gIGlkOiBzdHJpbmc7XG4gIGVmZmVjdGl2ZUF0OiBEYXRlO1xuICBhbGxvY2F0aW9uOiBudW1iZXI7XG4gIGNhcnJ5b3ZlckxpbWl0OiBudW1iZXI7XG4gIG92ZXJkcmFmdExpbWl0OiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBCYXNlQWxsb2NhdGlvblNlZ21lbnQgPSB7XG4gIHRpbWVQb2xpY3lBbGxvY2F0aW9uSWQ6IHN0cmluZztcbiAgZWZmZWN0aXZlQXQ6IERhdGU7XG4gIGZyb206IERhdGU7XG4gIHRvOiBEYXRlO1xuICBkYXlzSW5TZWdtZW50OiBudW1iZXI7XG4gIHBvcnRpb25PZlBlcmlvZDogbnVtYmVyO1xuICBhbGxvY2F0aW9uUmF0ZTogbnVtYmVyO1xuICBjb250cmlidXRpb246IG51bWJlcjtcbn07XG5cbmV4cG9ydCB0eXBlIEJhc2VBbGxvY2F0aW9uUmVzdWx0ID0ge1xuICBhbW91bnQ6IG51bWJlcjtcbiAgYnJlYWtkb3duOiBCYXNlQWxsb2NhdGlvblNlZ21lbnRbXTtcbiAgcGVyaW9kRGF5czogbnVtYmVyO1xuICBhY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbjogVGltZVBvbGljeUFsbG9jYXRpb25SZWNvcmQgfCBudWxsO1xufTtcblxuZXhwb3J0IHR5cGUgQmFzZUFsbG9jYXRpb25JbnB1dCA9IHtcbiAgY29udGV4dDogQ29udGV4dDtcbiAgdGltZVBvbGljeUlkOiBzdHJpbmc7XG4gIHBlcmlvZDogQWxsb2NhdGlvblBlcmlvZDtcbiAgdXNlclN0YXJ0RGF0ZT86IERhdGUgfCBudWxsO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../domains/allowance/types.ts\n");

/***/ }),

/***/ "(api)/../../domains/allowance/utils.ts":
/*!****************************************!*\
  !*** ../../domains/allowance/utils.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clampRange: () => (/* binding */ clampRange),\n/* harmony export */   differenceInDays: () => (/* binding */ differenceInDays),\n/* harmony export */   getUserStartDate: () => (/* binding */ getUserStartDate),\n/* harmony export */   getYearBounds: () => (/* binding */ getYearBounds),\n/* harmony export */   sumAdjustmentEvents: () => (/* binding */ sumAdjustmentEvents),\n/* harmony export */   sumUsageForYear: () => (/* binding */ sumUsageForYear),\n/* harmony export */   toDate: () => (/* binding */ toDate)\n/* harmony export */ });\nconst MS_PER_DAY = 1000 * 60 * 60 * 24;\nconst toDate = (value)=>{\n    if (value instanceof Date) return value;\n    if (typeof value === \"string\" || typeof value === \"number\") return new Date(value);\n    throw new Error(\"Unable to convert value to Date\");\n};\nconst differenceInDays = (start, end)=>Math.max(0, (end.getTime() - start.getTime()) / MS_PER_DAY);\nconst clampRange = (rangeStart, rangeEnd, clampStart, clampEnd)=>{\n    const start = new Date(Math.max(rangeStart.getTime(), clampStart.getTime()));\n    const end = new Date(Math.min(rangeEnd.getTime(), clampEnd.getTime()));\n    if (start.getTime() >= end.getTime()) return null;\n    return {\n        start,\n        end\n    };\n};\nconst getYearBounds = (year)=>{\n    const start = new Date(Date.UTC(year, 0, 1));\n    const end = new Date(Date.UTC(year + 1, 0, 1));\n    const yearEnd = new Date(Date.UTC(year, 11, 31, 23, 59, 59, 999));\n    const nextYearStart = new Date(Date.UTC(year + 1, 0, 1));\n    return {\n        start,\n        end,\n        yearEnd,\n        nextYearStart\n    };\n};\nconst getUserStartDate = async (context, userId)=>{\n    const user = await context.query.User.findOne({\n        where: {\n            id: userId\n        },\n        query: \"id startDate\"\n    });\n    return user?.startDate ? toDate(user.startDate) : null;\n};\nconst sumAdjustmentEvents = async ({ context, userId, timePolicyId, start, end, types })=>{\n    const events = await context.query.UserAllocation.findMany({\n        where: {\n            user: {\n                id: {\n                    equals: userId\n                }\n            },\n            timePolicy: {\n                id: {\n                    equals: timePolicyId\n                }\n            },\n            type: {\n                in: types\n            },\n            effectiveAt: {\n                gte: start.toISOString(),\n                lt: end.toISOString()\n            }\n        },\n        query: \"amount\"\n    });\n    return events.reduce((sum, event)=>sum + (event.amount ?? 0), 0);\n};\nconst sumUsageForYear = async ({ context, userId, timePolicyId, start, end })=>{\n    const requests = await context.query.TimePlan.findMany({\n        where: {\n            user: {\n                id: {\n                    equals: userId\n                }\n            },\n            timePolicy: {\n                id: {\n                    equals: timePolicyId\n                }\n            },\n            status: {\n                equals: \"APPROVED\"\n            },\n            startAt: {\n                lt: end.toISOString()\n            },\n            endAt: {\n                gte: start.toISOString()\n            }\n        },\n        query: \"id startAt endAt duration durationUnit\"\n    });\n    return requests.reduce((sum, request)=>{\n        const requestStart = toDate(request.startAt);\n        const requestEndExclusive = new Date(toDate(request.endAt).getTime() + MS_PER_DAY);\n        const overlap = clampRange(requestStart, requestEndExclusive, start, end);\n        if (!overlap) return sum;\n        const overlapDays = differenceInDays(overlap.start, overlap.end);\n        if (overlapDays <= 0) return sum;\n        const totalDays = differenceInDays(requestStart, requestEndExclusive);\n        const baseDuration = request.durationUnit === \"DAY\" && typeof request.duration === \"number\" && request.duration > 0 ? request.duration : Math.max(totalDays, 0);\n        if (totalDays <= 0) return sum + baseDuration;\n        const ratio = overlapDays / totalDays;\n        return sum + baseDuration * ratio;\n    }, 0);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQ29udGV4dCB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5cbmNvbnN0IE1TX1BFUl9EQVkgPSAxMDAwICogNjAgKiA2MCAqIDI0O1xuXG5leHBvcnQgY29uc3QgdG9EYXRlID0gKHZhbHVlOiB1bmtub3duKTogRGF0ZSA9PiB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHJldHVybiB2YWx1ZTtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykgcmV0dXJuIG5ldyBEYXRlKHZhbHVlKTtcbiAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gY29udmVydCB2YWx1ZSB0byBEYXRlJyk7XG59O1xuXG5leHBvcnQgY29uc3QgZGlmZmVyZW5jZUluRGF5cyA9IChzdGFydDogRGF0ZSwgZW5kOiBEYXRlKSA9PiBNYXRoLm1heCgwLCAoZW5kLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKSkgLyBNU19QRVJfREFZKTtcblxuZXhwb3J0IGNvbnN0IGNsYW1wUmFuZ2UgPSAocmFuZ2VTdGFydDogRGF0ZSwgcmFuZ2VFbmQ6IERhdGUsIGNsYW1wU3RhcnQ6IERhdGUsIGNsYW1wRW5kOiBEYXRlKSA9PiB7XG4gIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoTWF0aC5tYXgocmFuZ2VTdGFydC5nZXRUaW1lKCksIGNsYW1wU3RhcnQuZ2V0VGltZSgpKSk7XG4gIGNvbnN0IGVuZCA9IG5ldyBEYXRlKE1hdGgubWluKHJhbmdlRW5kLmdldFRpbWUoKSwgY2xhbXBFbmQuZ2V0VGltZSgpKSk7XG4gIGlmIChzdGFydC5nZXRUaW1lKCkgPj0gZW5kLmdldFRpbWUoKSkgcmV0dXJuIG51bGw7XG4gIHJldHVybiB7IHN0YXJ0LCBlbmQgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRZZWFyQm91bmRzID0gKHllYXI6IG51bWJlcikgPT4ge1xuICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIDAsIDEpKTtcbiAgY29uc3QgZW5kID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciArIDEsIDAsIDEpKTtcbiAgY29uc3QgeWVhckVuZCA9IG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIDExLCAzMSwgMjMsIDU5LCA1OSwgOTk5KSk7XG4gIGNvbnN0IG5leHRZZWFyU3RhcnQgPSBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyICsgMSwgMCwgMSkpO1xuICByZXR1cm4geyBzdGFydCwgZW5kLCB5ZWFyRW5kLCBuZXh0WWVhclN0YXJ0IH07XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VXNlclN0YXJ0RGF0ZSA9IGFzeW5jIChjb250ZXh0OiBDb250ZXh0LCB1c2VySWQ6IHN0cmluZykgPT4ge1xuICBjb25zdCB1c2VyID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVXNlci5maW5kT25lKHtcbiAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgcXVlcnk6ICdpZCBzdGFydERhdGUnXG4gIH0pKSBhcyB7IHN0YXJ0RGF0ZT86IERhdGUgfCBzdHJpbmcgfCBudWxsIH0gfCBudWxsO1xuICByZXR1cm4gdXNlcj8uc3RhcnREYXRlID8gdG9EYXRlKHVzZXIuc3RhcnREYXRlKSA6IG51bGw7XG59O1xuXG5leHBvcnQgY29uc3Qgc3VtQWRqdXN0bWVudEV2ZW50cyA9IGFzeW5jICh7XG4gIGNvbnRleHQsXG4gIHVzZXJJZCxcbiAgdGltZVBvbGljeUlkLFxuICBzdGFydCxcbiAgZW5kLFxuICB0eXBlc1xufToge1xuICBjb250ZXh0OiBDb250ZXh0O1xuICB1c2VySWQ6IHN0cmluZztcbiAgdGltZVBvbGljeUlkOiBzdHJpbmc7XG4gIHN0YXJ0OiBEYXRlO1xuICBlbmQ6IERhdGU7XG4gIHR5cGVzOiBzdHJpbmdbXTtcbn0pID0+IHtcbiAgY29uc3QgZXZlbnRzID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVXNlckFsbG9jYXRpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VyOiB7IGlkOiB7IGVxdWFsczogdXNlcklkIH0gfSxcbiAgICAgIHRpbWVQb2xpY3k6IHsgaWQ6IHsgZXF1YWxzOiB0aW1lUG9saWN5SWQgfSB9LFxuICAgICAgdHlwZTogeyBpbjogdHlwZXMgfSxcbiAgICAgIGVmZmVjdGl2ZUF0OiB7XG4gICAgICAgIGd0ZTogc3RhcnQudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbHQ6IGVuZC50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgfSxcbiAgICBxdWVyeTogJ2Ftb3VudCdcbiAgfSkpIGFzIEFycmF5PHsgYW1vdW50PzogbnVtYmVyIHwgbnVsbCB9PjtcblxuICByZXR1cm4gZXZlbnRzLnJlZHVjZSgoc3VtLCBldmVudCkgPT4gc3VtICsgKGV2ZW50LmFtb3VudCA/PyAwKSwgMCk7XG59O1xuXG5leHBvcnQgY29uc3Qgc3VtVXNhZ2VGb3JZZWFyID0gYXN5bmMgKHtcbiAgY29udGV4dCxcbiAgdXNlcklkLFxuICB0aW1lUG9saWN5SWQsXG4gIHN0YXJ0LFxuICBlbmRcbn06IHtcbiAgY29udGV4dDogQ29udGV4dDtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHRpbWVQb2xpY3lJZDogc3RyaW5nO1xuICBzdGFydDogRGF0ZTtcbiAgZW5kOiBEYXRlO1xufSkgPT4ge1xuICBjb25zdCByZXF1ZXN0cyA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQbGFuLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcjogeyBpZDogeyBlcXVhbHM6IHVzZXJJZCB9IH0sXG4gICAgICB0aW1lUG9saWN5OiB7IGlkOiB7IGVxdWFsczogdGltZVBvbGljeUlkIH0gfSxcbiAgICAgIHN0YXR1czogeyBlcXVhbHM6ICdBUFBST1ZFRCcgfSxcbiAgICAgIHN0YXJ0QXQ6IHsgbHQ6IGVuZC50b0lTT1N0cmluZygpIH0sXG4gICAgICBlbmRBdDogeyBndGU6IHN0YXJ0LnRvSVNPU3RyaW5nKCkgfVxuICAgIH0sXG4gICAgcXVlcnk6ICdpZCBzdGFydEF0IGVuZEF0IGR1cmF0aW9uIGR1cmF0aW9uVW5pdCdcbiAgfSkpIGFzIEFycmF5PHsgc3RhcnRBdDogc3RyaW5nOyBlbmRBdDogc3RyaW5nOyBkdXJhdGlvbj86IG51bWJlciB8IG51bGw7IGR1cmF0aW9uVW5pdD86IHN0cmluZyB8IG51bGwgfT47XG5cbiAgcmV0dXJuIHJlcXVlc3RzLnJlZHVjZSgoc3VtLCByZXF1ZXN0KSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdFN0YXJ0ID0gdG9EYXRlKHJlcXVlc3Quc3RhcnRBdCk7XG4gICAgY29uc3QgcmVxdWVzdEVuZEV4Y2x1c2l2ZSA9IG5ldyBEYXRlKHRvRGF0ZShyZXF1ZXN0LmVuZEF0KS5nZXRUaW1lKCkgKyBNU19QRVJfREFZKTtcbiAgICBjb25zdCBvdmVybGFwID0gY2xhbXBSYW5nZShyZXF1ZXN0U3RhcnQsIHJlcXVlc3RFbmRFeGNsdXNpdmUsIHN0YXJ0LCBlbmQpO1xuICAgIGlmICghb3ZlcmxhcCkgcmV0dXJuIHN1bTtcblxuICAgIGNvbnN0IG92ZXJsYXBEYXlzID0gZGlmZmVyZW5jZUluRGF5cyhvdmVybGFwLnN0YXJ0LCBvdmVybGFwLmVuZCk7XG4gICAgaWYgKG92ZXJsYXBEYXlzIDw9IDApIHJldHVybiBzdW07XG5cbiAgICBjb25zdCB0b3RhbERheXMgPSBkaWZmZXJlbmNlSW5EYXlzKHJlcXVlc3RTdGFydCwgcmVxdWVzdEVuZEV4Y2x1c2l2ZSk7XG4gICAgY29uc3QgYmFzZUR1cmF0aW9uID1cbiAgICAgIHJlcXVlc3QuZHVyYXRpb25Vbml0ID09PSAnREFZJyAmJiB0eXBlb2YgcmVxdWVzdC5kdXJhdGlvbiA9PT0gJ251bWJlcicgJiYgcmVxdWVzdC5kdXJhdGlvbiA+IDBcbiAgICAgICAgPyByZXF1ZXN0LmR1cmF0aW9uXG4gICAgICAgIDogTWF0aC5tYXgodG90YWxEYXlzLCAwKTtcblxuICAgIGlmICh0b3RhbERheXMgPD0gMCkgcmV0dXJuIHN1bSArIGJhc2VEdXJhdGlvbjtcbiAgICBjb25zdCByYXRpbyA9IG92ZXJsYXBEYXlzIC8gdG90YWxEYXlzO1xuICAgIHJldHVybiBzdW0gKyBiYXNlRHVyYXRpb24gKiByYXRpbztcbiAgfSwgMCk7XG59O1xuIl0sIm5hbWVzIjpbIk1TX1BFUl9EQVkiLCJ0b0RhdGUiLCJ2YWx1ZSIsIkRhdGUiLCJFcnJvciIsImRpZmZlcmVuY2VJbkRheXMiLCJzdGFydCIsImVuZCIsIk1hdGgiLCJtYXgiLCJnZXRUaW1lIiwiY2xhbXBSYW5nZSIsInJhbmdlU3RhcnQiLCJyYW5nZUVuZCIsImNsYW1wU3RhcnQiLCJjbGFtcEVuZCIsIm1pbiIsImdldFllYXJCb3VuZHMiLCJ5ZWFyIiwiVVRDIiwieWVhckVuZCIsIm5leHRZZWFyU3RhcnQiLCJnZXRVc2VyU3RhcnREYXRlIiwiY29udGV4dCIsInVzZXJJZCIsInVzZXIiLCJxdWVyeSIsIlVzZXIiLCJmaW5kT25lIiwid2hlcmUiLCJpZCIsInN0YXJ0RGF0ZSIsInN1bUFkanVzdG1lbnRFdmVudHMiLCJ0aW1lUG9saWN5SWQiLCJ0eXBlcyIsImV2ZW50cyIsIlVzZXJBbGxvY2F0aW9uIiwiZmluZE1hbnkiLCJlcXVhbHMiLCJ0aW1lUG9saWN5IiwidHlwZSIsImluIiwiZWZmZWN0aXZlQXQiLCJndGUiLCJ0b0lTT1N0cmluZyIsImx0IiwicmVkdWNlIiwic3VtIiwiZXZlbnQiLCJhbW91bnQiLCJzdW1Vc2FnZUZvclllYXIiLCJyZXF1ZXN0cyIsIlRpbWVQbGFuIiwic3RhdHVzIiwic3RhcnRBdCIsImVuZEF0IiwicmVxdWVzdCIsInJlcXVlc3RTdGFydCIsInJlcXVlc3RFbmRFeGNsdXNpdmUiLCJvdmVybGFwIiwib3ZlcmxhcERheXMiLCJ0b3RhbERheXMiLCJiYXNlRHVyYXRpb24iLCJkdXJhdGlvblVuaXQiLCJkdXJhdGlvbiIsInJhdGlvIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../domains/allowance/utils.ts\n");

/***/ }),

/***/ "(api)/../../domains/timePlan/directEntry.ts":
/*!*********************************************!*\
  !*** ../../domains/timePlan/directEntry.ts ***!
  \*********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createDirectAvailabilityEntry: () => (/* binding */ createDirectAvailabilityEntry),\n/* harmony export */   createDirectTimePlanEntry: () => (/* binding */ createDirectTimePlanEntry),\n/* harmony export */   findPolicyForAvailabilityType: () => (/* binding */ findPolicyForAvailabilityType),\n/* harmony export */   findPolicyForTimeType: () => (/* binding */ findPolicyForTimeType),\n/* harmony export */   resolveSessionUser: () => (/* binding */ resolveSessionUser),\n/* harmony export */   toMidnightUtc: () => (/* binding */ toMidnightUtc)\n/* harmony export */ });\n/* harmony import */ var _lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/holidays/dateHolidays */ \"(api)/../../lib/holidays/dateHolidays.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst defaultWorkingDays = [\n    \"MON\",\n    \"TUE\",\n    \"WED\",\n    \"THU\",\n    \"FRI\"\n];\nconst dayIndexToCode = [\n    \"SUN\",\n    \"MON\",\n    \"TUE\",\n    \"WED\",\n    \"THU\",\n    \"FRI\",\n    \"SAT\"\n];\nconst isStringArray = (value)=>Array.isArray(value) && value.every((item)=>typeof item === \"string\");\nconst toMidnightUtc = (value)=>new Date(Date.UTC(value.getUTCFullYear(), value.getUTCMonth(), value.getUTCDate(), 0, 0, 0, 0));\nconst resolveSessionUser = async ({ context, session })=>{\n    if (!session?.email) throw new Error(\"Unauthorized\");\n    const users = await context.query.User.findMany({\n        where: {\n            email: {\n                equals: session.email\n            }\n        },\n        query: \"id org { id } location { id workingDays weekStartDay holidayCountry }\"\n    });\n    const me = users?.[0];\n    if (!me?.org?.id) throw new Error(\"User is not part of an organization\");\n    return {\n        userId: me.id,\n        orgId: me.org.id,\n        location: me.location ?? null\n    };\n};\nconst findPolicyForTimeType = async ({ context, timeTypeId, orgId, locationId })=>{\n    const baseWhere = {\n        timeType: {\n            id: {\n                equals: timeTypeId\n            }\n        },\n        org: {\n            id: {\n                equals: orgId\n            }\n        }\n    };\n    const locationAwareWhere = {\n        ...baseWhere,\n        ...locationId && {\n            locations: {\n                some: {\n                    id: {\n                        equals: locationId\n                    }\n                }\n            }\n        }\n    };\n    const policies = await context.query.TimePolicy.findMany({\n        where: locationAwareWhere,\n        query: \"id\"\n    });\n    if (policies.length) return policies[0];\n    if (locationId) {\n        const fallbackPolicies = await context.query.TimePolicy.findMany({\n            where: baseWhere,\n            query: \"id\"\n        });\n        if (fallbackPolicies.length > 0) return fallbackPolicies[0];\n    }\n    return null;\n};\nconst iso = (d)=>d.toISOString().substring(0, 10);\nconst daysBetweenInclusive = (a, b)=>Array.from({\n        length: Math.floor((b.getTime() - a.getTime()) / (24 * 3600 * 1000)) + 1\n    }, (_, i)=>new Date(Date.UTC(a.getUTCFullYear(), a.getUTCMonth(), a.getUTCDate() + i)));\nconst createDirectTimePlanEntry = async ({ context, session, input, options })=>{\n    const { timeTypeId, startDateTime, endDateTime, isHalfDay, reason } = input;\n    const sessionUser = await resolveSessionUser({\n        context,\n        session\n    });\n    const startRaw = new Date(startDateTime);\n    const endRaw = new Date(endDateTime);\n    if (Number.isNaN(startRaw.getTime()) || Number.isNaN(endRaw.getTime()) || startRaw > endRaw) throw new Error(\"Invalid date range\");\n    const start = toMidnightUtc(startRaw);\n    const end = toMidnightUtc(endRaw);\n    const timeType = await context.query.TimeType.findOne({\n        where: {\n            id: timeTypeId\n        },\n        query: \"id org { id }\"\n    });\n    if (!timeType || timeType.org?.id !== sessionUser.orgId) {\n        throw new Error(\"Time type not found\");\n    }\n    const timePolicy = await findPolicyForTimeType({\n        context,\n        timeTypeId: timeType.id,\n        orgId: sessionUser.orgId,\n        locationId: sessionUser.location?.id\n    });\n    if (!timePolicy?.id) throw new Error(\"No time policy configured for this time type and location.\");\n    const policyDetails = await context.query.TimePolicy.findOne({\n        where: {\n            id: timePolicy.id\n        },\n        query: \"id isAllocationManaged isApprovable timePolicyAllocations(orderBy: { effectiveAt: desc }, take: 1) { id allocation overdraftLimit }\"\n    });\n    const allocationConfig = policyDetails?.timePolicyAllocations?.[0] ?? null;\n    const allocation = typeof allocationConfig?.allocation === \"number\" ? allocationConfig.allocation : null;\n    const overdraftLimit = typeof allocationConfig?.overdraftLimit === \"number\" ? allocationConfig.overdraftLimit : 0;\n    const workingDays = isStringArray(sessionUser.location?.workingDays) && sessionUser.location.workingDays.length ? sessionUser.location.workingDays : Array.from(defaultWorkingDays);\n    const cfg = {\n        holidayCountry: sessionUser.location?.holidayCountry ?? null,\n        workingDays,\n        allocation,\n        overdraftLimit,\n        isAllocationManaged: policyDetails?.isAllocationManaged ?? false\n    };\n    const workingDaySet = new Set(cfg.workingDays.length ? cfg.workingDays : defaultWorkingDays);\n    const isWorkingDay = (d)=>workingDaySet.has(dayIndexToCode[d.getUTCDay()]);\n    const buildHolidaySet = (rangeStart, rangeEnd)=>{\n        const base = cfg.holidayCountry ? (0,_lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_0__.getHolidaysInRange)({\n            country: cfg.holidayCountry,\n            start: rangeStart,\n            end: rangeEnd\n        }) : [];\n        const filtered = base.filter((h)=>{\n            const dt = new Date(h.date + \"T00:00:00.000Z\");\n            return isWorkingDay(dt);\n        });\n        return new Set(filtered.map((h)=>h.date));\n    };\n    const holidaySet = buildHolidaySet(start, end);\n    const requestedDays = start.getTime() === end.getTime() && !!isHalfDay ? 0.5 : daysBetweenInclusive(start, end).filter((d)=>isWorkingDay(d) && !holidaySet.has(iso(d))).length;\n    const now = new Date();\n    const startOfYear = new Date(Date.UTC(now.getUTCFullYear(), 0, 1));\n    const endOfYear = new Date(Date.UTC(now.getUTCFullYear(), 11, 31, 23, 59, 59, 999));\n    const overlapWhere = {\n        user: {\n            id: {\n                equals: sessionUser.userId\n            }\n        },\n        timePolicy: {\n            id: {\n                equals: timePolicy.id\n            }\n        },\n        status: {\n            in: [\n                \"PENDING\",\n                \"APPROVED\"\n            ]\n        }\n    };\n    const excludeId = options?.excludeTimePlanId ?? null;\n    const overlapFilters = excludeId ? {\n        ...overlapWhere,\n        id: {\n            not: {\n                equals: excludeId\n            }\n        }\n    } : overlapWhere;\n    const overlapping = await context.query.TimePlan.findMany({\n        where: {\n            ...overlapFilters,\n            startAt: {\n                lte: end.toISOString()\n            },\n            endAt: {\n                gte: start.toISOString()\n            }\n        },\n        query: \"id startAt endAt\"\n    });\n    if (overlapping.length > 0) {\n        throw new Error(\"You already have a pending or approved request for this time policy that overlaps with the requested dates.\");\n    }\n    const existing = await context.query.TimePlan.findMany({\n        where: {\n            ...overlapFilters,\n            startAt: {\n                lte: endOfYear.toISOString()\n            },\n            endAt: {\n                gte: startOfYear.toISOString()\n            }\n        },\n        query: \"id startAt endAt duration durationUnit\"\n    });\n    const sumExisting = existing.reduce((sum, current)=>{\n        if (typeof current.duration === \"number\" && current.duration > 0 && current.durationUnit === \"DAY\") {\n            return sum + current.duration;\n        }\n        const s = toMidnightUtc(new Date(current.startAt));\n        const e = toMidnightUtc(new Date(current.endAt));\n        const rangeStart = s < startOfYear ? startOfYear : s;\n        const rangeEnd = e > endOfYear ? endOfYear : e;\n        const hs = buildHolidaySet(rangeStart, rangeEnd);\n        const days = daysBetweenInclusive(rangeStart, rangeEnd).filter((d)=>isWorkingDay(d) && !hs.has(iso(d))).length;\n        return sum + days;\n    }, 0);\n    if (cfg.isAllocationManaged && typeof cfg.allocation === \"number\") {\n        const remainingAfter = cfg.allocation - sumExisting - requestedDays;\n        if (remainingAfter < -cfg.overdraftLimit) {\n            throw new Error(\"Request exceeds allowed negative balance\");\n        }\n    }\n    const isApprovable = policyDetails?.isApprovable !== false;\n    const status = isApprovable ? \"PENDING\" : \"APPROVED\";\n    return await context.db.TimePlan.createOne({\n        data: {\n            org: {\n                connect: {\n                    id: sessionUser.orgId\n                }\n            },\n            user: {\n                connect: {\n                    id: sessionUser.userId\n                }\n            },\n            timeType: {\n                connect: {\n                    id: timeType.id\n                }\n            },\n            timePolicy: {\n                connect: {\n                    id: timePolicy.id\n                }\n            },\n            status,\n            origin: \"DIRECT\",\n            startAt: start.toISOString(),\n            endAt: end.toISOString(),\n            durationUnit: \"DAY\",\n            duration: requestedDays,\n            isAllDay: !(start.getTime() === end.getTime() && !!isHalfDay),\n            repeatMode: \"SINGLE\",\n            reason: typeof reason === \"string\" ? reason : \"\"\n        }\n    });\n};\n// Backward-compatible aliases for old code\nconst findPolicyForAvailabilityType = findPolicyForTimeType;\nconst createDirectAvailabilityEntry = createDirectTimePlanEntry;\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy90aW1lUGxhbi9kaXJlY3RFbnRyeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBRXFFO0FBRXJFLE1BQU1DLHFCQUFxQjtJQUFDO0lBQU87SUFBTztJQUFPO0lBQU87Q0FBTTtBQUM5RCxNQUFNQyxpQkFBaUI7SUFBQztJQUFPO0lBQU87SUFBTztJQUFPO0lBQU87SUFBTztDQUFNO0FBRXhFLE1BQU1DLGdCQUFnQixDQUFDQyxRQUNyQkMsTUFBTUMsT0FBTyxDQUFDRixVQUFVQSxNQUFNRyxLQUFLLENBQUNDLENBQUFBLE9BQVEsT0FBT0EsU0FBUztBQUV2RCxNQUFNQyxnQkFBZ0IsQ0FBQ0wsUUFDNUIsSUFBSU0sS0FBS0EsS0FBS0MsR0FBRyxDQUFDUCxNQUFNUSxjQUFjLElBQUlSLE1BQU1TLFdBQVcsSUFBSVQsTUFBTVUsVUFBVSxJQUFJLEdBQUcsR0FBRyxHQUFHLElBQUk7QUFlM0YsTUFBTUMscUJBQXFCLE9BQU8sRUFDdkNDLE9BQU8sRUFDUEMsT0FBTyxFQUlSO0lBQ0MsSUFBSSxDQUFDQSxTQUFTQyxPQUFPLE1BQU0sSUFBSUMsTUFBTTtJQUVyQyxNQUFNQyxRQUFTLE1BQU1KLFFBQVFLLEtBQUssQ0FBQ0MsSUFBSSxDQUFDQyxRQUFRLENBQUM7UUFDL0NDLE9BQU87WUFBRU4sT0FBTztnQkFBRU8sUUFBUVIsUUFBUUMsS0FBSztZQUFDO1FBQUU7UUFDMUNHLE9BQU87SUFDVDtJQUtBLE1BQU1LLEtBQUtOLE9BQU8sQ0FBQyxFQUFFO0lBQ3JCLElBQUksQ0FBQ00sSUFBSUMsS0FBS0MsSUFBSSxNQUFNLElBQUlULE1BQU07SUFFbEMsT0FBTztRQUNMVSxRQUFRSCxHQUFHRSxFQUFFO1FBQ2JFLE9BQU9KLEdBQUdDLEdBQUcsQ0FBQ0MsRUFBRTtRQUNoQkcsVUFBVUwsR0FBR0ssUUFBUSxJQUFJO0lBQzNCO0FBQ0YsRUFBRTtBQUVLLE1BQU1DLHdCQUF3QixPQUFPLEVBQzFDaEIsT0FBTyxFQUNQaUIsVUFB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L2RvbWFpbnMvdGltZVBsYW4vZGlyZWN0RW50cnkudHM/MGFiNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFR5cGVJbmZvIH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcbmltcG9ydCB7IFNlc3Npb24gfSBmcm9tICdhdXRoJztcbmltcG9ydCB7IGdldEhvbGlkYXlzSW5SYW5nZSB9IGZyb20gJy4uLy4uL2xpYi9ob2xpZGF5cy9kYXRlSG9saWRheXMnO1xuXG5jb25zdCBkZWZhdWx0V29ya2luZ0RheXMgPSBbJ01PTicsICdUVUUnLCAnV0VEJywgJ1RIVScsICdGUkknXSBhcyBjb25zdDtcbmNvbnN0IGRheUluZGV4VG9Db2RlID0gWydTVU4nLCAnTU9OJywgJ1RVRScsICdXRUQnLCAnVEhVJywgJ0ZSSScsICdTQVQnXSBhcyBjb25zdDtcblxuY29uc3QgaXNTdHJpbmdBcnJheSA9ICh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIHN0cmluZ1tdID0+XG4gIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmV2ZXJ5KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKTtcblxuZXhwb3J0IGNvbnN0IHRvTWlkbmlnaHRVdGMgPSAodmFsdWU6IERhdGUpID0+XG4gIG5ldyBEYXRlKERhdGUuVVRDKHZhbHVlLmdldFVUQ0Z1bGxZZWFyKCksIHZhbHVlLmdldFVUQ01vbnRoKCksIHZhbHVlLmdldFVUQ0RhdGUoKSwgMCwgMCwgMCwgMCkpO1xuXG50eXBlIFVzZXJJdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ1VzZXInXVsnaXRlbSddO1xudHlwZSBUaW1lUGxhbkl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVGltZVBsYW4nXVsnaXRlbSddO1xudHlwZSBUaW1lVHlwZUl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVGltZVR5cGUnXVsnaXRlbSddO1xudHlwZSBMb2NhdGlvbkl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnTG9jYXRpb24nXVsnaXRlbSddO1xudHlwZSBPcmdhbml6YXRpb25JdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ09yZ2FuaXphdGlvbiddWydpdGVtJ107XG50eXBlIFRpbWVQb2xpY3lJdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ1RpbWVQb2xpY3knXVsnaXRlbSddO1xuXG50eXBlIFNlc3Npb25Vc2VyQ29udGV4dCA9IHtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIG9yZ0lkOiBzdHJpbmc7XG4gIGxvY2F0aW9uOiBQaWNrPExvY2F0aW9uSXRlbSwgJ2lkJyB8ICd3b3JraW5nRGF5cycgfCAnd2Vla1N0YXJ0RGF5JyB8ICdob2xpZGF5Q291bnRyeSc+IHwgbnVsbDtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNvbHZlU2Vzc2lvblVzZXIgPSBhc3luYyAoe1xuICBjb250ZXh0LFxuICBzZXNzaW9uXG59OiB7XG4gIGNvbnRleHQ6IGFueTtcbiAgc2Vzc2lvbjogU2Vzc2lvbiB8IG51bGw7XG59KTogUHJvbWlzZTxTZXNzaW9uVXNlckNvbnRleHQ+ID0+IHtcbiAgaWYgKCFzZXNzaW9uPy5lbWFpbCkgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcblxuICBjb25zdCB1c2VycyA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7IGVtYWlsOiB7IGVxdWFsczogc2Vzc2lvbi5lbWFpbCB9IH0sXG4gICAgcXVlcnk6ICdpZCBvcmcgeyBpZCB9IGxvY2F0aW9uIHsgaWQgd29ya2luZ0RheXMgd2Vla1N0YXJ0RGF5IGhvbGlkYXlDb3VudHJ5IH0nXG4gIH0pKSBhcyAoUGljazxVc2VySXRlbSwgJ2lkJz4gJiB7XG4gICAgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICBsb2NhdGlvbjogUGljazxMb2NhdGlvbkl0ZW0sICdpZCcgfCAnd29ya2luZ0RheXMnIHwgJ3dlZWtTdGFydERheScgfCAnaG9saWRheUNvdW50cnknPiB8IG51bGw7XG4gIH0pW107XG5cbiAgY29uc3QgbWUgPSB1c2Vycz8uWzBdO1xuICBpZiAoIW1lPy5vcmc/LmlkKSB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgaXMgbm90IHBhcnQgb2YgYW4gb3JnYW5pemF0aW9uJyk7XG5cbiAgcmV0dXJuIHtcbiAgICB1c2VySWQ6IG1lLmlkLFxuICAgIG9yZ0lkOiBtZS5vcmcuaWQsXG4gICAgbG9jYXRpb246IG1lLmxvY2F0aW9uID8/IG51bGxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBmaW5kUG9saWN5Rm9yVGltZVR5cGUgPSBhc3luYyAoe1xuICBjb250ZXh0LFxuICB0aW1lVHlwZUlkLFxuICBvcmdJZCxcbiAgbG9jYXRpb25JZFxufToge1xuICBjb250ZXh0OiBhbnk7XG4gIHRpbWVUeXBlSWQ6IHN0cmluZztcbiAgb3JnSWQ6IHN0cmluZztcbiAgbG9jYXRpb25JZD86IHN0cmluZyB8IG51bGw7XG59KSA9PiB7XG4gIGNvbnN0IGJhc2VXaGVyZSA9IHtcbiAgICB0aW1lVHlwZTogeyBpZDogeyBlcXVhbHM6IHRpbWVUeXBlSWQgfSB9LFxuICAgIG9yZzogeyBpZDogeyBlcXVhbHM6IG9yZ0lkIH0gfVxuICB9O1xuXG4gIGNvbnN0IGxvY2F0aW9uQXdhcmVXaGVyZSA9IHtcbiAgICAuLi5iYXNlV2hlcmUsXG4gICAgLi4uKGxvY2F0aW9uSWQgJiYgeyBsb2NhdGlvbnM6IHsgc29tZTogeyBpZDogeyBlcXVhbHM6IGxvY2F0aW9uSWQgfSB9IH0gfSlcbiAgfTtcblxuICBjb25zdCBwb2xpY2llcyA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQb2xpY3kuZmluZE1hbnkoe1xuICAgIHdoZXJlOiBsb2NhdGlvbkF3YXJlV2hlcmUsXG4gICAgcXVlcnk6ICdpZCdcbiAgfSkpIGFzIFBpY2s8VGltZVBvbGljeUl0ZW0sICdpZCc+W107XG5cbiAgaWYgKHBvbGljaWVzLmxlbmd0aCkgcmV0dXJuIHBvbGljaWVzWzBdO1xuXG4gIGlmIChsb2NhdGlvbklkKSB7XG4gICAgY29uc3QgZmFsbGJhY2tQb2xpY2llcyA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQb2xpY3kuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IGJhc2VXaGVyZSxcbiAgICAgIHF1ZXJ5OiAnaWQnXG4gICAgfSkpIGFzIFBpY2s8VGltZVBvbGljeUl0ZW0sICdpZCc+W107XG4gICAgaWYgKGZhbGxiYWNrUG9saWNpZXMubGVuZ3RoID4gMCkgcmV0dXJuIGZhbGxiYWNrUG9saWNpZXNbMF07XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbnR5cGUgQ3JlYXRlRGlyZWN0VGltZVBsYW5JbnB1dCA9IHtcbiAgdGltZVR5cGVJZDogc3RyaW5nO1xuICBzdGFydERhdGVUaW1lOiBzdHJpbmc7XG4gIGVuZERhdGVUaW1lOiBzdHJpbmc7XG4gIGlzSGFsZkRheT86IGJvb2xlYW4gfCBudWxsO1xuICByZWFzb24/OiBzdHJpbmcgfCBudWxsO1xufTtcblxuY29uc3QgaXNvID0gKGQ6IERhdGUpID0+IGQudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApO1xuXG5jb25zdCBkYXlzQmV0d2VlbkluY2x1c2l2ZSA9IChhOiBEYXRlLCBiOiBEYXRlKSA9PlxuICBBcnJheS5mcm9tKFxuICAgIHsgbGVuZ3RoOiBNYXRoLmZsb29yKChiLmdldFRpbWUoKSAtIGEuZ2V0VGltZSgpKSAvICgyNCAqIDM2MDAgKiAxMDAwKSkgKyAxIH0sXG4gICAgKF8sIGkpID0+IG5ldyBEYXRlKERhdGUuVVRDKGEuZ2V0VVRDRnVsbFllYXIoKSwgYS5nZXRVVENNb250aCgpLCBhLmdldFVUQ0RhdGUoKSArIGkpKVxuICApO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlRGlyZWN0VGltZVBsYW5FbnRyeSA9IGFzeW5jICh7XG4gIGNvbnRleHQsXG4gIHNlc3Npb24sXG4gIGlucHV0LFxuICBvcHRpb25zXG59OiB7XG4gIGNvbnRleHQ6IGFueTtcbiAgc2Vzc2lvbjogU2Vzc2lvbiB8IG51bGw7XG4gIGlucHV0OiBDcmVhdGVEaXJlY3RUaW1lUGxhbklucHV0O1xuICBvcHRpb25zPzogeyBleGNsdWRlVGltZVBsYW5JZD86IHN0cmluZyB8IG51bGwgfTtcbn0pID0+IHtcbiAgY29uc3QgeyB0aW1lVHlwZUlkLCBzdGFydERhdGVUaW1lLCBlbmREYXRlVGltZSwgaXNIYWxmRGF5LCByZWFzb24gfSA9IGlucHV0O1xuICBjb25zdCBzZXNzaW9uVXNlciA9IGF3YWl0IHJlc29sdmVTZXNzaW9uVXNlcih7IGNvbnRleHQsIHNlc3Npb24gfSk7XG5cbiAgY29uc3Qgc3RhcnRSYXcgPSBuZXcgRGF0ZShzdGFydERhdGVUaW1lKTtcbiAgY29uc3QgZW5kUmF3ID0gbmV3IERhdGUoZW5kRGF0ZVRpbWUpO1xuICBpZiAoTnVtYmVyLmlzTmFOKHN0YXJ0UmF3LmdldFRpbWUoKSkgfHwgTnVtYmVyLmlzTmFOKGVuZFJhdy5nZXRUaW1lKCkpIHx8IHN0YXJ0UmF3ID4gZW5kUmF3KVxuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkYXRlIHJhbmdlJyk7XG5cbiAgY29uc3Qgc3RhcnQgPSB0b01pZG5pZ2h0VXRjKHN0YXJ0UmF3KTtcbiAgY29uc3QgZW5kID0gdG9NaWRuaWdodFV0YyhlbmRSYXcpO1xuXG4gIGNvbnN0IHRpbWVUeXBlID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVGltZVR5cGUuZmluZE9uZSh7XG4gICAgd2hlcmU6IHsgaWQ6IHRpbWVUeXBlSWQgfSxcbiAgICBxdWVyeTogJ2lkIG9yZyB7IGlkIH0nXG4gIH0pKSBhcyAoUGljazxUaW1lVHlwZUl0ZW0sICdpZCc+ICYgeyBvcmc6IFBpY2s8T3JnYW5pemF0aW9uSXRlbSwgJ2lkJz4gfCBudWxsIH0pIHwgbnVsbDtcblxuICBpZiAoIXRpbWVUeXBlIHx8IHRpbWVUeXBlLm9yZz8uaWQgIT09IHNlc3Npb25Vc2VyLm9yZ0lkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaW1lIHR5cGUgbm90IGZvdW5kJyk7XG4gIH1cblxuICBjb25zdCB0aW1lUG9saWN5ID0gYXdhaXQgZmluZFBvbGljeUZvclRpbWVUeXBlKHtcbiAgICBjb250ZXh0LFxuICAgIHRpbWVUeXBlSWQ6IHRpbWVUeXBlLmlkLFxuICAgIG9yZ0lkOiBzZXNzaW9uVXNlci5vcmdJZCxcbiAgICBsb2NhdGlvbklkOiBzZXNzaW9uVXNlci5sb2NhdGlvbj8uaWRcbiAgfSk7XG4gIGlmICghdGltZVBvbGljeT8uaWQpIHRocm93IG5ldyBFcnJvcignTm8gdGltZSBwb2xpY3kgY29uZmlndXJlZCBmb3IgdGhpcyB0aW1lIHR5cGUgYW5kIGxvY2F0aW9uLicpO1xuXG4gIGNvbnN0IHBvbGljeURldGFpbHMgPSAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUG9saWN5LmZpbmRPbmUoe1xuICAgIHdoZXJlOiB7IGlkOiB0aW1lUG9saWN5LmlkIH0sXG4gICAgcXVlcnk6XG4gICAgICAnaWQgaXNBbGxvY2F0aW9uTWFuYWdlZCBpc0FwcHJvdmFibGUgdGltZVBvbGljeUFsbG9jYXRpb25zKG9yZGVyQnk6IHsgZWZmZWN0aXZlQXQ6IGRlc2MgfSwgdGFrZTogMSkgeyBpZCBhbGxvY2F0aW9uIG92ZXJkcmFmdExpbWl0IH0nXG4gIH0pKSBhc1xuICAgIHwgKFBpY2s8VGltZVBvbGljeUl0ZW0sICdpZCcgfCAnaXNBbGxvY2F0aW9uTWFuYWdlZCcgfCAnaXNBcHByb3ZhYmxlJz4gJiB7XG4gICAgICAgIHRpbWVQb2xpY3lBbGxvY2F0aW9ucz86IEFycmF5PHsgaWQ6IHN0cmluZzsgYWxsb2NhdGlvbjogbnVtYmVyIHwgbnVsbDsgb3ZlcmRyYWZ0TGltaXQ6IG51bWJlciB8IG51bGwgfSB8IG51bGw+O1xuICAgICAgfSlcbiAgICB8IG51bGw7XG5cbiAgY29uc3QgYWxsb2NhdGlvbkNvbmZpZyA9IHBvbGljeURldGFpbHM/LnRpbWVQb2xpY3lBbGxvY2F0aW9ucz8uWzBdID8/IG51bGw7XG4gIGNvbnN0IGFsbG9jYXRpb24gPSB0eXBlb2YgYWxsb2NhdGlvbkNvbmZpZz8uYWxsb2NhdGlvbiA9PT0gJ251bWJlcicgPyAoYWxsb2NhdGlvbkNvbmZpZy5hbGxvY2F0aW9uIGFzIG51bWJlcikgOiBudWxsO1xuICBjb25zdCBvdmVyZHJhZnRMaW1pdCA9XG4gICAgdHlwZW9mIGFsbG9jYXRpb25Db25maWc/Lm92ZXJkcmFmdExpbWl0ID09PSAnbnVtYmVyJyA/IChhbGxvY2F0aW9uQ29uZmlnLm92ZXJkcmFmdExpbWl0IGFzIG51bWJlcikgOiAwO1xuXG4gIGNvbnN0IHdvcmtpbmdEYXlzID1cbiAgICBpc1N0cmluZ0FycmF5KHNlc3Npb25Vc2VyLmxvY2F0aW9uPy53b3JraW5nRGF5cykgJiYgc2Vzc2lvblVzZXIubG9jYXRpb24ud29ya2luZ0RheXMubGVuZ3RoXG4gICAgICA/IHNlc3Npb25Vc2VyLmxvY2F0aW9uLndvcmtpbmdEYXlzXG4gICAgICA6IEFycmF5LmZyb20oZGVmYXVsdFdvcmtpbmdEYXlzKTtcblxuICBjb25zdCBjZmcgPSB7XG4gICAgaG9saWRheUNvdW50cnk6IHNlc3Npb25Vc2VyLmxvY2F0aW9uPy5ob2xpZGF5Q291bnRyeSA/PyBudWxsLFxuICAgIHdvcmtpbmdEYXlzLFxuICAgIGFsbG9jYXRpb24sXG4gICAgb3ZlcmRyYWZ0TGltaXQsXG4gICAgaXNBbGxvY2F0aW9uTWFuYWdlZDogcG9saWN5RGV0YWlscz8uaXNBbGxvY2F0aW9uTWFuYWdlZCA/PyBmYWxzZVxuICB9O1xuXG4gIGNvbnN0IHdvcmtpbmdEYXlTZXQgPSBuZXcgU2V0PHN0cmluZz4oY2ZnLndvcmtpbmdEYXlzLmxlbmd0aCA/IGNmZy53b3JraW5nRGF5cyA6IGRlZmF1bHRXb3JraW5nRGF5cyk7XG4gIGNvbnN0IGlzV29ya2luZ0RheSA9IChkOiBEYXRlKSA9PiB3b3JraW5nRGF5U2V0LmhhcyhkYXlJbmRleFRvQ29kZVtkLmdldFVUQ0RheSgpXSk7XG4gIGNvbnN0IGJ1aWxkSG9saWRheVNldCA9IChyYW5nZVN0YXJ0OiBEYXRlLCByYW5nZUVuZDogRGF0ZSkgPT4ge1xuICAgIGNvbnN0IGJhc2UgPSBjZmcuaG9saWRheUNvdW50cnlcbiAgICAgID8gZ2V0SG9saWRheXNJblJhbmdlKHsgY291bnRyeTogY2ZnLmhvbGlkYXlDb3VudHJ5LCBzdGFydDogcmFuZ2VTdGFydCwgZW5kOiByYW5nZUVuZCB9KVxuICAgICAgOiBbXTtcbiAgICBjb25zdCBmaWx0ZXJlZCA9IGJhc2UuZmlsdGVyKGggPT4ge1xuICAgICAgY29uc3QgZHQgPSBuZXcgRGF0ZShoLmRhdGUgKyAnVDAwOjAwOjAwLjAwMFonKTtcbiAgICAgIHJldHVybiBpc1dvcmtpbmdEYXkoZHQpO1xuICAgIH0pO1xuICAgIHJldHVybiBuZXcgU2V0KGZpbHRlcmVkLm1hcChoID0+IGguZGF0ZSkpO1xuICB9O1xuXG4gIGNvbnN0IGhvbGlkYXlTZXQgPSBidWlsZEhvbGlkYXlTZXQoc3RhcnQsIGVuZCk7XG4gIGNvbnN0IHJlcXVlc3RlZERheXMgPVxuICAgIHN0YXJ0LmdldFRpbWUoKSA9PT0gZW5kLmdldFRpbWUoKSAmJiAhIWlzSGFsZkRheVxuICAgICAgPyAwLjVcbiAgICAgIDogZGF5c0JldHdlZW5JbmNsdXNpdmUoc3RhcnQsIGVuZCkuZmlsdGVyKGQgPT4gaXNXb3JraW5nRGF5KGQpICYmICFob2xpZGF5U2V0Lmhhcyhpc28oZCkpKS5sZW5ndGg7XG5cbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3Qgc3RhcnRPZlllYXIgPSBuZXcgRGF0ZShEYXRlLlVUQyhub3cuZ2V0VVRDRnVsbFllYXIoKSwgMCwgMSkpO1xuICBjb25zdCBlbmRPZlllYXIgPSBuZXcgRGF0ZShEYXRlLlVUQyhub3cuZ2V0VVRDRnVsbFllYXIoKSwgMTEsIDMxLCAyMywgNTksIDU5LCA5OTkpKTtcblxuICBjb25zdCBvdmVybGFwV2hlcmUgPSB7XG4gICAgdXNlcjogeyBpZDogeyBlcXVhbHM6IHNlc3Npb25Vc2VyLnVzZXJJZCB9IH0sXG4gICAgdGltZVBvbGljeTogeyBpZDogeyBlcXVhbHM6IHRpbWVQb2xpY3kuaWQgfSB9LFxuICAgIHN0YXR1czogeyBpbjogWydQRU5ESU5HJywgJ0FQUFJPVkVEJ10gYXMgVGltZVBsYW5JdGVtWydzdGF0dXMnXVtdIH1cbiAgfTtcblxuICBjb25zdCBleGNsdWRlSWQgPSBvcHRpb25zPy5leGNsdWRlVGltZVBsYW5JZCA/PyBudWxsO1xuICBjb25zdCBvdmVybGFwRmlsdGVycyA9IGV4Y2x1ZGVJZFxuICAgID8ge1xuICAgICAgICAuLi5vdmVybGFwV2hlcmUsXG4gICAgICAgIGlkOiB7IG5vdDogeyBlcXVhbHM6IGV4Y2x1ZGVJZCB9IH1cbiAgICAgIH1cbiAgICA6IG92ZXJsYXBXaGVyZTtcblxuICBjb25zdCBvdmVybGFwcGluZyA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQbGFuLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgLi4ub3ZlcmxhcEZpbHRlcnMsXG4gICAgICBzdGFydEF0OiB7IGx0ZTogZW5kLnRvSVNPU3RyaW5nKCkgfSxcbiAgICAgIGVuZEF0OiB7IGd0ZTogc3RhcnQudG9JU09TdHJpbmcoKSB9XG4gICAgfSxcbiAgICBxdWVyeTogJ2lkIHN0YXJ0QXQgZW5kQXQnXG4gIH0pKSBhcyBBcnJheTxQaWNrPFRpbWVQbGFuSXRlbSwgJ2lkJyB8ICdzdGFydEF0JyB8ICdlbmRBdCc+PjtcblxuICBpZiAob3ZlcmxhcHBpbmcubGVuZ3RoID4gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdZb3UgYWxyZWFkeSBoYXZlIGEgcGVuZGluZyBvciBhcHByb3ZlZCByZXF1ZXN0IGZvciB0aGlzIHRpbWUgcG9saWN5IHRoYXQgb3ZlcmxhcHMgd2l0aCB0aGUgcmVxdWVzdGVkIGRhdGVzLidcbiAgICApO1xuICB9XG5cbiAgY29uc3QgZXhpc3RpbmcgPSAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUGxhbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIC4uLm92ZXJsYXBGaWx0ZXJzLFxuICAgICAgc3RhcnRBdDogeyBsdGU6IGVuZE9mWWVhci50b0lTT1N0cmluZygpIH0sXG4gICAgICBlbmRBdDogeyBndGU6IHN0YXJ0T2ZZZWFyLnRvSVNPU3RyaW5nKCkgfVxuICAgIH0sXG4gICAgcXVlcnk6ICdpZCBzdGFydEF0IGVuZEF0IGR1cmF0aW9uIGR1cmF0aW9uVW5pdCdcbiAgfSkpIGFzIEFycmF5PFBpY2s8VGltZVBsYW5JdGVtLCAnaWQnIHwgJ3N0YXJ0QXQnIHwgJ2VuZEF0JyB8ICdkdXJhdGlvbicgfCAnZHVyYXRpb25Vbml0Jz4+O1xuXG4gIGNvbnN0IHN1bUV4aXN0aW5nID0gZXhpc3RpbmcucmVkdWNlKChzdW0sIGN1cnJlbnQpID0+IHtcbiAgICBpZiAodHlwZW9mIGN1cnJlbnQuZHVyYXRpb24gPT09ICdudW1iZXInICYmIGN1cnJlbnQuZHVyYXRpb24gPiAwICYmIGN1cnJlbnQuZHVyYXRpb25Vbml0ID09PSAnREFZJykge1xuICAgICAgcmV0dXJuIHN1bSArIGN1cnJlbnQuZHVyYXRpb247XG4gICAgfVxuICAgIGNvbnN0IHMgPSB0b01pZG5pZ2h0VXRjKG5ldyBEYXRlKGN1cnJlbnQuc3RhcnRBdCkpO1xuICAgIGNvbnN0IGUgPSB0b01pZG5pZ2h0VXRjKG5ldyBEYXRlKGN1cnJlbnQuZW5kQXQpKTtcbiAgICBjb25zdCByYW5nZVN0YXJ0ID0gcyA8IHN0YXJ0T2ZZZWFyID8gc3RhcnRPZlllYXIgOiBzO1xuICAgIGNvbnN0IHJhbmdlRW5kID0gZSA+IGVuZE9mWWVhciA/IGVuZE9mWWVhciA6IGU7XG4gICAgY29uc3QgaHMgPSBidWlsZEhvbGlkYXlTZXQocmFuZ2VTdGFydCwgcmFuZ2VFbmQpO1xuICAgIGNvbnN0IGRheXMgPSBkYXlzQmV0d2VlbkluY2x1c2l2ZShyYW5nZVN0YXJ0LCByYW5nZUVuZCkuZmlsdGVyKGQgPT4gaXNXb3JraW5nRGF5KGQpICYmICFocy5oYXMoaXNvKGQpKSkubGVuZ3RoO1xuICAgIHJldHVybiBzdW0gKyBkYXlzO1xuICB9LCAwKTtcblxuICBpZiAoY2ZnLmlzQWxsb2NhdGlvbk1hbmFnZWQgJiYgdHlwZW9mIGNmZy5hbGxvY2F0aW9uID09PSAnbnVtYmVyJykge1xuICAgIGNvbnN0IHJlbWFpbmluZ0FmdGVyID0gY2ZnLmFsbG9jYXRpb24gLSBzdW1FeGlzdGluZyAtIHJlcXVlc3RlZERheXM7XG4gICAgaWYgKHJlbWFpbmluZ0FmdGVyIDwgLWNmZy5vdmVyZHJhZnRMaW1pdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IGV4Y2VlZHMgYWxsb3dlZCBuZWdhdGl2ZSBiYWxhbmNlJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaXNBcHByb3ZhYmxlID0gcG9saWN5RGV0YWlscz8uaXNBcHByb3ZhYmxlICE9PSBmYWxzZTtcbiAgY29uc3Qgc3RhdHVzID0gaXNBcHByb3ZhYmxlID8gJ1BFTkRJTkcnIDogJ0FQUFJPVkVEJztcblxuICByZXR1cm4gYXdhaXQgY29udGV4dC5kYi5UaW1lUGxhbi5jcmVhdGVPbmUoe1xuICAgIGRhdGE6IHtcbiAgICAgIG9yZzogeyBjb25uZWN0OiB7IGlkOiBzZXNzaW9uVXNlci5vcmdJZCB9IH0sXG4gICAgICB1c2VyOiB7IGNvbm5lY3Q6IHsgaWQ6IHNlc3Npb25Vc2VyLnVzZXJJZCB9IH0sXG4gICAgICB0aW1lVHlwZTogeyBjb25uZWN0OiB7IGlkOiB0aW1lVHlwZS5pZCB9IH0sXG4gICAgICB0aW1lUG9saWN5OiB7IGNvbm5lY3Q6IHsgaWQ6IHRpbWVQb2xpY3kuaWQgfSB9LFxuICAgICAgc3RhdHVzLFxuICAgICAgb3JpZ2luOiAnRElSRUNUJyxcbiAgICAgIHN0YXJ0QXQ6IHN0YXJ0LnRvSVNPU3RyaW5nKCksXG4gICAgICBlbmRBdDogZW5kLnRvSVNPU3RyaW5nKCksXG4gICAgICBkdXJhdGlvblVuaXQ6ICdEQVknLFxuICAgICAgZHVyYXRpb246IHJlcXVlc3RlZERheXMsXG4gICAgICBpc0FsbERheTogIShzdGFydC5nZXRUaW1lKCkgPT09IGVuZC5nZXRUaW1lKCkgJiYgISFpc0hhbGZEYXkpLFxuICAgICAgcmVwZWF0TW9kZTogJ1NJTkdMRScsXG4gICAgICByZWFzb246IHR5cGVvZiByZWFzb24gPT09ICdzdHJpbmcnID8gcmVhc29uIDogJydcbiAgICB9XG4gIH0pO1xufTtcblxuLy8gQmFja3dhcmQtY29tcGF0aWJsZSBhbGlhc2VzIGZvciBvbGQgY29kZVxuZXhwb3J0IGNvbnN0IGZpbmRQb2xpY3lGb3JBdmFpbGFiaWxpdHlUeXBlID0gZmluZFBvbGljeUZvclRpbWVUeXBlO1xuZXhwb3J0IGNvbnN0IGNyZWF0ZURpcmVjdEF2YWlsYWJpbGl0eUVudHJ5ID0gY3JlYXRlRGlyZWN0VGltZVBsYW5FbnRyeTtcbiJdLCJuYW1lcyI6WyJnZXRIb2xpZGF5c0luUmFuZ2UiLCJkZWZhdWx0V29ya2luZ0RheXMiLCJkYXlJbmRleFRvQ29kZSIsImlzU3RyaW5nQXJyYXkiLCJ2YWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiaXRlbSIsInRvTWlkbmlnaHRVdGMiLCJEYXRlIiwiVVRDIiwiZ2V0VVRDRnVsbFllYXIiLCJnZXRVVENNb250aCIsImdldFVUQ0RhdGUiLCJyZXNvbHZlU2Vzc2lvblVzZXIiLCJjb250ZXh0Iiwic2Vzc2lvbiIsImVtYWlsIiwiRXJyb3IiLCJ1c2VycyIsInF1ZXJ5IiwiVXNlciIsImZpbmRNYW55Iiwid2hlcmUiLCJlcXVhbHMiLCJtZSIsIm9yZyIsImlkIiwidXNlcklkIiwib3JnSWQiLCJsb2NhdGlvbiIsImZpbmRQb2xpY3lGb3JUaW1lVHlwZSIsInRpbWVUeXBlSWQiLCJsb2NhdGlvbklkIiwiYmFzZVdoZXJlIiwidGltZVR5cGUiLCJsb2NhdGlvbkF3YXJlV2hlcmUiLCJsb2NhdGlvbnMiLCJzb21lIiwicG9saWNpZXMiLCJUaW1lUG9saWN5IiwibGVuZ3RoIiwiZmFsbGJhY2tQb2xpY2llcyIsImlzbyIsImQiLCJ0b0lTT1N0cmluZyIsInN1YnN0cmluZyIsImRheXNCZXR3ZWVuSW5jbHVzaXZlIiwiYSIsImIiLCJmcm9tIiwiTWF0aCIsImZsb29yIiwiZ2V0VGltZSIsIl8iLCJpIiwiY3JlYXRlRGlyZWN0VGltZVBsYW5FbnRyeSIsImlucHV0Iiwib3B0aW9ucyIsInN0YXJ0RGF0ZVRpbWUiLCJlbmREYXRlVGltZSIsImlzSGFsZkRheSIsInJlYXNvbiIsInNlc3Npb25Vc2VyIiwic3RhcnRSYXciLCJlbmRSYXciLCJOdW1iZXIiLCJpc05hTiIsInN0YXJ0IiwiZW5kIiwiVGltZVR5cGUiLCJmaW5kT25lIiwidGltZVBvbGljeSIsInBvbGljeURldGFpbHMiLCJhbGxvY2F0aW9uQ29uZmlnIiwidGltZVBvbGljeUFsbG9jYXRpb25zIiwiYWxsb2NhdGlvbiIsIm92ZXJkcmFmdExpbWl0Iiwid29ya2luZ0RheXMiLCJjZmciLCJob2xpZGF5Q291bnRyeSIsImlzQWxsb2NhdGlvbk1hbmFnZWQiLCJ3b3JraW5nRGF5U2V0IiwiU2V0IiwiaXNXb3JraW5nRGF5IiwiaGFzIiwiZ2V0VVRDRGF5IiwiYnVpbGRIb2xpZGF5U2V0IiwicmFuZ2VTdGFydCIsInJhbmdlRW5kIiwiYmFzZSIsImNvdW50cnkiLCJmaWx0ZXJlZCIsImZpbHRlciIsImgiLCJkdCIsImRhdGUiLCJtYXAiLCJob2xpZGF5U2V0IiwicmVxdWVzdGVkRGF5cyIsIm5vdyIsInN0YXJ0T2ZZZWFyIiwiZW5kT2ZZZWFyIiwib3ZlcmxhcFdoZXJlIiwidXNlciIsInN0YXR1cyIsImluIiwiZXhjbHVkZUlkIiwiZXhjbHVkZVRpbWVQbGFuSWQiLCJvdmVybGFwRmlsdGVycyIsIm5vdCIsIm92ZXJsYXBwaW5nIiwiVGltZVBsYW4iLCJzdGFydEF0IiwibHRlIiwiZW5kQXQiLCJndGUiLCJleGlzdGluZyIsInN1bUV4aXN0aW5nIiwicmVkdWNlIiwic3VtIiwiY3VycmVudCIsImR1cmF0aW9uIiwiZHVyYXRpb25Vbml0IiwicyIsImUiLCJocyIsImRheXMiLCJyZW1haW5pbmdBZnRlciIsImlzQXBwcm92YWJsZSIsImRiIiwiY3JlYXRlT25lIiwiZGF0YSIsImNvbm5lY3QiLCJvcmlnaW4iLCJpc0FsbERheSIsInJlcGVhdE1vZGUiLCJmaW5kUG9saWN5Rm9yQXZhaWxhYmlsaXR5VHlwZSIsImNyZWF0ZURpcmVjdEF2YWlsYWJpbGl0eUVudHJ5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../domains/timePlan/directEntry.ts\n");

/***/ }),

/***/ "(api)/../../domains/timePlan/rrule.ts":
/*!***************************************!*\
  !*** ../../domains/timePlan/rrule.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   buildTimePlanRRule: () => (/* binding */ buildTimePlanRRule)\n/* harmony export */ });\nconst WEEKDAY_MAP = [\n    \"SU\",\n    \"MO\",\n    \"TU\",\n    \"WE\",\n    \"TH\",\n    \"FR\",\n    \"SA\"\n];\nconst BUSINESS_WEEKDAYS = [\n    \"MO\",\n    \"TU\",\n    \"WE\",\n    \"TH\",\n    \"FR\"\n];\nconst toRRuleDate = (value)=>{\n    if (!value) return null;\n    const date = typeof value === \"string\" ? new Date(value) : value;\n    if (Number.isNaN(date.getTime())) return null;\n    return `${date.toISOString().split(\".\")[0].replace(/[-:]/g, \"\")}Z`;\n};\nconst buildWeeklyRule = (day, interval = 1)=>{\n    const freqParts = [\n        \"FREQ=WEEKLY\",\n        `INTERVAL=${interval}`\n    ];\n    if (typeof day === \"number\" && day >= 0 && day <= 6) freqParts.push(`BYDAY=${WEEKDAY_MAP[day]}`);\n    return freqParts;\n};\nconst buildMonthlyCalendarRule = (day, interval = 1)=>{\n    if (typeof day !== \"number\" || day === 0) return null;\n    return [\n        \"FREQ=MONTHLY\",\n        `INTERVAL=${interval}`,\n        `BYMONTHDAY=${day}`\n    ];\n};\nconst buildMonthlyBusinessRule = (day, interval = 1)=>{\n    if (typeof day !== \"number\" || day === 0) return null;\n    return [\n        \"FREQ=MONTHLY\",\n        `INTERVAL=${interval}`,\n        `BYDAY=${BUSINESS_WEEKDAYS.join(\",\")}`,\n        `BYSETPOS=${day}`\n    ];\n};\nconst buildTimePlanRRule = ({ repeatMode = \"SINGLE\", repeatInterval, repeatDay, startAt, endAt })=>{\n    if (repeatMode === \"SINGLE\") return null;\n    const interval = repeatInterval && repeatInterval > 0 ? repeatInterval : 1;\n    const dtStart = toRRuleDate(startAt);\n    if (!dtStart) return null;\n    let components = null;\n    switch(repeatMode){\n        case \"WEEKLY\":\n            components = buildWeeklyRule(repeatDay, interval);\n            break;\n        case \"MONTHLY_CALENDAR\":\n            components = buildMonthlyCalendarRule(repeatDay, interval);\n            break;\n        case \"MONTHLY_BUSINESS\":\n            components = buildMonthlyBusinessRule(repeatDay, interval);\n            break;\n        default:\n            return null;\n    }\n    if (!components) return null;\n    const endUntil = toRRuleDate(endAt);\n    if (endUntil) components.push(`UNTIL=${endUntil}`);\n    components.push(`DTSTART=${dtStart}`);\n    return components.join(\";\");\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vZG9tYWlucy90aW1lUGxhbi9ycnVsZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTUEsY0FBYztJQUFDO0lBQU07SUFBTTtJQUFNO0lBQU07SUFBTTtJQUFNO0NBQUs7QUFDOUQsTUFBTUMsb0JBQW9CO0lBQUM7SUFBTTtJQUFNO0lBQU07SUFBTTtDQUFLO0FBWXhELE1BQU1DLGNBQWMsQ0FBQ0M7SUFDbkIsSUFBSSxDQUFDQSxPQUFPLE9BQU87SUFDbkIsTUFBTUMsT0FBTyxPQUFPRCxVQUFVLFdBQVcsSUFBSUUsS0FBS0YsU0FBU0E7SUFDM0QsSUFBSUcsT0FBT0MsS0FBSyxDQUFDSCxLQUFLSSxPQUFPLEtBQUssT0FBTztJQUN6QyxPQUFPLENBQUMsRUFBRUosS0FBS0ssV0FBVyxHQUFHQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQ0MsT0FBTyxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUM7QUFDcEU7QUFFQSxNQUFNQyxrQkFBa0IsQ0FBQ0MsS0FBcUJDLFdBQVcsQ0FBQztJQUN4RCxNQUFNQyxZQUFZO1FBQUM7UUFBZSxDQUFDLFNBQVMsRUFBRUQsU0FBUyxDQUFDO0tBQUM7SUFDekQsSUFBSSxPQUFPRCxRQUFRLFlBQVlBLE9BQU8sS0FBS0EsT0FBTyxHQUFHRSxVQUFVQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUVoQixXQUFXLENBQUNhLElBQUksQ0FBQyxDQUFDO0lBQy9GLE9BQU9FO0FBQ1Q7QUFFQSxNQUFNRSwyQkFBMkIsQ0FBQ0osS0FBcUJDLFdBQVcsQ0FBQztJQUNqRSxJQUFJLE9BQU9ELFFBQVEsWUFBWUEsUUFBUSxHQUFHLE9BQU87SUFDakQsT0FBTztRQUFDO1FBQWdCLENBQUMsU0FBUyxFQUFFQyxTQUFTLENBQUM7UUFBRSxDQUFDLFdBQVcsRUFBRUQsSUFBSSxDQUFDO0tBQUM7QUFDdEU7QUFFQSxNQUFNSywyQkFBMkIsQ0FBQ0wsS0FBcUJDLFdBQVcsQ0FBQztJQUNqRSxJQUFJLE9BQU9ELFFBQVEsWUFBWUEsUUFBUSxHQUFHLE9BQU87SUFDakQsT0FBTztRQUFDO1FBQWdCLENBQUMsU0FBUyxFQUFFQyxTQUFTLENBQUM7UUFBRSxDQUFDLE1BQU0sRUFBRWIsa0JBQWtCa0IsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUFFLENBQUMsU0FBUyxFQUFFTixJQUFJLENBQUM7S0FBQztBQUM1RztBQUVPLE1BQU1PLHFCQUFxQixDQUFDLEVBQ2pDQyxhQUFhLFFBQVEsRUFDckJDLGNBQWMsRUFDZEMsU0FBUyxFQUNUQyxPQUFPLEVBQ1BDLEtBQUssRUFDYztJQUNuQixJQUFJSixlQUFlLFVBQVUsT0FBTztJQUVwQyxNQUFNUCxXQUFXUSxrQkFBa0JBLGlCQUFpQixJQUFJQSxpQkFBaUI7SUFDekUsTUFBTUksVUFBVXhCLFlBQVlzQjtJQUM1QixJQUFJLENBQUNFLFNBQVMsT0FBTztJQUVyQixJQUFJQyxhQUE4QjtJQUVsQyxPQUFRTjtRQUNOLEtBQUs7WUFDSE0sYUFBYWYsZ0JBQWdCVyxXQUFXVDtZQUN4QztRQUNGLEtBQUs7WUFDSGEsYUFBYVYseUJBQXlCTSxXQUFXVDtZQUNqRDtRQUNGLEtBQUs7WUFDSGEsYUFBYVQseUJBQXlCSyxXQUFXVDtZQUNqRDtRQUNGO1lBQ0UsT0FBTztJQUNYO0lBRUEsSUFBSSxDQUFDYSxZQUFZLE9BQU87SUFFeEIsTUFBTUMsV0FBVzFCLFlBQVl1QjtJQUM3QixJQUFJRyxVQUFVRCxXQUFXWCxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUVZLFNBQVMsQ0FBQztJQUVqREQsV0FBV1gsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFVSxRQUFRLENBQUM7SUFDcEMsT0FBT0MsV0FBV1IsSUFBSSxDQUFDO0FBQ3pCLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vZG9tYWlucy90aW1lUGxhbi9ycnVsZS50cz84YjUxIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFdFRUtEQVlfTUFQID0gWydTVScsICdNTycsICdUVScsICdXRScsICdUSCcsICdGUicsICdTQSddIGFzIGNvbnN0O1xuY29uc3QgQlVTSU5FU1NfV0VFS0RBWVMgPSBbJ01PJywgJ1RVJywgJ1dFJywgJ1RIJywgJ0ZSJ107XG5cbnR5cGUgUmVwZWF0TW9kZSA9ICdTSU5HTEUnIHwgJ1dFRUtMWScgfCAnTU9OVEhMWV9DQUxFTkRBUicgfCAnTU9OVEhMWV9CVVNJTkVTUyc7XG5cbmludGVyZmFjZSBUaW1lUGxhblJSdWxlSW5wdXQge1xuICByZXBlYXRNb2RlPzogUmVwZWF0TW9kZSB8IG51bGw7XG4gIHJlcGVhdEludGVydmFsPzogbnVtYmVyIHwgbnVsbDtcbiAgcmVwZWF0RGF5PzogbnVtYmVyIHwgbnVsbDtcbiAgc3RhcnRBdD86IHN0cmluZyB8IERhdGUgfCBudWxsO1xuICBlbmRBdD86IHN0cmluZyB8IERhdGUgfCBudWxsO1xufVxuXG5jb25zdCB0b1JSdWxlRGF0ZSA9ICh2YWx1ZT86IHN0cmluZyB8IERhdGUgfCBudWxsKSA9PiB7XG4gIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICBjb25zdCBkYXRlID0gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKHZhbHVlKSA6IHZhbHVlO1xuICBpZiAoTnVtYmVyLmlzTmFOKGRhdGUuZ2V0VGltZSgpKSkgcmV0dXJuIG51bGw7XG4gIHJldHVybiBgJHtkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJy4nKVswXS5yZXBsYWNlKC9bLTpdL2csICcnKX1aYDtcbn07XG5cbmNvbnN0IGJ1aWxkV2Vla2x5UnVsZSA9IChkYXk/OiBudW1iZXIgfCBudWxsLCBpbnRlcnZhbCA9IDEpID0+IHtcbiAgY29uc3QgZnJlcVBhcnRzID0gWydGUkVRPVdFRUtMWScsIGBJTlRFUlZBTD0ke2ludGVydmFsfWBdO1xuICBpZiAodHlwZW9mIGRheSA9PT0gJ251bWJlcicgJiYgZGF5ID49IDAgJiYgZGF5IDw9IDYpIGZyZXFQYXJ0cy5wdXNoKGBCWURBWT0ke1dFRUtEQVlfTUFQW2RheV19YCk7XG4gIHJldHVybiBmcmVxUGFydHM7XG59O1xuXG5jb25zdCBidWlsZE1vbnRobHlDYWxlbmRhclJ1bGUgPSAoZGF5PzogbnVtYmVyIHwgbnVsbCwgaW50ZXJ2YWwgPSAxKSA9PiB7XG4gIGlmICh0eXBlb2YgZGF5ICE9PSAnbnVtYmVyJyB8fCBkYXkgPT09IDApIHJldHVybiBudWxsO1xuICByZXR1cm4gWydGUkVRPU1PTlRITFknLCBgSU5URVJWQUw9JHtpbnRlcnZhbH1gLCBgQllNT05USERBWT0ke2RheX1gXTtcbn07XG5cbmNvbnN0IGJ1aWxkTW9udGhseUJ1c2luZXNzUnVsZSA9IChkYXk/OiBudW1iZXIgfCBudWxsLCBpbnRlcnZhbCA9IDEpID0+IHtcbiAgaWYgKHR5cGVvZiBkYXkgIT09ICdudW1iZXInIHx8IGRheSA9PT0gMCkgcmV0dXJuIG51bGw7XG4gIHJldHVybiBbJ0ZSRVE9TU9OVEhMWScsIGBJTlRFUlZBTD0ke2ludGVydmFsfWAsIGBCWURBWT0ke0JVU0lORVNTX1dFRUtEQVlTLmpvaW4oJywnKX1gLCBgQllTRVRQT1M9JHtkYXl9YF07XG59O1xuXG5leHBvcnQgY29uc3QgYnVpbGRUaW1lUGxhblJSdWxlID0gKHtcbiAgcmVwZWF0TW9kZSA9ICdTSU5HTEUnLFxuICByZXBlYXRJbnRlcnZhbCxcbiAgcmVwZWF0RGF5LFxuICBzdGFydEF0LFxuICBlbmRBdFxufTogVGltZVBsYW5SUnVsZUlucHV0KSA9PiB7XG4gIGlmIChyZXBlYXRNb2RlID09PSAnU0lOR0xFJykgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgaW50ZXJ2YWwgPSByZXBlYXRJbnRlcnZhbCAmJiByZXBlYXRJbnRlcnZhbCA+IDAgPyByZXBlYXRJbnRlcnZhbCA6IDE7XG4gIGNvbnN0IGR0U3RhcnQgPSB0b1JSdWxlRGF0ZShzdGFydEF0KTtcbiAgaWYgKCFkdFN0YXJ0KSByZXR1cm4gbnVsbDtcblxuICBsZXQgY29tcG9uZW50czogc3RyaW5nW10gfCBudWxsID0gbnVsbDtcblxuICBzd2l0Y2ggKHJlcGVhdE1vZGUpIHtcbiAgICBjYXNlICdXRUVLTFknOlxuICAgICAgY29tcG9uZW50cyA9IGJ1aWxkV2Vla2x5UnVsZShyZXBlYXREYXksIGludGVydmFsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ01PTlRITFlfQ0FMRU5EQVInOlxuICAgICAgY29tcG9uZW50cyA9IGJ1aWxkTW9udGhseUNhbGVuZGFyUnVsZShyZXBlYXREYXksIGludGVydmFsKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ01PTlRITFlfQlVTSU5FU1MnOlxuICAgICAgY29tcG9uZW50cyA9IGJ1aWxkTW9udGhseUJ1c2luZXNzUnVsZShyZXBlYXREYXksIGludGVydmFsKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICghY29tcG9uZW50cykgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgZW5kVW50aWwgPSB0b1JSdWxlRGF0ZShlbmRBdCk7XG4gIGlmIChlbmRVbnRpbCkgY29tcG9uZW50cy5wdXNoKGBVTlRJTD0ke2VuZFVudGlsfWApO1xuXG4gIGNvbXBvbmVudHMucHVzaChgRFRTVEFSVD0ke2R0U3RhcnR9YCk7XG4gIHJldHVybiBjb21wb25lbnRzLmpvaW4oJzsnKTtcbn07XG5cbiJdLCJuYW1lcyI6WyJXRUVLREFZX01BUCIsIkJVU0lORVNTX1dFRUtEQVlTIiwidG9SUnVsZURhdGUiLCJ2YWx1ZSIsImRhdGUiLCJEYXRlIiwiTnVtYmVyIiwiaXNOYU4iLCJnZXRUaW1lIiwidG9JU09TdHJpbmciLCJzcGxpdCIsInJlcGxhY2UiLCJidWlsZFdlZWtseVJ1bGUiLCJkYXkiLCJpbnRlcnZhbCIsImZyZXFQYXJ0cyIsInB1c2giLCJidWlsZE1vbnRobHlDYWxlbmRhclJ1bGUiLCJidWlsZE1vbnRobHlCdXNpbmVzc1J1bGUiLCJqb2luIiwiYnVpbGRUaW1lUGxhblJSdWxlIiwicmVwZWF0TW9kZSIsInJlcGVhdEludGVydmFsIiwicmVwZWF0RGF5Iiwic3RhcnRBdCIsImVuZEF0IiwiZHRTdGFydCIsImNvbXBvbmVudHMiLCJlbmRVbnRpbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../domains/timePlan/rrule.ts\n");

/***/ }),

/***/ "(api)/../../keystone.ts":
/*!*************************!*\
  !*** ../../keystone.ts ***!
  \*************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _schemas__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./schemas */ \"(api)/../../schemas/index.ts\");\n/* harmony import */ var _config_env__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config/env */ \"(api)/../../config/env.ts\");\n/* harmony import */ var _auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./auth */ \"(api)/../../auth.ts\");\n/* harmony import */ var _lib_auth_providers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/auth/providers */ \"(api)/../../lib/auth/providers.ts\");\n/* harmony import */ var _lib_cors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./lib/cors */ \"(api)/../../lib/cors.ts\");\n/* harmony import */ var _routes__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./routes */ \"(api)/../../routes/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_schemas__WEBPACK_IMPORTED_MODULE_1__]);\n_schemas__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.config)({\n    db: {\n        provider: _config_env__WEBPACK_IMPORTED_MODULE_2__[\"default\"].DATABASE_PROVIDER,\n        url: _config_env__WEBPACK_IMPORTED_MODULE_2__[\"default\"].DATABASE_URL\n    },\n    lists: _schemas__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n    session: _auth__WEBPACK_IMPORTED_MODULE_3__.nextAuthSessionStrategy,\n    ui: {\n        publicPages: [\n            \"/api/auth/csrf\",\n            \"/api/auth/signin\",\n            \"/api/auth/callback\",\n            \"/api/auth/session\",\n            \"/api/auth/providers\",\n            \"/api/auth/signout\",\n            \"/api/auth/error\",\n            ..._lib_auth_providers__WEBPACK_IMPORTED_MODULE_4__[\"default\"].flatMap(({ id })=>[\n                    `/api/auth/signin/${id}`,\n                    `/api/auth/callback/${id}`\n                ])\n        ],\n        pageMiddleware: async ({ wasAccessAllowed })=>{\n            if (wasAccessAllowed) return;\n            return {\n                kind: \"redirect\",\n                to: \"/api/auth/signin\"\n            };\n        }\n    },\n    server: {\n        cors: _lib_cors__WEBPACK_IMPORTED_MODULE_5__[\"default\"],\n        extendExpressApp: _routes__WEBPACK_IMPORTED_MODULE_6__[\"default\"]\n    },\n    graphql: {\n        path: \"/api/graphql\",\n        debug: false,\n        // use the builder-style GraphQL extensions\n        extendGraphqlSchema: _schemas__WEBPACK_IMPORTED_MODULE_1__.extendGraphqlSchema\n    }\n}));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4va2V5c3RvbmUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQTBDO0FBQ2E7QUFFeEI7QUFDa0I7QUFDSjtBQUNmO0FBQ1U7QUFFeEMsaUVBQWVBLHdEQUFNQSxDQUFDO0lBQ3BCUSxJQUFJO1FBQ0ZDLFVBQVVOLHFFQUFxQjtRQUMvQlEsS0FBS1IsZ0VBQWdCO0lBQ3ZCO0lBQ0FGLEtBQUtBLGtEQUFBQTtJQUNMWSxTQUFTVCwwREFBdUJBO0lBQ2hDVSxJQUFJO1FBQ0ZDLGFBQWE7WUFDWDtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtlQUNHVixtRUFBaUIsQ0FBQyxDQUFDLEVBQUVZLEVBQUUsRUFBRSxHQUFLO29CQUFDLENBQUMsaUJBQWlCLEVBQUVBLEdBQUcsQ0FBQztvQkFBRSxDQUFDLG1CQUFtQixFQUFFQSxHQUFHLENBQUM7aUJBQUM7U0FDeEY7UUFFREMsZ0JBQWdCLE9BQU8sRUFBRUMsZ0JBQWdCLEVBQUU7WUFDekMsSUFBSUEsa0JBQWtCO1lBQ3RCLE9BQU87Z0JBQ0xDLE1BQU07Z0JBQ05DLElBQUk7WUFDTjtRQUNGO0lBQ0Y7SUFDQUMsUUFBUTtRQUNOaEIsSUFBSUEsbURBQUFBO1FBQ0pDLGdCQUFnQkEsaURBQUFBO0lBQ2xCO0lBQ0FnQixTQUFTO1FBQ1BDLE1BQU07UUFDTkMsT0FBTztRQUNQLDJDQUEyQztRQUMzQ3ZCLG1CQUFtQkEsMkRBQUFBO0lBQ3JCO0FBQ0YsRUFBRSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL2tleXN0b25lLnRzP2Q0ZGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgbGlzdHMsIHsgZXh0ZW5kR3JhcGhxbFNjaGVtYSB9IGZyb20gJy4vc2NoZW1hcyc7XG5pbXBvcnQgeyBEYXRhYmFzZVByb3ZpZGVyIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS90eXBlcyc7XG5pbXBvcnQgZW52IGZyb20gJy4vY29uZmlnL2Vudic7XG5pbXBvcnQgeyBuZXh0QXV0aFNlc3Npb25TdHJhdGVneSB9IGZyb20gJy4vYXV0aCc7XG5pbXBvcnQgcHJvdmlkZXJzIGZyb20gJy4vbGliL2F1dGgvcHJvdmlkZXJzJztcbmltcG9ydCBjb3JzIGZyb20gJy4vbGliL2NvcnMnO1xuaW1wb3J0IGV4dGVuZEV4cHJlc3NBcHAgZnJvbSAnLi9yb3V0ZXMnO1xuXG5leHBvcnQgZGVmYXVsdCBjb25maWcoe1xuICBkYjoge1xuICAgIHByb3ZpZGVyOiBlbnYuREFUQUJBU0VfUFJPVklERVIgYXMgRGF0YWJhc2VQcm92aWRlcixcbiAgICB1cmw6IGVudi5EQVRBQkFTRV9VUkxcbiAgfSxcbiAgbGlzdHMsXG4gIHNlc3Npb246IG5leHRBdXRoU2Vzc2lvblN0cmF0ZWd5LFxuICB1aToge1xuICAgIHB1YmxpY1BhZ2VzOiBbXG4gICAgICAnL2FwaS9hdXRoL2NzcmYnLFxuICAgICAgJy9hcGkvYXV0aC9zaWduaW4nLFxuICAgICAgJy9hcGkvYXV0aC9jYWxsYmFjaycsXG4gICAgICAnL2FwaS9hdXRoL3Nlc3Npb24nLFxuICAgICAgJy9hcGkvYXV0aC9wcm92aWRlcnMnLFxuICAgICAgJy9hcGkvYXV0aC9zaWdub3V0JyxcbiAgICAgICcvYXBpL2F1dGgvZXJyb3InLFxuICAgICAgLi4ucHJvdmlkZXJzLmZsYXRNYXAoKHsgaWQgfSkgPT4gW2AvYXBpL2F1dGgvc2lnbmluLyR7aWR9YCwgYC9hcGkvYXV0aC9jYWxsYmFjay8ke2lkfWBdKVxuICAgIF0sXG5cbiAgICBwYWdlTWlkZGxld2FyZTogYXN5bmMgKHsgd2FzQWNjZXNzQWxsb3dlZCB9KSA9PiB7XG4gICAgICBpZiAod2FzQWNjZXNzQWxsb3dlZCkgcmV0dXJuO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2luZDogJ3JlZGlyZWN0JyxcbiAgICAgICAgdG86ICcvYXBpL2F1dGgvc2lnbmluJ1xuICAgICAgfTtcbiAgICB9XG4gIH0sXG4gIHNlcnZlcjoge1xuICAgIGNvcnMsXG4gICAgZXh0ZW5kRXhwcmVzc0FwcFxuICB9LFxuICBncmFwaHFsOiB7XG4gICAgcGF0aDogJy9hcGkvZ3JhcGhxbCcsXG4gICAgZGVidWc6IGZhbHNlLFxuICAgIC8vIHVzZSB0aGUgYnVpbGRlci1zdHlsZSBHcmFwaFFMIGV4dGVuc2lvbnNcbiAgICBleHRlbmRHcmFwaHFsU2NoZW1hXG4gIH1cbn0pO1xuIl0sIm5hbWVzIjpbImNvbmZpZyIsImxpc3RzIiwiZXh0ZW5kR3JhcGhxbFNjaGVtYSIsImVudiIsIm5leHRBdXRoU2Vzc2lvblN0cmF0ZWd5IiwicHJvdmlkZXJzIiwiY29ycyIsImV4dGVuZEV4cHJlc3NBcHAiLCJkYiIsInByb3ZpZGVyIiwiREFUQUJBU0VfUFJPVklERVIiLCJ1cmwiLCJEQVRBQkFTRV9VUkwiLCJzZXNzaW9uIiwidWkiLCJwdWJsaWNQYWdlcyIsImZsYXRNYXAiLCJpZCIsInBhZ2VNaWRkbGV3YXJlIiwid2FzQWNjZXNzQWxsb3dlZCIsImtpbmQiLCJ0byIsInNlcnZlciIsImdyYXBocWwiLCJwYXRoIiwiZGVidWciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../keystone.ts\n");

/***/ }),

/***/ "(api)/../../lib/cors.ts":
/*!*************************!*\
  !*** ../../lib/cors.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _config_env__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../config/env */ \"(api)/../../config/env.ts\");\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n    credentials: true,\n    origin (origin, callback) {\n        const allowed = [\n            ..._config_env__WEBPACK_IMPORTED_MODULE_0__[\"default\"].ALLOWED_ORIGINS.split(\",\"),\n            _config_env__WEBPACK_IMPORTED_MODULE_0__[\"default\"].APP_URL,\n            _config_env__WEBPACK_IMPORTED_MODULE_0__[\"default\"].BASE_URL\n        ].filter(Boolean);\n        if (!origin || allowed.includes(origin)) {\n            callback(null, true);\n        } else {\n            callback(new Error(`Origin ${origin} not allowed by CORS`));\n        }\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vbGliL2NvcnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDZ0M7QUFFaEMsaUVBQWU7SUFDYkMsYUFBYTtJQUNiQyxRQUFPQSxNQUFNLEVBQUVDLFFBQVE7UUFDckIsTUFBTUMsVUFBVTtlQUFJSixtRUFBbUIsQ0FBQ00sS0FBSyxDQUFDO1lBQU1OLDJEQUFXO1lBQUVBLDREQUFZO1NBQUMsQ0FBQ1MsTUFBTSxDQUNuRkM7UUFFRixJQUFJLENBQUNSLFVBQVVFLFFBQVFPLFFBQVEsQ0FBQ1QsU0FBUztZQUN2Q0MsU0FBUyxNQUFNO1FBQ2pCLE9BQU87WUFDTEEsU0FBUyxJQUFJUyxNQUFNLENBQUMsT0FBTyxFQUFFVixPQUFPLG9CQUFvQixDQUFDO1FBQzNEO0lBQ0Y7QUFDRixDQUFDLEVBQXVCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL2xpYi9jb3JzLnRzP2U2NzciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDb3JzT3B0aW9ucyB9IGZyb20gJ2NvcnMnO1xuaW1wb3J0IGVudiBmcm9tICcuLi9jb25maWcvZW52JztcblxuZXhwb3J0IGRlZmF1bHQge1xuICBjcmVkZW50aWFsczogdHJ1ZSxcbiAgb3JpZ2luKG9yaWdpbiwgY2FsbGJhY2spIHtcbiAgICBjb25zdCBhbGxvd2VkID0gWy4uLmVudi5BTExPV0VEX09SSUdJTlMuc3BsaXQoJywnKSwgZW52LkFQUF9VUkwsIGVudi5CQVNFX1VSTF0uZmlsdGVyKFxuICAgICAgQm9vbGVhblxuICAgICk7XG4gICAgaWYgKCFvcmlnaW4gfHwgYWxsb3dlZC5pbmNsdWRlcyhvcmlnaW4pKSB7XG4gICAgICBjYWxsYmFjayhudWxsLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBPcmlnaW4gJHtvcmlnaW59IG5vdCBhbGxvd2VkIGJ5IENPUlNgKSk7XG4gICAgfVxuICB9XG59IHNhdGlzZmllcyBDb3JzT3B0aW9ucztcbiJdLCJuYW1lcyI6WyJlbnYiLCJjcmVkZW50aWFscyIsIm9yaWdpbiIsImNhbGxiYWNrIiwiYWxsb3dlZCIsIkFMTE9XRURfT1JJR0lOUyIsInNwbGl0IiwiQVBQX1VSTCIsIkJBU0VfVVJMIiwiZmlsdGVyIiwiQm9vbGVhbiIsImluY2x1ZGVzIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../lib/cors.ts\n");

/***/ }),

/***/ "(api)/../../lib/holidays/dateHolidays.ts":
/*!******************************************!*\
  !*** ../../lib/holidays/dateHolidays.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getHolidaysForYear: () => (/* binding */ getHolidaysForYear),\n/* harmony export */   getHolidaysInRange: () => (/* binding */ getHolidaysInRange)\n/* harmony export */ });\n/* harmony import */ var date_holidays__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! date-holidays */ \"date-holidays\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([date_holidays__WEBPACK_IMPORTED_MODULE_0__]);\ndate_holidays__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nfunction getHolidaysForYear(params) {\n    const hd = new date_holidays__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\n    const ok = hd.init(params.country, params.subdivision || undefined);\n    if (!ok) return [];\n    const holidays = hd.getHolidays(params.year);\n    return holidays.filter((h)=>h.type === \"public\").map((h)=>({\n            date: h.date.substring(0, 10),\n            title: h.name\n        }));\n}\nfunction getHolidaysInRange(params) {\n    const startYear = params.start.getUTCFullYear();\n    const endYear = params.end.getUTCFullYear();\n    const all = [];\n    for(let y = startYear; y <= endYear; y++){\n        all.push(...getHolidaysForYear({\n            country: params.country,\n            subdivision: params.subdivision,\n            year: y\n        }));\n    }\n    const startISO = params.start.toISOString().substring(0, 10);\n    const endISO = params.end.toISOString().substring(0, 10);\n    return all.filter((h)=>h.date >= startISO && h.date <= endISO);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vbGliL2hvbGlkYXlzL2RhdGVIb2xpZGF5cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBcUM7QUFPOUIsU0FBU0MsbUJBQW1CQyxNQUlsQztJQUNDLE1BQU1DLEtBQUssSUFBSUgscURBQVFBO0lBQ3ZCLE1BQU1JLEtBQUtELEdBQUdFLElBQUksQ0FBQ0gsT0FBT0ksT0FBTyxFQUFFSixPQUFPSyxXQUFXLElBQUlDO0lBQ3pELElBQUksQ0FBQ0osSUFBSSxPQUFPLEVBQUU7SUFDbEIsTUFBTUssV0FBV04sR0FBR08sV0FBVyxDQUFDUixPQUFPUyxJQUFJO0lBQzNDLE9BQU9GLFNBQ0pHLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsSUFBSSxLQUFLLFVBQ3ZCQyxHQUFHLENBQUNGLENBQUFBLElBQU07WUFBRUcsTUFBTUgsRUFBRUcsSUFBSSxDQUFDQyxTQUFTLENBQUMsR0FBRztZQUFLQyxPQUFPTCxFQUFFTSxJQUFJO1FBQUM7QUFDOUQ7QUFFTyxTQUFTQyxtQkFBbUJsQixNQUtsQztJQUNDLE1BQU1tQixZQUFZbkIsT0FBT29CLEtBQUssQ0FBQ0MsY0FBYztJQUM3QyxNQUFNQyxVQUFVdEIsT0FBT3VCLEdBQUcsQ0FBQ0YsY0FBYztJQUN6QyxNQUFNRyxNQUEyQixFQUFFO0lBQ25DLElBQUssSUFBSUMsSUFBSU4sV0FBV00sS0FBS0gsU0FBU0csSUFBSztRQUN6Q0QsSUFBSUUsSUFBSSxJQUFJM0IsbUJBQW1CO1lBQUVLLFNBQVNKLE9BQU9JLE9BQU87WUFBRUMsYUFBYUwsT0FBT0ssV0FBVztZQUFFSSxNQUFNZ0I7UUFBRTtJQUNyRztJQUNBLE1BQU1FLFdBQVczQixPQUFPb0IsS0FBSyxDQUFDUSxXQUFXLEdBQUdiLFNBQVMsQ0FBQyxHQUFHO0lBQ3pELE1BQU1jLFNBQVM3QixPQUFPdUIsR0FBRyxDQUFDSyxXQUFXLEdBQUdiLFNBQVMsQ0FBQyxHQUFHO0lBQ3JELE9BQU9TLElBQUlkLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUcsSUFBSSxJQUFJYSxZQUFZaEIsRUFBRUcsSUFBSSxJQUFJZTtBQUN6RCIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9saWIvaG9saWRheXMvZGF0ZUhvbGlkYXlzLnRzPzViNDgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEhvbGlkYXlzIGZyb20gJ2RhdGUtaG9saWRheXMnO1xuXG5leHBvcnQgdHlwZSBOb3JtYWxpemVkSG9saWRheSA9IHtcbiAgZGF0ZTogc3RyaW5nOyAvLyBJU08gZGF0ZSAoWVlZWS1NTS1ERClcbiAgdGl0bGU6IHN0cmluZztcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIb2xpZGF5c0ZvclllYXIocGFyYW1zOiB7XG4gIGNvdW50cnk6IHN0cmluZztcbiAgc3ViZGl2aXNpb24/OiBzdHJpbmcgfCBudWxsO1xuICB5ZWFyOiBudW1iZXI7XG59KTogTm9ybWFsaXplZEhvbGlkYXlbXSB7XG4gIGNvbnN0IGhkID0gbmV3IEhvbGlkYXlzKCk7XG4gIGNvbnN0IG9rID0gaGQuaW5pdChwYXJhbXMuY291bnRyeSwgcGFyYW1zLnN1YmRpdmlzaW9uIHx8IHVuZGVmaW5lZCk7XG4gIGlmICghb2spIHJldHVybiBbXTtcbiAgY29uc3QgaG9saWRheXMgPSBoZC5nZXRIb2xpZGF5cyhwYXJhbXMueWVhcik7XG4gIHJldHVybiBob2xpZGF5c1xuICAgIC5maWx0ZXIoaCA9PiBoLnR5cGUgPT09ICdwdWJsaWMnKVxuICAgIC5tYXAoaCA9PiAoeyBkYXRlOiBoLmRhdGUuc3Vic3RyaW5nKDAsIDEwKSwgdGl0bGU6IGgubmFtZSB9KSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIb2xpZGF5c0luUmFuZ2UocGFyYW1zOiB7XG4gIGNvdW50cnk6IHN0cmluZztcbiAgc3ViZGl2aXNpb24/OiBzdHJpbmcgfCBudWxsO1xuICBzdGFydDogRGF0ZTtcbiAgZW5kOiBEYXRlO1xufSk6IE5vcm1hbGl6ZWRIb2xpZGF5W10ge1xuICBjb25zdCBzdGFydFllYXIgPSBwYXJhbXMuc3RhcnQuZ2V0VVRDRnVsbFllYXIoKTtcbiAgY29uc3QgZW5kWWVhciA9IHBhcmFtcy5lbmQuZ2V0VVRDRnVsbFllYXIoKTtcbiAgY29uc3QgYWxsOiBOb3JtYWxpemVkSG9saWRheVtdID0gW107XG4gIGZvciAobGV0IHkgPSBzdGFydFllYXI7IHkgPD0gZW5kWWVhcjsgeSsrKSB7XG4gICAgYWxsLnB1c2goLi4uZ2V0SG9saWRheXNGb3JZZWFyKHsgY291bnRyeTogcGFyYW1zLmNvdW50cnksIHN1YmRpdmlzaW9uOiBwYXJhbXMuc3ViZGl2aXNpb24sIHllYXI6IHkgfSkpO1xuICB9XG4gIGNvbnN0IHN0YXJ0SVNPID0gcGFyYW1zLnN0YXJ0LnRvSVNPU3RyaW5nKCkuc3Vic3RyaW5nKDAsIDEwKTtcbiAgY29uc3QgZW5kSVNPID0gcGFyYW1zLmVuZC50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7XG4gIHJldHVybiBhbGwuZmlsdGVyKGggPT4gaC5kYXRlID49IHN0YXJ0SVNPICYmIGguZGF0ZSA8PSBlbmRJU08pO1xufVxuXG5cbiJdLCJuYW1lcyI6WyJIb2xpZGF5cyIsImdldEhvbGlkYXlzRm9yWWVhciIsInBhcmFtcyIsImhkIiwib2siLCJpbml0IiwiY291bnRyeSIsInN1YmRpdmlzaW9uIiwidW5kZWZpbmVkIiwiaG9saWRheXMiLCJnZXRIb2xpZGF5cyIsInllYXIiLCJmaWx0ZXIiLCJoIiwidHlwZSIsIm1hcCIsImRhdGUiLCJzdWJzdHJpbmciLCJ0aXRsZSIsIm5hbWUiLCJnZXRIb2xpZGF5c0luUmFuZ2UiLCJzdGFydFllYXIiLCJzdGFydCIsImdldFVUQ0Z1bGxZZWFyIiwiZW5kWWVhciIsImVuZCIsImFsbCIsInkiLCJwdXNoIiwic3RhcnRJU08iLCJ0b0lTT1N0cmluZyIsImVuZElTTyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../lib/holidays/dateHolidays.ts\n");

/***/ }),

/***/ "(api)/../../routes/example/index.ts":
/*!*************************************!*\
  !*** ../../routes/example/index.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var express__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! express */ \"express\");\n/* harmony import */ var express__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(express__WEBPACK_IMPORTED_MODULE_0__);\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((context)=>{\n    const router = express__WEBPACK_IMPORTED_MODULE_0___default().Router({\n        mergeParams: true,\n        caseSensitive: false\n    });\n    router.get(\"/\", async (req, res)=>{\n        return res.redirect(301, \"https://google.com\");\n    });\n    return router;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vcm91dGVzL2V4YW1wbGUvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQzhCO0FBRTlCLGlFQUFlLENBQUNDO0lBQ2QsTUFBTUMsU0FBU0YscURBQWMsQ0FBQztRQUFFSSxhQUFhO1FBQU1DLGVBQWU7SUFBTTtJQUV4RUgsT0FBT0ksR0FBRyxDQUFDLEtBQUssT0FBT0MsS0FBS0M7UUFFMUIsT0FBT0EsSUFBSUMsUUFBUSxDQUFDLEtBQUs7SUFDM0I7SUFFQSxPQUFPUDtBQUNULEdBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vcm91dGVzL2V4YW1wbGUvaW5kZXgudHM/MWNkOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IENvbnRleHQgfSBmcm9tICcua2V5c3RvbmUvdHlwZXMnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IChjb250ZXh0OiBDb250ZXh0KSA9PiB7XG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKHsgbWVyZ2VQYXJhbXM6IHRydWUsIGNhc2VTZW5zaXRpdmU6IGZhbHNlIH0pO1xuXG4gIHJvdXRlci5nZXQoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHtcblxuICAgIHJldHVybiByZXMucmVkaXJlY3QoMzAxLCBcImh0dHBzOi8vZ29vZ2xlLmNvbVwiKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn07XG4iXSwibmFtZXMiOlsiZXhwcmVzcyIsImNvbnRleHQiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJtZXJnZVBhcmFtcyIsImNhc2VTZW5zaXRpdmUiLCJnZXQiLCJyZXEiLCJyZXMiLCJyZWRpcmVjdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../routes/example/index.ts\n");

/***/ }),

/***/ "(api)/../../routes/index.ts":
/*!*****************************!*\
  !*** ../../routes/index.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var express__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! express */ \"express\");\n/* harmony import */ var express__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(express__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _example__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./example */ \"(api)/../../routes/example/index.ts\");\n\n\n// import ratehawk from './ratehawk';\n\nconst publicDir = path__WEBPACK_IMPORTED_MODULE_1___default().resolve(__dirname, \"..\", \"public\");\nconst extendExpressApp = async (app, context)=>{\n    app.use(\"/public\", express__WEBPACK_IMPORTED_MODULE_0___default()[\"static\"](publicDir));\n    app.use(\"/example\", (0,_example__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(context));\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (extendExpressApp);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vcm91dGVzL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUU4QjtBQUNOO0FBQ3hCLHFDQUFxQztBQUNMO0FBRWhDLE1BQU1HLFlBQVlGLG1EQUFZLENBQUNJLFdBQVcsTUFBTTtBQUVoRCxNQUFNQyxtQkFBbUIsT0FBT0MsS0FBa0JDO0lBRWhERCxJQUFJRSxHQUFHLENBQUMsV0FBV1Qsd0RBQWMsQ0FBQ0c7SUFHbENJLElBQUlFLEdBQUcsQ0FBQyxZQUFZUCxvREFBT0EsQ0FBQ007QUFDOUI7QUFFQSxpRUFBZUYsZ0JBQWdCQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3JvdXRlcy9pbmRleC50cz83NGNiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQXBwbGljYXRpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB0eXBlIHsgQ29udGV4dCB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuLy8gaW1wb3J0IHJhdGVoYXdrIGZyb20gJy4vcmF0ZWhhd2snO1xuaW1wb3J0IGV4YW1wbGUgZnJvbSAnLi9leGFtcGxlJztcblxuY29uc3QgcHVibGljRGlyID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJ3B1YmxpYycpO1xuXG5jb25zdCBleHRlbmRFeHByZXNzQXBwID0gYXN5bmMgKGFwcDogQXBwbGljYXRpb24sIGNvbnRleHQ6IENvbnRleHQpID0+IHtcblxuICBhcHAudXNlKCcvcHVibGljJywgZXhwcmVzcy5zdGF0aWMocHVibGljRGlyKSk7XG5cblxuICBhcHAudXNlKCcvZXhhbXBsZScsIGV4YW1wbGUoY29udGV4dCkpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZXh0ZW5kRXhwcmVzc0FwcDtcbiJdLCJuYW1lcyI6WyJleHByZXNzIiwicGF0aCIsImV4YW1wbGUiLCJwdWJsaWNEaXIiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZXh0ZW5kRXhwcmVzc0FwcCIsImFwcCIsImNvbnRleHQiLCJ1c2UiLCJzdGF0aWMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../routes/index.ts\n");

/***/ }),

/***/ "(api)/../../schemas/Location.ts":
/*!*********************************!*\
  !*** ../../schemas/Location.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _vvo_tzdb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @vvo/tzdb */ \"@vvo/tzdb\");\n/* harmony import */ var _vvo_tzdb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_vvo_tzdb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var date_holidays__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! date-holidays */ \"date-holidays\");\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([date_holidays__WEBPACK_IMPORTED_MODULE_3__]);\ndate_holidays__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nconst workingDayOptions = [\n    {\n        label: \"Monday\",\n        value: \"MON\"\n    },\n    {\n        label: \"Tuesday\",\n        value: \"TUE\"\n    },\n    {\n        label: \"Wednesday\",\n        value: \"WED\"\n    },\n    {\n        label: \"Thursday\",\n        value: \"THU\"\n    },\n    {\n        label: \"Friday\",\n        value: \"FRI\"\n    },\n    {\n        label: \"Saturday\",\n        value: \"SAT\"\n    },\n    {\n        label: \"Sunday\",\n        value: \"SUN\"\n    }\n];\nconst holidayCountryOptions = Object.entries(new date_holidays__WEBPACK_IMPORTED_MODULE_3__[\"default\"]().getCountries(\"en\")).map(([value, label])=>({\n        value,\n        label\n    }));\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        name: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)({\n            validation: {\n                isRequired: true\n            }\n        }),\n        org: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"Organization.locations\",\n            many: false\n        }),\n        timePolicies: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicy.locations\",\n            many: true\n        }),\n        users: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User.location\",\n            many: true\n        }),\n        timezone: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            options: (0,_vvo_tzdb__WEBPACK_IMPORTED_MODULE_2__.getTimeZones)().map(({ name, currentTimeFormat })=>({\n                    label: currentTimeFormat,\n                    value: name\n                })),\n            type: \"string\",\n            ui: {\n                description: \"IANA timezone\"\n            }\n        }),\n        workingDays: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.multiselect)({\n            options: workingDayOptions,\n            defaultValue: workingDayOptions.slice(0, 5).map((option)=>option.value),\n            type: \"enum\",\n            ui: {\n                description: \"Working days of the week\"\n            }\n        }),\n        weekStartDay: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            options: workingDayOptions,\n            type: \"enum\",\n            defaultValue: workingDayOptions[0].value,\n            validation: {\n                isRequired: true\n            },\n            ui: {\n                description: \"First day of the work week\"\n            }\n        }),\n        holidayCountry: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            options: holidayCountryOptions,\n            type: \"string\",\n            defaultValue: \"US\",\n            validation: {\n                isRequired: true\n            },\n            ui: {\n                description: \"Select a country to apply national holidays\"\n            }\n        })\n    },\n    ui: {\n        labelField: \"name\"\n    },\n    access: {\n        operation: {\n            query: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isAuthenticated)({\n                    session\n                }),\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.canEditOrgData,\n            update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.canEditLocationData,\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.canEditOrgData\n        },\n        item: {\n            update: async ({ session, item, context })=>{\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isGod)({\n                    session\n                })) return true;\n                if (!item?.id) return false;\n                const targetLocationId = String(item.id);\n                const sudoContext = context.sudo();\n                const location = await sudoContext.query.Location.findOne({\n                    where: {\n                        id: targetLocationId\n                    },\n                    query: \"id org { id }\"\n                });\n                if (!location) return false;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isOrgAdmin)({\n                    session\n                })) {\n                    if (!session?.orgId) return false;\n                    return location.org?.id ? String(location.org.id) === String(session.orgId) : false;\n                }\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isLocationAdmin)({\n                    session\n                })) {\n                    if (!session?.locationId) return false;\n                    return targetLocationId === String(session.locationId);\n                }\n                return false;\n            },\n            delete: async ({ session, item, context })=>{\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isGod)({\n                    session\n                })) return true;\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isOrgAdmin)({\n                    session\n                })) return false;\n                if (!session?.orgId || !item?.id) return false;\n                const sudoContext = context.sudo();\n                const location = await sudoContext.query.Location.findOne({\n                    where: {\n                        id: String(item.id)\n                    },\n                    query: \"id org { id }\"\n                });\n                if (!location?.org?.id) return false;\n                return String(location.org.id) === String(session.orgId);\n            }\n        },\n        filter: {\n            query: async ({ session })=>{\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isAuthenticated)({\n                    session\n                })) return false;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isGod)({\n                    session\n                })) return true;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.isOrgAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_4__.filterByUserOrg)({\n                    session\n                });\n                // For LocationAdmin and regular users, they can only see their own location\n                if (!session?.locationId) return false;\n                return {\n                    id: {\n                        equals: session.locationId\n                    }\n                };\n            }\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ resolvedData, context })=>{\n                if (resolvedData.org) return resolvedData;\n                const orgId = context.session?.orgId;\n                if (!orgId) return resolvedData;\n                return {\n                    ...resolvedData,\n                    org: {\n                        connect: {\n                            id: orgId\n                        }\n                    }\n                };\n            }\n        },\n        validateDelete: async ({ item, context, addValidationError })=>{\n            if (!item?.id) return;\n            const sudoContext = context.sudo();\n            const locationId = String(item.id);\n            const location = await sudoContext.query.Location.findOne({\n                where: {\n                    id: locationId\n                },\n                query: \"id org { id }\"\n            });\n            if (!location?.org?.id) {\n                addValidationError(\"Location is missing organization context.\");\n                return;\n            }\n            const [orgLocationCount, userCount] = await Promise.all([\n                sudoContext.db.Location.count({\n                    where: {\n                        org: {\n                            id: {\n                                equals: location.org.id\n                            }\n                        }\n                    }\n                }),\n                sudoContext.db.User.count({\n                    where: {\n                        location: {\n                            id: {\n                                equals: locationId\n                            }\n                        }\n                    }\n                })\n            ]);\n            if (userCount > 0) {\n                addValidationError(\"You cannot delete a location that still has users.\");\n                return;\n            }\n            if (orgLocationCount <= 1) {\n                addValidationError(\"Each organization must have at least one location.\");\n            }\n        }\n    }\n}));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TztvQkFBRVIsSUFBSVU7Z0JBQVc7Z0JBQ3hCakIsT0FBTztZQUNUO1lBRUEsSUFBSSxDQUFDWSxVQUFVaEMsS0FBSzJCLElBQUk7Z0JBQ3RCa0IsbUJBQW1CO2dCQUNuQjtZQUNGO1lBRUEsTUFBTSxDQUFDQyxrQkFBa0JDLFVBQVUsR0FBRyxNQUFNQyxRQUFRQyxHQUFHLENBQUM7Z0JBQ3REbkIsWUFBWW9CLEVBQUUsQ0FBQ2pCLFFBQVEsQ0FBQ2tCLEtBQUssQ0FBQztvQkFBRWhCLE9BQU87d0JBQUVuQyxLQUFLOzRCQUFFMkIsSUFBSTtnQ0FBRVksUUFBUVAsU0FBU2hDLEdBQUcsQ0FBQzJCLEVBQUU7NEJBQUM7d0JBQUU7b0JBQUU7Z0JBQUU7Z0JBQ3BGRyxZQUFZb0IsRUFBRSxDQUFDRSxJQUFJLENBQUNELEtBQUssQ0FBQztvQkFBRWhCLE9BQU87d0JBQUVILFVBQVU7NEJBQUVMLElBQUk7Z0NBQUVZLFFBQVFGOzRCQUFXO3dCQUFFO29CQUFFO2dCQUFFO2FBQ2pGO1lBRUQsSUFBSVUsWUFBWSxHQUFHO2dCQUNqQkYsbUJBQW1CO2dCQUNuQjtZQUNGO1lBRUEsSUFBSUMsb0JBQW9CLEdBQUc7Z0JBQ3pCRCxtQkFBbUI7WUFDckI7UUFDRjtJQUNGO0FBQ0YsRUFBRSxFQUE2QiIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL0xvY2F0aW9uLnRzPzEzZjUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBMaXN0cyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBsaXN0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgeyBtdWx0aXNlbGVjdCwgcmVsYXRpb25zaGlwLCBzZWxlY3QsIHRleHQgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2ZpZWxkcyc7XG5pbXBvcnQgeyBnZXRUaW1lWm9uZXMgfSBmcm9tICdAdnZvL3R6ZGInO1xuaW1wb3J0IEhvbGlkYXlzIGZyb20gJ2RhdGUtaG9saWRheXMnO1xuaW1wb3J0IHtcbiAgY2FuRWRpdExvY2F0aW9uRGF0YSxcbiAgY2FuRWRpdE9yZ0RhdGEsXG4gIGZpbHRlckJ5VXNlck9yZyxcbiAgaXNBdXRoZW50aWNhdGVkLFxuICBpc0dvZCxcbiAgaXNMb2NhdGlvbkFkbWluLFxuICBpc09yZ0FkbWluXG59IGZyb20gJy4uL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5cbmNvbnN0IHdvcmtpbmdEYXlPcHRpb25zID0gW1xuICB7IGxhYmVsOiAnTW9uZGF5JywgdmFsdWU6ICdNT04nIH0sXG4gIHsgbGFiZWw6ICdUdWVzZGF5JywgdmFsdWU6ICdUVUUnIH0sXG4gIHsgbGFiZWw6ICdXZWRuZXNkYXknLCB2YWx1ZTogJ1dFRCcgfSxcbiAgeyBsYWJlbDogJ1RodXJzZGF5JywgdmFsdWU6ICdUSFUnIH0sXG4gIHsgbGFiZWw6ICdGcmlkYXknLCB2YWx1ZTogJ0ZSSScgfSxcbiAgeyBsYWJlbDogJ1NhdHVyZGF5JywgdmFsdWU6ICdTQVQnIH0sXG4gIHsgbGFiZWw6ICdTdW5kYXknLCB2YWx1ZTogJ1NVTicgfVxuXSBhcyBjb25zdDtcblxuY29uc3QgaG9saWRheUNvdW50cnlPcHRpb25zID0gT2JqZWN0LmVudHJpZXMobmV3IEhvbGlkYXlzKCkuZ2V0Q291bnRyaWVzKCdlbicpKS5tYXAoKFt2YWx1ZSwgbGFiZWxdKSA9PiAoe1xuICB2YWx1ZSxcbiAgbGFiZWxcbn0pKTtcblxuZXhwb3J0IGRlZmF1bHQgbGlzdCh7XG4gIGZpZWxkczoge1xuICAgIG5hbWU6IHRleHQoeyB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfSB9KSxcbiAgICBvcmc6IHJlbGF0aW9uc2hpcCh7IHJlZjogJ09yZ2FuaXphdGlvbi5sb2NhdGlvbnMnLCBtYW55OiBmYWxzZSB9KSxcbiAgICB0aW1lUG9saWNpZXM6IHJlbGF0aW9uc2hpcCh7IHJlZjogJ1RpbWVQb2xpY3kubG9jYXRpb25zJywgbWFueTogdHJ1ZSB9KSxcbiAgICB1c2VyczogcmVsYXRpb25zaGlwKHsgcmVmOiAnVXNlci5sb2NhdGlvbicsIG1hbnk6IHRydWUgfSksXG4gICAgdGltZXpvbmU6IHNlbGVjdCh7XG4gICAgICBvcHRpb25zOiBnZXRUaW1lWm9uZXMoKS5tYXAoKHsgbmFtZSwgY3VycmVudFRpbWVGb3JtYXQgfSkgPT4gKHsgbGFiZWw6IGN1cnJlbnRUaW1lRm9ybWF0LCB2YWx1ZTogbmFtZSB9KSksXG4gICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgIHVpOiB7IGRlc2NyaXB0aW9uOiAnSUFOQSB0aW1lem9uZScgfVxuICAgIH0pLFxuICAgIHdvcmtpbmdEYXlzOiBtdWx0aXNlbGVjdCh7XG4gICAgICBvcHRpb25zOiB3b3JraW5nRGF5T3B0aW9ucyxcbiAgICAgIGRlZmF1bHRWYWx1ZTogd29ya2luZ0RheU9wdGlvbnMuc2xpY2UoMCwgNSkubWFwKG9wdGlvbiA9PiBvcHRpb24udmFsdWUpLFxuICAgICAgdHlwZTogJ2VudW0nLFxuICAgICAgdWk6IHsgZGVzY3JpcHRpb246ICdXb3JraW5nIGRheXMgb2YgdGhlIHdlZWsnIH1cbiAgICB9KSxcbiAgICB3ZWVrU3RhcnREYXk6IHNlbGVjdCh7XG4gICAgICBvcHRpb25zOiB3b3JraW5nRGF5T3B0aW9ucyxcbiAgICAgIHR5cGU6ICdlbnVtJyxcbiAgICAgIGRlZmF1bHRWYWx1ZTogd29ya2luZ0RheU9wdGlvbnNbMF0udmFsdWUsXG4gICAgICB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgIHVpOiB7IGRlc2NyaXB0aW9uOiAnRmlyc3QgZGF5IG9mIHRoZSB3b3JrIHdlZWsnIH1cbiAgICB9KSxcbiAgICBob2xpZGF5Q291bnRyeTogc2VsZWN0KHtcbiAgICAgIG9wdGlvbnM6IGhvbGlkYXlDb3VudHJ5T3B0aW9ucyxcbiAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgZGVmYXVsdFZhbHVlOiAnVVMnLFxuICAgICAgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0sXG4gICAgICB1aTogeyBkZXNjcmlwdGlvbjogJ1NlbGVjdCBhIGNvdW50cnkgdG8gYXBwbHkgbmF0aW9uYWwgaG9saWRheXMnIH1cbiAgICB9KVxuICB9LFxuICB1aToge1xuICAgIGxhYmVsRmllbGQ6ICduYW1lJ1xuICB9LFxuICBhY2Nlc3M6IHtcbiAgICBvcGVyYXRpb246IHtcbiAgICAgIHF1ZXJ5OiAoeyBzZXNzaW9uIH0pID0+IGlzQXV0aGVudGljYXRlZCh7IHNlc3Npb24gfSksXG4gICAgICBjcmVhdGU6IGNhbkVkaXRPcmdEYXRhLFxuICAgICAgdXBkYXRlOiBjYW5FZGl0TG9jYXRpb25EYXRhLFxuICAgICAgZGVsZXRlOiBjYW5FZGl0T3JnRGF0YVxuICAgIH0sXG4gICAgaXRlbToge1xuICAgICAgdXBkYXRlOiBhc3luYyAoeyBzZXNzaW9uLCBpdGVtLCBjb250ZXh0IH0pID0+IHtcbiAgICAgICAgaWYgKGlzR29kKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmICghaXRlbT8uaWQpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBjb25zdCB0YXJnZXRMb2NhdGlvbklkID0gU3RyaW5nKGl0ZW0uaWQpO1xuICAgICAgICBjb25zdCBzdWRvQ29udGV4dCA9IGNvbnRleHQuc3VkbygpO1xuICAgICAgICBjb25zdCBsb2NhdGlvbiA9IChhd2FpdCBzdWRvQ29udGV4dC5xdWVyeS5Mb2NhdGlvbi5maW5kT25lKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogdGFyZ2V0TG9jYXRpb25JZCB9LFxuICAgICAgICAgIHF1ZXJ5OiAnaWQgb3JnIHsgaWQgfSdcbiAgICAgICAgfSkpIGFzIHsgaWQ6IHN0cmluZzsgb3JnOiB7IGlkOiBzdHJpbmcgfSB8IG51bGwgfSB8IG51bGw7XG5cbiAgICAgICAgaWYgKCFsb2NhdGlvbikgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIGlmIChpc09yZ0FkbWluKHsgc2Vzc2lvbiB9KSkge1xuICAgICAgICAgIGlmICghc2Vzc2lvbj8ub3JnSWQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gbG9jYXRpb24ub3JnPy5pZCA/IFN0cmluZyhsb2NhdGlvbi5vcmcuaWQpID09PSBTdHJpbmcoc2Vzc2lvbi5vcmdJZCkgOiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0xvY2F0aW9uQWRtaW4oeyBzZXNzaW9uIH0pKSB7XG4gICAgICAgICAgaWYgKCFzZXNzaW9uPy5sb2NhdGlvbklkKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIHRhcmdldExvY2F0aW9uSWQgPT09IFN0cmluZyhzZXNzaW9uLmxvY2F0aW9uSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSxcbiAgICAgIGRlbGV0ZTogYXN5bmMgKHsgc2Vzc2lvbiwgaXRlbSwgY29udGV4dCB9KSA9PiB7XG4gICAgICAgIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAoIWlzT3JnQWRtaW4oeyBzZXNzaW9uIH0pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICghc2Vzc2lvbj8ub3JnSWQgfHwgIWl0ZW0/LmlkKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3Qgc3Vkb0NvbnRleHQgPSBjb250ZXh0LnN1ZG8oKTtcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSAoYXdhaXQgc3Vkb0NvbnRleHQucXVlcnkuTG9jYXRpb24uZmluZE9uZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IFN0cmluZyhpdGVtLmlkKSB9LFxuICAgICAgICAgIHF1ZXJ5OiAnaWQgb3JnIHsgaWQgfSdcbiAgICAgICAgfSkpIGFzIHsgb3JnOiB7IGlkOiBzdHJpbmcgfSB8IG51bGwgfSB8IG51bGw7XG5cbiAgICAgICAgaWYgKCFsb2NhdGlvbj8ub3JnPy5pZCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gU3RyaW5nKGxvY2F0aW9uLm9yZy5pZCkgPT09IFN0cmluZyhzZXNzaW9uLm9yZ0lkKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZpbHRlcjoge1xuICAgICAgcXVlcnk6IGFzeW5jICh7IHNlc3Npb24gfSkgPT4ge1xuICAgICAgICBpZiAoIWlzQXV0aGVudGljYXRlZCh7IHNlc3Npb24gfSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGlzR29kKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChpc09yZ0FkbWluKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIGZpbHRlckJ5VXNlck9yZyh7IHNlc3Npb24gfSk7XG4gICAgICAgIC8vIEZvciBMb2NhdGlvbkFkbWluIGFuZCByZWd1bGFyIHVzZXJzLCB0aGV5IGNhbiBvbmx5IHNlZSB0aGVpciBvd24gbG9jYXRpb25cbiAgICAgICAgaWYgKCFzZXNzaW9uPy5sb2NhdGlvbklkKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB7IGlkOiB7IGVxdWFsczogc2Vzc2lvbi5sb2NhdGlvbklkIH0gfTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGhvb2tzOiB7XG4gICAgcmVzb2x2ZUlucHV0OiB7XG4gICAgICBjcmVhdGU6IGFzeW5jICh7IHJlc29sdmVkRGF0YSwgY29udGV4dCB9KSA9PiB7XG4gICAgICAgIGlmIChyZXNvbHZlZERhdGEub3JnKSByZXR1cm4gcmVzb2x2ZWREYXRhO1xuICAgICAgICBjb25zdCBvcmdJZCA9IGNvbnRleHQuc2Vzc2lvbj8ub3JnSWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICBpZiAoIW9yZ0lkKSByZXR1cm4gcmVzb2x2ZWREYXRhO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnJlc29sdmVkRGF0YSxcbiAgICAgICAgICBvcmc6IHsgY29ubmVjdDogeyBpZDogb3JnSWQgfSB9XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcbiAgICB2YWxpZGF0ZURlbGV0ZTogYXN5bmMgKHsgaXRlbSwgY29udGV4dCwgYWRkVmFsaWRhdGlvbkVycm9yIH0pID0+IHtcbiAgICAgIGlmICghaXRlbT8uaWQpIHJldHVybjtcblxuICAgICAgY29uc3Qgc3Vkb0NvbnRleHQgPSBjb250ZXh0LnN1ZG8oKTtcbiAgICAgIGNvbnN0IGxvY2F0aW9uSWQgPSBTdHJpbmcoaXRlbS5pZCk7XG5cbiAgICAgIGNvbnN0IGxvY2F0aW9uID0gKGF3YWl0IHN1ZG9Db250ZXh0LnF1ZXJ5LkxvY2F0aW9uLmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZDogbG9jYXRpb25JZCB9LFxuICAgICAgICBxdWVyeTogJ2lkIG9yZyB7IGlkIH0nXG4gICAgICB9KSkgYXMgeyBvcmc6IHsgaWQ6IHN0cmluZyB9IHwgbnVsbCB9IHwgbnVsbDtcblxuICAgICAgaWYgKCFsb2NhdGlvbj8ub3JnPy5pZCkge1xuICAgICAgICBhZGRWYWxpZGF0aW9uRXJyb3IoJ0xvY2F0aW9uIGlzIG1pc3Npbmcgb3JnYW5pemF0aW9uIGNvbnRleHQuJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgW29yZ0xvY2F0aW9uQ291bnQsIHVzZXJDb3VudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHN1ZG9Db250ZXh0LmRiLkxvY2F0aW9uLmNvdW50KHsgd2hlcmU6IHsgb3JnOiB7IGlkOiB7IGVxdWFsczogbG9jYXRpb24ub3JnLmlkIH0gfSB9IH0pLFxuICAgICAgICBzdWRvQ29udGV4dC5kYi5Vc2VyLmNvdW50KHsgd2hlcmU6IHsgbG9jYXRpb246IHsgaWQ6IHsgZXF1YWxzOiBsb2NhdGlvbklkIH0gfSB9IH0pXG4gICAgICBdKTtcblxuICAgICAgaWYgKHVzZXJDb3VudCA+IDApIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdZb3UgY2Fubm90IGRlbGV0ZSBhIGxvY2F0aW9uIHRoYXQgc3RpbGwgaGFzIHVzZXJzLicpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChvcmdMb2NhdGlvbkNvdW50IDw9IDEpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdFYWNoIG9yZ2FuaXphdGlvbiBtdXN0IGhhdmUgYXQgbGVhc3Qgb25lIGxvY2F0aW9uLicpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSkgc2F0aXNmaWVzIExpc3RzWydMb2NhdGlvbiddO1xuIl0sIm5hbWVzIjpbImxpc3QiLCJtdWx0aXNlbGVjdCIsInJlbGF0aW9uc2hpcCIsInNlbGVjdCIsInRleHQiLCJnZXRUaW1lWm9uZXMiLCJIb2xpZGF5cyIsImNhbkVkaXRMb2NhdGlvbkRhdGEiLCJjYW5FZGl0T3JnRGF0YSIsImZpbHRlckJ5VXNlck9yZyIsImlzQXV0aGVudGljYXRlZCIsImlzR29kIiwiaXNMb2NhdGlvbkFkbWluIiwiaXNPcmdBZG1pbiIsIndvcmtpbmdEYXlPcHRpb25zIiwibGFiZWwiLCJ2YWx1ZSIsImhvbGlkYXlDb3VudHJ5T3B0aW9ucyIsIk9iamVjdCIsImVudHJpZXMiLCJnZXRDb3VudHJpZXMiLCJtYXAiLCJmaWVsZHMiLCJuYW1lIiwidmFsaWRhdGlvbiIsImlzUmVxdWlyZWQiLCJvcmciLCJyZWYiLCJtYW55IiwidGltZVBvbGljaWVzIiwidXNlcnMiLCJ0aW1lem9uZSIsIm9wdGlvbnMiLCJjdXJyZW50VGltZUZvcm1hdCIsInR5cGUiLCJ1aSIsImRlc2NyaXB0aW9uIiwid29ya2luZ0RheXMiLCJkZWZhdWx0VmFsdWUiLCJzbGljZSIsIm9wdGlvbiIsIndlZWtTdGFydERheSIsImhvbGlkYXlDb3VudHJ5IiwibGFiZWxGaWVsZCIsImFjY2VzcyIsIm9wZXJhdGlvbiIsInF1ZXJ5Iiwic2Vzc2lvbiIsImNyZWF0ZSIsInVwZGF0ZSIsImRlbGV0ZSIsIml0ZW0iLCJjb250ZXh0IiwiaWQiLCJ0YXJnZXRMb2NhdGlvbklkIiwiU3RyaW5nIiwic3Vkb0NvbnRleHQiLCJzdWRvIiwibG9jYXRpb24iLCJMb2NhdGlvbiIsImZpbmRPbmUiLCJ3aGVyZSIsIm9yZ0lkIiwibG9jYXRpb25JZCIsImZpbHRlciIsImVxdWFscyIsImhvb2tzIiwicmVzb2x2ZUlucHV0IiwicmVzb2x2ZWREYXRhIiwiY29ubmVjdCIsInZhbGlkYXRlRGVsZXRlIiwiYWRkVmFsaWRhdGlvbkVycm9yIiwib3JnTG9jYXRpb25Db3VudCIsInVzZXJDb3VudCIsIlByb21pc2UiLCJhbGwiLCJkYiIsImNvdW50IiwiVXNlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../schemas/Location.ts\n");

/***/ }),

/***/ "(api)/../../schemas/Organization.ts":
/*!*************************************!*\
  !*** ../../schemas/Organization.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var free_email_domains__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! free-email-domains */ \"free-email-domains\");\n/* harmony import */ var free_email_domains__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(free_email_domains__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\n\nconst freeEmailDomainSet = new Set(free_email_domains__WEBPACK_IMPORTED_MODULE_2___default().map((domain)=>domain.toLowerCase()));\nconst normalizeDomains = (value)=>{\n    if (!Array.isArray(value)) return [];\n    const seen = new Set();\n    const result = [];\n    value.map((domain)=>typeof domain === \"string\" ? domain.trim().toLowerCase() : \"\").filter(Boolean).forEach((domain)=>{\n        if (seen.has(domain)) return;\n        seen.add(domain);\n        result.push(domain);\n    });\n    return result;\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        name: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)({\n            validation: {\n                isRequired: true\n            }\n        }),\n        autojoinDomains: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.json)({\n            defaultValue: [],\n            ui: {\n                description: 'Array of domains allowed to auto-join (e.g. [\"example.com\"])'\n            }\n        }),\n        users: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User.org\",\n            many: true\n        }),\n        timePolicies: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicy.org\",\n            many: true\n        }),\n        timeTypes: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimeType.org\",\n            many: true\n        }),\n        locations: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"Location.org\",\n            many: true\n        })\n    },\n    ui: {\n        labelField: \"name\"\n    },\n    access: {\n        operation: {\n            query: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isAuthenticated,\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isAuthenticated,\n            update: (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.hasRole)([\n                _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.UserRole.GOD,\n                _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.UserRole.ORG_OWNER\n            ]),\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isGod\n        },\n        item: {\n            update: async ({ session, item })=>{\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isGod)({\n                    session\n                })) return true;\n                return session?.orgId === item.id;\n            }\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ resolvedData })=>({\n                    ...resolvedData,\n                    autojoinDomains: normalizeDomains(resolvedData.autojoinDomains)\n                }),\n            update: async ({ resolvedData })=>{\n                if (!Object.prototype.hasOwnProperty.call(resolvedData, \"autojoinDomains\")) return resolvedData;\n                return {\n                    ...resolvedData,\n                    autojoinDomains: normalizeDomains(resolvedData.autojoinDomains)\n                };\n            }\n        },\n        afterOperation: {\n            create: async ({ item, context })=>{\n                const session = context.session;\n                if (session?.id && item?.id) {\n                    const sudo = context.sudo();\n                    const user = await sudo.query.User.findOne({\n                        where: {\n                            id: session.id\n                        },\n                        query: \"id location { id }\"\n                    });\n                    // Only auto-connect if user already has a location (not in onboarding flow)\n                    // During onboarding, the completeOnboarding mutation will handle connecting both org and location\n                    if (user?.location?.id) {\n                        await sudo.db.User.updateOne({\n                            where: {\n                                id: session.id\n                            },\n                            data: {\n                                role: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.UserRole.ORG_OWNER,\n                                org: {\n                                    connect: {\n                                        id: item.id\n                                    }\n                                }\n                            }\n                        });\n                    }\n                }\n            }\n        },\n        validateInput: async ({ resolvedData, item, addValidationError })=>{\n            const candidate = Object.prototype.hasOwnProperty.call(resolvedData, \"autojoinDomains\") ? normalizeDomains(resolvedData.autojoinDomains) : normalizeDomains(item?.autojoinDomains);\n            const invalidDomain = candidate.find((domain)=>freeEmailDomainSet.has(domain));\n            if (invalidDomain) {\n                addValidationError(`Domain ${invalidDomain} is a free email provider and cannot be used for auto-join.`);\n            }\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM7d0JBQ3pDQyxPQUFPOzRCQUFFZCxJQUFJRixRQUFRRSxFQUFFO3dCQUFDO3dCQUN4QlQsT0FBTztvQkFDVDtvQkFFQSw0RUFBNEU7b0JBQzVFLGtHQUFrRztvQkFDbEcsSUFBSW9CLE1BQU1JLFVBQVVmLElBQUk7d0JBQ3RCLE1BQU1VLEtBQUtNLEVBQUUsQ0FBQ0osSUFBSSxDQUFDSyxTQUFTLENBQUM7NEJBQzNCSCxPQUFPO2dDQUFFZCxJQUFJRixRQUFRRSxFQUFFOzRCQUFDOzRCQUN4QmtCLE1BQU07Z0NBQ0pDLE1BQU1oRSw0REFBUUEsQ0FBQ3dDLFNBQVM7Z0NBQ3hCeUIsS0FBSztvQ0FBRUMsU0FBUzt3Q0FBRXJCLElBQUlILEtBQUtHLEVBQUU7b0NBQVc7Z0NBQUU7NEJBQzVDO3dCQUNGO29CQUNGO2dCQUNGO1lBQ0Y7UUFDRjtRQUNBc0IsZUFBZSxPQUFPLEVBQUVuQixZQUFZLEVBQUVOLElBQUksRUFBRTBCLGtCQUFrQixFQUFFO1lBQzlELE1BQU1DLFlBQVlwQixPQUFPQyxTQUFTLENBQUNDLGNBQWMsQ0FBQ0MsSUFBSSxDQUFDSixjQUFjLHFCQUNqRTFDLGlCQUFpQjBDLGFBQWF6QixlQUFlLElBQzdDakIsaUJBQWlCb0MsTUFBTW5CO1lBRTNCLE1BQU0rQyxnQkFBZ0JELFVBQVVFLElBQUksQ0FBQ25FLENBQUFBLFNBQVVILG1CQUFtQmUsR0FBRyxDQUFDWjtZQUN0RSxJQUFJa0UsZUFBZTtnQkFDakJGLG1CQUFtQixDQUFDLE9BQU8sRUFBRUUsY0FBYywyREFBMkQsQ0FBQztZQUN6RztRQUNGO0lBQ0Y7QUFDRixFQUFFLEVBQWlDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3NjaGVtYXMvT3JnYW5pemF0aW9uLnRzPzk3ZjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBMaXN0cyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBsaXN0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgeyBqc29uLCByZWxhdGlvbnNoaXAsIHRleHQgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2ZpZWxkcyc7XG5pbXBvcnQgZnJlZUVtYWlsRG9tYWlucyBmcm9tICdmcmVlLWVtYWlsLWRvbWFpbnMnO1xuaW1wb3J0IHR5cGUgeyBTZXNzaW9uIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQgeyBoYXNSb2xlLCBpc0F1dGhlbnRpY2F0ZWQsIGlzR29kLCBVc2VyUm9sZSB9IGZyb20gJy4uL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5cbmNvbnN0IGZyZWVFbWFpbERvbWFpblNldCA9IG5ldyBTZXQ8c3RyaW5nPigoZnJlZUVtYWlsRG9tYWlucyBhcyBzdHJpbmdbXSkubWFwKGRvbWFpbiA9PiBkb21haW4udG9Mb3dlckNhc2UoKSkpO1xuXG5jb25zdCBub3JtYWxpemVEb21haW5zID0gKHZhbHVlOiB1bmtub3duKTogc3RyaW5nW10gPT4ge1xuICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSByZXR1cm4gW107XG4gIGNvbnN0IHNlZW4gPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgY29uc3QgcmVzdWx0OiBzdHJpbmdbXSA9IFtdO1xuICB2YWx1ZVxuICAgIC5tYXAoZG9tYWluID0+ICh0eXBlb2YgZG9tYWluID09PSAnc3RyaW5nJyA/IGRvbWFpbi50cmltKCkudG9Mb3dlckNhc2UoKSA6ICcnKSlcbiAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgLmZvckVhY2goZG9tYWluID0+IHtcbiAgICAgIGlmIChzZWVuLmhhcyhkb21haW4pKSByZXR1cm47XG4gICAgICBzZWVuLmFkZChkb21haW4pO1xuICAgICAgcmVzdWx0LnB1c2goZG9tYWluKTtcbiAgICB9KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGxpc3Qoe1xuICBmaWVsZHM6IHtcbiAgICBuYW1lOiB0ZXh0KHsgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0gfSksXG4gICAgYXV0b2pvaW5Eb21haW5zOiBqc29uKHtcbiAgICAgIGRlZmF1bHRWYWx1ZTogW10sXG4gICAgICB1aToge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0FycmF5IG9mIGRvbWFpbnMgYWxsb3dlZCB0byBhdXRvLWpvaW4gKGUuZy4gW1wiZXhhbXBsZS5jb21cIl0pJ1xuICAgICAgfVxuICAgIH0pLFxuICAgIHVzZXJzOiByZWxhdGlvbnNoaXAoeyByZWY6ICdVc2VyLm9yZycsIG1hbnk6IHRydWUgfSksXG4gICAgdGltZVBvbGljaWVzOiByZWxhdGlvbnNoaXAoeyByZWY6ICdUaW1lUG9saWN5Lm9yZycsIG1hbnk6IHRydWUgfSksXG4gICAgdGltZVR5cGVzOiByZWxhdGlvbnNoaXAoeyByZWY6ICdUaW1lVHlwZS5vcmcnLCBtYW55OiB0cnVlIH0pLFxuICAgIGxvY2F0aW9uczogcmVsYXRpb25zaGlwKHsgcmVmOiAnTG9jYXRpb24ub3JnJywgbWFueTogdHJ1ZSB9KVxuICB9LFxuICB1aToge1xuICAgIGxhYmVsRmllbGQ6ICduYW1lJ1xuICB9LFxuICBhY2Nlc3M6IHtcbiAgICBvcGVyYXRpb246IHtcbiAgICAgIHF1ZXJ5OiBpc0F1dGhlbnRpY2F0ZWQsXG4gICAgICBjcmVhdGU6IGlzQXV0aGVudGljYXRlZCxcbiAgICAgIHVwZGF0ZTogaGFzUm9sZShbVXNlclJvbGUuR09ELCBVc2VyUm9sZS5PUkdfT1dORVJdKSxcbiAgICAgIGRlbGV0ZTogaXNHb2RcbiAgICB9LFxuICAgIGl0ZW06IHtcbiAgICAgIHVwZGF0ZTogYXN5bmMgKHsgc2Vzc2lvbiwgaXRlbSB9KSA9PiB7XG4gICAgICAgIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gc2Vzc2lvbj8ub3JnSWQgPT09IGl0ZW0uaWQ7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBob29rczoge1xuICAgIHJlc29sdmVJbnB1dDoge1xuICAgICAgY3JlYXRlOiBhc3luYyAoeyByZXNvbHZlZERhdGEgfSkgPT4gKHtcbiAgICAgICAgLi4ucmVzb2x2ZWREYXRhLFxuICAgICAgICBhdXRvam9pbkRvbWFpbnM6IG5vcm1hbGl6ZURvbWFpbnMocmVzb2x2ZWREYXRhLmF1dG9qb2luRG9tYWlucylcbiAgICAgIH0pLFxuICAgICAgdXBkYXRlOiBhc3luYyAoeyByZXNvbHZlZERhdGEgfSkgPT4ge1xuICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZXNvbHZlZERhdGEsICdhdXRvam9pbkRvbWFpbnMnKSkgcmV0dXJuIHJlc29sdmVkRGF0YTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5yZXNvbHZlZERhdGEsXG4gICAgICAgICAgYXV0b2pvaW5Eb21haW5zOiBub3JtYWxpemVEb21haW5zKHJlc29sdmVkRGF0YS5hdXRvam9pbkRvbWFpbnMpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcbiAgICBhZnRlck9wZXJhdGlvbjoge1xuICAgICAgY3JlYXRlOiBhc3luYyAoeyBpdGVtLCBjb250ZXh0IH0pID0+IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGNvbnRleHQuc2Vzc2lvbiBhcyBTZXNzaW9uIHwgbnVsbDtcbiAgICAgICAgaWYgKHNlc3Npb24/LmlkICYmIGl0ZW0/LmlkKSB7XG4gICAgICAgICAgY29uc3Qgc3VkbyA9IGNvbnRleHQuc3VkbygpO1xuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdWRvLnF1ZXJ5LlVzZXIuZmluZE9uZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogc2Vzc2lvbi5pZCB9LFxuICAgICAgICAgICAgcXVlcnk6ICdpZCBsb2NhdGlvbiB7IGlkIH0nXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBPbmx5IGF1dG8tY29ubmVjdCBpZiB1c2VyIGFscmVhZHkgaGFzIGEgbG9jYXRpb24gKG5vdCBpbiBvbmJvYXJkaW5nIGZsb3cpXG4gICAgICAgICAgLy8gRHVyaW5nIG9uYm9hcmRpbmcsIHRoZSBjb21wbGV0ZU9uYm9hcmRpbmcgbXV0YXRpb24gd2lsbCBoYW5kbGUgY29ubmVjdGluZyBib3RoIG9yZyBhbmQgbG9jYXRpb25cbiAgICAgICAgICBpZiAodXNlcj8ubG9jYXRpb24/LmlkKSB7XG4gICAgICAgICAgICBhd2FpdCBzdWRvLmRiLlVzZXIudXBkYXRlT25lKHtcbiAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IHNlc3Npb24uaWQgfSxcbiAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHJvbGU6IFVzZXJSb2xlLk9SR19PV05FUixcbiAgICAgICAgICAgICAgICBvcmc6IHsgY29ubmVjdDogeyBpZDogaXRlbS5pZCBhcyBzdHJpbmcgfSB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgdmFsaWRhdGVJbnB1dDogYXN5bmMgKHsgcmVzb2x2ZWREYXRhLCBpdGVtLCBhZGRWYWxpZGF0aW9uRXJyb3IgfSkgPT4ge1xuICAgICAgY29uc3QgY2FuZGlkYXRlID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc29sdmVkRGF0YSwgJ2F1dG9qb2luRG9tYWlucycpXG4gICAgICAgID8gbm9ybWFsaXplRG9tYWlucyhyZXNvbHZlZERhdGEuYXV0b2pvaW5Eb21haW5zKVxuICAgICAgICA6IG5vcm1hbGl6ZURvbWFpbnMoaXRlbT8uYXV0b2pvaW5Eb21haW5zKTtcblxuICAgICAgY29uc3QgaW52YWxpZERvbWFpbiA9IGNhbmRpZGF0ZS5maW5kKGRvbWFpbiA9PiBmcmVlRW1haWxEb21haW5TZXQuaGFzKGRvbWFpbikpO1xuICAgICAgaWYgKGludmFsaWREb21haW4pIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKGBEb21haW4gJHtpbnZhbGlkRG9tYWlufSBpcyBhIGZyZWUgZW1haWwgcHJvdmlkZXIgYW5kIGNhbm5vdCBiZSB1c2VkIGZvciBhdXRvLWpvaW4uYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59KSBzYXRpc2ZpZXMgTGlzdHNbJ09yZ2FuaXphdGlvbiddO1xuIl0sIm5hbWVzIjpbImxpc3QiLCJqc29uIiwicmVsYXRpb25zaGlwIiwidGV4dCIsImZyZWVFbWFpbERvbWFpbnMiLCJoYXNSb2xlIiwiaXNBdXRoZW50aWNhdGVkIiwiaXNHb2QiLCJVc2VyUm9sZSIsImZyZWVFbWFpbERvbWFpblNldCIsIlNldCIsIm1hcCIsImRvbWFpbiIsInRvTG93ZXJDYXNlIiwibm9ybWFsaXplRG9tYWlucyIsInZhbHVlIiwiQXJyYXkiLCJpc0FycmF5Iiwic2VlbiIsInJlc3VsdCIsInRyaW0iLCJmaWx0ZXIiLCJCb29sZWFuIiwiZm9yRWFjaCIsImhhcyIsImFkZCIsInB1c2giLCJmaWVsZHMiLCJuYW1lIiwidmFsaWRhdGlvbiIsImlzUmVxdWlyZWQiLCJhdXRvam9pbkRvbWFpbnMiLCJkZWZhdWx0VmFsdWUiLCJ1aSIsImRlc2NyaXB0aW9uIiwidXNlcnMiLCJyZWYiLCJtYW55IiwidGltZVBvbGljaWVzIiwidGltZVR5cGVzIiwibG9jYXRpb25zIiwibGFiZWxGaWVsZCIsImFjY2VzcyIsIm9wZXJhdGlvbiIsInF1ZXJ5IiwiY3JlYXRlIiwidXBkYXRlIiwiR09EIiwiT1JHX09XTkVSIiwiZGVsZXRlIiwiaXRlbSIsInNlc3Npb24iLCJvcmdJZCIsImlkIiwiaG9va3MiLCJyZXNvbHZlSW5wdXQiLCJyZXNvbHZlZERhdGEiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhZnRlck9wZXJhdGlvbiIsImNvbnRleHQiLCJzdWRvIiwidXNlciIsIlVzZXIiLCJmaW5kT25lIiwid2hlcmUiLCJsb2NhdGlvbiIsImRiIiwidXBkYXRlT25lIiwiZGF0YSIsInJvbGUiLCJvcmciLCJjb25uZWN0IiwidmFsaWRhdGVJbnB1dCIsImFkZFZhbGlkYXRpb25FcnJvciIsImNhbmRpZGF0ZSIsImludmFsaWREb21haW4iLCJmaW5kIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/Organization.ts\n");

/***/ }),

/***/ "(api)/../../schemas/TimePlan.ts":
/*!*********************************!*\
  !*** ../../schemas/TimePlan.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n/* harmony import */ var _domains_timePlan_rrule__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../domains/timePlan/rrule */ \"(api)/../../domains/timePlan/rrule.ts\");\n\n\n\n\n\nconst MAX_MONTHLY_CALENDAR_DAYS = 31;\nconst MAX_MONTHLY_BUSINESS_DAYS = 23;\nconst repeatModeOptions = [\n    {\n        label: \"Single\",\n        value: \"SINGLE\"\n    },\n    {\n        label: \"Weekly\",\n        value: \"WEEKLY\"\n    },\n    {\n        label: \"Monthly (Calendar Day)\",\n        value: \"MONTHLY_CALENDAR\"\n    },\n    {\n        label: \"Monthly (Business Day)\",\n        value: \"MONTHLY_BUSINESS\"\n    }\n];\nconst dayOfWeekOptions = [\n    {\n        label: \"Sunday\",\n        value: \"SUN\"\n    },\n    {\n        label: \"Monday\",\n        value: \"MON\"\n    },\n    {\n        label: \"Tuesday\",\n        value: \"TUE\"\n    },\n    {\n        label: \"Wednesday\",\n        value: \"WED\"\n    },\n    {\n        label: \"Thursday\",\n        value: \"THU\"\n    },\n    {\n        label: \"Friday\",\n        value: \"FRI\"\n    },\n    {\n        label: \"Saturday\",\n        value: \"SAT\"\n    }\n];\nconst toIsoString = (value)=>{\n    if (!value) return null;\n    const date = typeof value === \"string\" ? new Date(value) : value;\n    if (Number.isNaN(date.getTime())) return null;\n    return date.toISOString();\n};\nconst getRRuleExceptionDates = (item)=>{\n    const exceptions = item?.repeatExceptions ?? [];\n    return exceptions.map((exception)=>toIsoString(exception.startAt)).filter(Boolean);\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        org: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"Organization\",\n            many: false\n        }),\n        user: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User\",\n            many: false\n        }),\n        timeType: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimeType.timePlans\",\n            many: false\n        }),\n        timePolicy: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicy.timePlans\",\n            many: false\n        }),\n        // Self-relationship for repeat patterns\n        repeatOrigin: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePlan.repeatExceptions\",\n            many: false,\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        repeatExceptions: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePlan.repeatOrigin\",\n            many: true,\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        status: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: [\n                {\n                    label: \"Pending\",\n                    value: \"PENDING\"\n                },\n                {\n                    label: \"Approved\",\n                    value: \"APPROVED\"\n                },\n                {\n                    label: \"Declined\",\n                    value: \"DECLINED\"\n                }\n            ],\n            defaultValue: \"PENDING\"\n        }),\n        origin: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: [\n                {\n                    label: \"Direct\",\n                    value: \"DIRECT\"\n                },\n                {\n                    label: \"Repeater exception\",\n                    value: \"REPEATER_EXCEPTION\"\n                }\n            ],\n            defaultValue: \"DIRECT\",\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        // Unified date/time fields\n        startAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)({\n            validation: {\n                isRequired: true\n            }\n        }),\n        endAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)(),\n        durationUnit: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: [\n                {\n                    label: \"Day\",\n                    value: \"DAY\"\n                },\n                {\n                    label: \"Hour\",\n                    value: \"HOUR\"\n                }\n            ],\n            defaultValue: \"DAY\",\n            validation: {\n                isRequired: true\n            }\n        }),\n        duration: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.float)({\n            defaultValue: 0,\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        isAllDay: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.checkbox)({\n            defaultValue: true\n        }),\n        // Repeat configuration\n        repeatMode: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: repeatModeOptions,\n            defaultValue: \"SINGLE\",\n            validation: {\n                isRequired: true\n            }\n        }),\n        repeatInterval: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.integer)({\n            defaultValue: 1,\n            validation: {\n                min: 1\n            }\n        }),\n        repeatDay: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.integer)({\n            ui: {\n                description: \"For weekly: 0-6 (Sun-Sat). For monthly calendar: day 1-30. For monthly business: positive from start, negative from end.\"\n            }\n        }),\n        rrule: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.virtual)({\n            field: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>(0,_domains_timePlan_rrule__WEBPACK_IMPORTED_MODULE_3__.buildTimePlanRRule)(item)\n            })\n        }),\n        rruleExceptionDates: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.virtual)({\n            field: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)),\n                resolve: (item)=>getRRuleExceptionDates(item)\n            })\n        }),\n        // Virtual field for isRepeat\n        isRepeat: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.virtual)({\n            field: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean,\n                resolve: (item)=>item.repeatMode !== \"SINGLE\"\n            })\n        }),\n        // Virtual field for repeat day of week enum (when repeatMode is WEEKLY)\n        repeatDayOfWeek: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.virtual)({\n            field: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.enum({\n                    name: \"TimePlanRepeatDayOfWeek\",\n                    values: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.enumValues([\n                        \"SUN\",\n                        \"MON\",\n                        \"TUE\",\n                        \"WED\",\n                        \"THU\",\n                        \"FRI\",\n                        \"SAT\"\n                    ])\n                }),\n                resolve: (item)=>{\n                    if (item.repeatMode !== \"WEEKLY\" || item.repeatDay == null) return null;\n                    const dayMap = [\n                        \"SUN\",\n                        \"MON\",\n                        \"TUE\",\n                        \"WED\",\n                        \"THU\",\n                        \"FRI\",\n                        \"SAT\"\n                    ];\n                    return dayMap[item.repeatDay] || null;\n                }\n            })\n        }),\n        reason: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)(),\n        decidedBy: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User\",\n            many: false\n        }),\n        decidedAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)()\n    },\n    ui: {\n        labelField: \"id\"\n    },\n    access: {\n        operation: {\n            query: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated,\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated,\n            update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAnyAdmin,\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAnyAdmin\n        }\n    },\n    hooks: {\n        validateInput: async ({ resolvedData, item, operation, addValidationError, context })=>{\n            const { repeatMode, repeatDay, timePolicy } = resolvedData;\n            // Validate repeat patterns\n            if (repeatMode === \"WEEKLY\") {\n                if (repeatDay == null || repeatDay < 0 || repeatDay > 6) {\n                    addValidationError(\"Weekly patterns require repeatDay to be between 0 (Sunday) and 6 (Saturday).\");\n                }\n            }\n            if (repeatMode === \"MONTHLY_CALENDAR\") {\n                if (!repeatDay || repeatDay <= 0 || repeatDay >= MAX_MONTHLY_CALENDAR_DAYS) {\n                    addValidationError(`Monthly calendar patterns require repeatDay between 1 and ${MAX_MONTHLY_CALENDAR_DAYS - 1}.`);\n                }\n            }\n            if (repeatMode === \"MONTHLY_BUSINESS\") {\n                if (!repeatDay || repeatDay === 0 || Math.abs(repeatDay) > MAX_MONTHLY_BUSINESS_DAYS) {\n                    addValidationError(`Monthly business patterns require non-zero repeatDay with absolute value not exceeding ${MAX_MONTHLY_BUSINESS_DAYS}.`);\n                }\n            }\n            // Validate that timePolicy has isAllocationManaged = false for repeat patterns\n            if (repeatMode && repeatMode !== \"SINGLE\") {\n                const timePolicyId = timePolicy?.connect?.id ? timePolicy.connect.id : operation === \"update\" && item && !timePolicy ? (()=>{\n                    const existingItem = item;\n                    return existingItem.timePolicyId ? String(existingItem.timePolicyId) : null;\n                })() : null;\n                if (!timePolicyId) return;\n                const policyDetails = await context.query.TimePolicy.findOne({\n                    where: {\n                        id: timePolicyId\n                    },\n                    query: \"id isAllocationManaged\"\n                });\n                if (policyDetails?.isAllocationManaged) {\n                    addValidationError(\"Repeat patterns can only be used with policies that have isAllocationManaged set to false.\");\n                }\n            }\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGNBQWM7Z0JBRW5CLE1BQU1JLGdCQUFpQixNQUFNUCxRQUFRUixLQUFLLENBQUNnQixVQUFVLENBQUNDLE9BQU8sQ0FBQztvQkFDNURDLE9BQU87d0JBQUVMLElBQUlGO29CQUFhO29CQUMxQlgsT0FBTztnQkFDVDtnQkFFQSxJQUFJZSxlQUFlSSxxQkFBcUI7b0JBQ3RDWixtQkFBbUI7Z0JBQ3JCO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YsRUFBRSxFQUE2QiIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL1RpbWVQbGFuLnRzP2Q5OWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBMaXN0cyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBsaXN0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgeyBjaGVja2JveCwgZmxvYXQsIGludGVnZXIsIHJlbGF0aW9uc2hpcCwgc2VsZWN0LCB0ZXh0LCB0aW1lc3RhbXAsIHZpcnR1YWwgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2ZpZWxkcyc7XG5pbXBvcnQgeyBncmFwaHFsIGFzIGcgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlJztcbmltcG9ydCB7IGlzQW55QWRtaW4sIGlzQXV0aGVudGljYXRlZCB9IGZyb20gJy4uL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5pbXBvcnQgeyBidWlsZFRpbWVQbGFuUlJ1bGUgfSBmcm9tICcuLi9kb21haW5zL3RpbWVQbGFuL3JydWxlJztcblxuY29uc3QgTUFYX01PTlRITFlfQ0FMRU5EQVJfREFZUyA9IDMxO1xuY29uc3QgTUFYX01PTlRITFlfQlVTSU5FU1NfREFZUyA9IDIzO1xuXG5jb25zdCByZXBlYXRNb2RlT3B0aW9ucyA9IFtcbiAgeyBsYWJlbDogJ1NpbmdsZScsIHZhbHVlOiAnU0lOR0xFJyB9LFxuICB7IGxhYmVsOiAnV2Vla2x5JywgdmFsdWU6ICdXRUVLTFknIH0sXG4gIHsgbGFiZWw6ICdNb250aGx5IChDYWxlbmRhciBEYXkpJywgdmFsdWU6ICdNT05USExZX0NBTEVOREFSJyB9LFxuICB7IGxhYmVsOiAnTW9udGhseSAoQnVzaW5lc3MgRGF5KScsIHZhbHVlOiAnTU9OVEhMWV9CVVNJTkVTUycgfVxuXSBhcyBjb25zdDtcblxuY29uc3QgZGF5T2ZXZWVrT3B0aW9ucyA9IFtcbiAgeyBsYWJlbDogJ1N1bmRheScsIHZhbHVlOiAnU1VOJyB9LFxuICB7IGxhYmVsOiAnTW9uZGF5JywgdmFsdWU6ICdNT04nIH0sXG4gIHsgbGFiZWw6ICdUdWVzZGF5JywgdmFsdWU6ICdUVUUnIH0sXG4gIHsgbGFiZWw6ICdXZWRuZXNkYXknLCB2YWx1ZTogJ1dFRCcgfSxcbiAgeyBsYWJlbDogJ1RodXJzZGF5JywgdmFsdWU6ICdUSFUnIH0sXG4gIHsgbGFiZWw6ICdGcmlkYXknLCB2YWx1ZTogJ0ZSSScgfSxcbiAgeyBsYWJlbDogJ1NhdHVyZGF5JywgdmFsdWU6ICdTQVQnIH1cbl0gYXMgY29uc3Q7XG5cbmNvbnN0IHRvSXNvU3RyaW5nID0gKHZhbHVlPzogc3RyaW5nIHwgRGF0ZSB8IG51bGwpID0+IHtcbiAgaWYgKCF2YWx1ZSkgcmV0dXJuIG51bGw7XG4gIGNvbnN0IGRhdGUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUodmFsdWUpIDogdmFsdWU7XG4gIGlmIChOdW1iZXIuaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIGRhdGUudG9JU09TdHJpbmcoKTtcbn07XG5cbmNvbnN0IGdldFJSdWxlRXhjZXB0aW9uRGF0ZXMgPSAoaXRlbTogeyByZXBlYXRFeGNlcHRpb25zPzogQXJyYXk8eyBzdGFydEF0Pzogc3RyaW5nIHwgRGF0ZSB8IG51bGwgfT4gfCBudWxsIH0gfCBudWxsIHwgdW5kZWZpbmVkKSA9PiB7XG4gIGNvbnN0IGV4Y2VwdGlvbnMgPSBpdGVtPy5yZXBlYXRFeGNlcHRpb25zID8/IFtdO1xuICByZXR1cm4gZXhjZXB0aW9uc1xuICAgIC5tYXAoZXhjZXB0aW9uID0+IHRvSXNvU3RyaW5nKGV4Y2VwdGlvbi5zdGFydEF0KSlcbiAgICAuZmlsdGVyKEJvb2xlYW4pIGFzIHN0cmluZ1tdO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgbGlzdCh7XG4gIGZpZWxkczoge1xuICAgIG9yZzogcmVsYXRpb25zaGlwKHsgcmVmOiAnT3JnYW5pemF0aW9uJywgbWFueTogZmFsc2UgfSksXG4gICAgdXNlcjogcmVsYXRpb25zaGlwKHsgcmVmOiAnVXNlcicsIG1hbnk6IGZhbHNlIH0pLFxuICAgIHRpbWVUeXBlOiByZWxhdGlvbnNoaXAoeyByZWY6ICdUaW1lVHlwZS50aW1lUGxhbnMnLCBtYW55OiBmYWxzZSB9KSxcbiAgICB0aW1lUG9saWN5OiByZWxhdGlvbnNoaXAoeyByZWY6ICdUaW1lUG9saWN5LnRpbWVQbGFucycsIG1hbnk6IGZhbHNlIH0pLFxuICAgIFxuICAgIC8vIFNlbGYtcmVsYXRpb25zaGlwIGZvciByZXBlYXQgcGF0dGVybnNcbiAgICByZXBlYXRPcmlnaW46IHJlbGF0aW9uc2hpcCh7XG4gICAgICByZWY6ICdUaW1lUGxhbi5yZXBlYXRFeGNlcHRpb25zJyxcbiAgICAgIG1hbnk6IGZhbHNlLFxuICAgICAgdWk6IHsgY3JlYXRlVmlldzogeyBmaWVsZE1vZGU6ICdoaWRkZW4nIH0sIGl0ZW1WaWV3OiB7IGZpZWxkTW9kZTogJ3JlYWQnIH0gfVxuICAgIH0pLFxuICAgIHJlcGVhdEV4Y2VwdGlvbnM6IHJlbGF0aW9uc2hpcCh7XG4gICAgICByZWY6ICdUaW1lUGxhbi5yZXBlYXRPcmlnaW4nLFxuICAgICAgbWFueTogdHJ1ZSxcbiAgICAgIHVpOiB7IGNyZWF0ZVZpZXc6IHsgZmllbGRNb2RlOiAnaGlkZGVuJyB9LCBpdGVtVmlldzogeyBmaWVsZE1vZGU6ICdyZWFkJyB9IH1cbiAgICB9KSxcbiAgICBcbiAgICBzdGF0dXM6IHNlbGVjdCh7XG4gICAgICB0eXBlOiAnZW51bScsXG4gICAgICBvcHRpb25zOiBbXG4gICAgICAgIHsgbGFiZWw6ICdQZW5kaW5nJywgdmFsdWU6ICdQRU5ESU5HJyB9LFxuICAgICAgICB7IGxhYmVsOiAnQXBwcm92ZWQnLCB2YWx1ZTogJ0FQUFJPVkVEJyB9LFxuICAgICAgICB7IGxhYmVsOiAnRGVjbGluZWQnLCB2YWx1ZTogJ0RFQ0xJTkVEJyB9XG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiAnUEVORElORydcbiAgICB9KSxcbiAgICBvcmlnaW46IHNlbGVjdCh7XG4gICAgICB0eXBlOiAnZW51bScsXG4gICAgICBvcHRpb25zOiBbXG4gICAgICAgIHsgbGFiZWw6ICdEaXJlY3QnLCB2YWx1ZTogJ0RJUkVDVCcgfSxcbiAgICAgICAgeyBsYWJlbDogJ1JlcGVhdGVyIGV4Y2VwdGlvbicsIHZhbHVlOiAnUkVQRUFURVJfRVhDRVBUSU9OJyB9XG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiAnRElSRUNUJyxcbiAgICAgIHVpOiB7XG4gICAgICAgIGNyZWF0ZVZpZXc6IHsgZmllbGRNb2RlOiAnaGlkZGVuJyB9LFxuICAgICAgICBpdGVtVmlldzogeyBmaWVsZE1vZGU6ICdyZWFkJyB9XG4gICAgICB9XG4gICAgfSksXG4gICAgXG4gICAgLy8gVW5pZmllZCBkYXRlL3RpbWUgZmllbGRzXG4gICAgc3RhcnRBdDogdGltZXN0YW1wKHsgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0gfSksXG4gICAgZW5kQXQ6IHRpbWVzdGFtcCgpLFxuICAgIGR1cmF0aW9uVW5pdDogc2VsZWN0KHtcbiAgICAgIHR5cGU6ICdlbnVtJyxcbiAgICAgIG9wdGlvbnM6IFtcbiAgICAgICAgeyBsYWJlbDogJ0RheScsIHZhbHVlOiAnREFZJyB9LFxuICAgICAgICB7IGxhYmVsOiAnSG91cicsIHZhbHVlOiAnSE9VUicgfVxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogJ0RBWScsXG4gICAgICB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfVxuICAgIH0pLFxuICAgIGR1cmF0aW9uOiBmbG9hdCh7XG4gICAgICBkZWZhdWx0VmFsdWU6IDAsXG4gICAgICB1aTogeyBjcmVhdGVWaWV3OiB7IGZpZWxkTW9kZTogJ2hpZGRlbicgfSwgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfSB9XG4gICAgfSksXG4gICAgaXNBbGxEYXk6IGNoZWNrYm94KHsgZGVmYXVsdFZhbHVlOiB0cnVlIH0pLFxuICAgIFxuICAgIC8vIFJlcGVhdCBjb25maWd1cmF0aW9uXG4gICAgcmVwZWF0TW9kZTogc2VsZWN0KHtcbiAgICAgIHR5cGU6ICdlbnVtJyxcbiAgICAgIG9wdGlvbnM6IHJlcGVhdE1vZGVPcHRpb25zLFxuICAgICAgZGVmYXVsdFZhbHVlOiAnU0lOR0xFJyxcbiAgICAgIHZhbGlkYXRpb246IHsgaXNSZXF1aXJlZDogdHJ1ZSB9XG4gICAgfSksXG4gICAgcmVwZWF0SW50ZXJ2YWw6IGludGVnZXIoeyBkZWZhdWx0VmFsdWU6IDEsIHZhbGlkYXRpb246IHsgbWluOiAxIH0gfSksXG4gICAgcmVwZWF0RGF5OiBpbnRlZ2VyKHtcbiAgICAgIHVpOiB7IFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0ZvciB3ZWVrbHk6IDAtNiAoU3VuLVNhdCkuIEZvciBtb250aGx5IGNhbGVuZGFyOiBkYXkgMS0zMC4gRm9yIG1vbnRobHkgYnVzaW5lc3M6IHBvc2l0aXZlIGZyb20gc3RhcnQsIG5lZ2F0aXZlIGZyb20gZW5kLicgXG4gICAgICB9XG4gICAgfSksXG4gICAgcnJ1bGU6IHZpcnR1YWwoe1xuICAgICAgZmllbGQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLlN0cmluZyxcbiAgICAgICAgcmVzb2x2ZTogaXRlbSA9PiBidWlsZFRpbWVQbGFuUlJ1bGUoaXRlbSlcbiAgICAgIH0pXG4gICAgfSksXG4gICAgcnJ1bGVFeGNlcHRpb25EYXRlczogdmlydHVhbCh7XG4gICAgICBmaWVsZDogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcubGlzdChnLm5vbk51bGwoZy5TdHJpbmcpKSxcbiAgICAgICAgcmVzb2x2ZTogaXRlbSA9PiBnZXRSUnVsZUV4Y2VwdGlvbkRhdGVzKGl0ZW0pXG4gICAgICB9KVxuICAgIH0pLFxuICAgIFxuICAgIC8vIFZpcnR1YWwgZmllbGQgZm9yIGlzUmVwZWF0XG4gICAgaXNSZXBlYXQ6IHZpcnR1YWwoe1xuICAgICAgZmllbGQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLkJvb2xlYW4sXG4gICAgICAgIHJlc29sdmU6IChpdGVtOiBhbnkpID0+IGl0ZW0ucmVwZWF0TW9kZSAhPT0gJ1NJTkdMRSdcbiAgICAgIH0pXG4gICAgfSksXG4gICAgXG4gICAgLy8gVmlydHVhbCBmaWVsZCBmb3IgcmVwZWF0IGRheSBvZiB3ZWVrIGVudW0gKHdoZW4gcmVwZWF0TW9kZSBpcyBXRUVLTFkpXG4gICAgcmVwZWF0RGF5T2ZXZWVrOiB2aXJ0dWFsKHtcbiAgICAgIGZpZWxkOiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogZy5lbnVtKHtcbiAgICAgICAgICBuYW1lOiAnVGltZVBsYW5SZXBlYXREYXlPZldlZWsnLFxuICAgICAgICAgIHZhbHVlczogZy5lbnVtVmFsdWVzKFsnU1VOJywgJ01PTicsICdUVUUnLCAnV0VEJywgJ1RIVScsICdGUkknLCAnU0FUJ10pXG4gICAgICAgIH0pLFxuICAgICAgICByZXNvbHZlOiAoaXRlbTogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKGl0ZW0ucmVwZWF0TW9kZSAhPT0gJ1dFRUtMWScgfHwgaXRlbS5yZXBlYXREYXkgPT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgY29uc3QgZGF5TWFwID0gWydTVU4nLCAnTU9OJywgJ1RVRScsICdXRUQnLCAnVEhVJywgJ0ZSSScsICdTQVQnXTtcbiAgICAgICAgICByZXR1cm4gZGF5TWFwW2l0ZW0ucmVwZWF0RGF5XSB8fCBudWxsO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pLFxuICAgIFxuICAgIHJlYXNvbjogdGV4dCgpLFxuICAgIGRlY2lkZWRCeTogcmVsYXRpb25zaGlwKHsgcmVmOiAnVXNlcicsIG1hbnk6IGZhbHNlIH0pLFxuICAgIGRlY2lkZWRBdDogdGltZXN0YW1wKClcbiAgfSxcbiAgdWk6IHsgbGFiZWxGaWVsZDogJ2lkJyB9LFxuICBhY2Nlc3M6IHtcbiAgICBvcGVyYXRpb246IHtcbiAgICAgIHF1ZXJ5OiBpc0F1dGhlbnRpY2F0ZWQsXG4gICAgICBjcmVhdGU6IGlzQXV0aGVudGljYXRlZCxcbiAgICAgIHVwZGF0ZTogaXNBbnlBZG1pbixcbiAgICAgIGRlbGV0ZTogaXNBbnlBZG1pblxuICAgIH1cbiAgfSxcbiAgaG9va3M6IHtcbiAgICB2YWxpZGF0ZUlucHV0OiBhc3luYyAoeyByZXNvbHZlZERhdGEsIGl0ZW0sIG9wZXJhdGlvbiwgYWRkVmFsaWRhdGlvbkVycm9yLCBjb250ZXh0IH0pID0+IHtcbiAgICAgIGNvbnN0IHsgcmVwZWF0TW9kZSwgcmVwZWF0RGF5LCB0aW1lUG9saWN5IH0gPSByZXNvbHZlZERhdGE7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcGVhdCBwYXR0ZXJuc1xuICAgICAgaWYgKHJlcGVhdE1vZGUgPT09ICdXRUVLTFknKSB7XG4gICAgICAgIGlmIChyZXBlYXREYXkgPT0gbnVsbCB8fCByZXBlYXREYXkgPCAwIHx8IHJlcGVhdERheSA+IDYpIHtcbiAgICAgICAgICBhZGRWYWxpZGF0aW9uRXJyb3IoJ1dlZWtseSBwYXR0ZXJucyByZXF1aXJlIHJlcGVhdERheSB0byBiZSBiZXR3ZWVuIDAgKFN1bmRheSkgYW5kIDYgKFNhdHVyZGF5KS4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocmVwZWF0TW9kZSA9PT0gJ01PTlRITFlfQ0FMRU5EQVInKSB7XG4gICAgICAgIGlmICghcmVwZWF0RGF5IHx8IHJlcGVhdERheSA8PSAwIHx8IHJlcGVhdERheSA+PSBNQVhfTU9OVEhMWV9DQUxFTkRBUl9EQVlTKSB7XG4gICAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKFxuICAgICAgICAgICAgYE1vbnRobHkgY2FsZW5kYXIgcGF0dGVybnMgcmVxdWlyZSByZXBlYXREYXkgYmV0d2VlbiAxIGFuZCAke01BWF9NT05USExZX0NBTEVOREFSX0RBWVMgLSAxfS5gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocmVwZWF0TW9kZSA9PT0gJ01PTlRITFlfQlVTSU5FU1MnKSB7XG4gICAgICAgIGlmICghcmVwZWF0RGF5IHx8IHJlcGVhdERheSA9PT0gMCB8fCBNYXRoLmFicyhyZXBlYXREYXkpID4gTUFYX01PTlRITFlfQlVTSU5FU1NfREFZUykge1xuICAgICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcihcbiAgICAgICAgICAgIGBNb250aGx5IGJ1c2luZXNzIHBhdHRlcm5zIHJlcXVpcmUgbm9uLXplcm8gcmVwZWF0RGF5IHdpdGggYWJzb2x1dGUgdmFsdWUgbm90IGV4Y2VlZGluZyAke01BWF9NT05USExZX0JVU0lORVNTX0RBWVN9LmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHRoYXQgdGltZVBvbGljeSBoYXMgaXNBbGxvY2F0aW9uTWFuYWdlZCA9IGZhbHNlIGZvciByZXBlYXQgcGF0dGVybnNcbiAgICAgIGlmIChyZXBlYXRNb2RlICYmIHJlcGVhdE1vZGUgIT09ICdTSU5HTEUnKSB7XG4gICAgICAgIGNvbnN0IHRpbWVQb2xpY3lJZCA9IHRpbWVQb2xpY3k/LmNvbm5lY3Q/LmlkXG4gICAgICAgICAgPyB0aW1lUG9saWN5LmNvbm5lY3QuaWRcbiAgICAgICAgICA6IG9wZXJhdGlvbiA9PT0gJ3VwZGF0ZScgJiYgaXRlbSAmJiAhdGltZVBvbGljeVxuICAgICAgICAgICAgPyAoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSXRlbSA9IGl0ZW0gYXMgeyB0aW1lUG9saWN5SWQ/OiBzdHJpbmcgfCBudWxsIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nSXRlbS50aW1lUG9saWN5SWQgPyBTdHJpbmcoZXhpc3RpbmdJdGVtLnRpbWVQb2xpY3lJZCkgOiBudWxsO1xuICAgICAgICAgICAgICB9KSgpXG4gICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgaWYgKCF0aW1lUG9saWN5SWQpIHJldHVybjtcblxuICAgICAgICBjb25zdCBwb2xpY3lEZXRhaWxzID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVGltZVBvbGljeS5maW5kT25lKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogdGltZVBvbGljeUlkIH0sXG4gICAgICAgICAgcXVlcnk6ICdpZCBpc0FsbG9jYXRpb25NYW5hZ2VkJ1xuICAgICAgICB9KSkgYXMgeyBpZDogc3RyaW5nOyBpc0FsbG9jYXRpb25NYW5hZ2VkOiBib29sZWFuIHwgbnVsbCB9IHwgbnVsbDtcblxuICAgICAgICBpZiAocG9saWN5RGV0YWlscz8uaXNBbGxvY2F0aW9uTWFuYWdlZCkge1xuICAgICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcignUmVwZWF0IHBhdHRlcm5zIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCBwb2xpY2llcyB0aGF0IGhhdmUgaXNBbGxvY2F0aW9uTWFuYWdlZCBzZXQgdG8gZmFsc2UuJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pIHNhdGlzZmllcyBMaXN0c1snVGltZVBsYW4nXTtcblxuXG5cbiJdLCJuYW1lcyI6WyJsaXN0IiwiY2hlY2tib3giLCJmbG9hdCIsImludGVnZXIiLCJyZWxhdGlvbnNoaXAiLCJzZWxlY3QiLCJ0ZXh0IiwidGltZXN0YW1wIiwidmlydHVhbCIsImdyYXBocWwiLCJnIiwiaXNBbnlBZG1pbiIsImlzQXV0aGVudGljYXRlZCIsImJ1aWxkVGltZVBsYW5SUnVsZSIsIk1BWF9NT05USExZX0NBTEVOREFSX0RBWVMiLCJNQVhfTU9OVEhMWV9CVVNJTkVTU19EQVlTIiwicmVwZWF0TW9kZU9wdGlvbnMiLCJsYWJlbCIsInZhbHVlIiwiZGF5T2ZXZWVrT3B0aW9ucyIsInRvSXNvU3RyaW5nIiwiZGF0ZSIsIkRhdGUiLCJOdW1iZXIiLCJpc05hTiIsImdldFRpbWUiLCJ0b0lTT1N0cmluZyIsImdldFJSdWxlRXhjZXB0aW9uRGF0ZXMiLCJpdGVtIiwiZXhjZXB0aW9ucyIsInJlcGVhdEV4Y2VwdGlvbnMiLCJtYXAiLCJleGNlcHRpb24iLCJzdGFydEF0IiwiZmlsdGVyIiwiQm9vbGVhbiIsImZpZWxkcyIsIm9yZyIsInJlZiIsIm1hbnkiLCJ1c2VyIiwidGltZVR5cGUiLCJ0aW1lUG9saWN5IiwicmVwZWF0T3JpZ2luIiwidWkiLCJjcmVhdGVWaWV3IiwiZmllbGRNb2RlIiwiaXRlbVZpZXciLCJzdGF0dXMiLCJ0eXBlIiwib3B0aW9ucyIsImRlZmF1bHRWYWx1ZSIsIm9yaWdpbiIsInZhbGlkYXRpb24iLCJpc1JlcXVpcmVkIiwiZW5kQXQiLCJkdXJhdGlvblVuaXQiLCJkdXJhdGlvbiIsImlzQWxsRGF5IiwicmVwZWF0TW9kZSIsInJlcGVhdEludGVydmFsIiwibWluIiwicmVwZWF0RGF5IiwiZGVzY3JpcHRpb24iLCJycnVsZSIsImZpZWxkIiwiU3RyaW5nIiwicmVzb2x2ZSIsInJydWxlRXhjZXB0aW9uRGF0ZXMiLCJub25OdWxsIiwiaXNSZXBlYXQiLCJyZXBlYXREYXlPZldlZWsiLCJlbnVtIiwibmFtZSIsInZhbHVlcyIsImVudW1WYWx1ZXMiLCJkYXlNYXAiLCJyZWFzb24iLCJkZWNpZGVkQnkiLCJkZWNpZGVkQXQiLCJsYWJlbEZpZWxkIiwiYWNjZXNzIiwib3BlcmF0aW9uIiwicXVlcnkiLCJjcmVhdGUiLCJ1cGRhdGUiLCJkZWxldGUiLCJob29rcyIsInZhbGlkYXRlSW5wdXQiLCJyZXNvbHZlZERhdGEiLCJhZGRWYWxpZGF0aW9uRXJyb3IiLCJjb250ZXh0IiwiTWF0aCIsImFicyIsInRpbWVQb2xpY3lJZCIsImNvbm5lY3QiLCJpZCIsImV4aXN0aW5nSXRlbSIsInBvbGljeURldGFpbHMiLCJUaW1lUG9saWN5IiwiZmluZE9uZSIsIndoZXJlIiwiaXNBbGxvY2F0aW9uTWFuYWdlZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../schemas/TimePlan.ts\n");

/***/ }),

/***/ "(api)/../../schemas/TimePolicy.ts":
/*!***********************************!*\
  !*** ../../schemas/TimePolicy.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        name: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)({\n            validation: {\n                isRequired: true\n            }\n        }),\n        org: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"Organization.timePolicies\",\n            many: false\n        }),\n        timeType: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimeType.timePolicies\",\n            many: false\n        }),\n        locations: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"Location.timePolicies\",\n            many: true\n        }),\n        isAllocationManaged: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.checkbox)({\n            defaultValue: true\n        }),\n        isApprovable: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.checkbox)({\n            defaultValue: true\n        }),\n        timePolicyAllocations: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicyAllocation.timePolicy\",\n            many: true\n        }),\n        allocations: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"UserAllocation.timePolicy\",\n            many: true\n        }),\n        timePlans: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePlan.timePolicy\",\n            many: true\n        })\n    },\n    ui: {\n        labelField: \"name\"\n    },\n    access: {\n        operation: {\n            query: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n                    session\n                }),\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData\n        },\n        filter: {\n            query: async ({ session })=>{\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n                    session\n                })) return false;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isGod)({\n                    session\n                })) return true;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isOrgAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterByUserOrg)({\n                    session\n                });\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isLocationAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterByUserOrg)({\n                    session\n                });\n                return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterPoliciesByUserLocation)({\n                    session\n                });\n            }\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ resolvedData, context })=>{\n                if (resolvedData.org) return resolvedData;\n                const orgId = context.session?.orgId;\n                if (!orgId) return resolvedData;\n                return {\n                    ...resolvedData,\n                    org: {\n                        connect: {\n                            id: orgId\n                        }\n                    }\n                };\n            }\n        },\n        validateInput: async ({ operation, resolvedData, item, addValidationError, context })=>{\n            const session = context?.session ?? null;\n            const userIsGod = (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isGod)({\n                session\n            });\n            if (operation === \"update\" && !userIsGod && Object.prototype.hasOwnProperty.call(resolvedData, \"isAllocationManaged\") && resolvedData.isAllocationManaged !== item?.isAllocationManaged) {\n                addValidationError(\"isAllocationManaged cannot be changed after creation.\");\n            }\n            if (operation === \"update\" && !userIsGod && Object.prototype.hasOwnProperty.call(resolvedData, \"timeType\")) {\n                const existingTimeTypeId = item?.timeTypeId ?? item?.timeType?.id ?? null;\n                const incoming = resolvedData.timeType;\n                const connectId = incoming?.connect?.id ?? null;\n                const disconnectFlag = typeof incoming?.disconnect !== \"undefined\" ? incoming.disconnect : incoming === null ? true : false;\n                const disconnectAll = incoming?.disconnectAll;\n                const isChanging = disconnectFlag || disconnectAll || connectId !== null && connectId !== existingTimeTypeId || connectId === null && typeof incoming !== \"undefined\" && incoming !== null && !incoming?.connect;\n                if (isChanging) addValidationError(\"timeType cannot be changed after creation.\");\n            }\n        },\n        validateDelete: async ({ item, context, addValidationError })=>{\n            if (!item?.id) return;\n            const sudoContext = context.sudo();\n            const timePolicyId = String(item.id);\n            const timePolicy = await sudoContext.query.TimePolicy.findOne({\n                where: {\n                    id: timePolicyId\n                },\n                query: \"id org { id }\"\n            });\n            if (!timePolicy?.org?.id) {\n                addValidationError(\"Time policy is missing organization context.\");\n                return;\n            }\n            const orgTimePolicyCount = await sudoContext.db.TimePolicy.count({\n                where: {\n                    org: {\n                        id: {\n                            equals: timePolicy.org.id\n                        }\n                    }\n                }\n            });\n            if (orgTimePolicyCount <= 1) {\n                addValidationError(\"Each organization must have at least one time policy.\");\n            }\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QjtZQUNyQjtRQUNGO0lBQ0Y7QUFDRixFQUFFLEVBQStCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3NjaGVtYXMvVGltZVBvbGljeS50cz8wNTc1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHR5cGUgTGlzdHMgfSBmcm9tICcua2V5c3RvbmUvdHlwZXMnO1xuaW1wb3J0IHsgbGlzdCB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUnO1xuaW1wb3J0IHsgY2hlY2tib3gsIHJlbGF0aW9uc2hpcCwgdGV4dCB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUvZmllbGRzJztcbmltcG9ydCB7XG4gIGNhbkVkaXRPcmdEYXRhLFxuICBmaWx0ZXJCeVVzZXJPcmcsXG4gIGZpbHRlclBvbGljaWVzQnlVc2VyTG9jYXRpb24sXG4gIGlzQXV0aGVudGljYXRlZCxcbiAgaXNHb2QsXG4gIGlzTG9jYXRpb25BZG1pbixcbiAgaXNPcmdBZG1pblxufSBmcm9tICcuLi9kb21haW5zL2F1dGgvdXNlclJvbGUnO1xuXG5leHBvcnQgZGVmYXVsdCBsaXN0KHtcbiAgZmllbGRzOiB7XG4gICAgbmFtZTogdGV4dCh7IHZhbGlkYXRpb246IHsgaXNSZXF1aXJlZDogdHJ1ZSB9IH0pLFxuICAgIG9yZzogcmVsYXRpb25zaGlwKHsgcmVmOiAnT3JnYW5pemF0aW9uLnRpbWVQb2xpY2llcycsIG1hbnk6IGZhbHNlIH0pLFxuICAgIHRpbWVUeXBlOiByZWxhdGlvbnNoaXAoeyByZWY6ICdUaW1lVHlwZS50aW1lUG9saWNpZXMnLCBtYW55OiBmYWxzZSB9KSxcbiAgICBsb2NhdGlvbnM6IHJlbGF0aW9uc2hpcCh7IHJlZjogJ0xvY2F0aW9uLnRpbWVQb2xpY2llcycsIG1hbnk6IHRydWUgfSksXG4gICAgaXNBbGxvY2F0aW9uTWFuYWdlZDogY2hlY2tib3goeyBkZWZhdWx0VmFsdWU6IHRydWUgfSksXG4gICAgaXNBcHByb3ZhYmxlOiBjaGVja2JveCh7IGRlZmF1bHRWYWx1ZTogdHJ1ZSB9KSxcbiAgICB0aW1lUG9saWN5QWxsb2NhdGlvbnM6IHJlbGF0aW9uc2hpcCh7IHJlZjogJ1RpbWVQb2xpY3lBbGxvY2F0aW9uLnRpbWVQb2xpY3knLCBtYW55OiB0cnVlIH0pLFxuICAgIGFsbG9jYXRpb25zOiByZWxhdGlvbnNoaXAoeyByZWY6ICdVc2VyQWxsb2NhdGlvbi50aW1lUG9saWN5JywgbWFueTogdHJ1ZSB9KSxcbiAgICB0aW1lUGxhbnM6IHJlbGF0aW9uc2hpcCh7IHJlZjogJ1RpbWVQbGFuLnRpbWVQb2xpY3knLCBtYW55OiB0cnVlIH0pXG4gIH0sXG4gIHVpOiB7XG4gICAgbGFiZWxGaWVsZDogJ25hbWUnXG4gIH0sXG4gIGFjY2Vzczoge1xuICAgIG9wZXJhdGlvbjoge1xuICAgICAgcXVlcnk6ICh7IHNlc3Npb24gfSkgPT4gaXNBdXRoZW50aWNhdGVkKHsgc2Vzc2lvbiB9KSxcbiAgICAgIGNyZWF0ZTogY2FuRWRpdE9yZ0RhdGEsXG4gICAgICB1cGRhdGU6IGNhbkVkaXRPcmdEYXRhLFxuICAgICAgZGVsZXRlOiBjYW5FZGl0T3JnRGF0YVxuICAgIH0sXG4gICAgZmlsdGVyOiB7XG4gICAgICBxdWVyeTogYXN5bmMgKHsgc2Vzc2lvbiB9KSA9PiB7XG4gICAgICAgIGlmICghaXNBdXRoZW50aWNhdGVkKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoaXNHb2QoeyBzZXNzaW9uIH0pKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKGlzT3JnQWRtaW4oeyBzZXNzaW9uIH0pKSByZXR1cm4gZmlsdGVyQnlVc2VyT3JnKHsgc2Vzc2lvbiB9KTtcbiAgICAgICAgaWYgKGlzTG9jYXRpb25BZG1pbih7IHNlc3Npb24gfSkpIHJldHVybiBmaWx0ZXJCeVVzZXJPcmcoeyBzZXNzaW9uIH0pO1xuICAgICAgICByZXR1cm4gZmlsdGVyUG9saWNpZXNCeVVzZXJMb2NhdGlvbih7IHNlc3Npb24gfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBob29rczoge1xuICAgIHJlc29sdmVJbnB1dDoge1xuICAgICAgY3JlYXRlOiBhc3luYyAoeyByZXNvbHZlZERhdGEsIGNvbnRleHQgfSkgPT4ge1xuICAgICAgICBpZiAocmVzb2x2ZWREYXRhLm9yZykgcmV0dXJuIHJlc29sdmVkRGF0YTtcbiAgICAgICAgY29uc3Qgb3JnSWQgPSBjb250ZXh0LnNlc3Npb24/Lm9yZ0lkIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKCFvcmdJZCkgcmV0dXJuIHJlc29sdmVkRGF0YTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5yZXNvbHZlZERhdGEsXG4gICAgICAgICAgb3JnOiB7IGNvbm5lY3Q6IHsgaWQ6IG9yZ0lkIH0gfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgdmFsaWRhdGVJbnB1dDogYXN5bmMgKHsgb3BlcmF0aW9uLCByZXNvbHZlZERhdGEsIGl0ZW0sIGFkZFZhbGlkYXRpb25FcnJvciwgY29udGV4dCB9KSA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uID0gY29udGV4dD8uc2Vzc2lvbiA/PyBudWxsO1xuICAgICAgY29uc3QgdXNlcklzR29kID0gaXNHb2QoeyBzZXNzaW9uIH0pO1xuICAgICAgaWYgKFxuICAgICAgICBvcGVyYXRpb24gPT09ICd1cGRhdGUnICYmXG4gICAgICAgICF1c2VySXNHb2QgJiZcbiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc29sdmVkRGF0YSwgJ2lzQWxsb2NhdGlvbk1hbmFnZWQnKSAmJlxuICAgICAgICByZXNvbHZlZERhdGEuaXNBbGxvY2F0aW9uTWFuYWdlZCAhPT0gaXRlbT8uaXNBbGxvY2F0aW9uTWFuYWdlZFxuICAgICAgKSB7XG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcignaXNBbGxvY2F0aW9uTWFuYWdlZCBjYW5ub3QgYmUgY2hhbmdlZCBhZnRlciBjcmVhdGlvbi4nKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgb3BlcmF0aW9uID09PSAndXBkYXRlJyAmJlxuICAgICAgICAhdXNlcklzR29kICYmXG4gICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZXNvbHZlZERhdGEsICd0aW1lVHlwZScpXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUaW1lVHlwZUlkID1cbiAgICAgICAgICAoaXRlbSBhcyB7IHRpbWVUeXBlSWQ/OiBzdHJpbmcgfCBudWxsIH0pPy50aW1lVHlwZUlkID8/XG4gICAgICAgICAgKGl0ZW0gYXMgeyB0aW1lVHlwZT86IHsgaWQ/OiBzdHJpbmcgfCBudWxsIH0gfCBudWxsIH0pPy50aW1lVHlwZT8uaWQgPz9cbiAgICAgICAgICBudWxsO1xuICAgICAgICBjb25zdCBpbmNvbWluZyA9IHJlc29sdmVkRGF0YS50aW1lVHlwZTtcbiAgICAgICAgY29uc3QgY29ubmVjdElkID0gaW5jb21pbmc/LmNvbm5lY3Q/LmlkID8/IG51bGw7XG4gICAgICAgIGNvbnN0IGRpc2Nvbm5lY3RGbGFnID1cbiAgICAgICAgICB0eXBlb2YgaW5jb21pbmc/LmRpc2Nvbm5lY3QgIT09ICd1bmRlZmluZWQnID8gaW5jb21pbmcuZGlzY29ubmVjdCA6IGluY29taW5nID09PSBudWxsID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICBjb25zdCBkaXNjb25uZWN0QWxsID0gKGluY29taW5nIGFzIHsgZGlzY29ubmVjdEFsbD86IGJvb2xlYW4gfSk/LmRpc2Nvbm5lY3RBbGw7XG4gICAgICAgIGNvbnN0IGlzQ2hhbmdpbmcgPVxuICAgICAgICAgIGRpc2Nvbm5lY3RGbGFnIHx8XG4gICAgICAgICAgZGlzY29ubmVjdEFsbCB8fFxuICAgICAgICAgIChjb25uZWN0SWQgIT09IG51bGwgJiYgY29ubmVjdElkICE9PSBleGlzdGluZ1RpbWVUeXBlSWQpIHx8XG4gICAgICAgICAgKGNvbm5lY3RJZCA9PT0gbnVsbCAmJiB0eXBlb2YgaW5jb21pbmcgIT09ICd1bmRlZmluZWQnICYmIGluY29taW5nICE9PSBudWxsICYmICFpbmNvbWluZz8uY29ubmVjdCk7XG4gICAgICAgIGlmIChpc0NoYW5naW5nKSBhZGRWYWxpZGF0aW9uRXJyb3IoJ3RpbWVUeXBlIGNhbm5vdCBiZSBjaGFuZ2VkIGFmdGVyIGNyZWF0aW9uLicpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdmFsaWRhdGVEZWxldGU6IGFzeW5jICh7IGl0ZW0sIGNvbnRleHQsIGFkZFZhbGlkYXRpb25FcnJvciB9KSA9PiB7XG4gICAgICBpZiAoIWl0ZW0/LmlkKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IHN1ZG9Db250ZXh0ID0gY29udGV4dC5zdWRvKCk7XG4gICAgICBjb25zdCB0aW1lUG9saWN5SWQgPSBTdHJpbmcoaXRlbS5pZCk7XG5cbiAgICAgIGNvbnN0IHRpbWVQb2xpY3kgPSAoYXdhaXQgc3Vkb0NvbnRleHQucXVlcnkuVGltZVBvbGljeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHRpbWVQb2xpY3lJZCB9LFxuICAgICAgICBxdWVyeTogJ2lkIG9yZyB7IGlkIH0nXG4gICAgICB9KSkgYXMgeyBvcmc6IHsgaWQ6IHN0cmluZyB9IHwgbnVsbCB9IHwgbnVsbDtcblxuICAgICAgaWYgKCF0aW1lUG9saWN5Py5vcmc/LmlkKSB7XG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcignVGltZSBwb2xpY3kgaXMgbWlzc2luZyBvcmdhbml6YXRpb24gY29udGV4dC4nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcmdUaW1lUG9saWN5Q291bnQgPSBhd2FpdCBzdWRvQ29udGV4dC5kYi5UaW1lUG9saWN5LmNvdW50KHtcbiAgICAgICAgd2hlcmU6IHsgb3JnOiB7IGlkOiB7IGVxdWFsczogdGltZVBvbGljeS5vcmcuaWQgfSB9IH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAob3JnVGltZVBvbGljeUNvdW50IDw9IDEpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdFYWNoIG9yZ2FuaXphdGlvbiBtdXN0IGhhdmUgYXQgbGVhc3Qgb25lIHRpbWUgcG9saWN5LicpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSkgc2F0aXNmaWVzIExpc3RzWydUaW1lUG9saWN5J107XG5cblxuXG4iXSwibmFtZXMiOlsibGlzdCIsImNoZWNrYm94IiwicmVsYXRpb25zaGlwIiwidGV4dCIsImNhbkVkaXRPcmdEYXRhIiwiZmlsdGVyQnlVc2VyT3JnIiwiZmlsdGVyUG9saWNpZXNCeVVzZXJMb2NhdGlvbiIsImlzQXV0aGVudGljYXRlZCIsImlzR29kIiwiaXNMb2NhdGlvbkFkbWluIiwiaXNPcmdBZG1pbiIsImZpZWxkcyIsIm5hbWUiLCJ2YWxpZGF0aW9uIiwiaXNSZXF1aXJlZCIsIm9yZyIsInJlZiIsIm1hbnkiLCJ0aW1lVHlwZSIsImxvY2F0aW9ucyIsImlzQWxsb2NhdGlvbk1hbmFnZWQiLCJkZWZhdWx0VmFsdWUiLCJpc0FwcHJvdmFibGUiLCJ0aW1lUG9saWN5QWxsb2NhdGlvbnMiLCJhbGxvY2F0aW9ucyIsInRpbWVQbGFucyIsInVpIiwibGFiZWxGaWVsZCIsImFjY2VzcyIsIm9wZXJhdGlvbiIsInF1ZXJ5Iiwic2Vzc2lvbiIsImNyZWF0ZSIsInVwZGF0ZSIsImRlbGV0ZSIsImZpbHRlciIsImhvb2tzIiwicmVzb2x2ZUlucHV0IiwicmVzb2x2ZWREYXRhIiwiY29udGV4dCIsIm9yZ0lkIiwiY29ubmVjdCIsImlkIiwidmFsaWRhdGVJbnB1dCIsIml0ZW0iLCJhZGRWYWxpZGF0aW9uRXJyb3IiLCJ1c2VySXNHb2QiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJleGlzdGluZ1RpbWVUeXBlSWQiLCJ0aW1lVHlwZUlkIiwiaW5jb21pbmciLCJjb25uZWN0SWQiLCJkaXNjb25uZWN0RmxhZyIsImRpc2Nvbm5lY3QiLCJkaXNjb25uZWN0QWxsIiwiaXNDaGFuZ2luZyIsInZhbGlkYXRlRGVsZXRlIiwic3Vkb0NvbnRleHQiLCJzdWRvIiwidGltZVBvbGljeUlkIiwiU3RyaW5nIiwidGltZVBvbGljeSIsIlRpbWVQb2xpY3kiLCJmaW5kT25lIiwid2hlcmUiLCJvcmdUaW1lUG9saWN5Q291bnQiLCJkYiIsImNvdW50IiwiZXF1YWxzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/TimePolicy.ts\n");

/***/ }),

/***/ "(api)/../../schemas/TimePolicyAllocation.ts":
/*!*********************************************!*\
  !*** ../../schemas/TimePolicyAllocation.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\nconst policyFilterForSession = async ({ session })=>{\n    if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n        session\n    })) return false;\n    if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isGod)({\n        session\n    })) return true;\n    if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isOrgAdmin)({\n        session\n    }) || (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isLocationAdmin)({\n        session\n    })) {\n        const orgFilter = await (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterByUserOrg)({\n            session\n        });\n        if (!orgFilter) return false;\n        return {\n            timePolicy: orgFilter\n        };\n    }\n    const policyFilter = await (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterPoliciesByUserLocation)({\n        session\n    });\n    if (!policyFilter) return false;\n    return {\n        timePolicy: policyFilter\n    };\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        timePolicy: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicy.timePolicyAllocations\",\n            many: false,\n            ui: {\n                hideCreate: true\n            }\n        }),\n        effectiveAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: {\n                kind: \"now\"\n            },\n            isIndexed: true\n        }),\n        allocation: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.integer)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: 0\n        }),\n        carryoverLimit: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.integer)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: 0\n        }),\n        overdraftLimit: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.integer)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: 0\n        }),\n        notes: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)(),\n        createdAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: {\n                kind: \"now\"\n            },\n            ui: {\n                itemView: {\n                    fieldMode: \"read\"\n                },\n                listView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        events: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"UserAllocation.timePolicyAllocation\",\n            many: true\n        }),\n        createdBy: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User\",\n            many: false,\n            ui: {\n                hideCreate: true\n            }\n        })\n    },\n    ui: {\n        labelField: \"effectiveAt\",\n        listView: {\n            initialColumns: [\n                \"timePolicy\",\n                \"effectiveAt\",\n                \"allocation\",\n                \"carryoverLimit\",\n                \"overdraftLimit\"\n            ]\n        }\n    },\n    access: {\n        operation: {\n            query: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n                    session\n                }),\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData\n        },\n        filter: {\n            query: policyFilterForSession\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ context, resolvedData })=>{\n                const nextData = {\n                    ...resolvedData\n                };\n                if (!nextData.createdBy) {\n                    const userId = context.session?.id;\n                    if (userId) {\n                        nextData.createdBy = {\n                            connect: {\n                                id: userId\n                            }\n                        };\n                    }\n                }\n                return nextData;\n            }\n        },\n        validateInput: async ({ operation, resolvedData, addValidationError })=>{\n            if (operation !== \"create\") return;\n            if (!resolvedData.timePolicy?.connect?.id) {\n                addValidationError(\"Time policy must be provided when creating a TimePolicyAllocation.\");\n            }\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9UaW1lUG9saWN5QWxsb2NhdGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFDd0M7QUFDeUM7QUFVL0M7QUFJbEMsTUFBTVkseUJBQXlCLE9BQU8sRUFBRUMsT0FBTyxFQUFrQjtJQUMvRCxJQUFJLENBQUNMLHVFQUFlQSxDQUFDO1FBQUVLO0lBQVEsSUFBSSxPQUFPO0lBQzFDLElBQUlKLDZEQUFLQSxDQUFDO1FBQUVJO0lBQVEsSUFBSSxPQUFPO0lBQy9CLElBQUlGLGtFQUFVQSxDQUFDO1FBQUVFO0lBQVEsTUFBTUgsdUVBQWVBLENBQUM7UUFBRUc7SUFBUSxJQUFJO1FBQzNELE1BQU1DLFlBQVksTUFBTVIsdUVBQWVBLENBQUM7WUFBRU87UUFBUTtRQUNsRCxJQUFJLENBQUNDLFdBQVcsT0FBTztRQUN2QixPQUFPO1lBQUVDLFlBQVlEO1FBQVU7SUFDakM7SUFDQSxNQUFNRSxlQUFlLE1BQU1ULG9GQUE0QkEsQ0FBQztRQUFFTTtJQUFRO0lBQ2xFLElBQUksQ0FBQ0csY0FBYyxPQUFPO0lBQzFCLE9BQU87UUFBRUQsWUFBWUM7SUFBYTtBQUNwQztBQUVBLGlFQUFlaEIsc0RBQUlBLENBQUM7SUFDbEJpQixRQUFRO1FBQ05GLFlBQVliLHFFQUFZQSxDQUFDO1lBQ3ZCZ0IsS0FBSztZQUNMQyxNQUFNO1lBQ05DLElBQUk7Z0JBQUVDLFlBQVk7WUFBSztRQUN6QjtRQUNBQyxhQUFhbEIsa0VBQVNBLENBQUM7WUFDckJtQixZQUFZO2dCQUFFQyxZQUFZO1lBQUs7WUFDL0JDLGNBQWM7Z0JBQUVDLE1BQU07WUFBTTtZQUM1QkMsV0FBVztRQUNiO1FBQ0FDLFlBQVkzQixnRUFBT0EsQ0FBQztZQUFFc0IsWUFBWTtnQkFBRUMsWUFBWTtZQUFLO1lBQUdDLGNBQWM7UUFBRTtRQUN4RUksZ0JBQWdCNUIsZ0VBQU9BLENBQUM7WUFBRXNCLFlBQVk7Z0JBQUVDLFlBQVk7WUFBSztZQUFHQyxjQUFjO1FBQUU7UUFDNUVLLGdCQUFnQjdCLGdFQUFPQSxDQUFDO1lBQUVzQixZQUFZO2dCQUFFQyxZQUFZO1lBQUs7WUFBR0MsY0FBYztRQUFFO1FBQzVFTSxPQUFPNUIsNkRBQUlBO1FBQ1g2QixXQUFXNUIsa0VBQVNBLENBQUM7WUFDbkJtQixZQUFZO2dCQUFFQyxZQUFZO1lBQUs7WUFDL0JDLGNBQWM7Z0JBQUVDLE1BQU07WUFBTTtZQUM1Qk4sSUFBSTtnQkFBRWEsVUFBVTtvQkFBRUMsV0FBVztnQkFBTztnQkFBR0MsVUFBVTtvQkFBRUQsV0FBVztnQkFBTztZQUFFO1FBQ3pFO1FBQ0FFLFFBQVFsQyxxRUFBWUEsQ0FBQztZQUFFZ0IsS0FBSztZQUF1Q0MsTUFBTTtRQUFLO1FBQzlFa0IsV0FBV25DLHFFQUFZQSxDQUFDO1lBQ3RCZ0IsS0FBSztZQUNMQyxNQUFNO1lBQ05DLElBQUk7Z0JBQUVDLFlBQVk7WUFBSztRQUN6QjtJQUNGO0lBQ0FELElBQUk7UUFDRmtCLFlBQVk7UUFDWkgsVUFBVTtZQUNSSSxnQkFBZ0I7Z0JBQUM7Z0JBQWM7Z0JBQWU7Z0JBQWM7Z0JBQWtCO2FBQWlCO1FBQ2pHO0lBQ0Y7SUFDQUMsUUFBUTtRQUNOQyxXQUFXO1lBQ1RDLE9BQU8sQ0FBQyxFQUFFN0IsT0FBTyxFQUFFLEdBQUtMLHVFQUFlQSxDQUFDO29CQUFFSztnQkFBUTtZQUNsRDhCLFFBQVF0QyxrRUFBY0E7WUFDdEJ1QyxRQUFRdkMsa0VBQWNBO1lBQ3RCd0MsUUFBUXhDLGtFQUFjQTtRQUN4QjtRQUNBeUMsUUFBUTtZQUNOSixPQUFPOUI7UUFDVDtJQUNGO0lBQ0FtQyxPQUFPO1FBQ0xDLGNBQWM7WUFDWkwsUUFBUSxPQUFPLEVBQUVNLE9BQU8sRUFBRUMsWUFBWSxFQUFFO2dCQUN0QyxNQUFNQyxXQUFXO29CQUFFLEdBQUdELFlBQVk7Z0JBQUM7Z0JBQ25DLElBQUksQ0FBQ0MsU0FBU2QsU0FBUyxFQUFFO29CQUN2QixNQUFNZSxTQUFTSCxRQUFRcEMsT0FBTyxFQUFFd0M7b0JBQ2hDLElBQUlELFFBQVE7d0JBQ1ZELFNBQVNkLFNBQVMsR0FBRzs0QkFBRWlCLFNBQVM7Z0NBQUVELElBQUlEOzRCQUFPO3dCQUFFO29CQUNqRDtnQkFDRjtnQkFDQSxPQUFPRDtZQUNUO1FBQ0Y7UUFDQUksZUFBZSxPQUFPLEVBQUVkLFNBQVMsRUFBRVMsWUFBWSxFQUFFTSxrQkFBa0IsRUFBRTtZQUNuRSxJQUFJZixjQUFjLFVBQVU7WUFDNUIsSUFBSSxDQUFDUyxhQUFhbkMsVUFBVSxFQUFFdUMsU0FBU0QsSUFBSTtnQkFDekNHLG1CQUFtQjtZQUNyQjtRQUNGO0lBQ0Y7QUFDRixFQUFFLEVBQXlDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3NjaGVtYXMvVGltZVBvbGljeUFsbG9jYXRpb24udHM/Yzc3MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0eXBlIExpc3RzIH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcbmltcG9ydCB7IGxpc3QgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlJztcbmltcG9ydCB7IGludGVnZXIsIHJlbGF0aW9uc2hpcCwgdGV4dCwgdGltZXN0YW1wIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS9maWVsZHMnO1xuaW1wb3J0IHR5cGUgeyBTZXNzaW9uIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQge1xuICBjYW5FZGl0T3JnRGF0YSxcbiAgZmlsdGVyQnlVc2VyT3JnLFxuICBmaWx0ZXJQb2xpY2llc0J5VXNlckxvY2F0aW9uLFxuICBpc0F1dGhlbnRpY2F0ZWQsXG4gIGlzR29kLFxuICBpc0xvY2F0aW9uQWRtaW4sXG4gIGlzT3JnQWRtaW5cbn0gZnJvbSAnLi4vZG9tYWlucy9hdXRoL3VzZXJSb2xlJztcblxudHlwZSBTZXNzaW9uQ29udGV4dCA9IHsgc2Vzc2lvbj86IFNlc3Npb24gfCBudWxsIH07XG5cbmNvbnN0IHBvbGljeUZpbHRlckZvclNlc3Npb24gPSBhc3luYyAoeyBzZXNzaW9uIH06IFNlc3Npb25Db250ZXh0KSA9PiB7XG4gIGlmICghaXNBdXRoZW50aWNhdGVkKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIGZhbHNlO1xuICBpZiAoaXNHb2QoeyBzZXNzaW9uIH0pKSByZXR1cm4gdHJ1ZTtcbiAgaWYgKGlzT3JnQWRtaW4oeyBzZXNzaW9uIH0pIHx8IGlzTG9jYXRpb25BZG1pbih7IHNlc3Npb24gfSkpIHtcbiAgICBjb25zdCBvcmdGaWx0ZXIgPSBhd2FpdCBmaWx0ZXJCeVVzZXJPcmcoeyBzZXNzaW9uIH0pO1xuICAgIGlmICghb3JnRmlsdGVyKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHsgdGltZVBvbGljeTogb3JnRmlsdGVyIH07XG4gIH1cbiAgY29uc3QgcG9saWN5RmlsdGVyID0gYXdhaXQgZmlsdGVyUG9saWNpZXNCeVVzZXJMb2NhdGlvbih7IHNlc3Npb24gfSk7XG4gIGlmICghcG9saWN5RmlsdGVyKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiB7IHRpbWVQb2xpY3k6IHBvbGljeUZpbHRlciB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgbGlzdCh7XG4gIGZpZWxkczoge1xuICAgIHRpbWVQb2xpY3k6IHJlbGF0aW9uc2hpcCh7XG4gICAgICByZWY6ICdUaW1lUG9saWN5LnRpbWVQb2xpY3lBbGxvY2F0aW9ucycsXG4gICAgICBtYW55OiBmYWxzZSxcbiAgICAgIHVpOiB7IGhpZGVDcmVhdGU6IHRydWUgfVxuICAgIH0pLFxuICAgIGVmZmVjdGl2ZUF0OiB0aW1lc3RhbXAoe1xuICAgICAgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0sXG4gICAgICBkZWZhdWx0VmFsdWU6IHsga2luZDogJ25vdycgfSxcbiAgICAgIGlzSW5kZXhlZDogdHJ1ZVxuICAgIH0pLFxuICAgIGFsbG9jYXRpb246IGludGVnZXIoeyB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfSwgZGVmYXVsdFZhbHVlOiAwIH0pLFxuICAgIGNhcnJ5b3ZlckxpbWl0OiBpbnRlZ2VyKHsgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0sIGRlZmF1bHRWYWx1ZTogMCB9KSxcbiAgICBvdmVyZHJhZnRMaW1pdDogaW50ZWdlcih7IHZhbGlkYXRpb246IHsgaXNSZXF1aXJlZDogdHJ1ZSB9LCBkZWZhdWx0VmFsdWU6IDAgfSksXG4gICAgbm90ZXM6IHRleHQoKSxcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCh7XG4gICAgICB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogeyBraW5kOiAnbm93JyB9LFxuICAgICAgdWk6IHsgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfSwgbGlzdFZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfSB9XG4gICAgfSksXG4gICAgZXZlbnRzOiByZWxhdGlvbnNoaXAoeyByZWY6ICdVc2VyQWxsb2NhdGlvbi50aW1lUG9saWN5QWxsb2NhdGlvbicsIG1hbnk6IHRydWUgfSksXG4gICAgY3JlYXRlZEJ5OiByZWxhdGlvbnNoaXAoe1xuICAgICAgcmVmOiAnVXNlcicsXG4gICAgICBtYW55OiBmYWxzZSxcbiAgICAgIHVpOiB7IGhpZGVDcmVhdGU6IHRydWUgfVxuICAgIH0pXG4gIH0sXG4gIHVpOiB7XG4gICAgbGFiZWxGaWVsZDogJ2VmZmVjdGl2ZUF0JyxcbiAgICBsaXN0Vmlldzoge1xuICAgICAgaW5pdGlhbENvbHVtbnM6IFsndGltZVBvbGljeScsICdlZmZlY3RpdmVBdCcsICdhbGxvY2F0aW9uJywgJ2NhcnJ5b3ZlckxpbWl0JywgJ292ZXJkcmFmdExpbWl0J11cbiAgICB9XG4gIH0sXG4gIGFjY2Vzczoge1xuICAgIG9wZXJhdGlvbjoge1xuICAgICAgcXVlcnk6ICh7IHNlc3Npb24gfSkgPT4gaXNBdXRoZW50aWNhdGVkKHsgc2Vzc2lvbiB9KSxcbiAgICAgIGNyZWF0ZTogY2FuRWRpdE9yZ0RhdGEsXG4gICAgICB1cGRhdGU6IGNhbkVkaXRPcmdEYXRhLFxuICAgICAgZGVsZXRlOiBjYW5FZGl0T3JnRGF0YVxuICAgIH0sXG4gICAgZmlsdGVyOiB7XG4gICAgICBxdWVyeTogcG9saWN5RmlsdGVyRm9yU2Vzc2lvblxuICAgIH1cbiAgfSxcbiAgaG9va3M6IHtcbiAgICByZXNvbHZlSW5wdXQ6IHtcbiAgICAgIGNyZWF0ZTogYXN5bmMgKHsgY29udGV4dCwgcmVzb2x2ZWREYXRhIH0pID0+IHtcbiAgICAgICAgY29uc3QgbmV4dERhdGEgPSB7IC4uLnJlc29sdmVkRGF0YSB9O1xuICAgICAgICBpZiAoIW5leHREYXRhLmNyZWF0ZWRCeSkge1xuICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IGNvbnRleHQuc2Vzc2lvbj8uaWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICAgIGlmICh1c2VySWQpIHtcbiAgICAgICAgICAgIG5leHREYXRhLmNyZWF0ZWRCeSA9IHsgY29ubmVjdDogeyBpZDogdXNlcklkIH0gfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5leHREYXRhO1xuICAgICAgfVxuICAgIH0sXG4gICAgdmFsaWRhdGVJbnB1dDogYXN5bmMgKHsgb3BlcmF0aW9uLCByZXNvbHZlZERhdGEsIGFkZFZhbGlkYXRpb25FcnJvciB9KSA9PiB7XG4gICAgICBpZiAob3BlcmF0aW9uICE9PSAnY3JlYXRlJykgcmV0dXJuO1xuICAgICAgaWYgKCFyZXNvbHZlZERhdGEudGltZVBvbGljeT8uY29ubmVjdD8uaWQpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdUaW1lIHBvbGljeSBtdXN0IGJlIHByb3ZpZGVkIHdoZW4gY3JlYXRpbmcgYSBUaW1lUG9saWN5QWxsb2NhdGlvbi4nKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pIHNhdGlzZmllcyBMaXN0c1snVGltZVBvbGljeUFsbG9jYXRpb24nXTtcblxuXG5cbiJdLCJuYW1lcyI6WyJsaXN0IiwiaW50ZWdlciIsInJlbGF0aW9uc2hpcCIsInRleHQiLCJ0aW1lc3RhbXAiLCJjYW5FZGl0T3JnRGF0YSIsImZpbHRlckJ5VXNlck9yZyIsImZpbHRlclBvbGljaWVzQnlVc2VyTG9jYXRpb24iLCJpc0F1dGhlbnRpY2F0ZWQiLCJpc0dvZCIsImlzTG9jYXRpb25BZG1pbiIsImlzT3JnQWRtaW4iLCJwb2xpY3lGaWx0ZXJGb3JTZXNzaW9uIiwic2Vzc2lvbiIsIm9yZ0ZpbHRlciIsInRpbWVQb2xpY3kiLCJwb2xpY3lGaWx0ZXIiLCJmaWVsZHMiLCJyZWYiLCJtYW55IiwidWkiLCJoaWRlQ3JlYXRlIiwiZWZmZWN0aXZlQXQiLCJ2YWxpZGF0aW9uIiwiaXNSZXF1aXJlZCIsImRlZmF1bHRWYWx1ZSIsImtpbmQiLCJpc0luZGV4ZWQiLCJhbGxvY2F0aW9uIiwiY2FycnlvdmVyTGltaXQiLCJvdmVyZHJhZnRMaW1pdCIsIm5vdGVzIiwiY3JlYXRlZEF0IiwiaXRlbVZpZXciLCJmaWVsZE1vZGUiLCJsaXN0VmlldyIsImV2ZW50cyIsImNyZWF0ZWRCeSIsImxhYmVsRmllbGQiLCJpbml0aWFsQ29sdW1ucyIsImFjY2VzcyIsIm9wZXJhdGlvbiIsInF1ZXJ5IiwiY3JlYXRlIiwidXBkYXRlIiwiZGVsZXRlIiwiZmlsdGVyIiwiaG9va3MiLCJyZXNvbHZlSW5wdXQiLCJjb250ZXh0IiwicmVzb2x2ZWREYXRhIiwibmV4dERhdGEiLCJ1c2VySWQiLCJpZCIsImNvbm5lY3QiLCJ2YWxpZGF0ZUlucHV0IiwiYWRkVmFsaWRhdGlvbkVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/TimePolicyAllocation.ts\n");

/***/ }),

/***/ "(api)/../../schemas/TimeType.ts":
/*!*********************************!*\
  !*** ../../schemas/TimeType.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\nconst typeColorOptions = [\n    {\n        label: \"Blue\",\n        value: \"BLUE\"\n    },\n    {\n        label: \"Green\",\n        value: \"GREEN\"\n    },\n    {\n        label: \"Red\",\n        value: \"RED\"\n    },\n    {\n        label: \"Orange\",\n        value: \"ORANGE\"\n    },\n    {\n        label: \"Purple\",\n        value: \"PURPLE\"\n    },\n    {\n        label: \"Teal\",\n        value: \"TEAL\"\n    },\n    {\n        label: \"Yellow\",\n        value: \"YELLOW\"\n    },\n    {\n        label: \"Pink\",\n        value: \"PINK\"\n    },\n    {\n        label: \"Gray\",\n        value: \"GRAY\"\n    }\n];\nconst typeIconOptions = [\n    {\n        label: \"Calendar\",\n        value: \"CALENDAR\"\n    },\n    {\n        label: \"Plane\",\n        value: \"PLANE\"\n    },\n    {\n        label: \"Medical Cross\",\n        value: \"MEDICAL_CROSS\"\n    },\n    {\n        label: \"Home\",\n        value: \"HOME\"\n    },\n    {\n        label: \"Beach\",\n        value: \"BEACH\"\n    },\n    {\n        label: \"Baby\",\n        value: \"BABY\"\n    },\n    {\n        label: \"Briefcase\",\n        value: \"BRIEFCASE\"\n    },\n    {\n        label: \"Star\",\n        value: \"STAR\"\n    },\n    {\n        label: \"Dot\",\n        value: \"DOT\"\n    }\n];\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        name: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)({\n            validation: {\n                isRequired: true\n            }\n        }),\n        isAway: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.checkbox)({\n            defaultValue: true\n        }),\n        color: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: typeColorOptions,\n            validation: {\n                isRequired: true\n            },\n            defaultValue: typeColorOptions[0].value\n        }),\n        icon: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: typeIconOptions,\n            validation: {\n                isRequired: true\n            },\n            defaultValue: typeIconOptions[0].value\n        }),\n        org: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"Organization.timeTypes\",\n            many: false\n        }),\n        timePolicies: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicy.timeType\",\n            many: true\n        }),\n        timePlans: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePlan.timeType\",\n            many: true\n        })\n    },\n    ui: {\n        labelField: \"name\"\n    },\n    access: {\n        operation: {\n            query: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n                    session\n                }),\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData\n        },\n        filter: {\n            query: async ({ session })=>{\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n                    session\n                })) return false;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isGod)({\n                    session\n                })) return true;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isOrgAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterByUserOrg)({\n                    session\n                });\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isLocationAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterByUserOrg)({\n                    session\n                });\n                return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterTimeTypesByUserLocation)({\n                    session\n                });\n            }\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ resolvedData, context })=>{\n                if (resolvedData.org) return resolvedData;\n                const orgId = context.session?.orgId;\n                if (!orgId) return resolvedData;\n                return {\n                    ...resolvedData,\n                    org: {\n                        connect: {\n                            id: orgId\n                        }\n                    }\n                };\n            }\n        },\n        validateDelete: async ({ item, context, addValidationError })=>{\n            if (!item?.id) return;\n            const sudoContext = context.sudo();\n            const timeTypeId = String(item.id);\n            const timeType = await sudoContext.query.TimeType.findOne({\n                where: {\n                    id: timeTypeId\n                },\n                query: \"id org { id }\"\n            });\n            if (!timeType?.org?.id) {\n                addValidationError(\"Time type is missing organization context.\");\n                return;\n            }\n            const orgTimeTypeCount = await sudoContext.db.TimeType.count({\n                where: {\n                    org: {\n                        id: {\n                            equals: timeType.org.id\n                        }\n                    }\n                }\n            });\n            if (orgTimeTypeCount <= 1) {\n                addValidationError(\"Each organization must have at least one time type.\");\n            }\n        },\n        beforeOperation: {\n            delete: async ({ item, context })=>{\n                if (!item?.id) return;\n                const sudoContext = context.sudo();\n                const timeTypeId = String(item.id);\n                // Delete all time policies associated with this time type\n                const policies = await sudoContext.db.TimePolicy.findMany({\n                    where: {\n                        timeType: {\n                            id: {\n                                equals: timeTypeId\n                            }\n                        }\n                    }\n                });\n                for (const policy of policies){\n                    await sudoContext.db.TimePolicy.deleteOne({\n                        where: {\n                            id: policy.id\n                        }\n                    });\n                }\n            }\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QzlCLElBQUksQ0FBQ0ssTUFBTUYsSUFBSTtnQkFFZixNQUFNSSxjQUFjUCxRQUFRUSxJQUFJO2dCQUNoQyxNQUFNQyxhQUFhQyxPQUFPTCxLQUFLRixFQUFFO2dCQUVqQywwREFBMEQ7Z0JBQzFELE1BQU1pQixXQUFXLE1BQU1iLFlBQVlTLEVBQUUsQ0FBQ0ssVUFBVSxDQUFDQyxRQUFRLENBQUM7b0JBQ3hEUixPQUFPO3dCQUFFSCxVQUFVOzRCQUFFUixJQUFJO2dDQUFFZSxRQUFRVDs0QkFBVzt3QkFBRTtvQkFBRTtnQkFDcEQ7Z0JBRUEsS0FBSyxNQUFNYyxVQUFVSCxTQUFVO29CQUM3QixNQUFNYixZQUFZUyxFQUFFLENBQUNLLFVBQVUsQ0FBQ0csU0FBUyxDQUFDO3dCQUFFVixPQUFPOzRCQUFFWCxJQUFJb0IsT0FBT3BCLEVBQUU7d0JBQUM7b0JBQUU7Z0JBQ3ZFO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YsRUFBRSxFQUE2QiIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL1RpbWVUeXBlLnRzPzEyNjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBMaXN0cyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBsaXN0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgeyBjaGVja2JveCwgcmVsYXRpb25zaGlwLCBzZWxlY3QsIHRleHQgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2ZpZWxkcyc7XG5pbXBvcnQge1xuICBjYW5FZGl0T3JnRGF0YSxcbiAgZmlsdGVyVGltZVR5cGVzQnlVc2VyTG9jYXRpb24sXG4gIGZpbHRlckJ5VXNlck9yZyxcbiAgaXNBdXRoZW50aWNhdGVkLFxuICBpc0dvZCxcbiAgaXNMb2NhdGlvbkFkbWluLFxuICBpc09yZ0FkbWluXG59IGZyb20gJy4uL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5cbmNvbnN0IHR5cGVDb2xvck9wdGlvbnMgPSBbXG4gIHsgbGFiZWw6ICdCbHVlJywgdmFsdWU6ICdCTFVFJyB9LFxuICB7IGxhYmVsOiAnR3JlZW4nLCB2YWx1ZTogJ0dSRUVOJyB9LFxuICB7IGxhYmVsOiAnUmVkJywgdmFsdWU6ICdSRUQnIH0sXG4gIHsgbGFiZWw6ICdPcmFuZ2UnLCB2YWx1ZTogJ09SQU5HRScgfSxcbiAgeyBsYWJlbDogJ1B1cnBsZScsIHZhbHVlOiAnUFVSUExFJyB9LFxuICB7IGxhYmVsOiAnVGVhbCcsIHZhbHVlOiAnVEVBTCcgfSxcbiAgeyBsYWJlbDogJ1llbGxvdycsIHZhbHVlOiAnWUVMTE9XJyB9LFxuICB7IGxhYmVsOiAnUGluaycsIHZhbHVlOiAnUElOSycgfSxcbiAgeyBsYWJlbDogJ0dyYXknLCB2YWx1ZTogJ0dSQVknIH1cbl0gYXMgY29uc3Q7XG5cbmNvbnN0IHR5cGVJY29uT3B0aW9ucyA9IFtcbiAgeyBsYWJlbDogJ0NhbGVuZGFyJywgdmFsdWU6ICdDQUxFTkRBUicgfSxcbiAgeyBsYWJlbDogJ1BsYW5lJywgdmFsdWU6ICdQTEFORScgfSxcbiAgeyBsYWJlbDogJ01lZGljYWwgQ3Jvc3MnLCB2YWx1ZTogJ01FRElDQUxfQ1JPU1MnIH0sXG4gIHsgbGFiZWw6ICdIb21lJywgdmFsdWU6ICdIT01FJyB9LFxuICB7IGxhYmVsOiAnQmVhY2gnLCB2YWx1ZTogJ0JFQUNIJyB9LFxuICB7IGxhYmVsOiAnQmFieScsIHZhbHVlOiAnQkFCWScgfSxcbiAgeyBsYWJlbDogJ0JyaWVmY2FzZScsIHZhbHVlOiAnQlJJRUZDQVNFJyB9LFxuICB7IGxhYmVsOiAnU3RhcicsIHZhbHVlOiAnU1RBUicgfSxcbiAgeyBsYWJlbDogJ0RvdCcsIHZhbHVlOiAnRE9UJyB9XG5dIGFzIGNvbnN0O1xuXG5leHBvcnQgZGVmYXVsdCBsaXN0KHtcbiAgZmllbGRzOiB7XG4gICAgbmFtZTogdGV4dCh7IHZhbGlkYXRpb246IHsgaXNSZXF1aXJlZDogdHJ1ZSB9IH0pLFxuICAgIGlzQXdheTogY2hlY2tib3goeyBkZWZhdWx0VmFsdWU6IHRydWUgfSksXG4gICAgY29sb3I6IHNlbGVjdCh7XG4gICAgICB0eXBlOiAnZW51bScsXG4gICAgICBvcHRpb25zOiB0eXBlQ29sb3JPcHRpb25zLFxuICAgICAgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0sXG4gICAgICBkZWZhdWx0VmFsdWU6IHR5cGVDb2xvck9wdGlvbnNbMF0udmFsdWVcbiAgICB9KSxcbiAgICBpY29uOiBzZWxlY3Qoe1xuICAgICAgdHlwZTogJ2VudW0nLFxuICAgICAgb3B0aW9uczogdHlwZUljb25PcHRpb25zLFxuICAgICAgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0sXG4gICAgICBkZWZhdWx0VmFsdWU6IHR5cGVJY29uT3B0aW9uc1swXS52YWx1ZVxuICAgIH0pLFxuICAgIG9yZzogcmVsYXRpb25zaGlwKHsgcmVmOiAnT3JnYW5pemF0aW9uLnRpbWVUeXBlcycsIG1hbnk6IGZhbHNlIH0pLFxuICAgIHRpbWVQb2xpY2llczogcmVsYXRpb25zaGlwKHsgcmVmOiAnVGltZVBvbGljeS50aW1lVHlwZScsIG1hbnk6IHRydWUgfSksXG4gICAgdGltZVBsYW5zOiByZWxhdGlvbnNoaXAoeyByZWY6ICdUaW1lUGxhbi50aW1lVHlwZScsIG1hbnk6IHRydWUgfSlcbiAgfSxcbiAgdWk6IHtcbiAgICBsYWJlbEZpZWxkOiAnbmFtZSdcbiAgfSxcbiAgYWNjZXNzOiB7XG4gICAgb3BlcmF0aW9uOiB7XG4gICAgICBxdWVyeTogKHsgc2Vzc2lvbiB9KSA9PiBpc0F1dGhlbnRpY2F0ZWQoeyBzZXNzaW9uIH0pLFxuICAgICAgY3JlYXRlOiBjYW5FZGl0T3JnRGF0YSxcbiAgICAgIHVwZGF0ZTogY2FuRWRpdE9yZ0RhdGEsXG4gICAgICBkZWxldGU6IGNhbkVkaXRPcmdEYXRhXG4gICAgfSxcbiAgICBmaWx0ZXI6IHtcbiAgICAgIHF1ZXJ5OiBhc3luYyAoeyBzZXNzaW9uIH0pID0+IHtcbiAgICAgICAgaWYgKCFpc0F1dGhlbnRpY2F0ZWQoeyBzZXNzaW9uIH0pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB0cnVlO1xuICAgICAgICBpZiAoaXNPcmdBZG1pbih7IHNlc3Npb24gfSkpIHJldHVybiBmaWx0ZXJCeVVzZXJPcmcoeyBzZXNzaW9uIH0pO1xuICAgICAgICBpZiAoaXNMb2NhdGlvbkFkbWluKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIGZpbHRlckJ5VXNlck9yZyh7IHNlc3Npb24gfSk7XG4gICAgICAgIHJldHVybiBmaWx0ZXJUaW1lVHlwZXNCeVVzZXJMb2NhdGlvbih7IHNlc3Npb24gfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBob29rczoge1xuICAgIHJlc29sdmVJbnB1dDoge1xuICAgICAgY3JlYXRlOiBhc3luYyAoeyByZXNvbHZlZERhdGEsIGNvbnRleHQgfSkgPT4ge1xuICAgICAgICBpZiAocmVzb2x2ZWREYXRhLm9yZykgcmV0dXJuIHJlc29sdmVkRGF0YTtcbiAgICAgICAgY29uc3Qgb3JnSWQgPSBjb250ZXh0LnNlc3Npb24/Lm9yZ0lkIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKCFvcmdJZCkgcmV0dXJuIHJlc29sdmVkRGF0YTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5yZXNvbHZlZERhdGEsXG4gICAgICAgICAgb3JnOiB7IGNvbm5lY3Q6IHsgaWQ6IG9yZ0lkIH0gfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG4gICAgdmFsaWRhdGVEZWxldGU6IGFzeW5jICh7IGl0ZW0sIGNvbnRleHQsIGFkZFZhbGlkYXRpb25FcnJvciB9KSA9PiB7XG4gICAgICBpZiAoIWl0ZW0/LmlkKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IHN1ZG9Db250ZXh0ID0gY29udGV4dC5zdWRvKCk7XG4gICAgICBjb25zdCB0aW1lVHlwZUlkID0gU3RyaW5nKGl0ZW0uaWQpO1xuXG4gICAgICBjb25zdCB0aW1lVHlwZSA9IChhd2FpdCBzdWRvQ29udGV4dC5xdWVyeS5UaW1lVHlwZS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHRpbWVUeXBlSWQgfSxcbiAgICAgICAgcXVlcnk6ICdpZCBvcmcgeyBpZCB9J1xuICAgICAgfSkpIGFzIHsgb3JnOiB7IGlkOiBzdHJpbmcgfSB8IG51bGwgfSB8IG51bGw7XG5cbiAgICAgIGlmICghdGltZVR5cGU/Lm9yZz8uaWQpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdUaW1lIHR5cGUgaXMgbWlzc2luZyBvcmdhbml6YXRpb24gY29udGV4dC4nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcmdUaW1lVHlwZUNvdW50ID0gYXdhaXQgc3Vkb0NvbnRleHQuZGIuVGltZVR5cGUuY291bnQoe1xuICAgICAgICB3aGVyZTogeyBvcmc6IHsgaWQ6IHsgZXF1YWxzOiB0aW1lVHlwZS5vcmcuaWQgfSB9IH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAob3JnVGltZVR5cGVDb3VudCA8PSAxKSB7XG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcignRWFjaCBvcmdhbml6YXRpb24gbXVzdCBoYXZlIGF0IGxlYXN0IG9uZSB0aW1lIHR5cGUuJyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBiZWZvcmVPcGVyYXRpb246IHtcbiAgICAgIGRlbGV0ZTogYXN5bmMgKHsgaXRlbSwgY29udGV4dCB9KSA9PiB7XG4gICAgICAgIGlmICghaXRlbT8uaWQpIHJldHVybjtcblxuICAgICAgICBjb25zdCBzdWRvQ29udGV4dCA9IGNvbnRleHQuc3VkbygpO1xuICAgICAgICBjb25zdCB0aW1lVHlwZUlkID0gU3RyaW5nKGl0ZW0uaWQpO1xuXG4gICAgICAgIC8vIERlbGV0ZSBhbGwgdGltZSBwb2xpY2llcyBhc3NvY2lhdGVkIHdpdGggdGhpcyB0aW1lIHR5cGVcbiAgICAgICAgY29uc3QgcG9saWNpZXMgPSBhd2FpdCBzdWRvQ29udGV4dC5kYi5UaW1lUG9saWN5LmZpbmRNYW55KHtcbiAgICAgICAgICB3aGVyZTogeyB0aW1lVHlwZTogeyBpZDogeyBlcXVhbHM6IHRpbWVUeXBlSWQgfSB9IH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yIChjb25zdCBwb2xpY3kgb2YgcG9saWNpZXMpIHtcbiAgICAgICAgICBhd2FpdCBzdWRvQ29udGV4dC5kYi5UaW1lUG9saWN5LmRlbGV0ZU9uZSh7IHdoZXJlOiB7IGlkOiBwb2xpY3kuaWQgfSB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSkgc2F0aXNmaWVzIExpc3RzWydUaW1lVHlwZSddO1xuXG5cblxuIl0sIm5hbWVzIjpbImxpc3QiLCJjaGVja2JveCIsInJlbGF0aW9uc2hpcCIsInNlbGVjdCIsInRleHQiLCJjYW5FZGl0T3JnRGF0YSIsImZpbHRlclRpbWVUeXBlc0J5VXNlckxvY2F0aW9uIiwiZmlsdGVyQnlVc2VyT3JnIiwiaXNBdXRoZW50aWNhdGVkIiwiaXNHb2QiLCJpc0xvY2F0aW9uQWRtaW4iLCJpc09yZ0FkbWluIiwidHlwZUNvbG9yT3B0aW9ucyIsImxhYmVsIiwidmFsdWUiLCJ0eXBlSWNvbk9wdGlvbnMiLCJmaWVsZHMiLCJuYW1lIiwidmFsaWRhdGlvbiIsImlzUmVxdWlyZWQiLCJpc0F3YXkiLCJkZWZhdWx0VmFsdWUiLCJjb2xvciIsInR5cGUiLCJvcHRpb25zIiwiaWNvbiIsIm9yZyIsInJlZiIsIm1hbnkiLCJ0aW1lUG9saWNpZXMiLCJ0aW1lUGxhbnMiLCJ1aSIsImxhYmVsRmllbGQiLCJhY2Nlc3MiLCJvcGVyYXRpb24iLCJxdWVyeSIsInNlc3Npb24iLCJjcmVhdGUiLCJ1cGRhdGUiLCJkZWxldGUiLCJmaWx0ZXIiLCJob29rcyIsInJlc29sdmVJbnB1dCIsInJlc29sdmVkRGF0YSIsImNvbnRleHQiLCJvcmdJZCIsImNvbm5lY3QiLCJpZCIsInZhbGlkYXRlRGVsZXRlIiwiaXRlbSIsImFkZFZhbGlkYXRpb25FcnJvciIsInN1ZG9Db250ZXh0Iiwic3VkbyIsInRpbWVUeXBlSWQiLCJTdHJpbmciLCJ0aW1lVHlwZSIsIlRpbWVUeXBlIiwiZmluZE9uZSIsIndoZXJlIiwib3JnVGltZVR5cGVDb3VudCIsImRiIiwiY291bnQiLCJlcXVhbHMiLCJiZWZvcmVPcGVyYXRpb24iLCJwb2xpY2llcyIsIlRpbWVQb2xpY3kiLCJmaW5kTWFueSIsInBvbGljeSIsImRlbGV0ZU9uZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../schemas/TimeType.ts\n");

/***/ }),

/***/ "(api)/../../schemas/User.ts":
/*!*****************************!*\
  !*** ../../schemas/User.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_cloudinary__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/cloudinary */ \"@keystone-6/cloudinary\");\n/* harmony import */ var _keystone_6_cloudinary__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_cloudinary__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @keystone-6/core/access */ \"@keystone-6/core/access\");\n/* harmony import */ var _keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _config_env__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../config/env */ \"(api)/../../config/env.ts\");\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\n\n\n\n\nconst validation = {\n    isRequired: true\n};\nconst socialLoginOpts = [\n    {\n        label: \"Google\",\n        value: \"google\"\n    }\n];\nconst userRoleOptions = [\n    {\n        label: \"User\",\n        value: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.USER\n    },\n    {\n        label: \"Location Admin\",\n        value: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN\n    },\n    {\n        label: \"Organization Admin\",\n        value: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_ADMIN\n    },\n    {\n        label: \"Organization Owner\",\n        value: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_OWNER\n    },\n    {\n        label: \"System Admin\",\n        value: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.GOD\n    }\n];\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_1__.list)({\n    fields: {\n        avatarSocialUrl: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.text)({\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"hidden\"\n                }\n            }\n        }),\n        avatarUploaded: (0,_keystone_6_cloudinary__WEBPACK_IMPORTED_MODULE_0__.cloudinaryImage)({\n            cloudinary: {\n                cloudName: _config_env__WEBPACK_IMPORTED_MODULE_5__[\"default\"].CLOUDINARY_CLOUD_NAME,\n                apiKey: _config_env__WEBPACK_IMPORTED_MODULE_5__[\"default\"].CLOUDINARY_API_KEY,\n                apiSecret: _config_env__WEBPACK_IMPORTED_MODULE_5__[\"default\"].CLOUDINARY_API_SECRET,\n                folder: _config_env__WEBPACK_IMPORTED_MODULE_5__[\"default\"].CLOUDINARY_API_FOLDER\n            }\n        }),\n        avatarUrl: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.virtual)({\n            field: _keystone_6_core__WEBPACK_IMPORTED_MODULE_1__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_1__.graphql.String,\n                resolve: (item)=>item.avatarUploaded?.publicUrl || item.avatarSocialUrl || \"\"\n            })\n        }),\n        email: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.text)({\n            validation,\n            isIndexed: true,\n            isFilterable: true\n        }),\n        firstName: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.text)(),\n        lastName: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.text)(),\n        displayName: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.virtual)({\n            field: _keystone_6_core__WEBPACK_IMPORTED_MODULE_1__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_1__.graphql.String,\n                resolve: (item)=>{\n                    const name = [\n                        item.firstName,\n                        item.lastName\n                    ].filter(Boolean).join(\" \");\n                    return name || item.email || \"\";\n                }\n            })\n        }),\n        role: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.select)({\n            type: \"enum\",\n            options: userRoleOptions,\n            defaultValue: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.USER,\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin,\n                update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin\n            }\n        }),\n        providerAccountId: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.text)({\n            isIndexed: \"unique\",\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod,\n                update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod\n            },\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                }\n            }\n        }),\n        provider: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.select)({\n            type: \"enum\",\n            validation,\n            options: socialLoginOpts,\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod\n            },\n            defaultValue: socialLoginOpts[0].value\n        }),\n        rawAuth: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.json)({\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod\n            },\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"hidden\"\n                }\n            }\n        }),\n        org: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.relationship)({\n            ref: \"Organization.users\",\n            many: false,\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin,\n                update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isOrgAdminOrAbove\n            }\n        }),\n        location: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.relationship)({\n            ref: \"Location.users\",\n            many: false,\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin,\n                update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin\n            }\n        }),\n        startDate: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.timestamp)(),\n        allocations: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.relationship)({\n            ref: \"UserAllocation.user\",\n            many: true\n        }),\n        isActive: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.checkbox)({\n            defaultValue: true,\n            access: {\n                ...(0,_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.allOperations)(_keystone_6_core_access__WEBPACK_IMPORTED_MODULE_2__.denyAll),\n                read: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated,\n                create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin,\n                update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isOrgAdminOrAbove\n            }\n        }),\n        createdAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.timestamp)({\n            defaultValue: {\n                kind: \"now\"\n            },\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        provisionedAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.timestamp)({\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        updatedAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.timestamp)({\n            db: {\n                updatedAt: true\n            },\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        seenAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_3__.timestamp)({\n            ui: {\n                createView: {\n                    fieldMode: \"hidden\"\n                },\n                itemView: {\n                    fieldMode: \"read\"\n                }\n            }\n        })\n    },\n    ui: {\n        labelField: \"email\"\n    },\n    access: {\n        operation: {\n            query: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated)({\n                    session\n                }),\n            create: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAnyAdmin)({\n                    session\n                }),\n            update: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated)({\n                    session\n                }),\n            delete: async (args)=>{\n                const typedArgs = args;\n                const { session, itemId, context } = typedArgs;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod)({\n                    session\n                })) return true;\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isOrgAdmin)({\n                    session\n                })) return false;\n                if (!session?.orgId || !itemId) return false;\n                const user = await context.sudo().query.User.findOne({\n                    where: {\n                        id: itemId\n                    },\n                    query: \"org { id }\"\n                });\n                if (!user) return false;\n                return user.org?.id === session.orgId;\n            }\n        },\n        item: {\n            update: async ({ session, item, context })=>{\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod)({\n                    session\n                })) return true;\n                if (!session?.id || !item?.id) return false;\n                const targetUserId = String(item.id);\n                const sessionId = String(session.id);\n                // Users can update themselves\n                if (sessionId === targetUserId) return true;\n                // Query the item with relationships and role we need\n                const sudoContext = context.sudo();\n                const userWithRelations = await sudoContext.query.User.findOne({\n                    where: {\n                        id: targetUserId\n                    },\n                    query: \"id org { id } location { id } role\"\n                });\n                if (!userWithRelations) return false;\n                // Role hierarchy check: admins cannot edit users with higher roles\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.canEditUserByRole)(session?.role, userWithRelations.role)) return false;\n                // Org admins (ORG_ADMIN and ORG_OWNER) can update users in their org\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isOrgAdmin)({\n                    session\n                })) {\n                    if (!session?.orgId) return false;\n                    if (!userWithRelations.org?.id) return false;\n                    // Compare org IDs as strings to ensure proper comparison\n                    return String(userWithRelations.org.id) === String(session.orgId);\n                }\n                // Location admins can update users in their location\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isLocationAdmin)({\n                    session\n                })) {\n                    if (!session?.locationId || !session?.orgId) return false;\n                    if (!userWithRelations.location?.id || !userWithRelations.org?.id) return false;\n                    // Must be in same location and same org\n                    return String(userWithRelations.location.id) === String(session.locationId) && String(userWithRelations.org.id) === String(session.orgId);\n                }\n                return false;\n            }\n        },\n        filter: {\n            query: async ({ session })=>{\n                if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isAuthenticated)({\n                    session\n                })) return false;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isGod)({\n                    session\n                })) return true;\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isOrgAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.filterByUserOrg)({\n                    session\n                });\n                if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isLocationAdmin)({\n                    session\n                })) return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.filterByUserLocation)({\n                    session\n                });\n                return (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.isSelf)({\n                    session\n                });\n            }\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ resolvedData })=>({\n                    ...resolvedData,\n                    email: resolvedData.email?.toLowerCase(),\n                    providerAccountId: resolvedData.providerAccountId || (0,crypto__WEBPACK_IMPORTED_MODULE_4__.randomUUID)()\n                }),\n            update: async ({ resolvedData })=>({\n                    ...resolvedData,\n                    email: typeof resolvedData.email === \"string\" ? resolvedData.email.toLowerCase() : resolvedData.email,\n                    providerAccountId: resolvedData.providerAccountId || (0,crypto__WEBPACK_IMPORTED_MODULE_4__.randomUUID)()\n                })\n        },\n        validateInput: async ({ operation, resolvedData, item, context, addValidationError })=>{\n            const existingUser = item?.id ? await context.query.User.findOne({\n                where: {\n                    id: item.id\n                },\n                query: \"id org { id } location { id } role\"\n            }) : null;\n            // Check if user is trying to edit themselves\n            const session = context.session;\n            const isEditingSelf = operation === \"update\" && existingUser && session?.id && String(existingUser.id) === String(session.id);\n            // Prevent self-editing of role (always)\n            isEditingSelf && resolvedData.role && addValidationError(\"You cannot edit your own role.\");\n            // Prevent self-editing of isActive (always)\n            isEditingSelf && resolvedData.isActive !== undefined && addValidationError(\"You cannot edit your own active status.\");\n            // Prevent self-editing of location unless ORG_OWNER/ORG_ADMIN\n            isEditingSelf && resolvedData.location && session?.role !== _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_ADMIN && session?.role !== _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_OWNER && addValidationError(\"You cannot edit your own location.\");\n            const resolveRelationshipId = (input, existingId)=>{\n                const typedInput = input;\n                if (!typedInput) return existingId ?? null;\n                const getDisconnectedId = ()=>{\n                    if (!(\"disconnect\" in typedInput) || !typedInput.disconnect) return null;\n                    if (typedInput.disconnect === true) return null;\n                    if (Array.isArray(typedInput.disconnect) && typedInput.disconnect.length > 0) return null;\n                    return existingId ?? null;\n                };\n                const getConnectedId = ()=>{\n                    if (!(\"connect\" in typedInput) || !typedInput.connect) return null;\n                    if (Array.isArray(typedInput.connect)) return typedInput.connect[0]?.id;\n                    return typedInput.connect.id;\n                };\n                const getSetId = ()=>{\n                    if (!(\"set\" in typedInput) || typedInput.set === undefined) return null;\n                    if (typedInput.set === null) return null;\n                    if (Array.isArray(typedInput.set)) return typedInput.set[0]?.id;\n                    return typedInput.set?.id;\n                };\n                return getDisconnectedId() ?? getConnectedId() ?? getSetId() ?? existingId ?? null;\n            };\n            const getAllowedRolesForAdmin = (adminRole)=>{\n                const baseRoles = [\n                    _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.USER\n                ];\n                const roleMap = {\n                    [_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.USER]: baseRoles,\n                    [_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN]: [\n                        ...baseRoles,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN\n                    ],\n                    [_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_ADMIN]: [\n                        ...baseRoles,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_ADMIN\n                    ],\n                    [_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_OWNER]: [\n                        ...baseRoles,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_ADMIN,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_OWNER\n                    ],\n                    [_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.GOD]: [\n                        ...baseRoles,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_ADMIN,\n                        _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.ORG_OWNER\n                    ]\n                };\n                return roleMap[adminRole] ?? baseRoles;\n            };\n            const validateRoleAssignment = (assignedRole, adminRole)=>{\n                if (!adminRole) return;\n                if (assignedRole === _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.GOD) {\n                    addValidationError(\"GOD role cannot be assigned via API. It can only be set directly in the database.\");\n                    return;\n                }\n                const allowedRoles = getAllowedRolesForAdmin(adminRole);\n                if (!allowedRoles.includes(assignedRole)) {\n                    addValidationError(\"You cannot assign this role. You can only assign roles up to your own permission level.\");\n                }\n            };\n            const validateLocationRestriction = (operation, nextLocationId, adminRole, adminLocationId)=>{\n                const isLocationAdminCreating = operation === \"create\" && adminRole === _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_6__.UserRole.LOCATION_ADMIN && adminLocationId;\n                if (isLocationAdminCreating && nextLocationId && String(nextLocationId) !== String(adminLocationId)) {\n                    addValidationError(\"Location Admins can only create users in their own location.\");\n                }\n            };\n            const validateProvisioning = (operation, nextOrgId, nextLocationId, existingOrgId, existingLocationId)=>{\n                const isUnprovisioned = !nextOrgId && !nextLocationId;\n                const isInitialProvision = operation === \"create\" && isUnprovisioned;\n                const isExistingUnprovisioned = operation === \"update\" && isUnprovisioned && !existingOrgId && !existingLocationId;\n                if (!isInitialProvision && !isExistingUnprovisioned && (!nextOrgId || !nextLocationId)) {\n                    addValidationError(\"Users must belong to both an organization and a location once provisioned.\");\n                }\n            };\n            const validateLocationOrgMatch = async (nextOrgId, nextLocationId, context)=>{\n                if (!nextOrgId || !nextLocationId) return;\n                const location = await context.query.Location.findOne({\n                    where: {\n                        id: nextLocationId\n                    },\n                    query: \"id org { id }\"\n                });\n                const locationOrgId = location?.org?.id ?? null;\n                if (locationOrgId && locationOrgId !== nextOrgId) {\n                    addValidationError(\"Selected location does not belong to the user's organization.\");\n                }\n            };\n            const nextOrgId = resolveRelationshipId(resolvedData.org, existingUser?.org?.id ?? null);\n            const nextLocationId = resolveRelationshipId(resolvedData.location, existingUser?.location?.id ?? null);\n            resolvedData.role && validateRoleAssignment(resolvedData.role, session?.role);\n            validateLocationRestriction(operation, nextLocationId, session?.role, session?.locationId);\n            validateProvisioning(operation, nextOrgId, nextLocationId, existingUser?.org?.id ?? null, existingUser?.location?.id ?? null);\n            await validateLocationOrgMatch(nextOrgId, nextLocationId, context);\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUFBTTtZQUNuRixNQUFNcUMsaUJBQWlCdEIsc0JBQXNCUCxhQUFhakMsUUFBUSxFQUFFcUMsY0FBY3JDLFVBQVV5QixNQUFNO1lBRWxHUSxhQUFhOUMsSUFBSSxJQUFJc0UsdUJBQXVCeEIsYUFBYTlDLElBQUksRUFBYzBCLFNBQVMxQjtZQUVwRjBFLDRCQUE0QmxELFdBQVdtRCxnQkFBZ0JqRCxTQUFTMUIsTUFBTTBCLFNBQVNpQjtZQUUvRW1DLHFCQUNFdEQsV0FDQXVELFdBQ0FKLGdCQUNBekIsY0FBY3hDLEtBQUs0QixNQUFNLE1BQ3pCWSxjQUFjckMsVUFBVXlCLE1BQU07WUFHaEMsTUFBTStDLHlCQUF5Qk4sV0FBV0osZ0JBQWdCNUM7UUFDNUQ7SUFDRjtBQUNGLEVBQUUsRUFBeUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vc2NoZW1hcy9Vc2VyLnRzP2ZjMjMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBDb250ZXh0LCB0eXBlIExpc3RzLCB0eXBlIFR5cGVJbmZvIH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcbmltcG9ydCB7IGNsb3VkaW5hcnlJbWFnZSB9IGZyb20gJ0BrZXlzdG9uZS02L2Nsb3VkaW5hcnknO1xuaW1wb3J0IHsgZ3JhcGhxbCBhcyBnLCBsaXN0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgeyBhbGxPcGVyYXRpb25zLCBkZW55QWxsIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS9hY2Nlc3MnO1xuaW1wb3J0IHsgY2hlY2tib3gsIGpzb24sIHJlbGF0aW9uc2hpcCwgc2VsZWN0LCB0ZXh0LCB0aW1lc3RhbXAsIHZpcnR1YWwgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2ZpZWxkcyc7XG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSAnY3J5cHRvJztcbmltcG9ydCB0eXBlIHsgU2Vzc2lvbiB9IGZyb20gJy4uL2F1dGgnO1xuaW1wb3J0IGVudiBmcm9tICcuLi9jb25maWcvZW52JztcbmltcG9ydCB7XG4gIGNhbkVkaXRVc2VyQnlSb2xlLFxuICBmaWx0ZXJCeVVzZXJMb2NhdGlvbixcbiAgZmlsdGVyQnlVc2VyT3JnLFxuICBpc0FueUFkbWluLFxuICBpc0F1dGhlbnRpY2F0ZWQsXG4gIGlzR29kLFxuICBpc0xvY2F0aW9uQWRtaW4sXG4gIGlzT3JnQWRtaW4sXG4gIGlzT3JnQWRtaW5PckFib3ZlLFxuICBpc1NlbGYsXG4gIFVzZXJSb2xlXG59IGZyb20gJy4uL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5cbnR5cGUgVXNlckl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVXNlciddWydpdGVtJ107XG50eXBlIE9yZ2FuaXphdGlvbkl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnT3JnYW5pemF0aW9uJ11bJ2l0ZW0nXTtcbnR5cGUgTG9jYXRpb25JdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ0xvY2F0aW9uJ11bJ2l0ZW0nXTtcbnR5cGUgUmVsYXRpb25zaGlwSW5wdXQgPVxuICB8IHsgZGlzY29ubmVjdD86IGJvb2xlYW4gfCBBcnJheTx7IGlkOiBzdHJpbmcgfT4gfVxuICB8IHsgY29ubmVjdD86IHsgaWQ6IHN0cmluZyB9IHwgQXJyYXk8eyBpZDogc3RyaW5nIH0+IH1cbiAgfCB7IHNldD86IHsgaWQ6IHN0cmluZyB9IHwgQXJyYXk8eyBpZDogc3RyaW5nIH0+IHwgbnVsbCB9XG4gIHwgbnVsbFxuICB8IHVuZGVmaW5lZDtcblxuY29uc3QgdmFsaWRhdGlvbiA9IHsgaXNSZXF1aXJlZDogdHJ1ZSB9O1xuY29uc3Qgc29jaWFsTG9naW5PcHRzID0gW3sgbGFiZWw6ICdHb29nbGUnLCB2YWx1ZTogJ2dvb2dsZScgfV07XG5cbmNvbnN0IHVzZXJSb2xlT3B0aW9ucyA9IFtcbiAgeyBsYWJlbDogJ1VzZXInLCB2YWx1ZTogVXNlclJvbGUuVVNFUiB9LFxuICB7IGxhYmVsOiAnTG9jYXRpb24gQWRtaW4nLCB2YWx1ZTogVXNlclJvbGUuTE9DQVRJT05fQURNSU4gfSxcbiAgeyBsYWJlbDogJ09yZ2FuaXphdGlvbiBBZG1pbicsIHZhbHVlOiBVc2VyUm9sZS5PUkdfQURNSU4gfSxcbiAgeyBsYWJlbDogJ09yZ2FuaXphdGlvbiBPd25lcicsIHZhbHVlOiBVc2VyUm9sZS5PUkdfT1dORVIgfSxcbiAgeyBsYWJlbDogJ1N5c3RlbSBBZG1pbicsIHZhbHVlOiBVc2VyUm9sZS5HT0QgfVxuXTtcblxuZXhwb3J0IGRlZmF1bHQgbGlzdCh7XG4gIGZpZWxkczoge1xuICAgIGF2YXRhclNvY2lhbFVybDogdGV4dCh7XG4gICAgICB1aToge1xuICAgICAgICBjcmVhdGVWaWV3OiB7XG4gICAgICAgICAgZmllbGRNb2RlOiAnaGlkZGVuJ1xuICAgICAgICB9LFxuICAgICAgICBpdGVtVmlldzoge1xuICAgICAgICAgIGZpZWxkTW9kZTogJ2hpZGRlbidcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pLFxuICAgIGF2YXRhclVwbG9hZGVkOiBjbG91ZGluYXJ5SW1hZ2Uoe1xuICAgICAgY2xvdWRpbmFyeToge1xuICAgICAgICBjbG91ZE5hbWU6IGVudi5DTE9VRElOQVJZX0NMT1VEX05BTUUsXG4gICAgICAgIGFwaUtleTogZW52LkNMT1VESU5BUllfQVBJX0tFWSEsXG4gICAgICAgIGFwaVNlY3JldDogZW52LkNMT1VESU5BUllfQVBJX1NFQ1JFVCEsXG4gICAgICAgIGZvbGRlcjogZW52LkNMT1VESU5BUllfQVBJX0ZPTERFUiFcbiAgICAgIH1cbiAgICB9KSxcbiAgICBhdmF0YXJVcmw6IHZpcnR1YWwoe1xuICAgICAgZmllbGQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLlN0cmluZyxcbiAgICAgICAgcmVzb2x2ZTogKGl0ZW06IFVzZXJJdGVtKTogc3RyaW5nIHwgbnVsbCA9PlxuICAgICAgICAgIChpdGVtLmF2YXRhclVwbG9hZGVkIGFzIHsgcHVibGljVXJsPzogc3RyaW5nIH0pPy5wdWJsaWNVcmwgfHwgaXRlbS5hdmF0YXJTb2NpYWxVcmwgfHwgJydcbiAgICAgIH0pXG4gICAgfSksXG4gICAgZW1haWw6IHRleHQoe1xuICAgICAgdmFsaWRhdGlvbixcbiAgICAgIGlzSW5kZXhlZDogdHJ1ZSxcbiAgICAgIGlzRmlsdGVyYWJsZTogdHJ1ZVxuICAgIH0pLFxuICAgIGZpcnN0TmFtZTogdGV4dCgpLFxuICAgIGxhc3ROYW1lOiB0ZXh0KCksXG4gICAgZGlzcGxheU5hbWU6IHZpcnR1YWwoe1xuICAgICAgZmllbGQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLlN0cmluZyxcbiAgICAgICAgcmVzb2x2ZTogKGl0ZW06IFVzZXJJdGVtKTogc3RyaW5nID0+IHtcbiAgICAgICAgICBjb25zdCBuYW1lID0gW2l0ZW0uZmlyc3ROYW1lLCBpdGVtLmxhc3ROYW1lXS5maWx0ZXIoQm9vbGVhbikuam9pbignICcpO1xuICAgICAgICAgIHJldHVybiBuYW1lIHx8IGl0ZW0uZW1haWwgfHwgJyc7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSksXG4gICAgcm9sZTogc2VsZWN0KHtcbiAgICAgIHR5cGU6ICdlbnVtJyxcbiAgICAgIG9wdGlvbnM6IHVzZXJSb2xlT3B0aW9ucyxcbiAgICAgIGRlZmF1bHRWYWx1ZTogVXNlclJvbGUuVVNFUixcbiAgICAgIGFjY2Vzczoge1xuICAgICAgICAuLi5hbGxPcGVyYXRpb25zKGRlbnlBbGwpLFxuICAgICAgICByZWFkOiBpc0F1dGhlbnRpY2F0ZWQsXG4gICAgICAgIGNyZWF0ZTogaXNBbnlBZG1pbixcbiAgICAgICAgdXBkYXRlOiBpc0FueUFkbWluXG4gICAgICB9XG4gICAgfSksXG4gICAgcHJvdmlkZXJBY2NvdW50SWQ6IHRleHQoe1xuICAgICAgaXNJbmRleGVkOiAndW5pcXVlJyxcbiAgICAgIGFjY2Vzczoge1xuICAgICAgICAuLi5hbGxPcGVyYXRpb25zKGRlbnlBbGwpLFxuICAgICAgICByZWFkOiBpc0dvZCxcbiAgICAgICAgY3JlYXRlOiBpc0dvZCxcbiAgICAgICAgdXBkYXRlOiBpc0dvZFxuICAgICAgfSxcbiAgICAgIHVpOiB7XG4gICAgICAgIGNyZWF0ZVZpZXc6IHsgZmllbGRNb2RlOiAnaGlkZGVuJyB9XG4gICAgICB9XG4gICAgfSksXG4gICAgcHJvdmlkZXI6IHNlbGVjdCh7XG4gICAgICB0eXBlOiAnZW51bScsXG4gICAgICB2YWxpZGF0aW9uLFxuICAgICAgb3B0aW9uczogc29jaWFsTG9naW5PcHRzLFxuICAgICAgYWNjZXNzOiB7IC4uLmFsbE9wZXJhdGlvbnMoZGVueUFsbCksIHJlYWQ6IGlzR29kLCBjcmVhdGU6IGlzR29kIH0sXG4gICAgICBkZWZhdWx0VmFsdWU6IHNvY2lhbExvZ2luT3B0c1swXS52YWx1ZVxuICAgIH0pLFxuICAgIHJhd0F1dGg6IGpzb24oe1xuICAgICAgYWNjZXNzOiB7IC4uLmFsbE9wZXJhdGlvbnMoZGVueUFsbCksIHJlYWQ6IGlzR29kLCBjcmVhdGU6IGlzR29kIH0sXG4gICAgICB1aToge1xuICAgICAgICBjcmVhdGVWaWV3OiB7IGZpZWxkTW9kZTogJ2hpZGRlbicgfSxcbiAgICAgICAgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAnaGlkZGVuJyB9XG4gICAgICB9XG4gICAgfSksXG4gICAgb3JnOiByZWxhdGlvbnNoaXAoe1xuICAgICAgcmVmOiAnT3JnYW5pemF0aW9uLnVzZXJzJyxcbiAgICAgIG1hbnk6IGZhbHNlLFxuICAgICAgYWNjZXNzOiB7XG4gICAgICAgIC4uLmFsbE9wZXJhdGlvbnMoZGVueUFsbCksXG4gICAgICAgIHJlYWQ6IGlzQXV0aGVudGljYXRlZCxcbiAgICAgICAgY3JlYXRlOiBpc0FueUFkbWluLFxuICAgICAgICB1cGRhdGU6IGlzT3JnQWRtaW5PckFib3ZlXG4gICAgICB9XG4gICAgfSksXG4gICAgbG9jYXRpb246IHJlbGF0aW9uc2hpcCh7XG4gICAgICByZWY6ICdMb2NhdGlvbi51c2VycycsXG4gICAgICBtYW55OiBmYWxzZSxcbiAgICAgIGFjY2Vzczoge1xuICAgICAgICAuLi5hbGxPcGVyYXRpb25zKGRlbnlBbGwpLFxuICAgICAgICByZWFkOiBpc0F1dGhlbnRpY2F0ZWQsXG4gICAgICAgIGNyZWF0ZTogaXNBbnlBZG1pbixcbiAgICAgICAgdXBkYXRlOiBpc0FueUFkbWluXG4gICAgICB9XG4gICAgfSksXG4gICAgc3RhcnREYXRlOiB0aW1lc3RhbXAoKSxcbiAgICBhbGxvY2F0aW9uczogcmVsYXRpb25zaGlwKHsgcmVmOiAnVXNlckFsbG9jYXRpb24udXNlcicsIG1hbnk6IHRydWUgfSksXG5cbiAgICBpc0FjdGl2ZTogY2hlY2tib3goe1xuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgICAgYWNjZXNzOiB7XG4gICAgICAgIC4uLmFsbE9wZXJhdGlvbnMoZGVueUFsbCksXG4gICAgICAgIHJlYWQ6IGlzQXV0aGVudGljYXRlZCxcbiAgICAgICAgY3JlYXRlOiBpc0FueUFkbWluLFxuICAgICAgICB1cGRhdGU6IGlzT3JnQWRtaW5PckFib3ZlXG4gICAgICB9XG4gICAgfSksXG4gICAgY3JlYXRlZEF0OiB0aW1lc3RhbXAoe1xuICAgICAgZGVmYXVsdFZhbHVlOiB7IGtpbmQ6ICdub3cnIH0sXG4gICAgICB1aToge1xuICAgICAgICBjcmVhdGVWaWV3OiB7IGZpZWxkTW9kZTogJ2hpZGRlbicgfSxcbiAgICAgICAgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfVxuICAgICAgfVxuICAgIH0pLFxuICAgIHByb3Zpc2lvbmVkQXQ6IHRpbWVzdGFtcCh7XG4gICAgICB1aToge1xuICAgICAgICBjcmVhdGVWaWV3OiB7IGZpZWxkTW9kZTogJ2hpZGRlbicgfSxcbiAgICAgICAgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfVxuICAgICAgfVxuICAgIH0pLFxuICAgIHVwZGF0ZWRBdDogdGltZXN0YW1wKHtcbiAgICAgIGRiOiB7IHVwZGF0ZWRBdDogdHJ1ZSB9LFxuICAgICAgdWk6IHtcbiAgICAgICAgY3JlYXRlVmlldzogeyBmaWVsZE1vZGU6ICdoaWRkZW4nIH0sXG4gICAgICAgIGl0ZW1WaWV3OiB7IGZpZWxkTW9kZTogJ3JlYWQnIH1cbiAgICAgIH1cbiAgICB9KSxcbiAgICBzZWVuQXQ6IHRpbWVzdGFtcCh7XG4gICAgICB1aToge1xuICAgICAgICBjcmVhdGVWaWV3OiB7IGZpZWxkTW9kZTogJ2hpZGRlbicgfSxcbiAgICAgICAgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIHVpOiB7XG4gICAgbGFiZWxGaWVsZDogJ2VtYWlsJ1xuICB9LFxuICBhY2Nlc3M6IHtcbiAgICBvcGVyYXRpb246IHtcbiAgICAgIHF1ZXJ5OiAoeyBzZXNzaW9uIH0pID0+IGlzQXV0aGVudGljYXRlZCh7IHNlc3Npb24gfSksXG5cbiAgICAgIGNyZWF0ZTogKHsgc2Vzc2lvbiB9KSA9PiBpc0FueUFkbWluKHsgc2Vzc2lvbiB9KSxcbiAgICAgIHVwZGF0ZTogKHsgc2Vzc2lvbiB9KSA9PiBpc0F1dGhlbnRpY2F0ZWQoeyBzZXNzaW9uIH0pLFxuICAgICAgZGVsZXRlOiBhc3luYyBhcmdzID0+IHtcbiAgICAgICAgY29uc3QgdHlwZWRBcmdzID0gYXJncyBhcyB1bmtub3duIGFzIHtcbiAgICAgICAgICBzZXNzaW9uOiBTZXNzaW9uIHwgbnVsbDtcbiAgICAgICAgICBpdGVtSWQ6IHN0cmluZztcbiAgICAgICAgICBjb250ZXh0OiBDb250ZXh0O1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCB7IHNlc3Npb24sIGl0ZW1JZCwgY29udGV4dCB9ID0gdHlwZWRBcmdzO1xuICAgICAgICBpZiAoaXNHb2QoeyBzZXNzaW9uIH0pKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKCFpc09yZ0FkbWluKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoIXNlc3Npb24/Lm9yZ0lkIHx8ICFpdGVtSWQpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBjb25zdCB1c2VyID0gKGF3YWl0IGNvbnRleHQuc3VkbygpLnF1ZXJ5LlVzZXIuZmluZE9uZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IGl0ZW1JZCB9LFxuICAgICAgICAgIHF1ZXJ5OiAnb3JnIHsgaWQgfSdcbiAgICAgICAgfSkpIGFzIChQaWNrPFVzZXJJdGVtLCAnaWQnPiAmIHsgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbCB9KSB8IG51bGw7XG4gICAgICAgIGlmICghdXNlcikgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdXNlci5vcmc/LmlkID09PSBzZXNzaW9uLm9yZ0lkO1xuICAgICAgfVxuICAgIH0sXG4gICAgaXRlbToge1xuICAgICAgdXBkYXRlOiBhc3luYyAoeyBzZXNzaW9uLCBpdGVtLCBjb250ZXh0IH0pID0+IHtcbiAgICAgICAgaWYgKGlzR29kKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmICghc2Vzc2lvbj8uaWQgfHwgIWl0ZW0/LmlkKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0VXNlcklkID0gU3RyaW5nKGl0ZW0uaWQpO1xuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBTdHJpbmcoc2Vzc2lvbi5pZCk7XG5cbiAgICAgICAgLy8gVXNlcnMgY2FuIHVwZGF0ZSB0aGVtc2VsdmVzXG4gICAgICAgIGlmIChzZXNzaW9uSWQgPT09IHRhcmdldFVzZXJJZCkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgLy8gUXVlcnkgdGhlIGl0ZW0gd2l0aCByZWxhdGlvbnNoaXBzIGFuZCByb2xlIHdlIG5lZWRcbiAgICAgICAgY29uc3Qgc3Vkb0NvbnRleHQgPSBjb250ZXh0LnN1ZG8oKTtcbiAgICAgICAgY29uc3QgdXNlcldpdGhSZWxhdGlvbnMgPSAoYXdhaXQgc3Vkb0NvbnRleHQucXVlcnkuVXNlci5maW5kT25lKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogdGFyZ2V0VXNlcklkIH0sXG4gICAgICAgICAgcXVlcnk6ICdpZCBvcmcgeyBpZCB9IGxvY2F0aW9uIHsgaWQgfSByb2xlJ1xuICAgICAgICB9KSkgYXNcbiAgICAgICAgICB8IChQaWNrPFVzZXJJdGVtLCAnaWQnIHwgJ3JvbGUnPiAmIHtcbiAgICAgICAgICAgICAgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgICAgICAgbG9jYXRpb246IFBpY2s8TG9jYXRpb25JdGVtLCAnaWQnPiB8IG51bGw7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIHwgbnVsbDtcblxuICAgICAgICBpZiAoIXVzZXJXaXRoUmVsYXRpb25zKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgLy8gUm9sZSBoaWVyYXJjaHkgY2hlY2s6IGFkbWlucyBjYW5ub3QgZWRpdCB1c2VycyB3aXRoIGhpZ2hlciByb2xlc1xuICAgICAgICBpZiAoIWNhbkVkaXRVc2VyQnlSb2xlKHNlc3Npb24/LnJvbGUgYXMgVXNlclJvbGUgfCBudWxsLCB1c2VyV2l0aFJlbGF0aW9ucy5yb2xlIGFzIFVzZXJSb2xlIHwgbnVsbCkpXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIC8vIE9yZyBhZG1pbnMgKE9SR19BRE1JTiBhbmQgT1JHX09XTkVSKSBjYW4gdXBkYXRlIHVzZXJzIGluIHRoZWlyIG9yZ1xuICAgICAgICBpZiAoaXNPcmdBZG1pbih7IHNlc3Npb24gfSkpIHtcbiAgICAgICAgICBpZiAoIXNlc3Npb24/Lm9yZ0lkKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgaWYgKCF1c2VyV2l0aFJlbGF0aW9ucy5vcmc/LmlkKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAvLyBDb21wYXJlIG9yZyBJRHMgYXMgc3RyaW5ncyB0byBlbnN1cmUgcHJvcGVyIGNvbXBhcmlzb25cbiAgICAgICAgICByZXR1cm4gU3RyaW5nKHVzZXJXaXRoUmVsYXRpb25zLm9yZy5pZCkgPT09IFN0cmluZyhzZXNzaW9uLm9yZ0lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExvY2F0aW9uIGFkbWlucyBjYW4gdXBkYXRlIHVzZXJzIGluIHRoZWlyIGxvY2F0aW9uXG4gICAgICAgIGlmIChpc0xvY2F0aW9uQWRtaW4oeyBzZXNzaW9uIH0pKSB7XG4gICAgICAgICAgaWYgKCFzZXNzaW9uPy5sb2NhdGlvbklkIHx8ICFzZXNzaW9uPy5vcmdJZCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIGlmICghdXNlcldpdGhSZWxhdGlvbnMubG9jYXRpb24/LmlkIHx8ICF1c2VyV2l0aFJlbGF0aW9ucy5vcmc/LmlkKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAvLyBNdXN0IGJlIGluIHNhbWUgbG9jYXRpb24gYW5kIHNhbWUgb3JnXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIFN0cmluZyh1c2VyV2l0aFJlbGF0aW9ucy5sb2NhdGlvbi5pZCkgPT09IFN0cmluZyhzZXNzaW9uLmxvY2F0aW9uSWQpICYmXG4gICAgICAgICAgICBTdHJpbmcodXNlcldpdGhSZWxhdGlvbnMub3JnLmlkKSA9PT0gU3RyaW5nKHNlc3Npb24ub3JnSWQpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZpbHRlcjoge1xuICAgICAgcXVlcnk6IGFzeW5jICh7IHNlc3Npb24gfSkgPT4ge1xuICAgICAgICBpZiAoIWlzQXV0aGVudGljYXRlZCh7IHNlc3Npb24gfSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGlzR29kKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChpc09yZ0FkbWluKHsgc2Vzc2lvbiB9KSkgcmV0dXJuIGZpbHRlckJ5VXNlck9yZyh7IHNlc3Npb24gfSk7XG4gICAgICAgIGlmIChpc0xvY2F0aW9uQWRtaW4oeyBzZXNzaW9uIH0pKSByZXR1cm4gZmlsdGVyQnlVc2VyTG9jYXRpb24oeyBzZXNzaW9uIH0pO1xuICAgICAgICByZXR1cm4gaXNTZWxmKHsgc2Vzc2lvbiB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGhvb2tzOiB7XG4gICAgcmVzb2x2ZUlucHV0OiB7XG4gICAgICBjcmVhdGU6IGFzeW5jICh7IHJlc29sdmVkRGF0YSB9KSA9PiAoe1xuICAgICAgICAuLi5yZXNvbHZlZERhdGEsXG4gICAgICAgIGVtYWlsOiByZXNvbHZlZERhdGEuZW1haWw/LnRvTG93ZXJDYXNlKCksXG4gICAgICAgIHByb3ZpZGVyQWNjb3VudElkOiByZXNvbHZlZERhdGEucHJvdmlkZXJBY2NvdW50SWQgfHwgcmFuZG9tVVVJRCgpXG4gICAgICB9KSxcbiAgICAgIHVwZGF0ZTogYXN5bmMgKHsgcmVzb2x2ZWREYXRhIH0pID0+ICh7XG4gICAgICAgIC4uLnJlc29sdmVkRGF0YSxcbiAgICAgICAgZW1haWw6IHR5cGVvZiByZXNvbHZlZERhdGEuZW1haWwgPT09ICdzdHJpbmcnID8gcmVzb2x2ZWREYXRhLmVtYWlsLnRvTG93ZXJDYXNlKCkgOiByZXNvbHZlZERhdGEuZW1haWwsXG4gICAgICAgIHByb3ZpZGVyQWNjb3VudElkOiByZXNvbHZlZERhdGEucHJvdmlkZXJBY2NvdW50SWQgfHwgcmFuZG9tVVVJRCgpXG4gICAgICB9KVxuICAgIH0sXG4gICAgdmFsaWRhdGVJbnB1dDogYXN5bmMgKHsgb3BlcmF0aW9uLCByZXNvbHZlZERhdGEsIGl0ZW0sIGNvbnRleHQsIGFkZFZhbGlkYXRpb25FcnJvciB9KSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBpdGVtPy5pZFxuICAgICAgICA/ICgoYXdhaXQgY29udGV4dC5xdWVyeS5Vc2VyLmZpbmRPbmUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGl0ZW0uaWQgYXMgc3RyaW5nIH0sXG4gICAgICAgICAgICBxdWVyeTogJ2lkIG9yZyB7IGlkIH0gbG9jYXRpb24geyBpZCB9IHJvbGUnXG4gICAgICAgICAgfSkpIGFzXG4gICAgICAgICAgICB8IChQaWNrPFVzZXJJdGVtLCAnaWQnIHwgJ3JvbGUnPiAmIHtcbiAgICAgICAgICAgICAgICBvcmc6IFBpY2s8T3JnYW5pemF0aW9uSXRlbSwgJ2lkJz4gfCBudWxsO1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBQaWNrPExvY2F0aW9uSXRlbSwgJ2lkJz4gfCBudWxsO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfCBudWxsKVxuICAgICAgICA6IG51bGw7XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgdHJ5aW5nIHRvIGVkaXQgdGhlbXNlbHZlc1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGNvbnRleHQuc2Vzc2lvbiBhcyBTZXNzaW9uIHwgbnVsbDtcbiAgICAgIGNvbnN0IGlzRWRpdGluZ1NlbGYgPVxuICAgICAgICBvcGVyYXRpb24gPT09ICd1cGRhdGUnICYmIGV4aXN0aW5nVXNlciAmJiBzZXNzaW9uPy5pZCAmJiBTdHJpbmcoZXhpc3RpbmdVc2VyLmlkKSA9PT0gU3RyaW5nKHNlc3Npb24uaWQpO1xuXG4gICAgICAvLyBQcmV2ZW50IHNlbGYtZWRpdGluZyBvZiByb2xlIChhbHdheXMpXG4gICAgICBpc0VkaXRpbmdTZWxmICYmIHJlc29sdmVkRGF0YS5yb2xlICYmIGFkZFZhbGlkYXRpb25FcnJvcignWW91IGNhbm5vdCBlZGl0IHlvdXIgb3duIHJvbGUuJyk7XG5cbiAgICAgIC8vIFByZXZlbnQgc2VsZi1lZGl0aW5nIG9mIGlzQWN0aXZlIChhbHdheXMpXG4gICAgICBpc0VkaXRpbmdTZWxmICYmXG4gICAgICAgIHJlc29sdmVkRGF0YS5pc0FjdGl2ZSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcignWW91IGNhbm5vdCBlZGl0IHlvdXIgb3duIGFjdGl2ZSBzdGF0dXMuJyk7XG5cbiAgICAgIC8vIFByZXZlbnQgc2VsZi1lZGl0aW5nIG9mIGxvY2F0aW9uIHVubGVzcyBPUkdfT1dORVIvT1JHX0FETUlOXG4gICAgICBpc0VkaXRpbmdTZWxmICYmXG4gICAgICAgIHJlc29sdmVkRGF0YS5sb2NhdGlvbiAmJlxuICAgICAgICBzZXNzaW9uPy5yb2xlICE9PSBVc2VyUm9sZS5PUkdfQURNSU4gJiZcbiAgICAgICAgc2Vzc2lvbj8ucm9sZSAhPT0gVXNlclJvbGUuT1JHX09XTkVSICYmXG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcignWW91IGNhbm5vdCBlZGl0IHlvdXIgb3duIGxvY2F0aW9uLicpO1xuXG4gICAgICBjb25zdCByZXNvbHZlUmVsYXRpb25zaGlwSWQgPSAoaW5wdXQ6IFJlbGF0aW9uc2hpcElucHV0IHwgdW5rbm93biwgZXhpc3RpbmdJZDogc3RyaW5nIHwgbnVsbCk6IHN0cmluZyB8IG51bGwgPT4ge1xuICAgICAgICBjb25zdCB0eXBlZElucHV0ID0gaW5wdXQgYXMgUmVsYXRpb25zaGlwSW5wdXQ7XG4gICAgICAgIGlmICghdHlwZWRJbnB1dCkgcmV0dXJuIGV4aXN0aW5nSWQgPz8gbnVsbDtcblxuICAgICAgICBjb25zdCBnZXREaXNjb25uZWN0ZWRJZCA9ICgpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgICAgICAgICBpZiAoISgnZGlzY29ubmVjdCcgaW4gdHlwZWRJbnB1dCkgfHwgIXR5cGVkSW5wdXQuZGlzY29ubmVjdCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgaWYgKHR5cGVkSW5wdXQuZGlzY29ubmVjdCA9PT0gdHJ1ZSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodHlwZWRJbnB1dC5kaXNjb25uZWN0KSAmJiB0eXBlZElucHV0LmRpc2Nvbm5lY3QubGVuZ3RoID4gMCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgcmV0dXJuIGV4aXN0aW5nSWQgPz8gbnVsbDtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBnZXRDb25uZWN0ZWRJZCA9ICgpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgICAgICAgICBpZiAoISgnY29ubmVjdCcgaW4gdHlwZWRJbnB1dCkgfHwgIXR5cGVkSW5wdXQuY29ubmVjdCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodHlwZWRJbnB1dC5jb25uZWN0KSkgcmV0dXJuIHR5cGVkSW5wdXQuY29ubmVjdFswXT8uaWQgYXMgc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgICByZXR1cm4gdHlwZWRJbnB1dC5jb25uZWN0LmlkIGFzIHN0cmluZyB8IG51bGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZ2V0U2V0SWQgPSAoKTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gICAgICAgICAgaWYgKCEoJ3NldCcgaW4gdHlwZWRJbnB1dCkgfHwgdHlwZWRJbnB1dC5zZXQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgaWYgKHR5cGVkSW5wdXQuc2V0ID09PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0eXBlZElucHV0LnNldCkpIHJldHVybiB0eXBlZElucHV0LnNldFswXT8uaWQgYXMgc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgICByZXR1cm4gdHlwZWRJbnB1dC5zZXQ/LmlkIGFzIHN0cmluZyB8IG51bGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGdldERpc2Nvbm5lY3RlZElkKCkgPz8gZ2V0Q29ubmVjdGVkSWQoKSA/PyBnZXRTZXRJZCgpID8/IGV4aXN0aW5nSWQgPz8gbnVsbDtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGdldEFsbG93ZWRSb2xlc0ZvckFkbWluID0gKGFkbWluUm9sZTogVXNlclJvbGUpOiBVc2VyUm9sZVtdID0+IHtcbiAgICAgICAgY29uc3QgYmFzZVJvbGVzOiBVc2VyUm9sZVtdID0gW1VzZXJSb2xlLlVTRVJdO1xuICAgICAgICBjb25zdCByb2xlTWFwOiBSZWNvcmQ8VXNlclJvbGUsIFVzZXJSb2xlW10+ID0ge1xuICAgICAgICAgIFtVc2VyUm9sZS5VU0VSXTogYmFzZVJvbGVzLFxuICAgICAgICAgIFtVc2VyUm9sZS5MT0NBVElPTl9BRE1JTl06IFsuLi5iYXNlUm9sZXMsIFVzZXJSb2xlLkxPQ0FUSU9OX0FETUlOXSxcbiAgICAgICAgICBbVXNlclJvbGUuT1JHX0FETUlOXTogWy4uLmJhc2VSb2xlcywgVXNlclJvbGUuTE9DQVRJT05fQURNSU4sIFVzZXJSb2xlLk9SR19BRE1JTl0sXG4gICAgICAgICAgW1VzZXJSb2xlLk9SR19PV05FUl06IFsuLi5iYXNlUm9sZXMsIFVzZXJSb2xlLkxPQ0FUSU9OX0FETUlOLCBVc2VyUm9sZS5PUkdfQURNSU4sIFVzZXJSb2xlLk9SR19PV05FUl0sXG4gICAgICAgICAgW1VzZXJSb2xlLkdPRF06IFsuLi5iYXNlUm9sZXMsIFVzZXJSb2xlLkxPQ0FUSU9OX0FETUlOLCBVc2VyUm9sZS5PUkdfQURNSU4sIFVzZXJSb2xlLk9SR19PV05FUl1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHJvbGVNYXBbYWRtaW5Sb2xlXSA/PyBiYXNlUm9sZXM7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZVJvbGVBc3NpZ25tZW50ID0gKGFzc2lnbmVkUm9sZTogVXNlclJvbGUsIGFkbWluUm9sZTogVXNlclJvbGUgfCBudWxsIHwgdW5kZWZpbmVkKTogdm9pZCA9PiB7XG4gICAgICAgIGlmICghYWRtaW5Sb2xlKSByZXR1cm47XG5cbiAgICAgICAgaWYgKGFzc2lnbmVkUm9sZSA9PT0gVXNlclJvbGUuR09EKSB7XG4gICAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdHT0Qgcm9sZSBjYW5ub3QgYmUgYXNzaWduZWQgdmlhIEFQSS4gSXQgY2FuIG9ubHkgYmUgc2V0IGRpcmVjdGx5IGluIHRoZSBkYXRhYmFzZS4nKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbGxvd2VkUm9sZXMgPSBnZXRBbGxvd2VkUm9sZXNGb3JBZG1pbihhZG1pblJvbGUpO1xuICAgICAgICBpZiAoIWFsbG93ZWRSb2xlcy5pbmNsdWRlcyhhc3NpZ25lZFJvbGUpKSB7XG4gICAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdZb3UgY2Fubm90IGFzc2lnbiB0aGlzIHJvbGUuIFlvdSBjYW4gb25seSBhc3NpZ24gcm9sZXMgdXAgdG8geW91ciBvd24gcGVybWlzc2lvbiBsZXZlbC4nKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVMb2NhdGlvblJlc3RyaWN0aW9uID0gKFxuICAgICAgICBvcGVyYXRpb246IHN0cmluZyxcbiAgICAgICAgbmV4dExvY2F0aW9uSWQ6IHN0cmluZyB8IG51bGwsXG4gICAgICAgIGFkbWluUm9sZTogVXNlclJvbGUgfCBudWxsIHwgdW5kZWZpbmVkLFxuICAgICAgICBhZG1pbkxvY2F0aW9uSWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWRcbiAgICAgICk6IHZvaWQgPT4ge1xuICAgICAgICBjb25zdCBpc0xvY2F0aW9uQWRtaW5DcmVhdGluZyA9XG4gICAgICAgICAgb3BlcmF0aW9uID09PSAnY3JlYXRlJyAmJiBhZG1pblJvbGUgPT09IFVzZXJSb2xlLkxPQ0FUSU9OX0FETUlOICYmIGFkbWluTG9jYXRpb25JZDtcbiAgICAgICAgaWYgKGlzTG9jYXRpb25BZG1pbkNyZWF0aW5nICYmIG5leHRMb2NhdGlvbklkICYmIFN0cmluZyhuZXh0TG9jYXRpb25JZCkgIT09IFN0cmluZyhhZG1pbkxvY2F0aW9uSWQpKSB7XG4gICAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdMb2NhdGlvbiBBZG1pbnMgY2FuIG9ubHkgY3JlYXRlIHVzZXJzIGluIHRoZWlyIG93biBsb2NhdGlvbi4nKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVQcm92aXNpb25pbmcgPSAoXG4gICAgICAgIG9wZXJhdGlvbjogc3RyaW5nLFxuICAgICAgICBuZXh0T3JnSWQ6IHN0cmluZyB8IG51bGwsXG4gICAgICAgIG5leHRMb2NhdGlvbklkOiBzdHJpbmcgfCBudWxsLFxuICAgICAgICBleGlzdGluZ09yZ0lkOiBzdHJpbmcgfCBudWxsLFxuICAgICAgICBleGlzdGluZ0xvY2F0aW9uSWQ6IHN0cmluZyB8IG51bGxcbiAgICAgICk6IHZvaWQgPT4ge1xuICAgICAgICBjb25zdCBpc1VucHJvdmlzaW9uZWQgPSAhbmV4dE9yZ0lkICYmICFuZXh0TG9jYXRpb25JZDtcbiAgICAgICAgY29uc3QgaXNJbml0aWFsUHJvdmlzaW9uID0gb3BlcmF0aW9uID09PSAnY3JlYXRlJyAmJiBpc1VucHJvdmlzaW9uZWQ7XG4gICAgICAgIGNvbnN0IGlzRXhpc3RpbmdVbnByb3Zpc2lvbmVkID1cbiAgICAgICAgICBvcGVyYXRpb24gPT09ICd1cGRhdGUnICYmIGlzVW5wcm92aXNpb25lZCAmJiAhZXhpc3RpbmdPcmdJZCAmJiAhZXhpc3RpbmdMb2NhdGlvbklkO1xuXG4gICAgICAgIGlmICghaXNJbml0aWFsUHJvdmlzaW9uICYmICFpc0V4aXN0aW5nVW5wcm92aXNpb25lZCAmJiAoIW5leHRPcmdJZCB8fCAhbmV4dExvY2F0aW9uSWQpKSB7XG4gICAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9yKCdVc2VycyBtdXN0IGJlbG9uZyB0byBib3RoIGFuIG9yZ2FuaXphdGlvbiBhbmQgYSBsb2NhdGlvbiBvbmNlIHByb3Zpc2lvbmVkLicpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZUxvY2F0aW9uT3JnTWF0Y2ggPSBhc3luYyAoXG4gICAgICAgIG5leHRPcmdJZDogc3RyaW5nIHwgbnVsbCxcbiAgICAgICAgbmV4dExvY2F0aW9uSWQ6IHN0cmluZyB8IG51bGwsXG4gICAgICAgIGNvbnRleHQ6IENvbnRleHRcbiAgICAgICk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICBpZiAoIW5leHRPcmdJZCB8fCAhbmV4dExvY2F0aW9uSWQpIHJldHVybjtcblxuICAgICAgICBjb25zdCBsb2NhdGlvbiA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LkxvY2F0aW9uLmZpbmRPbmUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBuZXh0TG9jYXRpb25JZCB9LFxuICAgICAgICAgIHF1ZXJ5OiAnaWQgb3JnIHsgaWQgfSdcbiAgICAgICAgfSkpIGFzIChQaWNrPExvY2F0aW9uSXRlbSwgJ2lkJz4gJiB7IG9yZzogUGljazxPcmdhbml6YXRpb25JdGVtLCAnaWQnPiB8IG51bGwgfSkgfCBudWxsO1xuXG4gICAgICAgIGNvbnN0IGxvY2F0aW9uT3JnSWQgPSBsb2NhdGlvbj8ub3JnPy5pZCA/PyBudWxsO1xuICAgICAgICBpZiAobG9jYXRpb25PcmdJZCAmJiBsb2NhdGlvbk9yZ0lkICE9PSBuZXh0T3JnSWQpIHtcbiAgICAgICAgICBhZGRWYWxpZGF0aW9uRXJyb3IoXCJTZWxlY3RlZCBsb2NhdGlvbiBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHVzZXIncyBvcmdhbml6YXRpb24uXCIpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBuZXh0T3JnSWQgPSByZXNvbHZlUmVsYXRpb25zaGlwSWQocmVzb2x2ZWREYXRhLm9yZywgZXhpc3RpbmdVc2VyPy5vcmc/LmlkID8/IG51bGwpO1xuICAgICAgY29uc3QgbmV4dExvY2F0aW9uSWQgPSByZXNvbHZlUmVsYXRpb25zaGlwSWQocmVzb2x2ZWREYXRhLmxvY2F0aW9uLCBleGlzdGluZ1VzZXI/LmxvY2F0aW9uPy5pZCA/PyBudWxsKTtcblxuICAgICAgcmVzb2x2ZWREYXRhLnJvbGUgJiYgdmFsaWRhdGVSb2xlQXNzaWdubWVudChyZXNvbHZlZERhdGEucm9sZSBhcyBVc2VyUm9sZSwgc2Vzc2lvbj8ucm9sZSk7XG5cbiAgICAgIHZhbGlkYXRlTG9jYXRpb25SZXN0cmljdGlvbihvcGVyYXRpb24sIG5leHRMb2NhdGlvbklkLCBzZXNzaW9uPy5yb2xlLCBzZXNzaW9uPy5sb2NhdGlvbklkKTtcblxuICAgICAgdmFsaWRhdGVQcm92aXNpb25pbmcoXG4gICAgICAgIG9wZXJhdGlvbixcbiAgICAgICAgbmV4dE9yZ0lkLFxuICAgICAgICBuZXh0TG9jYXRpb25JZCxcbiAgICAgICAgZXhpc3RpbmdVc2VyPy5vcmc/LmlkID8/IG51bGwsXG4gICAgICAgIGV4aXN0aW5nVXNlcj8ubG9jYXRpb24/LmlkID8/IG51bGxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IHZhbGlkYXRlTG9jYXRpb25PcmdNYXRjaChuZXh0T3JnSWQsIG5leHRMb2NhdGlvbklkLCBjb250ZXh0KTtcbiAgICB9XG4gIH1cbn0pIHNhdGlzZmllcyBMaXN0c1snVXNlciddO1xuIl0sIm5hbWVzIjpbImNsb3VkaW5hcnlJbWFnZSIsImdyYXBocWwiLCJnIiwibGlzdCIsImFsbE9wZXJhdGlvbnMiLCJkZW55QWxsIiwiY2hlY2tib3giLCJqc29uIiwicmVsYXRpb25zaGlwIiwic2VsZWN0IiwidGV4dCIsInRpbWVzdGFtcCIsInZpcnR1YWwiLCJyYW5kb21VVUlEIiwiZW52IiwiY2FuRWRpdFVzZXJCeVJvbGUiLCJmaWx0ZXJCeVVzZXJMb2NhdGlvbiIsImZpbHRlckJ5VXNlck9yZyIsImlzQW55QWRtaW4iLCJpc0F1dGhlbnRpY2F0ZWQiLCJpc0dvZCIsImlzTG9jYXRpb25BZG1pbiIsImlzT3JnQWRtaW4iLCJpc09yZ0FkbWluT3JBYm92ZSIsImlzU2VsZiIsIlVzZXJSb2xlIiwidmFsaWRhdGlvbiIsImlzUmVxdWlyZWQiLCJzb2NpYWxMb2dpbk9wdHMiLCJsYWJlbCIsInZhbHVlIiwidXNlclJvbGVPcHRpb25zIiwiVVNFUiIsIkxPQ0FUSU9OX0FETUlOIiwiT1JHX0FETUlOIiwiT1JHX09XTkVSIiwiR09EIiwiZmllbGRzIiwiYXZhdGFyU29jaWFsVXJsIiwidWkiLCJjcmVhdGVWaWV3IiwiZmllbGRNb2RlIiwiaXRlbVZpZXciLCJhdmF0YXJVcGxvYWRlZCIsImNsb3VkaW5hcnkiLCJjbG91ZE5hbWUiLCJDTE9VRElOQVJZX0NMT1VEX05BTUUiLCJhcGlLZXkiLCJDTE9VRElOQVJZX0FQSV9LRVkiLCJhcGlTZWNyZXQiLCJDTE9VRElOQVJZX0FQSV9TRUNSRVQiLCJmb2xkZXIiLCJDTE9VRElOQVJZX0FQSV9GT0xERVIiLCJhdmF0YXJVcmwiLCJmaWVsZCIsInR5cGUiLCJTdHJpbmciLCJyZXNvbHZlIiwiaXRlbSIsInB1YmxpY1VybCIsImVtYWlsIiwiaXNJbmRleGVkIiwiaXNGaWx0ZXJhYmxlIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJkaXNwbGF5TmFtZSIsIm5hbWUiLCJmaWx0ZXIiLCJCb29sZWFuIiwiam9pbiIsInJvbGUiLCJvcHRpb25zIiwiZGVmYXVsdFZhbHVlIiwiYWNjZXNzIiwicmVhZCIsImNyZWF0ZSIsInVwZGF0ZSIsInByb3ZpZGVyQWNjb3VudElkIiwicHJvdmlkZXIiLCJyYXdBdXRoIiwib3JnIiwicmVmIiwibWFueSIsImxvY2F0aW9uIiwic3RhcnREYXRlIiwiYWxsb2NhdGlvbnMiLCJpc0FjdGl2ZSIsImNyZWF0ZWRBdCIsImtpbmQiLCJwcm92aXNpb25lZEF0IiwidXBkYXRlZEF0IiwiZGIiLCJzZWVuQXQiLCJsYWJlbEZpZWxkIiwib3BlcmF0aW9uIiwicXVlcnkiLCJzZXNzaW9uIiwiZGVsZXRlIiwiYXJncyIsInR5cGVkQXJncyIsIml0ZW1JZCIsImNvbnRleHQiLCJvcmdJZCIsInVzZXIiLCJzdWRvIiwiVXNlciIsImZpbmRPbmUiLCJ3aGVyZSIsImlkIiwidGFyZ2V0VXNlcklkIiwic2Vzc2lvbklkIiwic3Vkb0NvbnRleHQiLCJ1c2VyV2l0aFJlbGF0aW9ucyIsImxvY2F0aW9uSWQiLCJob29rcyIsInJlc29sdmVJbnB1dCIsInJlc29sdmVkRGF0YSIsInRvTG93ZXJDYXNlIiwidmFsaWRhdGVJbnB1dCIsImFkZFZhbGlkYXRpb25FcnJvciIsImV4aXN0aW5nVXNlciIsImlzRWRpdGluZ1NlbGYiLCJ1bmRlZmluZWQiLCJyZXNvbHZlUmVsYXRpb25zaGlwSWQiLCJpbnB1dCIsImV4aXN0aW5nSWQiLCJ0eXBlZElucHV0IiwiZ2V0RGlzY29ubmVjdGVkSWQiLCJkaXNjb25uZWN0IiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiZ2V0Q29ubmVjdGVkSWQiLCJjb25uZWN0IiwiZ2V0U2V0SWQiLCJzZXQiLCJnZXRBbGxvd2VkUm9sZXNGb3JBZG1pbiIsImFkbWluUm9sZSIsImJhc2VSb2xlcyIsInJvbGVNYXAiLCJ2YWxpZGF0ZVJvbGVBc3NpZ25tZW50IiwiYXNzaWduZWRSb2xlIiwiYWxsb3dlZFJvbGVzIiwiaW5jbHVkZXMiLCJ2YWxpZGF0ZUxvY2F0aW9uUmVzdHJpY3Rpb24iLCJuZXh0TG9jYXRpb25JZCIsImFkbWluTG9jYXRpb25JZCIsImlzTG9jYXRpb25BZG1pbkNyZWF0aW5nIiwidmFsaWRhdGVQcm92aXNpb25pbmciLCJuZXh0T3JnSWQiLCJleGlzdGluZ09yZ0lkIiwiZXhpc3RpbmdMb2NhdGlvbklkIiwiaXNVbnByb3Zpc2lvbmVkIiwiaXNJbml0aWFsUHJvdmlzaW9uIiwiaXNFeGlzdGluZ1VucHJvdmlzaW9uZWQiLCJ2YWxpZGF0ZUxvY2F0aW9uT3JnTWF0Y2giLCJMb2NhdGlvbiIsImxvY2F0aW9uT3JnSWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../schemas/User.ts\n");

/***/ }),

/***/ "(api)/../../schemas/UserAllocation.ts":
/*!***************************************!*\
  !*** ../../schemas/UserAllocation.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @keystone-6/core/fields */ \"@keystone-6/core/fields\");\n/* harmony import */ var _keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\nconst policyScopedFilter = async ({ session })=>{\n    if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n        session\n    })) return false;\n    if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isGod)({\n        session\n    })) return true;\n    if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isOrgAdmin)({\n        session\n    }) || (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isLocationAdmin)({\n        session\n    })) {\n        const orgFilter = await (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterByUserOrg)({\n            session\n        });\n        if (!orgFilter) return false;\n        return {\n            timePolicy: orgFilter\n        };\n    }\n    const policyFilter = await (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.filterPoliciesByUserLocation)({\n        session\n    });\n    if (!policyFilter) return false;\n    return {\n        timePolicy: policyFilter\n    };\n};\nconst eventTypeOptions = [\n    {\n        label: \"Manual\",\n        value: \"MANUAL\"\n    },\n    {\n        label: \"Policy Change (Retro)\",\n        value: \"POLICY_CHANGE_RETRO\"\n    },\n    {\n        label: \"Carryover Out\",\n        value: \"CARRYOVER_OUT\"\n    },\n    {\n        label: \"Carryover In\",\n        value: \"CARRYOVER_IN\"\n    }\n];\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.list)({\n    fields: {\n        user: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User.allocations\",\n            many: false\n        }),\n        timePolicy: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicy.allocations\",\n            many: false\n        }),\n        timePolicyAllocation: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"TimePolicyAllocation.events\",\n            many: false\n        }),\n        type: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.select)({\n            type: \"enum\",\n            options: eventTypeOptions,\n            validation: {\n                isRequired: true\n            }\n        }),\n        effectiveAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: {\n                kind: \"now\"\n            }\n        }),\n        amount: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.integer)({\n            validation: {\n                isRequired: true\n            }\n        }),\n        notes: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.text)(),\n        createdAt: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.timestamp)({\n            validation: {\n                isRequired: true\n            },\n            defaultValue: {\n                kind: \"now\"\n            },\n            ui: {\n                itemView: {\n                    fieldMode: \"read\"\n                },\n                listView: {\n                    fieldMode: \"read\"\n                }\n            }\n        }),\n        createdBy: (0,_keystone_6_core_fields__WEBPACK_IMPORTED_MODULE_1__.relationship)({\n            ref: \"User\",\n            many: false,\n            ui: {\n                hideCreate: true\n            }\n        })\n    },\n    ui: {\n        labelField: \"effectiveAt\",\n        listView: {\n            initialColumns: [\n                \"user\",\n                \"timePolicy\",\n                \"type\",\n                \"amount\",\n                \"effectiveAt\"\n            ]\n        }\n    },\n    access: {\n        operation: {\n            query: ({ session })=>(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAuthenticated)({\n                    session\n                }),\n            create: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            update: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData,\n            delete: _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.canEditOrgData\n        },\n        filter: {\n            query: policyScopedFilter\n        }\n    },\n    hooks: {\n        resolveInput: {\n            create: async ({ context, resolvedData })=>{\n                const nextData = {\n                    ...resolvedData\n                };\n                if (!nextData.createdBy) {\n                    const userId = context.session?.id;\n                    if (userId) nextData.createdBy = {\n                        connect: {\n                            id: userId\n                        }\n                    };\n                }\n                return nextData;\n            }\n        },\n        validateInput: async ({ operation, resolvedData, addValidationError })=>{\n            if (operation !== \"create\") return;\n            const userId = resolvedData.user?.connect?.id;\n            if (!userId) addValidationError(\"User is required for allocation events.\");\n            const timePolicyId = resolvedData.timePolicy?.connect?.id;\n            if (!timePolicyId) addValidationError(\"Time policy is required for allocation events.\");\n        }\n    }\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTZixTQUFTLEVBQUU7b0JBQ3ZCLE1BQU1nQixTQUFTSCxRQUFRdkMsT0FBTyxFQUFFMkM7b0JBQ2hDLElBQUlELFFBQVFELFNBQVNmLFNBQVMsR0FBRzt3QkFBRWtCLFNBQVM7NEJBQUVELElBQUlEO3dCQUFPO29CQUFFO2dCQUM3RDtnQkFDQSxPQUFPRDtZQUNUO1FBQ0Y7UUFDQUksZUFBZSxPQUFPLEVBQUVkLFNBQVMsRUFBRVMsWUFBWSxFQUFFTSxrQkFBa0IsRUFBRTtZQUNuRSxJQUFJZixjQUFjLFVBQVU7WUFDNUIsTUFBTVcsU0FBU0YsYUFBYWhDLElBQUksRUFBRW9DLFNBQVNEO1lBQzNDLElBQUksQ0FBQ0QsUUFBUUksbUJBQW1CO1lBQ2hDLE1BQU1DLGVBQWVQLGFBQWF0QyxVQUFVLEVBQUUwQyxTQUFTRDtZQUN2RCxJQUFJLENBQUNJLGNBQWNELG1CQUFtQjtRQUN4QztJQUNGO0FBQ0YsRUFBRSxFQUFtQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL1VzZXJBbGxvY2F0aW9uLnRzP2MxMjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBMaXN0cyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBsaXN0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgeyBpbnRlZ2VyLCByZWxhdGlvbnNoaXAsIHNlbGVjdCwgdGV4dCwgdGltZXN0YW1wIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS9maWVsZHMnO1xuaW1wb3J0IHR5cGUgeyBTZXNzaW9uIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQge1xuICBjYW5FZGl0T3JnRGF0YSxcbiAgZmlsdGVyQnlVc2VyT3JnLFxuICBmaWx0ZXJQb2xpY2llc0J5VXNlckxvY2F0aW9uLFxuICBpc0F1dGhlbnRpY2F0ZWQsXG4gIGlzR29kLFxuICBpc0xvY2F0aW9uQWRtaW4sXG4gIGlzT3JnQWRtaW5cbn0gZnJvbSAnLi4vZG9tYWlucy9hdXRoL3VzZXJSb2xlJztcblxudHlwZSBTZXNzaW9uQ29udGV4dCA9IHsgc2Vzc2lvbj86IFNlc3Npb24gfCBudWxsIH07XG5cbmNvbnN0IHBvbGljeVNjb3BlZEZpbHRlciA9IGFzeW5jICh7IHNlc3Npb24gfTogU2Vzc2lvbkNvbnRleHQpID0+IHtcbiAgaWYgKCFpc0F1dGhlbnRpY2F0ZWQoeyBzZXNzaW9uIH0pKSByZXR1cm4gZmFsc2U7XG4gIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB0cnVlO1xuICBpZiAoaXNPcmdBZG1pbih7IHNlc3Npb24gfSkgfHwgaXNMb2NhdGlvbkFkbWluKHsgc2Vzc2lvbiB9KSkge1xuICAgIGNvbnN0IG9yZ0ZpbHRlciA9IGF3YWl0IGZpbHRlckJ5VXNlck9yZyh7IHNlc3Npb24gfSk7XG4gICAgaWYgKCFvcmdGaWx0ZXIpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4geyB0aW1lUG9saWN5OiBvcmdGaWx0ZXIgfTtcbiAgfVxuICBjb25zdCBwb2xpY3lGaWx0ZXIgPSBhd2FpdCBmaWx0ZXJQb2xpY2llc0J5VXNlckxvY2F0aW9uKHsgc2Vzc2lvbiB9KTtcbiAgaWYgKCFwb2xpY3lGaWx0ZXIpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIHsgdGltZVBvbGljeTogcG9saWN5RmlsdGVyIH07XG59O1xuXG5jb25zdCBldmVudFR5cGVPcHRpb25zID0gW1xuICB7IGxhYmVsOiAnTWFudWFsJywgdmFsdWU6ICdNQU5VQUwnIH0sXG4gIHsgbGFiZWw6ICdQb2xpY3kgQ2hhbmdlIChSZXRybyknLCB2YWx1ZTogJ1BPTElDWV9DSEFOR0VfUkVUUk8nIH0sXG4gIHsgbGFiZWw6ICdDYXJyeW92ZXIgT3V0JywgdmFsdWU6ICdDQVJSWU9WRVJfT1VUJyB9LFxuICB7IGxhYmVsOiAnQ2FycnlvdmVyIEluJywgdmFsdWU6ICdDQVJSWU9WRVJfSU4nIH1cbl0gYXMgY29uc3Q7XG5cbmV4cG9ydCBkZWZhdWx0IGxpc3Qoe1xuICBmaWVsZHM6IHtcbiAgICB1c2VyOiByZWxhdGlvbnNoaXAoe1xuICAgICAgcmVmOiAnVXNlci5hbGxvY2F0aW9ucycsXG4gICAgICBtYW55OiBmYWxzZVxuICAgIH0pLFxuICAgIHRpbWVQb2xpY3k6IHJlbGF0aW9uc2hpcCh7XG4gICAgICByZWY6ICdUaW1lUG9saWN5LmFsbG9jYXRpb25zJyxcbiAgICAgIG1hbnk6IGZhbHNlXG4gICAgfSksXG4gICAgdGltZVBvbGljeUFsbG9jYXRpb246IHJlbGF0aW9uc2hpcCh7XG4gICAgICByZWY6ICdUaW1lUG9saWN5QWxsb2NhdGlvbi5ldmVudHMnLFxuICAgICAgbWFueTogZmFsc2VcbiAgICB9KSxcbiAgICB0eXBlOiBzZWxlY3Qoe1xuICAgICAgdHlwZTogJ2VudW0nLFxuICAgICAgb3B0aW9uczogZXZlbnRUeXBlT3B0aW9ucyxcbiAgICAgIHZhbGlkYXRpb246IHsgaXNSZXF1aXJlZDogdHJ1ZSB9XG4gICAgfSksXG4gICAgZWZmZWN0aXZlQXQ6IHRpbWVzdGFtcCh7XG4gICAgICB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogeyBraW5kOiAnbm93JyB9XG4gICAgfSksXG4gICAgYW1vdW50OiBpbnRlZ2VyKHsgdmFsaWRhdGlvbjogeyBpc1JlcXVpcmVkOiB0cnVlIH0gfSksXG4gICAgbm90ZXM6IHRleHQoKSxcbiAgICBjcmVhdGVkQXQ6IHRpbWVzdGFtcCh7XG4gICAgICB2YWxpZGF0aW9uOiB7IGlzUmVxdWlyZWQ6IHRydWUgfSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogeyBraW5kOiAnbm93JyB9LFxuICAgICAgdWk6IHsgaXRlbVZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfSwgbGlzdFZpZXc6IHsgZmllbGRNb2RlOiAncmVhZCcgfSB9XG4gICAgfSksXG4gICAgY3JlYXRlZEJ5OiByZWxhdGlvbnNoaXAoe1xuICAgICAgcmVmOiAnVXNlcicsXG4gICAgICBtYW55OiBmYWxzZSxcbiAgICAgIHVpOiB7IGhpZGVDcmVhdGU6IHRydWUgfVxuICAgIH0pXG4gIH0sXG4gIHVpOiB7XG4gICAgbGFiZWxGaWVsZDogJ2VmZmVjdGl2ZUF0JyxcbiAgICBsaXN0Vmlldzoge1xuICAgICAgaW5pdGlhbENvbHVtbnM6IFsndXNlcicsICd0aW1lUG9saWN5JywgJ3R5cGUnLCAnYW1vdW50JywgJ2VmZmVjdGl2ZUF0J11cbiAgICB9XG4gIH0sXG4gIGFjY2Vzczoge1xuICAgIG9wZXJhdGlvbjoge1xuICAgICAgcXVlcnk6ICh7IHNlc3Npb24gfSkgPT4gaXNBdXRoZW50aWNhdGVkKHsgc2Vzc2lvbiB9KSxcbiAgICAgIGNyZWF0ZTogY2FuRWRpdE9yZ0RhdGEsXG4gICAgICB1cGRhdGU6IGNhbkVkaXRPcmdEYXRhLFxuICAgICAgZGVsZXRlOiBjYW5FZGl0T3JnRGF0YVxuICAgIH0sXG4gICAgZmlsdGVyOiB7XG4gICAgICBxdWVyeTogcG9saWN5U2NvcGVkRmlsdGVyXG4gICAgfVxuICB9LFxuICBob29rczoge1xuICAgIHJlc29sdmVJbnB1dDoge1xuICAgICAgY3JlYXRlOiBhc3luYyAoeyBjb250ZXh0LCByZXNvbHZlZERhdGEgfSkgPT4ge1xuICAgICAgICBjb25zdCBuZXh0RGF0YSA9IHsgLi4ucmVzb2x2ZWREYXRhIH07XG4gICAgICAgIGlmICghbmV4dERhdGEuY3JlYXRlZEJ5KSB7XG4gICAgICAgICAgY29uc3QgdXNlcklkID0gY29udGV4dC5zZXNzaW9uPy5pZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgaWYgKHVzZXJJZCkgbmV4dERhdGEuY3JlYXRlZEJ5ID0geyBjb25uZWN0OiB7IGlkOiB1c2VySWQgfSB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXh0RGF0YTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHZhbGlkYXRlSW5wdXQ6IGFzeW5jICh7IG9wZXJhdGlvbiwgcmVzb2x2ZWREYXRhLCBhZGRWYWxpZGF0aW9uRXJyb3IgfSkgPT4ge1xuICAgICAgaWYgKG9wZXJhdGlvbiAhPT0gJ2NyZWF0ZScpIHJldHVybjtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlc29sdmVkRGF0YS51c2VyPy5jb25uZWN0Py5pZDtcbiAgICAgIGlmICghdXNlcklkKSBhZGRWYWxpZGF0aW9uRXJyb3IoJ1VzZXIgaXMgcmVxdWlyZWQgZm9yIGFsbG9jYXRpb24gZXZlbnRzLicpO1xuICAgICAgY29uc3QgdGltZVBvbGljeUlkID0gcmVzb2x2ZWREYXRhLnRpbWVQb2xpY3k/LmNvbm5lY3Q/LmlkO1xuICAgICAgaWYgKCF0aW1lUG9saWN5SWQpIGFkZFZhbGlkYXRpb25FcnJvcignVGltZSBwb2xpY3kgaXMgcmVxdWlyZWQgZm9yIGFsbG9jYXRpb24gZXZlbnRzLicpO1xuICAgIH1cbiAgfVxufSkgc2F0aXNmaWVzIExpc3RzWydVc2VyQWxsb2NhdGlvbiddO1xuXG5cblxuIl0sIm5hbWVzIjpbImxpc3QiLCJpbnRlZ2VyIiwicmVsYXRpb25zaGlwIiwic2VsZWN0IiwidGV4dCIsInRpbWVzdGFtcCIsImNhbkVkaXRPcmdEYXRhIiwiZmlsdGVyQnlVc2VyT3JnIiwiZmlsdGVyUG9saWNpZXNCeVVzZXJMb2NhdGlvbiIsImlzQXV0aGVudGljYXRlZCIsImlzR29kIiwiaXNMb2NhdGlvbkFkbWluIiwiaXNPcmdBZG1pbiIsInBvbGljeVNjb3BlZEZpbHRlciIsInNlc3Npb24iLCJvcmdGaWx0ZXIiLCJ0aW1lUG9saWN5IiwicG9saWN5RmlsdGVyIiwiZXZlbnRUeXBlT3B0aW9ucyIsImxhYmVsIiwidmFsdWUiLCJmaWVsZHMiLCJ1c2VyIiwicmVmIiwibWFueSIsInRpbWVQb2xpY3lBbGxvY2F0aW9uIiwidHlwZSIsIm9wdGlvbnMiLCJ2YWxpZGF0aW9uIiwiaXNSZXF1aXJlZCIsImVmZmVjdGl2ZUF0IiwiZGVmYXVsdFZhbHVlIiwia2luZCIsImFtb3VudCIsIm5vdGVzIiwiY3JlYXRlZEF0IiwidWkiLCJpdGVtVmlldyIsImZpZWxkTW9kZSIsImxpc3RWaWV3IiwiY3JlYXRlZEJ5IiwiaGlkZUNyZWF0ZSIsImxhYmVsRmllbGQiLCJpbml0aWFsQ29sdW1ucyIsImFjY2VzcyIsIm9wZXJhdGlvbiIsInF1ZXJ5IiwiY3JlYXRlIiwidXBkYXRlIiwiZGVsZXRlIiwiZmlsdGVyIiwiaG9va3MiLCJyZXNvbHZlSW5wdXQiLCJjb250ZXh0IiwicmVzb2x2ZWREYXRhIiwibmV4dERhdGEiLCJ1c2VySWQiLCJpZCIsImNvbm5lY3QiLCJ2YWxpZGF0ZUlucHV0IiwiYWRkVmFsaWRhdGlvbkVycm9yIiwidGltZVBvbGljeUlkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/UserAllocation.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/Allocations.ts":
/*!***********************************************!*\
  !*** ../../schemas/extensions/Allocations.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Allocations: () => (/* binding */ Allocations)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _domains_allowance__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../domains/allowance */ \"(api)/../../domains/allowance/index.ts\");\n/* harmony import */ var _domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../domains/allowance/utils */ \"(api)/../../domains/allowance/utils.ts\");\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\n\nconst toIsoString = (value)=>{\n    if (!value) return null;\n    const date = value instanceof Date ? value : new Date(value);\n    return Number.isNaN(date.getTime()) ? null : date.toISOString();\n};\nconst formatUserName = (user)=>{\n    if (!user) return null;\n    const parts = [\n        user.firstName,\n        user.lastName\n    ].filter(Boolean);\n    if (parts.length === 0) return null;\n    return parts.join(\" \");\n};\nconst sanitizeNumber = (value)=>{\n    const numericValue = typeof value === \"number\" ? value : Number(value);\n    return Number.isFinite(numericValue) ? numericValue : 0;\n};\nconst normalizeNotes = (value)=>value?.trim() ?? \"\";\nconst timePolicyAllocationHistorySelection = \"id allocation carryoverLimit overdraftLimit notes effectiveAt createdAt createdBy { id firstName lastName }\";\nconst userAllocationSelection = \"id type amount effectiveAt createdAt notes createdBy { id firstName lastName } timePolicyAllocation { id effectiveAt }\";\nconst fetchLatestTimePolicyAllocation = async (context, timePolicyId)=>{\n    const history = await context.query.TimePolicyAllocation.findMany({\n        where: {\n            timePolicy: {\n                id: {\n                    equals: timePolicyId\n                }\n            }\n        },\n        orderBy: {\n            effectiveAt: \"desc\"\n        },\n        take: 1,\n        query: timePolicyAllocationHistorySelection\n    });\n    return history[0] ?? null;\n};\nconst fetchTimePolicyAllocationById = async (context, id)=>{\n    return await context.query.TimePolicyAllocation.findOne({\n        where: {\n            id\n        },\n        query: timePolicyAllocationHistorySelection\n    });\n};\nconst fetchUserAllocationById = async (context, id)=>{\n    return await context.query.UserAllocation.findOne({\n        where: {\n            id\n        },\n        query: userAllocationSelection\n    });\n};\nconst assertCanAccessTimePolicy = async (context, session, timePolicyId)=>{\n    const timePolicy = await context.query.TimePolicy.findOne({\n        where: {\n            id: timePolicyId\n        },\n        query: \"id org { id } isAllocationManaged\"\n    });\n    if (!timePolicy) throw new Error(\"Time policy not found\");\n    if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isGod)({\n        session\n    })) return timePolicy;\n    if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isAnyAdmin)({\n        session\n    })) throw new Error(\"Forbidden\");\n    if (!session?.orgId || timePolicy.org?.id !== session.orgId) throw new Error(\"Forbidden\");\n    return timePolicy;\n};\nconst assertCanAccessUser = async (context, session, userId)=>{\n    const user = await context.query.User.findOne({\n        where: {\n            id: userId\n        },\n        query: \"id org { id }\"\n    });\n    if (!user) throw new Error(\"User not found\");\n    if (session?.id === userId) return user;\n    if ((0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isGod)({\n        session\n    })) return user;\n    if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isAnyAdmin)({\n        session\n    })) throw new Error(\"Forbidden\");\n    if (!session?.orgId || user.org?.id !== session.orgId) throw new Error(\"Forbidden\");\n    return user;\n};\nconst Allocations = (base)=>{\n    const TimePolicyAllocationRulesInput = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.inputObject({\n        name: \"TimePolicyAllocationRulesInput\",\n        fields: ()=>({\n                allocation: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int)\n                }),\n                carryoverLimit: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int)\n                }),\n                overdraftLimit: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int)\n                }),\n                notes: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                effectiveAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                })\n            })\n    });\n    const TimePolicyMutationInputType = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.inputObject({\n        name: \"TimePolicyMutationInput\",\n        fields: ()=>({\n                name: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                timeTypeId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID\n                }),\n                locationIds: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID))\n                }),\n                isAllocationManaged: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean\n                })\n            })\n    });\n    const TimePolicyAllocationHistoryEntry = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"TimePolicyAllocationHistoryEntry\",\n        fields: {\n            id: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID),\n                resolve: (item)=>item.id\n            }),\n            effectiveAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>toIsoString(item.effectiveAt)\n            }),\n            allocation: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.allocation ?? 0\n            }),\n            carryoverLimit: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.carryoverLimit ?? 0\n            }),\n            overdraftLimit: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.overdraftLimit ?? 0\n            }),\n            notes: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>item.notes ?? \"\"\n            }),\n            createdAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>toIsoString(item.createdAt ?? null)\n            }),\n            createdBy: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>formatUserName(item.createdBy)\n            })\n        }\n    });\n    const UserAllocationEntry = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"UserAllocationEntry\",\n        fields: {\n            id: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID),\n                resolve: (item)=>item.id\n            }),\n            type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (item)=>item.type\n            }),\n            amount: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.amount\n            }),\n            effectiveAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (item)=>item.effectiveAt\n            }),\n            createdAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>item.createdAt ?? null\n            }),\n            notes: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>item.notes ?? null\n            }),\n            createdBy: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String,\n                resolve: (item)=>formatUserName(item.createdBy)\n            }),\n            timePolicyAllocationId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID,\n                resolve: (item)=>item.timePolicyAllocation?.id ?? null\n            })\n        }\n    });\n    const AllocationBreakdownSegment = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"AllocationBreakdownSegment\",\n        fields: {\n            timePolicyAllocationId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID),\n                resolve: (item)=>item.timePolicyAllocationId\n            }),\n            effectiveAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (item)=>item.effectiveAt\n            }),\n            from: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (item)=>item.from\n            }),\n            to: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (item)=>item.to\n            }),\n            daysInSegment: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.daysInSegment\n            }),\n            portionOfPeriod: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.portionOfPeriod\n            }),\n            allocationRate: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.allocationRate\n            }),\n            contribution: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.contribution\n            })\n        }\n    });\n    const UserAllocationBalance = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"UserAllocationBalance\",\n        fields: {\n            year: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int),\n                resolve: (item)=>item.year\n            }),\n            base: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.base\n            }),\n            carryoverIn: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.carryoverIn\n            }),\n            manualAdjustments: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.manualAdjustments\n            }),\n            retroAdjustments: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.retroAdjustments\n            }),\n            used: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.used\n            }),\n            available: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.available\n            }),\n            timePolicyAllocationId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID,\n                resolve: (item)=>item.timePolicyAllocation?.id ?? null\n            }),\n            allocationRate: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float,\n                resolve: (item)=>item.timePolicyAllocation?.allocation ?? null\n            }),\n            carryoverLimit: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float,\n                resolve: (item)=>item.timePolicyAllocation?.carryoverLimit ?? null\n            }),\n            overdraftLimit: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float,\n                resolve: (item)=>item.timePolicyAllocation?.overdraftLimit ?? null\n            }),\n            breakdown: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(AllocationBreakdownSegment)),\n                resolve: (item)=>item.breakdown\n            })\n        }\n    });\n    const upsertTimePolicyAllocationRules = async ({ context, timePolicyId, allocationConfig, session })=>{\n        if (!allocationConfig) return null;\n        const timePolicy = await context.query.TimePolicy.findOne({\n            where: {\n                id: timePolicyId\n            },\n            query: \"id isAllocationManaged\"\n        });\n        if (!timePolicy?.isAllocationManaged) return null;\n        const normalizedAllocation = sanitizeNumber(allocationConfig.allocation);\n        const normalizedCarryover = sanitizeNumber(allocationConfig.carryoverLimit);\n        const normalizedOverdraft = sanitizeNumber(allocationConfig.overdraftLimit);\n        const normalizedNotes = normalizeNotes(allocationConfig.notes);\n        const latest = await fetchLatestTimePolicyAllocation(context, timePolicyId);\n        const shouldCreate = !latest || sanitizeNumber(latest.allocation) !== normalizedAllocation || sanitizeNumber(latest.carryoverLimit) !== normalizedCarryover || sanitizeNumber(latest.overdraftLimit) !== normalizedOverdraft || normalizeNotes(latest.notes) !== normalizedNotes;\n        if (!shouldCreate) return latest;\n        const createdBy = session?.id ? {\n            connect: {\n                id: String(session.id)\n            }\n        } : undefined;\n        const effectiveAtIso = allocationConfig.effectiveAt ? (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(allocationConfig.effectiveAt).toISOString() : new Date().toISOString();\n        const created = await context.db.TimePolicyAllocation.createOne({\n            data: {\n                timePolicy: {\n                    connect: {\n                        id: timePolicyId\n                    }\n                },\n                allocation: normalizedAllocation,\n                carryoverLimit: normalizedCarryover,\n                overdraftLimit: normalizedOverdraft,\n                notes: normalizedNotes || undefined,\n                effectiveAt: effectiveAtIso,\n                createdBy\n            }\n        });\n        return fetchTimePolicyAllocationById(context, created.id);\n    };\n    const buildTimePolicyData = (input, { isUpdate })=>{\n        if (!input) return {};\n        const next = {};\n        if (typeof input.name === \"string\") {\n            const trimmed = input.name.trim();\n            if (trimmed.length) next.name = trimmed;\n        }\n        if (typeof input.isAllocationManaged === \"boolean\") {\n            next.isAllocationManaged = input.isAllocationManaged;\n        }\n        if (input.timeTypeId) {\n            next.timeType = {\n                connect: {\n                    id: input.timeTypeId\n                }\n            };\n        }\n        if (Array.isArray(input.locationIds)) {\n            const nodes = input.locationIds.filter(Boolean).map((id)=>({\n                    id\n                }));\n            next.locations = isUpdate ? {\n                set: nodes\n            } : {\n                connect: nodes\n            };\n        }\n        return next;\n    };\n    return {\n        query: {\n            timePolicyAllocationHistory: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePolicyAllocationHistoryEntry)),\n                args: {\n                    timePolicyId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    })\n                },\n                async resolve (source, { timePolicyId }, context) {\n                    const session = context.session;\n                    await assertCanAccessTimePolicy(context, session, timePolicyId);\n                    const items = await context.query.TimePolicyAllocation.findMany({\n                        where: {\n                            timePolicy: {\n                                id: {\n                                    equals: timePolicyId\n                                }\n                            }\n                        },\n                        orderBy: {\n                            effectiveAt: \"desc\"\n                        },\n                        query: \"id effectiveAt allocation carryoverLimit overdraftLimit notes createdAt createdBy { id firstName lastName }\"\n                    });\n                    return items;\n                }\n            }),\n            userAllocationEventLog: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(UserAllocationEntry)),\n                args: {\n                    userId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    timePolicyId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    year: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int\n                    })\n                },\n                async resolve (source, { userId, timePolicyId, year }, context) {\n                    const session = context.session;\n                    const user = await assertCanAccessUser(context, session, userId);\n                    const timePolicy = await assertCanAccessTimePolicy(context, session, timePolicyId);\n                    if (timePolicy.org?.id && user.org?.id && timePolicy.org.id !== user.org.id) {\n                        throw new Error(\"Time policy does not belong to the same organization as user.\");\n                    }\n                    const where = {\n                        user: {\n                            id: {\n                                equals: userId\n                            }\n                        },\n                        timePolicy: {\n                            id: {\n                                equals: timePolicyId\n                            }\n                        }\n                    };\n                    if (year != null) {\n                        const { start, end } = (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.getYearBounds)(year);\n                        where.effectiveAt = {\n                            gte: start.toISOString(),\n                            lt: end.toISOString()\n                        };\n                    }\n                    const events = await context.query.UserAllocation.findMany({\n                        where,\n                        orderBy: {\n                            effectiveAt: \"desc\"\n                        },\n                        query: \"id type amount effectiveAt createdAt notes createdBy { id firstName lastName } timePolicyAllocation { id effectiveAt }\"\n                    });\n                    return events.map((event)=>({\n                            ...event,\n                            effectiveAt: (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(event.effectiveAt).toISOString(),\n                            createdAt: event.createdAt ? (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(event.createdAt).toISOString() : null,\n                            timePolicyAllocation: event.timePolicyAllocation ? {\n                                id: event.timePolicyAllocation.id,\n                                effectiveAt: (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(event.timePolicyAllocation.effectiveAt).toISOString()\n                            } : null\n                        }));\n                }\n            }),\n            userAllocationBalance: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: UserAllocationBalance,\n                args: {\n                    userId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    timePolicyId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    year: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int)\n                    })\n                },\n                async resolve (source, { userId, timePolicyId, year }, context) {\n                    const session = context.session;\n                    const user = await assertCanAccessUser(context, session, userId);\n                    const timePolicy = await assertCanAccessTimePolicy(context, session, timePolicyId);\n                    if (timePolicy.org?.id && user.org?.id && timePolicy.org.id !== user.org.id) {\n                        throw new Error(\"Time policy does not belong to the same organization as user.\");\n                    }\n                    const targetYear = year;\n                    await (0,_domains_allowance__WEBPACK_IMPORTED_MODULE_1__.ensureCarryoverUpToYear)({\n                        context,\n                        userId: userId,\n                        timePolicyId: timePolicyId,\n                        targetYear\n                    });\n                    const sudo = context.sudo();\n                    const userStartDate = await (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.getUserStartDate)(sudo, userId);\n                    const period = (0,_domains_allowance__WEBPACK_IMPORTED_MODULE_1__.createYearPeriod)(targetYear);\n                    const baseResult = await (0,_domains_allowance__WEBPACK_IMPORTED_MODULE_1__.calculateBaseAllocationForTimePolicy)({\n                        context: sudo,\n                        timePolicyId: timePolicyId,\n                        period,\n                        userStartDate\n                    });\n                    const { start, end } = (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.getYearBounds)(targetYear);\n                    const carryoverIn = await (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.sumAdjustmentEvents)({\n                        context: sudo,\n                        userId: userId,\n                        timePolicyId: timePolicyId,\n                        start,\n                        end,\n                        types: [\n                            \"CARRYOVER_IN\"\n                        ]\n                    });\n                    const manualAdjustments = await (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.sumAdjustmentEvents)({\n                        context: sudo,\n                        userId: userId,\n                        timePolicyId: timePolicyId,\n                        start,\n                        end,\n                        types: [\n                            \"MANUAL\"\n                        ]\n                    });\n                    const retroAdjustments = await (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.sumAdjustmentEvents)({\n                        context: sudo,\n                        userId: userId,\n                        timePolicyId: timePolicyId,\n                        start,\n                        end,\n                        types: [\n                            \"POLICY_CHANGE_RETRO\"\n                        ]\n                    });\n                    const used = await (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.sumUsageForYear)({\n                        context: sudo,\n                        userId: userId,\n                        timePolicyId: timePolicyId,\n                        start,\n                        end\n                    });\n                    const available = baseResult.amount + carryoverIn + manualAdjustments + retroAdjustments - used;\n                    const breakdown = baseResult.breakdown.map((segment)=>({\n                            timePolicyAllocationId: segment.timePolicyAllocationId,\n                            effectiveAt: segment.effectiveAt.toISOString(),\n                            from: segment.from.toISOString(),\n                            to: segment.to.toISOString(),\n                            daysInSegment: segment.daysInSegment,\n                            portionOfPeriod: segment.portionOfPeriod,\n                            allocationRate: segment.allocationRate,\n                            contribution: segment.contribution\n                        }));\n                    return {\n                        year: targetYear,\n                        base: baseResult.amount,\n                        carryoverIn,\n                        manualAdjustments,\n                        retroAdjustments,\n                        used,\n                        available,\n                        timePolicyAllocation: baseResult.activeTimePolicyAllocation ? {\n                            id: baseResult.activeTimePolicyAllocation.id,\n                            allocation: baseResult.activeTimePolicyAllocation.allocation,\n                            carryoverLimit: baseResult.activeTimePolicyAllocation.carryoverLimit,\n                            overdraftLimit: baseResult.activeTimePolicyAllocation.overdraftLimit,\n                            effectiveAt: baseResult.activeTimePolicyAllocation.effectiveAt.toISOString()\n                        } : null,\n                        breakdown\n                    };\n                }\n            })\n        },\n        mutation: {\n            createTimePolicyWithAllocation: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: base.object(\"TimePolicy\"),\n                args: {\n                    data: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePolicyMutationInputType)\n                    }),\n                    allocationConfig: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: TimePolicyAllocationRulesInput\n                    })\n                },\n                async resolve (_, { data, allocationConfig }, context) {\n                    const session = context.session;\n                    if (!(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isGod)({\n                        session\n                    }) && !(0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_3__.isAnyAdmin)({\n                        session\n                    })) throw new Error(\"Forbidden\");\n                    const timePolicyData = buildTimePolicyData(data, {\n                        isUpdate: false\n                    });\n                    const created = await context.db.TimePolicy.createOne({\n                        data: timePolicyData,\n                        query: \"id\"\n                    });\n                    if (!created?.id) return null;\n                    await upsertTimePolicyAllocationRules({\n                        context,\n                        timePolicyId: created.id,\n                        allocationConfig: allocationConfig,\n                        session\n                    });\n                    return context.query.TimePolicy.findOne({\n                        where: {\n                            id: created.id\n                        },\n                        query: \"id\"\n                    });\n                }\n            }),\n            updateTimePolicyWithAllocation: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: base.object(\"TimePolicy\"),\n                args: {\n                    id: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    data: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePolicyMutationInputType)\n                    }),\n                    allocationConfig: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: TimePolicyAllocationRulesInput\n                    })\n                },\n                async resolve (_, { id, data, allocationConfig }, context) {\n                    const session = context.session;\n                    await assertCanAccessTimePolicy(context, session, id);\n                    const timePolicyData = buildTimePolicyData(data, {\n                        isUpdate: true\n                    });\n                    const updated = await context.db.TimePolicy.updateOne({\n                        where: {\n                            id: id\n                        },\n                        data: timePolicyData,\n                        query: \"id\"\n                    });\n                    if (!updated?.id) return null;\n                    await upsertTimePolicyAllocationRules({\n                        context,\n                        timePolicyId: updated.id,\n                        allocationConfig: allocationConfig,\n                        session\n                    });\n                    return context.query.TimePolicy.findOne({\n                        where: {\n                            id: updated.id\n                        },\n                        query: \"id\"\n                    });\n                }\n            }),\n            createManualAllocationAdjustment: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: UserAllocationEntry,\n                args: {\n                    userId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    timePolicyId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    amount: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int)\n                    }),\n                    effectiveAt: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    }),\n                    notes: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                    })\n                },\n                async resolve (source, args, context) {\n                    const { userId, timePolicyId, amount, effectiveAt, notes } = args;\n                    const session = context.session;\n                    const user = await assertCanAccessUser(context, session, userId);\n                    const timePolicy = await assertCanAccessTimePolicy(context, session, timePolicyId);\n                    if (timePolicy.org?.id && user.org?.id && timePolicy.org.id !== user.org.id) {\n                        throw new Error(\"Time policy does not belong to the same organization as user.\");\n                    }\n                    const createdBy = session?.id ? {\n                        connect: {\n                            id: String(session.id)\n                        }\n                    } : undefined;\n                    const event = await context.db.UserAllocation.createOne({\n                        data: {\n                            user: {\n                                connect: {\n                                    id: userId\n                                }\n                            },\n                            timePolicy: {\n                                connect: {\n                                    id: timePolicyId\n                                }\n                            },\n                            type: \"MANUAL\",\n                            amount: sanitizeNumber(amount),\n                            effectiveAt: (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(effectiveAt).toISOString(),\n                            notes: normalizeNotes(notes) || undefined,\n                            createdBy\n                        }\n                    });\n                    const fullEvent = await fetchUserAllocationById(context, event.id);\n                    if (!fullEvent) return null;\n                    return {\n                        ...fullEvent,\n                        effectiveAt: (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(fullEvent.effectiveAt).toISOString(),\n                        createdAt: fullEvent.createdAt ? (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(fullEvent.createdAt).toISOString() : null,\n                        timePolicyAllocation: fullEvent.timePolicyAllocation ? {\n                            id: fullEvent.timePolicyAllocation.id,\n                            effectiveAt: fullEvent.timePolicyAllocation.effectiveAt ? (0,_domains_allowance_utils__WEBPACK_IMPORTED_MODULE_2__.toDate)(fullEvent.timePolicyAllocation.effectiveAt).toISOString() : null\n                        } : null\n                    };\n                }\n            })\n        }\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL0FsbG9jYXRpb25zLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNnRDtBQUcwRTtBQU9uRjtBQUN5QjtBQXFCaEUsTUFBTVksY0FBYyxDQUFDQztJQUNuQixJQUFJLENBQUNBLE9BQU8sT0FBTztJQUNuQixNQUFNQyxPQUFPRCxpQkFBaUJFLE9BQU9GLFFBQVEsSUFBSUUsS0FBS0Y7SUFDdEQsT0FBT0csT0FBT0MsS0FBSyxDQUFDSCxLQUFLSSxPQUFPLE1BQU0sT0FBT0osS0FBS0ssV0FBVztBQUMvRDtBQStCQSxNQUFNQyxpQkFBaUIsQ0FBQ0M7SUFDdEIsSUFBSSxDQUFDQSxNQUFNLE9BQU87SUFDbEIsTUFBTUMsUUFBUTtRQUFDRCxLQUFLRSxTQUFTO1FBQUVGLEtBQUtHLFFBQVE7S0FBQyxDQUFDQyxNQUFNLENBQUNDO0lBQ3JELElBQUlKLE1BQU1LLE1BQU0sS0FBSyxHQUFHLE9BQU87SUFDL0IsT0FBT0wsTUFBTU0sSUFBSSxDQUFDO0FBQ3BCO0FBRUEsTUFBTUMsaUJBQWlCLENBQUNoQjtJQUN0QixNQUFNaUIsZUFBZSxPQUFPakIsVUFBVSxXQUFXQSxRQUFRRyxPQUFPSDtJQUNoRSxPQUFPRyxPQUFPZSxRQUFRLENBQUNELGdCQUFnQkEsZUFBZTtBQUN4RDtBQUVBLE1BQU1FLGlCQUFpQixDQUFDbkIsUUFBMEJBLE9BQU9vQixVQUFVO0FBVW5FLE1BQU1DLHVDQUNKO0FBRUYsTUFBTUMsMEJBQ0o7QUFFRixNQUFNQyxrQ0FBa0MsT0FBT0MsU0FBb0NDO0lBQ2pGLE1BQU1DLFVBQVcsTUFBTUYsUUFBUUcsS0FBSyxDQUFDQyxvQkFBb0IsQ0FBQ0MsUUFBUSxDQUFDO1FBQ2pFQyxPQUFPO1lBQUVDLFlBQVk7Z0JBQUVDLElBQUk7b0JBQUVDLFFBQVFSO2dCQUFhO1lBQUU7UUFBRTtRQUN0RFMsU0FBUztZQUFFQyxhQUFhO1FBQU87UUFDL0JDLE1BQU07UUFDTlQsT0FBT047SUFDVDtJQUVBLE9B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SixVQUFVNUUsU0FBUyxFQUFFdkUsV0FBVyxLQUFLO3dCQUM3RTRFLHNCQUFzQnVFLFVBQVV2RSxvQkFBb0IsR0FDaEQ7NEJBQ0VsRCxJQUFJeUgsVUFBVXZFLG9CQUFvQixDQUFDbEQsRUFBRTs0QkFDckNHLGFBQWFzSCxVQUFVdkUsb0JBQW9CLENBQUMvQyxXQUFXLEdBQ25EdkMsZ0VBQU1BLENBQUM2SixVQUFVdkUsb0JBQW9CLENBQUMvQyxXQUFXLEVBQUU3QixXQUFXLEtBQzlEO3dCQUNOLElBQ0E7b0JBQ047Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3NjaGVtYXMvZXh0ZW5zaW9ucy9BbGxvY2F0aW9ucy50cz8yZTdlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVHlwZUluZm8gfSBmcm9tICcua2V5c3RvbmUvdHlwZXMnO1xuaW1wb3J0IHsgZ3JhcGhxbCBhcyBnIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgdHlwZSB7IEJhc2VTY2hlbWFNZXRhIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS9kaXN0L2RlY2xhcmF0aW9ucy9zcmMvdHlwZXMvc2NoZW1hL2dyYXBocWwtdHMtc2NoZW1hJztcbmltcG9ydCB7IFNlc3Npb24gfSBmcm9tICdhdXRoJztcbmltcG9ydCB7IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uRm9yVGltZVBvbGljeSwgY3JlYXRlWWVhclBlcmlvZCwgZW5zdXJlQ2FycnlvdmVyVXBUb1llYXIgfSBmcm9tICcuLi8uLi9kb21haW5zL2FsbG93YW5jZSc7XG5pbXBvcnQge1xuICBnZXRVc2VyU3RhcnREYXRlLFxuICBnZXRZZWFyQm91bmRzLFxuICBzdW1BZGp1c3RtZW50RXZlbnRzLFxuICBzdW1Vc2FnZUZvclllYXIsXG4gIHRvRGF0ZVxufSBmcm9tICcuLi8uLi9kb21haW5zL2FsbG93YW5jZS91dGlscyc7XG5pbXBvcnQgeyBpc0FueUFkbWluLCBpc0dvZCB9IGZyb20gJy4uLy4uL2RvbWFpbnMvYXV0aC91c2VyUm9sZSc7XG5cbnR5cGUgVGltZVBvbGljeUl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVGltZVBvbGljeSddWydpdGVtJ107XG50eXBlIFRpbWVQb2xpY3lBbGxvY2F0aW9uSXRlbSA9IFR5cGVJbmZvWydsaXN0cyddWydUaW1lUG9saWN5QWxsb2NhdGlvbiddWydpdGVtJ107XG50eXBlIFVzZXJJdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ1VzZXInXVsnaXRlbSddO1xuXG50eXBlIFRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeU5vZGUgPSBUaW1lUG9saWN5QWxsb2NhdGlvbkl0ZW0gJiB7XG4gIGNyZWF0ZWRCeT86IHsgaWQ6IHN0cmluZzsgZmlyc3ROYW1lPzogc3RyaW5nIHwgbnVsbDsgbGFzdE5hbWU/OiBzdHJpbmcgfCBudWxsIH0gfCBudWxsO1xufTtcblxudHlwZSBVc2VyQWxsb2NhdGlvbk5vZGUgPSB7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbiAgYW1vdW50OiBudW1iZXI7XG4gIGVmZmVjdGl2ZUF0OiBzdHJpbmc7XG4gIGNyZWF0ZWRBdD86IHN0cmluZyB8IG51bGw7XG4gIG5vdGVzPzogc3RyaW5nIHwgbnVsbDtcbiAgY3JlYXRlZEJ5PzogeyBpZDogc3RyaW5nOyBmaXJzdE5hbWU/OiBzdHJpbmcgfCBudWxsOyBsYXN0TmFtZT86IHN0cmluZyB8IG51bGwgfSB8IG51bGw7XG4gIHRpbWVQb2xpY3lBbGxvY2F0aW9uPzogeyBpZDogc3RyaW5nOyBlZmZlY3RpdmVBdD86IHN0cmluZyB8IG51bGwgfSB8IG51bGw7XG59O1xuXG5jb25zdCB0b0lzb1N0cmluZyA9ICh2YWx1ZT86IHN0cmluZyB8IERhdGUgfCBudWxsKSA9PiB7XG4gIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICBjb25zdCBkYXRlID0gdmFsdWUgaW5zdGFuY2VvZiBEYXRlID8gdmFsdWUgOiBuZXcgRGF0ZSh2YWx1ZSk7XG4gIHJldHVybiBOdW1iZXIuaXNOYU4oZGF0ZS5nZXRUaW1lKCkpID8gbnVsbCA6IGRhdGUudG9JU09TdHJpbmcoKTtcbn07XG5cbnR5cGUgQWxsb2NhdGlvbkJyZWFrZG93blNlZ21lbnROb2RlID0ge1xuICB0aW1lUG9saWN5QWxsb2NhdGlvbklkOiBzdHJpbmc7XG4gIGVmZmVjdGl2ZUF0OiBzdHJpbmc7XG4gIGZyb206IHN0cmluZztcbiAgdG86IHN0cmluZztcbiAgZGF5c0luU2VnbWVudDogbnVtYmVyO1xuICBwb3J0aW9uT2ZQZXJpb2Q6IG51bWJlcjtcbiAgYWxsb2NhdGlvblJhdGU6IG51bWJlcjtcbiAgY29udHJpYnV0aW9uOiBudW1iZXI7XG59O1xuXG50eXBlIFVzZXJBbGxvY2F0aW9uQmFsYW5jZU5vZGUgPSB7XG4gIHllYXI6IG51bWJlcjtcbiAgYmFzZTogbnVtYmVyO1xuICBjYXJyeW92ZXJJbjogbnVtYmVyO1xuICBtYW51YWxBZGp1c3RtZW50czogbnVtYmVyO1xuICByZXRyb0FkanVzdG1lbnRzOiBudW1iZXI7XG4gIHVzZWQ6IG51bWJlcjtcbiAgYXZhaWxhYmxlOiBudW1iZXI7XG4gIHRpbWVQb2xpY3lBbGxvY2F0aW9uPzoge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgYWxsb2NhdGlvbjogbnVtYmVyO1xuICAgIGNhcnJ5b3ZlckxpbWl0OiBudW1iZXI7XG4gICAgb3ZlcmRyYWZ0TGltaXQ6IG51bWJlcjtcbiAgICBlZmZlY3RpdmVBdDogc3RyaW5nO1xuICB9IHwgbnVsbDtcbiAgYnJlYWtkb3duOiBBbGxvY2F0aW9uQnJlYWtkb3duU2VnbWVudE5vZGVbXTtcbn07XG5cbmNvbnN0IGZvcm1hdFVzZXJOYW1lID0gKHVzZXI/OiB7IGZpcnN0TmFtZT86IHN0cmluZyB8IG51bGw7IGxhc3ROYW1lPzogc3RyaW5nIHwgbnVsbCB9KSA9PiB7XG4gIGlmICghdXNlcikgcmV0dXJuIG51bGw7XG4gIGNvbnN0IHBhcnRzID0gW3VzZXIuZmlyc3ROYW1lLCB1c2VyLmxhc3ROYW1lXS5maWx0ZXIoQm9vbGVhbik7XG4gIGlmIChwYXJ0cy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xuICByZXR1cm4gcGFydHMuam9pbignICcpO1xufTtcblxuY29uc3Qgc2FuaXRpemVOdW1iZXIgPSAodmFsdWU/OiBudW1iZXIgfCBudWxsKSA9PiB7XG4gIGNvbnN0IG51bWVyaWNWYWx1ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgPyB2YWx1ZSA6IE51bWJlcih2YWx1ZSk7XG4gIHJldHVybiBOdW1iZXIuaXNGaW5pdGUobnVtZXJpY1ZhbHVlKSA/IG51bWVyaWNWYWx1ZSA6IDA7XG59O1xuXG5jb25zdCBub3JtYWxpemVOb3RlcyA9ICh2YWx1ZT86IHN0cmluZyB8IG51bGwpID0+IHZhbHVlPy50cmltKCkgPz8gJyc7XG5cbnR5cGUgVGltZVBvbGljeUFsbG9jYXRpb25SdWxlc0lucHV0VmFsdWUgPSB7XG4gIGFsbG9jYXRpb246IG51bWJlcjtcbiAgY2FycnlvdmVyTGltaXQ6IG51bWJlcjtcbiAgb3ZlcmRyYWZ0TGltaXQ6IG51bWJlcjtcbiAgbm90ZXM/OiBzdHJpbmcgfCBudWxsO1xuICBlZmZlY3RpdmVBdD86IHN0cmluZyB8IERhdGUgfCBudWxsO1xufTtcblxuY29uc3QgdGltZVBvbGljeUFsbG9jYXRpb25IaXN0b3J5U2VsZWN0aW9uID1cbiAgJ2lkIGFsbG9jYXRpb24gY2FycnlvdmVyTGltaXQgb3ZlcmRyYWZ0TGltaXQgbm90ZXMgZWZmZWN0aXZlQXQgY3JlYXRlZEF0IGNyZWF0ZWRCeSB7IGlkIGZpcnN0TmFtZSBsYXN0TmFtZSB9JztcblxuY29uc3QgdXNlckFsbG9jYXRpb25TZWxlY3Rpb24gPVxuICAnaWQgdHlwZSBhbW91bnQgZWZmZWN0aXZlQXQgY3JlYXRlZEF0IG5vdGVzIGNyZWF0ZWRCeSB7IGlkIGZpcnN0TmFtZSBsYXN0TmFtZSB9IHRpbWVQb2xpY3lBbGxvY2F0aW9uIHsgaWQgZWZmZWN0aXZlQXQgfSc7XG5cbmNvbnN0IGZldGNoTGF0ZXN0VGltZVBvbGljeUFsbG9jYXRpb24gPSBhc3luYyAoY29udGV4dDogQmFzZVNjaGVtYU1ldGFbJ2NvbnRleHQnXSwgdGltZVBvbGljeUlkOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgaGlzdG9yeSA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQb2xpY3lBbGxvY2F0aW9uLmZpbmRNYW55KHtcbiAgICB3aGVyZTogeyB0aW1lUG9saWN5OiB7IGlkOiB7IGVxdWFsczogdGltZVBvbGljeUlkIH0gfSB9LFxuICAgIG9yZGVyQnk6IHsgZWZmZWN0aXZlQXQ6ICdkZXNjJyB9LFxuICAgIHRha2U6IDEsXG4gICAgcXVlcnk6IHRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeVNlbGVjdGlvblxuICB9KSkgYXMgVGltZVBvbGljeUFsbG9jYXRpb25IaXN0b3J5Tm9kZVtdO1xuXG4gIHJldHVybiBoaXN0b3J5WzBdID8/IG51bGw7XG59O1xuXG5jb25zdCBmZXRjaFRpbWVQb2xpY3lBbGxvY2F0aW9uQnlJZCA9IGFzeW5jIChjb250ZXh0OiBCYXNlU2NoZW1hTWV0YVsnY29udGV4dCddLCBpZDogc3RyaW5nKSA9PiB7XG4gIHJldHVybiAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUG9saWN5QWxsb2NhdGlvbi5maW5kT25lKHtcbiAgICB3aGVyZTogeyBpZCB9LFxuICAgIHF1ZXJ5OiB0aW1lUG9saWN5QWxsb2NhdGlvbkhpc3RvcnlTZWxlY3Rpb25cbiAgfSkpIGFzIFRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeU5vZGUgfCBudWxsO1xufTtcblxuY29uc3QgZmV0Y2hVc2VyQWxsb2NhdGlvbkJ5SWQgPSBhc3luYyAoY29udGV4dDogQmFzZVNjaGVtYU1ldGFbJ2NvbnRleHQnXSwgaWQ6IHN0cmluZykgPT4ge1xuICByZXR1cm4gKGF3YWl0IGNvbnRleHQucXVlcnkuVXNlckFsbG9jYXRpb24uZmluZE9uZSh7XG4gICAgd2hlcmU6IHsgaWQgfSxcbiAgICBxdWVyeTogdXNlckFsbG9jYXRpb25TZWxlY3Rpb25cbiAgfSkpIGFzIChVc2VyQWxsb2NhdGlvbk5vZGUgJiB7IHRpbWVQb2xpY3lBbGxvY2F0aW9uPzogeyBpZDogc3RyaW5nOyBlZmZlY3RpdmVBdD86IHN0cmluZyB8IERhdGUgfCBudWxsIH0gfCBudWxsIH0pIHwgbnVsbDtcbn07XG5cbmNvbnN0IGFzc2VydENhbkFjY2Vzc1RpbWVQb2xpY3kgPSBhc3luYyAoY29udGV4dDogQmFzZVNjaGVtYU1ldGFbJ2NvbnRleHQnXSwgc2Vzc2lvbjogU2Vzc2lvbiB8IG51bGwsIHRpbWVQb2xpY3lJZDogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHRpbWVQb2xpY3kgPSAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUG9saWN5LmZpbmRPbmUoe1xuICAgIHdoZXJlOiB7IGlkOiB0aW1lUG9saWN5SWQgfSxcbiAgICBxdWVyeTogJ2lkIG9yZyB7IGlkIH0gaXNBbGxvY2F0aW9uTWFuYWdlZCdcbiAgfSkpIGFzIChQaWNrPFRpbWVQb2xpY3lJdGVtLCAnaWQnIHwgJ2lzQWxsb2NhdGlvbk1hbmFnZWQnPiAmIHsgb3JnOiB7IGlkOiBzdHJpbmcgfSB8IG51bGwgfSkgfCBudWxsO1xuICBpZiAoIXRpbWVQb2xpY3kpIHRocm93IG5ldyBFcnJvcignVGltZSBwb2xpY3kgbm90IGZvdW5kJyk7XG4gIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB0aW1lUG9saWN5O1xuICBpZiAoIWlzQW55QWRtaW4oeyBzZXNzaW9uIH0pKSB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuICBpZiAoIXNlc3Npb24/Lm9yZ0lkIHx8IHRpbWVQb2xpY3kub3JnPy5pZCAhPT0gc2Vzc2lvbi5vcmdJZCkgdGhyb3cgbmV3IEVycm9yKCdGb3JiaWRkZW4nKTtcbiAgcmV0dXJuIHRpbWVQb2xpY3k7XG59O1xuXG5jb25zdCBhc3NlcnRDYW5BY2Nlc3NVc2VyID0gYXN5bmMgKGNvbnRleHQ6IEJhc2VTY2hlbWFNZXRhWydjb250ZXh0J10sIHNlc3Npb246IFNlc3Npb24gfCBudWxsLCB1c2VySWQ6IHN0cmluZykgPT4ge1xuICBjb25zdCB1c2VyID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVXNlci5maW5kT25lKHtcbiAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgcXVlcnk6ICdpZCBvcmcgeyBpZCB9J1xuICB9KSkgYXMgKFBpY2s8VXNlckl0ZW0sICdpZCc+ICYgeyBvcmc6IHsgaWQ6IHN0cmluZyB9IHwgbnVsbCB9KSB8IG51bGw7XG4gIGlmICghdXNlcikgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBmb3VuZCcpO1xuICBpZiAoc2Vzc2lvbj8uaWQgPT09IHVzZXJJZCkgcmV0dXJuIHVzZXI7XG4gIGlmIChpc0dvZCh7IHNlc3Npb24gfSkpIHJldHVybiB1c2VyO1xuICBpZiAoIWlzQW55QWRtaW4oeyBzZXNzaW9uIH0pKSB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuICBpZiAoIXNlc3Npb24/Lm9yZ0lkIHx8IHVzZXIub3JnPy5pZCAhPT0gc2Vzc2lvbi5vcmdJZCkgdGhyb3cgbmV3IEVycm9yKCdGb3JiaWRkZW4nKTtcbiAgcmV0dXJuIHVzZXI7XG59O1xuXG5leHBvcnQgY29uc3QgQWxsb2NhdGlvbnMgPSAoYmFzZTogQmFzZVNjaGVtYU1ldGEpID0+IHtcbiAgY29uc3QgVGltZVBvbGljeUFsbG9jYXRpb25SdWxlc0lucHV0ID0gZy5pbnB1dE9iamVjdDxUaW1lUG9saWN5QWxsb2NhdGlvblJ1bGVzSW5wdXRWYWx1ZT4oe1xuICAgIG5hbWU6ICdUaW1lUG9saWN5QWxsb2NhdGlvblJ1bGVzSW5wdXQnLFxuICAgIGZpZWxkczogKCkgPT4gKHtcbiAgICAgIGFsbG9jYXRpb246IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSW50KSB9KSxcbiAgICAgIGNhcnJ5b3ZlckxpbWl0OiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLkludCkgfSksXG4gICAgICBvdmVyZHJhZnRMaW1pdDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JbnQpIH0pLFxuICAgICAgbm90ZXM6IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSksXG4gICAgICBlZmZlY3RpdmVBdDogZy5hcmcoeyB0eXBlOiBnLlN0cmluZyB9KVxuICAgIH0pXG4gIH0pO1xuXG4gIHR5cGUgVGltZVBvbGljeU11dGF0aW9uSW5wdXQgPSB7XG4gICAgbmFtZT86IHN0cmluZyB8IG51bGw7XG4gICAgdGltZVR5cGVJZD86IHN0cmluZyB8IG51bGw7XG4gICAgbG9jYXRpb25JZHM/OiBzdHJpbmdbXSB8IG51bGw7XG4gICAgaXNBbGxvY2F0aW9uTWFuYWdlZD86IGJvb2xlYW4gfCBudWxsO1xuICB9O1xuXG4gIGNvbnN0IFRpbWVQb2xpY3lNdXRhdGlvbklucHV0VHlwZSA9IGcuaW5wdXRPYmplY3Q8VGltZVBvbGljeU11dGF0aW9uSW5wdXQ+KHtcbiAgICBuYW1lOiAnVGltZVBvbGljeU11dGF0aW9uSW5wdXQnLFxuICAgIGZpZWxkczogKCkgPT4gKHtcbiAgICAgIG5hbWU6IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSksXG4gICAgICB0aW1lVHlwZUlkOiBnLmFyZyh7IHR5cGU6IGcuSUQgfSksXG4gICAgICBsb2NhdGlvbklkczogZy5hcmcoeyB0eXBlOiBnLmxpc3QoZy5ub25OdWxsKGcuSUQpKSB9KSxcbiAgICAgIGlzQWxsb2NhdGlvbk1hbmFnZWQ6IGcuYXJnKHsgdHlwZTogZy5Cb29sZWFuIH0pXG4gICAgfSlcbiAgfSk7XG5cbiAgY29uc3QgVGltZVBvbGljeUFsbG9jYXRpb25IaXN0b3J5RW50cnkgPSBnLm9iamVjdDxUaW1lUG9saWN5QWxsb2NhdGlvbkhpc3RvcnlOb2RlPigpKHtcbiAgICBuYW1lOiAnVGltZVBvbGljeUFsbG9jYXRpb25IaXN0b3J5RW50cnknLFxuICAgIGZpZWxkczoge1xuICAgICAgaWQ6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCksIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5pZCB9KSxcbiAgICAgIGVmZmVjdGl2ZUF0OiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogZy5TdHJpbmcsXG4gICAgICAgIHJlc29sdmU6IGl0ZW0gPT4gdG9Jc29TdHJpbmcoaXRlbS5lZmZlY3RpdmVBdClcbiAgICAgIH0pLFxuICAgICAgYWxsb2NhdGlvbjogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLmFsbG9jYXRpb24gPz8gMCB9KSxcbiAgICAgIGNhcnJ5b3ZlckxpbWl0OiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuRmxvYXQpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0uY2FycnlvdmVyTGltaXQgPz8gMCB9KSxcbiAgICAgIG92ZXJkcmFmdExpbWl0OiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuRmxvYXQpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0ub3ZlcmRyYWZ0TGltaXQgPz8gMCB9KSxcbiAgICAgIG5vdGVzOiBnLmZpZWxkKHsgdHlwZTogZy5TdHJpbmcsIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5ub3RlcyA/PyAnJyB9KSxcbiAgICAgIGNyZWF0ZWRBdDogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcuU3RyaW5nLFxuICAgICAgICByZXNvbHZlOiBpdGVtID0+IHRvSXNvU3RyaW5nKChpdGVtIGFzIFRpbWVQb2xpY3lBbGxvY2F0aW9uSXRlbSkuY3JlYXRlZEF0ID8/IG51bGwpXG4gICAgICB9KSxcbiAgICAgIGNyZWF0ZWRCeTogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcuU3RyaW5nLFxuICAgICAgICByZXNvbHZlOiBpdGVtID0+IGZvcm1hdFVzZXJOYW1lKGl0ZW0uY3JlYXRlZEJ5IGFzIHsgZmlyc3ROYW1lPzogc3RyaW5nIHwgbnVsbDsgbGFzdE5hbWU/OiBzdHJpbmcgfCBudWxsIH0pXG4gICAgICB9KVxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgVXNlckFsbG9jYXRpb25FbnRyeSA9IGcub2JqZWN0PFVzZXJBbGxvY2F0aW9uTm9kZT4oKSh7XG4gICAgbmFtZTogJ1VzZXJBbGxvY2F0aW9uRW50cnknLFxuICAgIGZpZWxkczoge1xuICAgICAgaWQ6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCksIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5pZCB9KSxcbiAgICAgIHR5cGU6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5TdHJpbmcpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0udHlwZSB9KSxcbiAgICAgIGFtb3VudDogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLmFtb3VudCB9KSxcbiAgICAgIGVmZmVjdGl2ZUF0OiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuU3RyaW5nKSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLmVmZmVjdGl2ZUF0IH0pLFxuICAgICAgY3JlYXRlZEF0OiBnLmZpZWxkKHsgdHlwZTogZy5TdHJpbmcsIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5jcmVhdGVkQXQgPz8gbnVsbCB9KSxcbiAgICAgIG5vdGVzOiBnLmZpZWxkKHsgdHlwZTogZy5TdHJpbmcsIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5ub3RlcyA/PyBudWxsIH0pLFxuICAgICAgY3JlYXRlZEJ5OiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogZy5TdHJpbmcsXG4gICAgICAgIHJlc29sdmU6IGl0ZW0gPT4gZm9ybWF0VXNlck5hbWUoaXRlbS5jcmVhdGVkQnkpXG4gICAgICB9KSxcbiAgICAgIHRpbWVQb2xpY3lBbGxvY2F0aW9uSWQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLklELFxuICAgICAgICByZXNvbHZlOiBpdGVtID0+IGl0ZW0udGltZVBvbGljeUFsbG9jYXRpb24/LmlkID8/IG51bGxcbiAgICAgIH0pXG4gICAgfVxuICB9KTtcblxuICBjb25zdCBBbGxvY2F0aW9uQnJlYWtkb3duU2VnbWVudCA9IGcub2JqZWN0PEFsbG9jYXRpb25CcmVha2Rvd25TZWdtZW50Tm9kZT4oKSh7XG4gICAgbmFtZTogJ0FsbG9jYXRpb25CcmVha2Rvd25TZWdtZW50JyxcbiAgICBmaWVsZHM6IHtcbiAgICAgIHRpbWVQb2xpY3lBbGxvY2F0aW9uSWQ6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCksIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS50aW1lUG9saWN5QWxsb2NhdGlvbklkIH0pLFxuICAgICAgZWZmZWN0aXZlQXQ6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5TdHJpbmcpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0uZWZmZWN0aXZlQXQgfSksXG4gICAgICBmcm9tOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuU3RyaW5nKSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLmZyb20gfSksXG4gICAgICB0bzogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLlN0cmluZyksIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS50byB9KSxcbiAgICAgIGRheXNJblNlZ21lbnQ6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5GbG9hdCksIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5kYXlzSW5TZWdtZW50IH0pLFxuICAgICAgcG9ydGlvbk9mUGVyaW9kOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuRmxvYXQpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0ucG9ydGlvbk9mUGVyaW9kIH0pLFxuICAgICAgYWxsb2NhdGlvblJhdGU6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5GbG9hdCksIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5hbGxvY2F0aW9uUmF0ZSB9KSxcbiAgICAgIGNvbnRyaWJ1dGlvbjogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLmNvbnRyaWJ1dGlvbiB9KVxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgVXNlckFsbG9jYXRpb25CYWxhbmNlID0gZy5vYmplY3Q8VXNlckFsbG9jYXRpb25CYWxhbmNlTm9kZT4oKSh7XG4gICAgbmFtZTogJ1VzZXJBbGxvY2F0aW9uQmFsYW5jZScsXG4gICAgZmllbGRzOiB7XG4gICAgICB5ZWFyOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuSW50KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLnllYXIgfSksXG4gICAgICBiYXNlOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuRmxvYXQpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0uYmFzZSB9KSxcbiAgICAgIGNhcnJ5b3ZlckluOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuRmxvYXQpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0uY2FycnlvdmVySW4gfSksXG4gICAgICBtYW51YWxBZGp1c3RtZW50czogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLm1hbnVhbEFkanVzdG1lbnRzIH0pLFxuICAgICAgcmV0cm9BZGp1c3RtZW50czogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLnJldHJvQWRqdXN0bWVudHMgfSksXG4gICAgICB1c2VkOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuRmxvYXQpLCByZXNvbHZlOiBpdGVtID0+IGl0ZW0udXNlZCB9KSxcbiAgICAgIGF2YWlsYWJsZTogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSwgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLmF2YWlsYWJsZSB9KSxcbiAgICAgIHRpbWVQb2xpY3lBbGxvY2F0aW9uSWQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLklELFxuICAgICAgICByZXNvbHZlOiBpdGVtID0+IGl0ZW0udGltZVBvbGljeUFsbG9jYXRpb24/LmlkID8/IG51bGxcbiAgICAgIH0pLFxuICAgICAgYWxsb2NhdGlvblJhdGU6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLkZsb2F0LFxuICAgICAgICByZXNvbHZlOiBpdGVtID0+IGl0ZW0udGltZVBvbGljeUFsbG9jYXRpb24/LmFsbG9jYXRpb24gPz8gbnVsbFxuICAgICAgfSksXG4gICAgICBjYXJyeW92ZXJMaW1pdDogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcuRmxvYXQsXG4gICAgICAgIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS50aW1lUG9saWN5QWxsb2NhdGlvbj8uY2FycnlvdmVyTGltaXQgPz8gbnVsbFxuICAgICAgfSksXG4gICAgICBvdmVyZHJhZnRMaW1pdDogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcuRmxvYXQsXG4gICAgICAgIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS50aW1lUG9saWN5QWxsb2NhdGlvbj8ub3ZlcmRyYWZ0TGltaXQgPz8gbnVsbFxuICAgICAgfSksXG4gICAgICBicmVha2Rvd246IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLmxpc3QoZy5ub25OdWxsKEFsbG9jYXRpb25CcmVha2Rvd25TZWdtZW50KSksXG4gICAgICAgIHJlc29sdmU6IGl0ZW0gPT4gaXRlbS5icmVha2Rvd25cbiAgICAgIH0pXG4gICAgfVxuICB9KTtcblxuICBjb25zdCB1cHNlcnRUaW1lUG9saWN5QWxsb2NhdGlvblJ1bGVzID0gYXN5bmMgKHtcbiAgICBjb250ZXh0LFxuICAgIHRpbWVQb2xpY3lJZCxcbiAgICBhbGxvY2F0aW9uQ29uZmlnLFxuICAgIHNlc3Npb25cbiAgfToge1xuICAgIGNvbnRleHQ6IEJhc2VTY2hlbWFNZXRhWydjb250ZXh0J107XG4gICAgdGltZVBvbGljeUlkOiBzdHJpbmc7XG4gICAgYWxsb2NhdGlvbkNvbmZpZz86IFRpbWVQb2xpY3lBbGxvY2F0aW9uUnVsZXNJbnB1dFZhbHVlIHwgbnVsbDtcbiAgICBzZXNzaW9uOiBTZXNzaW9uIHwgbnVsbDtcbiAgfSkgPT4ge1xuICAgIGlmICghYWxsb2NhdGlvbkNvbmZpZykgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgdGltZVBvbGljeSA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQb2xpY3kuZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBpZDogdGltZVBvbGljeUlkIH0sXG4gICAgICBxdWVyeTogJ2lkIGlzQWxsb2NhdGlvbk1hbmFnZWQnXG4gICAgfSkpIGFzIHsgaWQ6IHN0cmluZzsgaXNBbGxvY2F0aW9uTWFuYWdlZD86IGJvb2xlYW4gfCBudWxsIH0gfCBudWxsO1xuICAgIGlmICghdGltZVBvbGljeT8uaXNBbGxvY2F0aW9uTWFuYWdlZCkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBub3JtYWxpemVkQWxsb2NhdGlvbiA9IHNhbml0aXplTnVtYmVyKGFsbG9jYXRpb25Db25maWcuYWxsb2NhdGlvbik7XG4gICAgY29uc3Qgbm9ybWFsaXplZENhcnJ5b3ZlciA9IHNhbml0aXplTnVtYmVyKGFsbG9jYXRpb25Db25maWcuY2FycnlvdmVyTGltaXQpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRPdmVyZHJhZnQgPSBzYW5pdGl6ZU51bWJlcihhbGxvY2F0aW9uQ29uZmlnLm92ZXJkcmFmdExpbWl0KTtcbiAgICBjb25zdCBub3JtYWxpemVkTm90ZXMgPSBub3JtYWxpemVOb3RlcyhhbGxvY2F0aW9uQ29uZmlnLm5vdGVzKTtcblxuICAgIGNvbnN0IGxhdGVzdCA9IGF3YWl0IGZldGNoTGF0ZXN0VGltZVBvbGljeUFsbG9jYXRpb24oY29udGV4dCwgdGltZVBvbGljeUlkKTtcbiAgICBjb25zdCBzaG91bGRDcmVhdGUgPVxuICAgICAgIWxhdGVzdCB8fFxuICAgICAgc2FuaXRpemVOdW1iZXIobGF0ZXN0LmFsbG9jYXRpb24pICE9PSBub3JtYWxpemVkQWxsb2NhdGlvbiB8fFxuICAgICAgc2FuaXRpemVOdW1iZXIobGF0ZXN0LmNhcnJ5b3ZlckxpbWl0KSAhPT0gbm9ybWFsaXplZENhcnJ5b3ZlciB8fFxuICAgICAgc2FuaXRpemVOdW1iZXIobGF0ZXN0Lm92ZXJkcmFmdExpbWl0KSAhPT0gbm9ybWFsaXplZE92ZXJkcmFmdCB8fFxuICAgICAgbm9ybWFsaXplTm90ZXMobGF0ZXN0Lm5vdGVzKSAhPT0gbm9ybWFsaXplZE5vdGVzO1xuXG4gICAgaWYgKCFzaG91bGRDcmVhdGUpIHJldHVybiBsYXRlc3Q7XG5cbiAgICBjb25zdCBjcmVhdGVkQnkgPSBzZXNzaW9uPy5pZCA/IHsgY29ubmVjdDogeyBpZDogU3RyaW5nKHNlc3Npb24uaWQpIH0gfSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBlZmZlY3RpdmVBdElzbyA9IGFsbG9jYXRpb25Db25maWcuZWZmZWN0aXZlQXRcbiAgICAgID8gdG9EYXRlKGFsbG9jYXRpb25Db25maWcuZWZmZWN0aXZlQXQpLnRvSVNPU3RyaW5nKClcbiAgICAgIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGNyZWF0ZWQgPSBhd2FpdCBjb250ZXh0LmRiLlRpbWVQb2xpY3lBbGxvY2F0aW9uLmNyZWF0ZU9uZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHRpbWVQb2xpY3k6IHsgY29ubmVjdDogeyBpZDogdGltZVBvbGljeUlkIH0gfSxcbiAgICAgICAgYWxsb2NhdGlvbjogbm9ybWFsaXplZEFsbG9jYXRpb24sXG4gICAgICAgIGNhcnJ5b3ZlckxpbWl0OiBub3JtYWxpemVkQ2FycnlvdmVyLFxuICAgICAgICBvdmVyZHJhZnRMaW1pdDogbm9ybWFsaXplZE92ZXJkcmFmdCxcbiAgICAgICAgbm90ZXM6IG5vcm1hbGl6ZWROb3RlcyB8fCB1bmRlZmluZWQsXG4gICAgICAgIGVmZmVjdGl2ZUF0OiBlZmZlY3RpdmVBdElzbyxcbiAgICAgICAgY3JlYXRlZEJ5XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZmV0Y2hUaW1lUG9saWN5QWxsb2NhdGlvbkJ5SWQoY29udGV4dCwgY3JlYXRlZC5pZCk7XG4gIH07XG5cbiAgY29uc3QgYnVpbGRUaW1lUG9saWN5RGF0YSA9IChpbnB1dDogVGltZVBvbGljeU11dGF0aW9uSW5wdXQgfCBudWxsIHwgdW5kZWZpbmVkLCB7IGlzVXBkYXRlIH06IHsgaXNVcGRhdGU6IGJvb2xlYW4gfSkgPT4ge1xuICAgIGlmICghaW5wdXQpIHJldHVybiB7fTtcbiAgICBjb25zdCBuZXh0OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuICAgIGlmICh0eXBlb2YgaW5wdXQubmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IHRyaW1tZWQgPSBpbnB1dC5uYW1lLnRyaW0oKTtcbiAgICAgIGlmICh0cmltbWVkLmxlbmd0aCkgbmV4dC5uYW1lID0gdHJpbW1lZDtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBpbnB1dC5pc0FsbG9jYXRpb25NYW5hZ2VkID09PSAnYm9vbGVhbicpIHtcbiAgICAgIG5leHQuaXNBbGxvY2F0aW9uTWFuYWdlZCA9IGlucHV0LmlzQWxsb2NhdGlvbk1hbmFnZWQ7XG4gICAgfVxuICAgIGlmIChpbnB1dC50aW1lVHlwZUlkKSB7XG4gICAgICBuZXh0LnRpbWVUeXBlID0geyBjb25uZWN0OiB7IGlkOiBpbnB1dC50aW1lVHlwZUlkIH0gfTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoaW5wdXQubG9jYXRpb25JZHMpKSB7XG4gICAgICBjb25zdCBub2RlcyA9IGlucHV0LmxvY2F0aW9uSWRzLmZpbHRlcihCb29sZWFuKS5tYXAoaWQgPT4gKHsgaWQgfSkpO1xuICAgICAgbmV4dC5sb2NhdGlvbnMgPSBpc1VwZGF0ZSA/IHsgc2V0OiBub2RlcyB9IDogeyBjb25uZWN0OiBub2RlcyB9O1xuICAgIH1cbiAgICByZXR1cm4gbmV4dDtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHF1ZXJ5OiB7XG4gICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbkhpc3Rvcnk6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBnLmxpc3QoZy5ub25OdWxsKFRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeUVudHJ5KSksXG4gICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICB0aW1lUG9saWN5SWQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSUQpIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIHJlc29sdmUoc291cmNlLCB7IHRpbWVQb2xpY3lJZCB9LCBjb250ZXh0KSB7XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGNvbnRleHQuc2Vzc2lvbiBhcyBTZXNzaW9uIHwgbnVsbDtcbiAgICAgICAgICBhd2FpdCBhc3NlcnRDYW5BY2Nlc3NUaW1lUG9saWN5KGNvbnRleHQsIHNlc3Npb24sIHRpbWVQb2xpY3lJZCBhcyBzdHJpbmcpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVGltZVBvbGljeUFsbG9jYXRpb24uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHsgdGltZVBvbGljeTogeyBpZDogeyBlcXVhbHM6IHRpbWVQb2xpY3lJZCBhcyBzdHJpbmcgfSB9IH0sXG4gICAgICAgICAgICBvcmRlckJ5OiB7IGVmZmVjdGl2ZUF0OiAnZGVzYycgfSxcbiAgICAgICAgICAgIHF1ZXJ5OlxuICAgICAgICAgICAgICAnaWQgZWZmZWN0aXZlQXQgYWxsb2NhdGlvbiBjYXJyeW92ZXJMaW1pdCBvdmVyZHJhZnRMaW1pdCBub3RlcyBjcmVhdGVkQXQgY3JlYXRlZEJ5IHsgaWQgZmlyc3ROYW1lIGxhc3ROYW1lIH0nXG4gICAgICAgICAgfSkpIGFzIFRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeU5vZGVbXTtcbiAgICAgICAgICByZXR1cm4gaXRlbXM7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgdXNlckFsbG9jYXRpb25FdmVudExvZzogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcubGlzdChnLm5vbk51bGwoVXNlckFsbG9jYXRpb25FbnRyeSkpLFxuICAgICAgICBhcmdzOiB7XG4gICAgICAgICAgdXNlcklkOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLklEKSB9KSxcbiAgICAgICAgICB0aW1lUG9saWN5SWQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSUQpIH0pLFxuICAgICAgICAgIHllYXI6IGcuYXJnKHsgdHlwZTogZy5JbnQgfSlcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgcmVzb2x2ZShzb3VyY2UsIHsgdXNlcklkLCB0aW1lUG9saWN5SWQsIHllYXIgfSwgY29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBjb250ZXh0LnNlc3Npb24gYXMgU2Vzc2lvbiB8IG51bGw7XG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGFzc2VydENhbkFjY2Vzc1VzZXIoY29udGV4dCwgc2Vzc2lvbiwgdXNlcklkIGFzIHN0cmluZyk7XG4gICAgICAgICAgY29uc3QgdGltZVBvbGljeSA9IGF3YWl0IGFzc2VydENhbkFjY2Vzc1RpbWVQb2xpY3koY29udGV4dCwgc2Vzc2lvbiwgdGltZVBvbGljeUlkIGFzIHN0cmluZyk7XG4gICAgICAgICAgaWYgKHRpbWVQb2xpY3kub3JnPy5pZCAmJiB1c2VyLm9yZz8uaWQgJiYgdGltZVBvbGljeS5vcmcuaWQgIT09IHVzZXIub3JnLmlkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RpbWUgcG9saWN5IGRvZXMgbm90IGJlbG9uZyB0byB0aGUgc2FtZSBvcmdhbml6YXRpb24gYXMgdXNlci4nKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB3aGVyZTogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcbiAgICAgICAgICAgIHVzZXI6IHsgaWQ6IHsgZXF1YWxzOiB1c2VySWQgYXMgc3RyaW5nIH0gfSxcbiAgICAgICAgICAgIHRpbWVQb2xpY3k6IHsgaWQ6IHsgZXF1YWxzOiB0aW1lUG9saWN5SWQgYXMgc3RyaW5nIH0gfVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKHllYXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGFydCwgZW5kIH0gPSBnZXRZZWFyQm91bmRzKHllYXIgYXMgbnVtYmVyKTtcbiAgICAgICAgICAgIHdoZXJlLmVmZmVjdGl2ZUF0ID0ge1xuICAgICAgICAgICAgICBndGU6IHN0YXJ0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgIGx0OiBlbmQudG9JU09TdHJpbmcoKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBldmVudHMgPSAoYXdhaXQgY29udGV4dC5xdWVyeS5Vc2VyQWxsb2NhdGlvbi5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgZWZmZWN0aXZlQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgICAgcXVlcnk6XG4gICAgICAgICAgICAgICdpZCB0eXBlIGFtb3VudCBlZmZlY3RpdmVBdCBjcmVhdGVkQXQgbm90ZXMgY3JlYXRlZEJ5IHsgaWQgZmlyc3ROYW1lIGxhc3ROYW1lIH0gdGltZVBvbGljeUFsbG9jYXRpb24geyBpZCBlZmZlY3RpdmVBdCB9J1xuICAgICAgICAgIH0pKSBhcyAoVXNlckFsbG9jYXRpb25Ob2RlICYge1xuICAgICAgICAgICAgdGltZVBvbGljeUFsbG9jYXRpb24/OiB7IGlkOiBzdHJpbmc7IGVmZmVjdGl2ZUF0Pzogc3RyaW5nIHwgRGF0ZSB8IG51bGwgfSB8IG51bGw7XG4gICAgICAgICAgfSlbXTtcblxuICAgICAgICAgIHJldHVybiBldmVudHMubWFwKGV2ZW50ID0+ICh7XG4gICAgICAgICAgICAuLi5ldmVudCxcbiAgICAgICAgICAgIGVmZmVjdGl2ZUF0OiB0b0RhdGUoZXZlbnQuZWZmZWN0aXZlQXQpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IGV2ZW50LmNyZWF0ZWRBdCA/IHRvRGF0ZShldmVudC5jcmVhdGVkQXQpLnRvSVNPU3RyaW5nKCkgOiBudWxsLFxuICAgICAgICAgICAgdGltZVBvbGljeUFsbG9jYXRpb246IGV2ZW50LnRpbWVQb2xpY3lBbGxvY2F0aW9uXG4gICAgICAgICAgICAgID8geyBpZDogZXZlbnQudGltZVBvbGljeUFsbG9jYXRpb24uaWQsIGVmZmVjdGl2ZUF0OiB0b0RhdGUoZXZlbnQudGltZVBvbGljeUFsbG9jYXRpb24uZWZmZWN0aXZlQXQpLnRvSVNPU3RyaW5nKCkgfVxuICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgdXNlckFsbG9jYXRpb25CYWxhbmNlOiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogVXNlckFsbG9jYXRpb25CYWxhbmNlLFxuICAgICAgICBhcmdzOiB7XG4gICAgICAgICAgdXNlcklkOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLklEKSB9KSxcbiAgICAgICAgICB0aW1lUG9saWN5SWQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSUQpIH0pLFxuICAgICAgICAgIHllYXI6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSW50KSB9KVxuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXNvbHZlKHNvdXJjZSwgeyB1c2VySWQsIHRpbWVQb2xpY3lJZCwgeWVhciB9LCBjb250ZXh0KSB7XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGNvbnRleHQuc2Vzc2lvbiBhcyBTZXNzaW9uIHwgbnVsbDtcbiAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXNzZXJ0Q2FuQWNjZXNzVXNlcihjb250ZXh0LCBzZXNzaW9uLCB1c2VySWQgYXMgc3RyaW5nKTtcbiAgICAgICAgICBjb25zdCB0aW1lUG9saWN5ID0gYXdhaXQgYXNzZXJ0Q2FuQWNjZXNzVGltZVBvbGljeShjb250ZXh0LCBzZXNzaW9uLCB0aW1lUG9saWN5SWQgYXMgc3RyaW5nKTtcbiAgICAgICAgICBpZiAodGltZVBvbGljeS5vcmc/LmlkICYmIHVzZXIub3JnPy5pZCAmJiB0aW1lUG9saWN5Lm9yZy5pZCAhPT0gdXNlci5vcmcuaWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGltZSBwb2xpY3kgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBzYW1lIG9yZ2FuaXphdGlvbiBhcyB1c2VyLicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHRhcmdldFllYXIgPSB5ZWFyIGFzIG51bWJlcjtcbiAgICAgICAgICBhd2FpdCBlbnN1cmVDYXJyeW92ZXJVcFRvWWVhcih7XG4gICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgdXNlcklkOiB1c2VySWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgdGltZVBvbGljeUlkOiB0aW1lUG9saWN5SWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgdGFyZ2V0WWVhclxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3Qgc3VkbyA9IGNvbnRleHQuc3VkbygpO1xuICAgICAgICAgIGNvbnN0IHVzZXJTdGFydERhdGUgPSBhd2FpdCBnZXRVc2VyU3RhcnREYXRlKHN1ZG8sIHVzZXJJZCBhcyBzdHJpbmcpO1xuICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IGNyZWF0ZVllYXJQZXJpb2QodGFyZ2V0WWVhcik7XG4gICAgICAgICAgY29uc3QgYmFzZVJlc3VsdCA9IGF3YWl0IGNhbGN1bGF0ZUJhc2VBbGxvY2F0aW9uRm9yVGltZVBvbGljeSh7XG4gICAgICAgICAgICBjb250ZXh0OiBzdWRvLFxuICAgICAgICAgICAgdGltZVBvbGljeUlkOiB0aW1lUG9saWN5SWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgcGVyaW9kLFxuICAgICAgICAgICAgdXNlclN0YXJ0RGF0ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IHsgc3RhcnQsIGVuZCB9ID0gZ2V0WWVhckJvdW5kcyh0YXJnZXRZZWFyKTtcbiAgICAgICAgICBjb25zdCBjYXJyeW92ZXJJbiA9IGF3YWl0IHN1bUFkanVzdG1lbnRFdmVudHMoe1xuICAgICAgICAgICAgY29udGV4dDogc3VkbyxcbiAgICAgICAgICAgIHVzZXJJZDogdXNlcklkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHRpbWVQb2xpY3lJZDogdGltZVBvbGljeUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgZW5kLFxuICAgICAgICAgICAgdHlwZXM6IFsnQ0FSUllPVkVSX0lOJ11cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCBtYW51YWxBZGp1c3RtZW50cyA9IGF3YWl0IHN1bUFkanVzdG1lbnRFdmVudHMoe1xuICAgICAgICAgICAgY29udGV4dDogc3VkbyxcbiAgICAgICAgICAgIHVzZXJJZDogdXNlcklkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHRpbWVQb2xpY3lJZDogdGltZVBvbGljeUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgZW5kLFxuICAgICAgICAgICAgdHlwZXM6IFsnTUFOVUFMJ11cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCByZXRyb0FkanVzdG1lbnRzID0gYXdhaXQgc3VtQWRqdXN0bWVudEV2ZW50cyh7XG4gICAgICAgICAgICBjb250ZXh0OiBzdWRvLFxuICAgICAgICAgICAgdXNlcklkOiB1c2VySWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgdGltZVBvbGljeUlkOiB0aW1lUG9saWN5SWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICB0eXBlczogWydQT0xJQ1lfQ0hBTkdFX1JFVFJPJ11cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCB1c2VkID0gYXdhaXQgc3VtVXNhZ2VGb3JZZWFyKHtcbiAgICAgICAgICAgIGNvbnRleHQ6IHN1ZG8sXG4gICAgICAgICAgICB1c2VySWQ6IHVzZXJJZCBhcyBzdHJpbmcsXG4gICAgICAgICAgICB0aW1lUG9saWN5SWQ6IHRpbWVQb2xpY3lJZCBhcyBzdHJpbmcsXG4gICAgICAgICAgICBzdGFydCxcbiAgICAgICAgICAgIGVuZFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgYXZhaWxhYmxlID0gYmFzZVJlc3VsdC5hbW91bnQgKyBjYXJyeW92ZXJJbiArIG1hbnVhbEFkanVzdG1lbnRzICsgcmV0cm9BZGp1c3RtZW50cyAtIHVzZWQ7XG4gICAgICAgICAgY29uc3QgYnJlYWtkb3duOiBBbGxvY2F0aW9uQnJlYWtkb3duU2VnbWVudE5vZGVbXSA9IGJhc2VSZXN1bHQuYnJlYWtkb3duLm1hcChzZWdtZW50ID0+ICh7XG4gICAgICAgICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbklkOiBzZWdtZW50LnRpbWVQb2xpY3lBbGxvY2F0aW9uSWQsXG4gICAgICAgICAgICBlZmZlY3RpdmVBdDogc2VnbWVudC5lZmZlY3RpdmVBdC50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgZnJvbTogc2VnbWVudC5mcm9tLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB0bzogc2VnbWVudC50by50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgZGF5c0luU2VnbWVudDogc2VnbWVudC5kYXlzSW5TZWdtZW50LFxuICAgICAgICAgICAgcG9ydGlvbk9mUGVyaW9kOiBzZWdtZW50LnBvcnRpb25PZlBlcmlvZCxcbiAgICAgICAgICAgIGFsbG9jYXRpb25SYXRlOiBzZWdtZW50LmFsbG9jYXRpb25SYXRlLFxuICAgICAgICAgICAgY29udHJpYnV0aW9uOiBzZWdtZW50LmNvbnRyaWJ1dGlvblxuICAgICAgICAgIH0pKTtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB5ZWFyOiB0YXJnZXRZZWFyLFxuICAgICAgICAgICAgYmFzZTogYmFzZVJlc3VsdC5hbW91bnQsXG4gICAgICAgICAgICBjYXJyeW92ZXJJbixcbiAgICAgICAgICAgIG1hbnVhbEFkanVzdG1lbnRzLFxuICAgICAgICAgICAgcmV0cm9BZGp1c3RtZW50cyxcbiAgICAgICAgICAgIHVzZWQsXG4gICAgICAgICAgICBhdmFpbGFibGUsXG4gICAgICAgICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbjogYmFzZVJlc3VsdC5hY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvblxuICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgIGlkOiBiYXNlUmVzdWx0LmFjdGl2ZVRpbWVQb2xpY3lBbGxvY2F0aW9uLmlkLFxuICAgICAgICAgICAgICAgICAgYWxsb2NhdGlvbjogYmFzZVJlc3VsdC5hY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbi5hbGxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgY2FycnlvdmVyTGltaXQ6IGJhc2VSZXN1bHQuYWN0aXZlVGltZVBvbGljeUFsbG9jYXRpb24uY2FycnlvdmVyTGltaXQsXG4gICAgICAgICAgICAgICAgICBvdmVyZHJhZnRMaW1pdDogYmFzZVJlc3VsdC5hY3RpdmVUaW1lUG9saWN5QWxsb2NhdGlvbi5vdmVyZHJhZnRMaW1pdCxcbiAgICAgICAgICAgICAgICAgIGVmZmVjdGl2ZUF0OiBiYXNlUmVzdWx0LmFjdGl2ZVRpbWVQb2xpY3lBbGxvY2F0aW9uLmVmZmVjdGl2ZUF0LnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgIGJyZWFrZG93blxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgICBtdXRhdGlvbjoge1xuICAgICAgY3JlYXRlVGltZVBvbGljeVdpdGhBbGxvY2F0aW9uOiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogYmFzZS5vYmplY3QoJ1RpbWVQb2xpY3knKSxcbiAgICAgICAgYXJnczoge1xuICAgICAgICAgIGRhdGE6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKFRpbWVQb2xpY3lNdXRhdGlvbklucHV0VHlwZSkgfSksXG4gICAgICAgICAgYWxsb2NhdGlvbkNvbmZpZzogZy5hcmcoeyB0eXBlOiBUaW1lUG9saWN5QWxsb2NhdGlvblJ1bGVzSW5wdXQgfSlcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgcmVzb2x2ZShfLCB7IGRhdGEsIGFsbG9jYXRpb25Db25maWcgfSwgY29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBjb250ZXh0LnNlc3Npb24gYXMgU2Vzc2lvbiB8IG51bGw7XG4gICAgICAgICAgaWYgKCFpc0dvZCh7IHNlc3Npb24gfSkgJiYgIWlzQW55QWRtaW4oeyBzZXNzaW9uIH0pKSB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuICAgICAgICAgIGNvbnN0IHRpbWVQb2xpY3lEYXRhID0gYnVpbGRUaW1lUG9saWN5RGF0YShkYXRhIGFzIFRpbWVQb2xpY3lNdXRhdGlvbklucHV0LCB7IGlzVXBkYXRlOiBmYWxzZSB9KTtcbiAgICAgICAgICBjb25zdCBjcmVhdGVkID0gYXdhaXQgY29udGV4dC5kYi5UaW1lUG9saWN5LmNyZWF0ZU9uZSh7XG4gICAgICAgICAgICBkYXRhOiB0aW1lUG9saWN5RGF0YSBhcyBQYXJhbWV0ZXJzPHR5cGVvZiBjb250ZXh0LmRiLlRpbWVQb2xpY3kuY3JlYXRlT25lPlswXVsnZGF0YSddLFxuICAgICAgICAgICAgcXVlcnk6ICdpZCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoIWNyZWF0ZWQ/LmlkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICBhd2FpdCB1cHNlcnRUaW1lUG9saWN5QWxsb2NhdGlvblJ1bGVzKHtcbiAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICB0aW1lUG9saWN5SWQ6IGNyZWF0ZWQuaWQsXG4gICAgICAgICAgICBhbGxvY2F0aW9uQ29uZmlnOiBhbGxvY2F0aW9uQ29uZmlnIGFzIFRpbWVQb2xpY3lBbGxvY2F0aW9uUnVsZXNJbnB1dFZhbHVlIHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2Vzc2lvblxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBjb250ZXh0LnF1ZXJ5LlRpbWVQb2xpY3kuZmluZE9uZSh7IHdoZXJlOiB7IGlkOiBjcmVhdGVkLmlkIH0sIHF1ZXJ5OiAnaWQnIH0pO1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHVwZGF0ZVRpbWVQb2xpY3lXaXRoQWxsb2NhdGlvbjogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGJhc2Uub2JqZWN0KCdUaW1lUG9saWN5JyksXG4gICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICBpZDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCkgfSksXG4gICAgICAgICAgZGF0YTogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoVGltZVBvbGljeU11dGF0aW9uSW5wdXRUeXBlKSB9KSxcbiAgICAgICAgICBhbGxvY2F0aW9uQ29uZmlnOiBnLmFyZyh7IHR5cGU6IFRpbWVQb2xpY3lBbGxvY2F0aW9uUnVsZXNJbnB1dCB9KVxuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXNvbHZlKF8sIHsgaWQsIGRhdGEsIGFsbG9jYXRpb25Db25maWcgfSwgY29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBjb250ZXh0LnNlc3Npb24gYXMgU2Vzc2lvbiB8IG51bGw7XG4gICAgICAgICAgYXdhaXQgYXNzZXJ0Q2FuQWNjZXNzVGltZVBvbGljeShjb250ZXh0LCBzZXNzaW9uLCBpZCBhcyBzdHJpbmcpO1xuICAgICAgICAgIGNvbnN0IHRpbWVQb2xpY3lEYXRhID0gYnVpbGRUaW1lUG9saWN5RGF0YShkYXRhIGFzIFRpbWVQb2xpY3lNdXRhdGlvbklucHV0LCB7IGlzVXBkYXRlOiB0cnVlIH0pO1xuICAgICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBjb250ZXh0LmRiLlRpbWVQb2xpY3kudXBkYXRlT25lKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBpZCBhcyBzdHJpbmcgfSxcbiAgICAgICAgICAgIGRhdGE6IHRpbWVQb2xpY3lEYXRhIGFzIFBhcmFtZXRlcnM8dHlwZW9mIGNvbnRleHQuZGIuVGltZVBvbGljeS51cGRhdGVPbmU+WzBdWydkYXRhJ10sXG4gICAgICAgICAgICBxdWVyeTogJ2lkJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICghdXBkYXRlZD8uaWQpIHJldHVybiBudWxsO1xuICAgICAgICAgIGF3YWl0IHVwc2VydFRpbWVQb2xpY3lBbGxvY2F0aW9uUnVsZXMoe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIHRpbWVQb2xpY3lJZDogdXBkYXRlZC5pZCxcbiAgICAgICAgICAgIGFsbG9jYXRpb25Db25maWc6IGFsbG9jYXRpb25Db25maWcgYXMgVGltZVBvbGljeUFsbG9jYXRpb25SdWxlc0lucHV0VmFsdWUgfCB1bmRlZmluZWQsXG4gICAgICAgICAgICBzZXNzaW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGNvbnRleHQucXVlcnkuVGltZVBvbGljeS5maW5kT25lKHsgd2hlcmU6IHsgaWQ6IHVwZGF0ZWQuaWQgfSwgcXVlcnk6ICdpZCcgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgY3JlYXRlTWFudWFsQWxsb2NhdGlvbkFkanVzdG1lbnQ6IGcuZmllbGQoe1xuICAgICAgICB0eXBlOiBVc2VyQWxsb2NhdGlvbkVudHJ5LFxuICAgICAgICBhcmdzOiB7XG4gICAgICAgICAgdXNlcklkOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLklEKSB9KSxcbiAgICAgICAgICB0aW1lUG9saWN5SWQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSUQpIH0pLFxuICAgICAgICAgIGFtb3VudDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JbnQpIH0pLFxuICAgICAgICAgIGVmZmVjdGl2ZUF0OiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLlN0cmluZykgfSksXG4gICAgICAgICAgbm90ZXM6IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSlcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQpIHtcbiAgICAgICAgICBjb25zdCB7IHVzZXJJZCwgdGltZVBvbGljeUlkLCBhbW91bnQsIGVmZmVjdGl2ZUF0LCBub3RlcyB9ID0gYXJncztcbiAgICAgICAgICBjb25zdCBzZXNzaW9uID0gY29udGV4dC5zZXNzaW9uIGFzIFNlc3Npb24gfCBudWxsO1xuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhc3NlcnRDYW5BY2Nlc3NVc2VyKGNvbnRleHQsIHNlc3Npb24sIHVzZXJJZCBhcyBzdHJpbmcpO1xuICAgICAgICAgIGNvbnN0IHRpbWVQb2xpY3kgPSBhd2FpdCBhc3NlcnRDYW5BY2Nlc3NUaW1lUG9saWN5KGNvbnRleHQsIHNlc3Npb24sIHRpbWVQb2xpY3lJZCBhcyBzdHJpbmcpO1xuICAgICAgICAgIGlmICh0aW1lUG9saWN5Lm9yZz8uaWQgJiYgdXNlci5vcmc/LmlkICYmIHRpbWVQb2xpY3kub3JnLmlkICE9PSB1c2VyLm9yZy5pZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaW1lIHBvbGljeSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIHNhbWUgb3JnYW5pemF0aW9uIGFzIHVzZXIuJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgY3JlYXRlZEJ5ID0gc2Vzc2lvbj8uaWQgPyB7IGNvbm5lY3Q6IHsgaWQ6IFN0cmluZyhzZXNzaW9uLmlkKSB9IH0gOiB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc3QgZXZlbnQgPSBhd2FpdCBjb250ZXh0LmRiLlVzZXJBbGxvY2F0aW9uLmNyZWF0ZU9uZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHsgY29ubmVjdDogeyBpZDogdXNlcklkIGFzIHN0cmluZyB9IH0sXG4gICAgICAgICAgICAgIHRpbWVQb2xpY3k6IHsgY29ubmVjdDogeyBpZDogdGltZVBvbGljeUlkIGFzIHN0cmluZyB9IH0sXG4gICAgICAgICAgICAgIHR5cGU6ICdNQU5VQUwnLFxuICAgICAgICAgICAgICBhbW91bnQ6IHNhbml0aXplTnVtYmVyKGFtb3VudCBhcyBudW1iZXIpLFxuICAgICAgICAgICAgICBlZmZlY3RpdmVBdDogdG9EYXRlKGVmZmVjdGl2ZUF0KS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICBub3Rlczogbm9ybWFsaXplTm90ZXMobm90ZXMgYXMgc3RyaW5nIHwgbnVsbCkgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICBjcmVhdGVkQnlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGZ1bGxFdmVudCA9IGF3YWl0IGZldGNoVXNlckFsbG9jYXRpb25CeUlkKGNvbnRleHQsIGV2ZW50LmlkKTtcbiAgICAgICAgICBpZiAoIWZ1bGxFdmVudCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uZnVsbEV2ZW50LFxuICAgICAgICAgICAgZWZmZWN0aXZlQXQ6IHRvRGF0ZShmdWxsRXZlbnQuZWZmZWN0aXZlQXQpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IGZ1bGxFdmVudC5jcmVhdGVkQXQgPyB0b0RhdGUoZnVsbEV2ZW50LmNyZWF0ZWRBdCkudG9JU09TdHJpbmcoKSA6IG51bGwsXG4gICAgICAgICAgICB0aW1lUG9saWN5QWxsb2NhdGlvbjogZnVsbEV2ZW50LnRpbWVQb2xpY3lBbGxvY2F0aW9uXG4gICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgaWQ6IGZ1bGxFdmVudC50aW1lUG9saWN5QWxsb2NhdGlvbi5pZCxcbiAgICAgICAgICAgICAgICAgIGVmZmVjdGl2ZUF0OiBmdWxsRXZlbnQudGltZVBvbGljeUFsbG9jYXRpb24uZWZmZWN0aXZlQXRcbiAgICAgICAgICAgICAgICAgICAgPyB0b0RhdGUoZnVsbEV2ZW50LnRpbWVQb2xpY3lBbGxvY2F0aW9uLmVmZmVjdGl2ZUF0KS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgIDogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiBudWxsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH07XG59O1xuXG5cblxuIl0sIm5hbWVzIjpbImdyYXBocWwiLCJnIiwiY2FsY3VsYXRlQmFzZUFsbG9jYXRpb25Gb3JUaW1lUG9saWN5IiwiY3JlYXRlWWVhclBlcmlvZCIsImVuc3VyZUNhcnJ5b3ZlclVwVG9ZZWFyIiwiZ2V0VXNlclN0YXJ0RGF0ZSIsImdldFllYXJCb3VuZHMiLCJzdW1BZGp1c3RtZW50RXZlbnRzIiwic3VtVXNhZ2VGb3JZZWFyIiwidG9EYXRlIiwiaXNBbnlBZG1pbiIsImlzR29kIiwidG9Jc29TdHJpbmciLCJ2YWx1ZSIsImRhdGUiLCJEYXRlIiwiTnVtYmVyIiwiaXNOYU4iLCJnZXRUaW1lIiwidG9JU09TdHJpbmciLCJmb3JtYXRVc2VyTmFtZSIsInVzZXIiLCJwYXJ0cyIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiZmlsdGVyIiwiQm9vbGVhbiIsImxlbmd0aCIsImpvaW4iLCJzYW5pdGl6ZU51bWJlciIsIm51bWVyaWNWYWx1ZSIsImlzRmluaXRlIiwibm9ybWFsaXplTm90ZXMiLCJ0cmltIiwidGltZVBvbGljeUFsbG9jYXRpb25IaXN0b3J5U2VsZWN0aW9uIiwidXNlckFsbG9jYXRpb25TZWxlY3Rpb24iLCJmZXRjaExhdGVzdFRpbWVQb2xpY3lBbGxvY2F0aW9uIiwiY29udGV4dCIsInRpbWVQb2xpY3lJZCIsImhpc3RvcnkiLCJxdWVyeSIsIlRpbWVQb2xpY3lBbGxvY2F0aW9uIiwiZmluZE1hbnkiLCJ3aGVyZSIsInRpbWVQb2xpY3kiLCJpZCIsImVxdWFscyIsIm9yZGVyQnkiLCJlZmZlY3RpdmVBdCIsInRha2UiLCJmZXRjaFRpbWVQb2xpY3lBbGxvY2F0aW9uQnlJZCIsImZpbmRPbmUiLCJmZXRjaFVzZXJBbGxvY2F0aW9uQnlJZCIsIlVzZXJBbGxvY2F0aW9uIiwiYXNzZXJ0Q2FuQWNjZXNzVGltZVBvbGljeSIsInNlc3Npb24iLCJUaW1lUG9saWN5IiwiRXJyb3IiLCJvcmdJZCIsIm9yZyIsImFzc2VydENhbkFjY2Vzc1VzZXIiLCJ1c2VySWQiLCJVc2VyIiwiQWxsb2NhdGlvbnMiLCJiYXNlIiwiVGltZVBvbGljeUFsbG9jYXRpb25SdWxlc0lucHV0IiwiaW5wdXRPYmplY3QiLCJuYW1lIiwiZmllbGRzIiwiYWxsb2NhdGlvbiIsImFyZyIsInR5cGUiLCJub25OdWxsIiwiSW50IiwiY2FycnlvdmVyTGltaXQiLCJvdmVyZHJhZnRMaW1pdCIsIm5vdGVzIiwiU3RyaW5nIiwiVGltZVBvbGljeU11dGF0aW9uSW5wdXRUeXBlIiwidGltZVR5cGVJZCIsIklEIiwibG9jYXRpb25JZHMiLCJsaXN0IiwiaXNBbGxvY2F0aW9uTWFuYWdlZCIsIlRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeUVudHJ5Iiwib2JqZWN0IiwiZmllbGQiLCJyZXNvbHZlIiwiaXRlbSIsIkZsb2F0IiwiY3JlYXRlZEF0IiwiY3JlYXRlZEJ5IiwiVXNlckFsbG9jYXRpb25FbnRyeSIsImFtb3VudCIsInRpbWVQb2xpY3lBbGxvY2F0aW9uSWQiLCJ0aW1lUG9saWN5QWxsb2NhdGlvbiIsIkFsbG9jYXRpb25CcmVha2Rvd25TZWdtZW50IiwiZnJvbSIsInRvIiwiZGF5c0luU2VnbWVudCIsInBvcnRpb25PZlBlcmlvZCIsImFsbG9jYXRpb25SYXRlIiwiY29udHJpYnV0aW9uIiwiVXNlckFsbG9jYXRpb25CYWxhbmNlIiwieWVhciIsImNhcnJ5b3ZlckluIiwibWFudWFsQWRqdXN0bWVudHMiLCJyZXRyb0FkanVzdG1lbnRzIiwidXNlZCIsImF2YWlsYWJsZSIsImJyZWFrZG93biIsInVwc2VydFRpbWVQb2xpY3lBbGxvY2F0aW9uUnVsZXMiLCJhbGxvY2F0aW9uQ29uZmlnIiwibm9ybWFsaXplZEFsbG9jYXRpb24iLCJub3JtYWxpemVkQ2FycnlvdmVyIiwibm9ybWFsaXplZE92ZXJkcmFmdCIsIm5vcm1hbGl6ZWROb3RlcyIsImxhdGVzdCIsInNob3VsZENyZWF0ZSIsImNvbm5lY3QiLCJ1bmRlZmluZWQiLCJlZmZlY3RpdmVBdElzbyIsImNyZWF0ZWQiLCJkYiIsImNyZWF0ZU9uZSIsImRhdGEiLCJidWlsZFRpbWVQb2xpY3lEYXRhIiwiaW5wdXQiLCJpc1VwZGF0ZSIsIm5leHQiLCJ0cmltbWVkIiwidGltZVR5cGUiLCJBcnJheSIsImlzQXJyYXkiLCJub2RlcyIsIm1hcCIsImxvY2F0aW9ucyIsInNldCIsInRpbWVQb2xpY3lBbGxvY2F0aW9uSGlzdG9yeSIsImFyZ3MiLCJzb3VyY2UiLCJpdGVtcyIsInVzZXJBbGxvY2F0aW9uRXZlbnRMb2ciLCJzdGFydCIsImVuZCIsImd0ZSIsImx0IiwiZXZlbnRzIiwiZXZlbnQiLCJ1c2VyQWxsb2NhdGlvbkJhbGFuY2UiLCJ0YXJnZXRZZWFyIiwic3VkbyIsInVzZXJTdGFydERhdGUiLCJwZXJpb2QiLCJiYXNlUmVzdWx0IiwidHlwZXMiLCJzZWdtZW50IiwiYWN0aXZlVGltZVBvbGljeUFsbG9jYXRpb24iLCJtdXRhdGlvbiIsImNyZWF0ZVRpbWVQb2xpY3lXaXRoQWxsb2NhdGlvbiIsIl8iLCJ0aW1lUG9saWN5RGF0YSIsInVwZGF0ZVRpbWVQb2xpY3lXaXRoQWxsb2NhdGlvbiIsInVwZGF0ZWQiLCJ1cGRhdGVPbmUiLCJjcmVhdGVNYW51YWxBbGxvY2F0aW9uQWRqdXN0bWVudCIsImZ1bGxFdmVudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/Allocations.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/Holidays.ts":
/*!********************************************!*\
  !*** ../../schemas/extensions/Holidays.ts ***!
  \********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Holidays: () => (/* binding */ Holidays)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/holidays/dateHolidays */ \"(api)/../../lib/holidays/dateHolidays.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst Holidays = ()=>{\n    const Holiday = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"Holiday\",\n        fields: {\n            date: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (root)=>root.date\n            }),\n            title: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String),\n                resolve: (root)=>root.title\n            })\n        }\n    });\n    return {\n        query: {\n            holidays: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(Holiday)),\n                args: {\n                    locationId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    start: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    }),\n                    end: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    })\n                },\n                async resolve (source, { locationId, start, end }, context) {\n                    const location = await context.query.Location.findOne({\n                        where: {\n                            id: locationId\n                        },\n                        query: \"holidayCountry\"\n                    });\n                    if (!location?.holidayCountry) return [];\n                    const startDate = new Date(start);\n                    const endDate = new Date(end);\n                    return (0,_lib_holidays_dateHolidays__WEBPACK_IMPORTED_MODULE_1__.getHolidaysInRange)({\n                        country: location.holidayCountry,\n                        start: startDate,\n                        end: endDate\n                    });\n                }\n            })\n        }\n    };\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL0hvbGlkYXlzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFDZ0Q7QUFDcUI7QUFJOUQsTUFBTUcsV0FBVztJQUN0QixNQUFNQyxVQUFVSCxxREFBQ0EsQ0FBQ0ksTUFBTSxHQUFvQztRQUMxREMsTUFBTTtRQUNOQyxRQUFRO1lBQ05DLE1BQU1QLHFEQUFDQSxDQUFDUSxLQUFLLENBQUM7Z0JBQUVDLE1BQU1ULHFEQUFDQSxDQUFDVSxPQUFPLENBQUNWLHFEQUFDQSxDQUFDVyxNQUFNO2dCQUFHQyxTQUFTQyxDQUFBQSxPQUFRQSxLQUFLTixJQUFJO1lBQUM7WUFDdEVPLE9BQU9kLHFEQUFDQSxDQUFDUSxLQUFLLENBQUM7Z0JBQUVDLE1BQU1ULHFEQUFDQSxDQUFDVSxPQUFPLENBQUNWLHFEQUFDQSxDQUFDVyxNQUFNO2dCQUFHQyxTQUFTQyxDQUFBQSxPQUFRQSxLQUFLQyxLQUFLO1lBQUM7UUFDMUU7SUFDRjtJQUVBLE9BQU87UUFDTEMsT0FBTztZQUNMQyxVQUFVaEIscURBQUNBLENBQUNRLEtBQUssQ0FBQztnQkFDaEJDLE1BQU1ULHFEQUFDQSxDQUFDaUIsSUFBSSxDQUFDakIscURBQUNBLENBQUNVLE9BQU8sQ0FBQ1A7Z0JBQ3ZCZSxNQUFNO29CQUNKQyxZQUFZbkIscURBQUNBLENBQUNvQixHQUFHLENBQUM7d0JBQUVYLE1BQU1ULHFEQUFDQSxDQUFDVSxPQUFPLENBQUNWLHFEQUFDQSxDQUFDcUIsRUFBRTtvQkFBRTtvQkFDMUNDLE9BQU90QixxREFBQ0EsQ0FBQ29CLEdBQUcsQ0FBQzt3QkFBRVgsTUFBTVQscURBQUNBLENBQUNVLE9BQU8sQ0FBQ1YscURBQUNBLENBQUNXLE1BQU07b0JBQUU7b0JBQ3pDWSxLQUFLdkIscURBQUNBLENBQUNvQixHQUFHLENBQUM7d0JBQUVYLE1BQU1ULHFEQUFDQSxDQUFDVSxPQUFPLENBQUNWLHFEQUFDQSxDQUFDVyxNQUFNO29CQUFFO2dCQUN6QztnQkFDQSxNQUFNQyxTQUFRWSxNQUFNLEVBQUUsRUFBRUwsVUFBVSxFQUFFRyxLQUFLLEVBQUVDLEdBQUcsRUFBRSxFQUFFRSxPQUFPO29CQUN2RCxNQUFNQyxXQUFZLE1BQU1ELFFBQVFWLEtBQUssQ0FBQ1ksUUFBUSxDQUFDQyxPQUFPLENBQUM7d0JBQ3JEQyxPQUFPOzRCQUFFQyxJQUFJWDt3QkFBcUI7d0JBQ2xDSixPQUFPO29CQUNUO29CQUNBLElBQUksQ0FBQ1csVUFBVUssZ0JBQWdCLE9BQU8sRUFBRTtvQkFDeEMsTUFBTUMsWUFBWSxJQUFJQyxLQUFLWDtvQkFDM0IsTUFBTVksVUFBVSxJQUFJRCxLQUFLVjtvQkFDekIsT0FBT3RCLDhFQUFrQkEsQ0FBQzt3QkFDeEJrQyxTQUFTVCxTQUFTSyxjQUFjO3dCQUNoQ1QsT0FBT1U7d0JBQ1BULEtBQUtXO29CQUNQO2dCQUNGO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL2V4dGVuc2lvbnMvSG9saWRheXMudHM/ZjExNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFR5cGVJbmZvIH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcbmltcG9ydCB7IGdyYXBocWwgYXMgZyB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUnO1xuaW1wb3J0IHsgZ2V0SG9saWRheXNJblJhbmdlIH0gZnJvbSAnLi4vLi4vbGliL2hvbGlkYXlzL2RhdGVIb2xpZGF5cyc7XG5cbnR5cGUgTG9jYXRpb25JdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ0xvY2F0aW9uJ11bJ2l0ZW0nXTtcblxuZXhwb3J0IGNvbnN0IEhvbGlkYXlzID0gKCkgPT4ge1xuICBjb25zdCBIb2xpZGF5ID0gZy5vYmplY3Q8eyBkYXRlOiBzdHJpbmc7IHRpdGxlOiBzdHJpbmcgfT4oKSh7XG4gICAgbmFtZTogJ0hvbGlkYXknLFxuICAgIGZpZWxkczoge1xuICAgICAgZGF0ZTogZy5maWVsZCh7IHR5cGU6IGcubm9uTnVsbChnLlN0cmluZyksIHJlc29sdmU6IHJvb3QgPT4gcm9vdC5kYXRlIH0pLFxuICAgICAgdGl0bGU6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5TdHJpbmcpLCByZXNvbHZlOiByb290ID0+IHJvb3QudGl0bGUgfSlcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgcXVlcnk6IHtcbiAgICAgIGhvbGlkYXlzOiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogZy5saXN0KGcubm9uTnVsbChIb2xpZGF5KSksXG4gICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICBsb2NhdGlvbklkOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLklEKSB9KSxcbiAgICAgICAgICBzdGFydDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5TdHJpbmcpIH0pLFxuICAgICAgICAgIGVuZDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5TdHJpbmcpIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIHJlc29sdmUoc291cmNlLCB7IGxvY2F0aW9uSWQsIHN0YXJ0LCBlbmQgfSwgY29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gKGF3YWl0IGNvbnRleHQucXVlcnkuTG9jYXRpb24uZmluZE9uZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogbG9jYXRpb25JZCBhcyBzdHJpbmcgfSxcbiAgICAgICAgICAgIHF1ZXJ5OiAnaG9saWRheUNvdW50cnknXG4gICAgICAgICAgfSkpIGFzIFBpY2s8TG9jYXRpb25JdGVtLCAnaG9saWRheUNvdW50cnknPiB8IG51bGw7XG4gICAgICAgICAgaWYgKCFsb2NhdGlvbj8uaG9saWRheUNvdW50cnkpIHJldHVybiBbXSBhcyBBcnJheTx7IGRhdGU6IHN0cmluZzsgdGl0bGU6IHN0cmluZyB9PjtcbiAgICAgICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZShzdGFydCBhcyBzdHJpbmcpO1xuICAgICAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShlbmQgYXMgc3RyaW5nKTtcbiAgICAgICAgICByZXR1cm4gZ2V0SG9saWRheXNJblJhbmdlKHtcbiAgICAgICAgICAgIGNvdW50cnk6IGxvY2F0aW9uLmhvbGlkYXlDb3VudHJ5LFxuICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0RGF0ZSxcbiAgICAgICAgICAgIGVuZDogZW5kRGF0ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfTtcbn07XG4iXSwibmFtZXMiOlsiZ3JhcGhxbCIsImciLCJnZXRIb2xpZGF5c0luUmFuZ2UiLCJIb2xpZGF5cyIsIkhvbGlkYXkiLCJvYmplY3QiLCJuYW1lIiwiZmllbGRzIiwiZGF0ZSIsImZpZWxkIiwidHlwZSIsIm5vbk51bGwiLCJTdHJpbmciLCJyZXNvbHZlIiwicm9vdCIsInRpdGxlIiwicXVlcnkiLCJob2xpZGF5cyIsImxpc3QiLCJhcmdzIiwibG9jYXRpb25JZCIsImFyZyIsIklEIiwic3RhcnQiLCJlbmQiLCJzb3VyY2UiLCJjb250ZXh0IiwibG9jYXRpb24iLCJMb2NhdGlvbiIsImZpbmRPbmUiLCJ3aGVyZSIsImlkIiwiaG9saWRheUNvdW50cnkiLCJzdGFydERhdGUiLCJEYXRlIiwiZW5kRGF0ZSIsImNvdW50cnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/Holidays.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/Onboarding.ts":
/*!**********************************************!*\
  !*** ../../schemas/extensions/Onboarding.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Onboarding: () => (/* binding */ Onboarding)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var free_email_domains__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! free-email-domains */ \"free-email-domains\");\n/* harmony import */ var free_email_domains__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(free_email_domains__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n\n\n\nconst freeEmailDomainSet = new Set(free_email_domains__WEBPACK_IMPORTED_MODULE_1___default().map((domain)=>domain.toLowerCase()));\nconst defaultWorkingDays = [\n    \"MON\",\n    \"TUE\",\n    \"WED\",\n    \"THU\",\n    \"FRI\"\n];\nconst timeTypeBlueprints = [\n    {\n        name: \"Paid Time Off\",\n        policy: {\n            allowance: 20,\n            carryoverLimit: 10,\n            overdraftLimit: 0\n        }\n    },\n    {\n        name: \"Sick Day\",\n        policy: {\n            allowance: 18,\n            carryoverLimit: 0,\n            overdraftLimit: 0\n        }\n    },\n    {\n        name: \"Work From Home\",\n        policy: {\n            allowance: 120,\n            carryoverLimit: 0,\n            overdraftLimit: 0\n        }\n    }\n];\nconst extractDomain = (email)=>{\n    if (!email) return null;\n    const [, domain] = email.toLowerCase().split(\"@\");\n    return domain || null;\n};\nconst Onboarding = (base)=>{\n    const LocationDefaultsInput = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.inputObject({\n        name: \"LocationDefaultsInput\",\n        fields: {\n            timezone: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n            }),\n            weekStartDay: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(base.enum(\"LocationWeekStartDayType\"))\n            }),\n            workingDays: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(base.enum(\"LocationWorkingDayType\"))))\n            }),\n            holidayCountry: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n            })\n        }\n    });\n    const CompleteOnboardingInput = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.inputObject({\n        name: \"CompleteOnboardingInput\",\n        fields: {\n            orgName: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n            }),\n            allowAutojoinForDomain: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean)\n            }),\n            locationDefaults: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(LocationDefaultsInput)\n            })\n        }\n    });\n    const OnboardingResult = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"CompleteOnboardingPayload\",\n        fields: {\n            orgId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n            }),\n            locationId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n            }),\n            timeTypeIds: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)))\n            }),\n            policyIds: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)))\n            })\n        }\n    });\n    return {\n        mutation: {\n            completeOnboarding: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(OnboardingResult),\n                args: {\n                    input: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(CompleteOnboardingInput)\n                    })\n                },\n                async resolve (_root, { input }, context) {\n                    const session = context.session;\n                    if (!session?.email) throw new Error(\"Unauthorized\");\n                    if (session.orgId) throw new Error(\"Onboarding already completed.\");\n                    const { orgName: rawOrgName, allowAutojoinForDomain, locationDefaults: rawLocationDefaults } = input;\n                    const orgName = typeof rawOrgName === \"string\" ? rawOrgName.trim() : \"\";\n                    if (!orgName) throw new Error(\"Organization name is required.\");\n                    const locationDefaults = rawLocationDefaults ?? {\n                        timezone: undefined,\n                        weekStartDay: undefined,\n                        workingDays: undefined,\n                        holidayCountry: undefined\n                    };\n                    const timezone = locationDefaults?.timezone || \"America/New_York\";\n                    const weekStartDay = locationDefaults?.weekStartDay || \"MON\";\n                    const workingDays = Array.isArray(locationDefaults?.workingDays) && locationDefaults.workingDays.length > 0 ? locationDefaults.workingDays : defaultWorkingDays;\n                    const holidayCountry = locationDefaults?.holidayCountry || \"US\";\n                    const domain = extractDomain(session.email);\n                    const allowAutojoin = Boolean(allowAutojoinForDomain && domain && !freeEmailDomainSet.has(domain));\n                    const autojoinDomains = allowAutojoin && domain ? [\n                        domain\n                    ] : [];\n                    const sudo = context.sudo();\n                    const organization = await sudo.db.Organization.createOne({\n                        data: {\n                            name: orgName,\n                            autojoinDomains\n                        },\n                        query: \"id\"\n                    });\n                    if (!organization?.id) {\n                        throw new Error(\"Failed to create organization.\");\n                    }\n                    const location = await sudo.db.Location.createOne({\n                        data: {\n                            name: `${orgName} Primary Location`,\n                            org: {\n                                connect: {\n                                    id: organization.id\n                                }\n                            },\n                            timezone,\n                            weekStartDay,\n                            workingDays,\n                            holidayCountry\n                        },\n                        query: \"id\"\n                    });\n                    if (!location?.id) {\n                        throw new Error(\"Failed to create location.\");\n                    }\n                    const timeTypeIds = [];\n                    const policyIds = [];\n                    for (const blueprint of timeTypeBlueprints){\n                        const timeType = await sudo.db.TimeType.createOne({\n                            data: {\n                                name: blueprint.name,\n                                org: {\n                                    connect: {\n                                        id: organization.id\n                                    }\n                                }\n                            },\n                            query: \"id\"\n                        });\n                        if (!timeType?.id) throw new Error(`Failed to create time type ${blueprint.name}.`);\n                        timeTypeIds.push(timeType.id);\n                        const timePolicy = await sudo.db.TimePolicy.createOne({\n                            data: {\n                                name: blueprint.name,\n                                org: {\n                                    connect: {\n                                        id: organization.id\n                                    }\n                                },\n                                timeType: {\n                                    connect: {\n                                        id: timeType.id\n                                    }\n                                },\n                                locations: {\n                                    connect: [\n                                        {\n                                            id: location.id\n                                        }\n                                    ]\n                                }\n                            },\n                            query: \"id\"\n                        });\n                        if (!timePolicy?.id) throw new Error(`Failed to create time policy for ${blueprint.name}.`);\n                        await sudo.db.TimePolicyAllocation.createOne({\n                            data: {\n                                timePolicy: {\n                                    connect: {\n                                        id: timePolicy.id\n                                    }\n                                },\n                                allocation: blueprint.policy.allowance,\n                                carryoverLimit: blueprint.policy.carryoverLimit,\n                                overdraftLimit: blueprint.policy.overdraftLimit,\n                                effectiveAt: new Date().toISOString()\n                            }\n                        });\n                        policyIds.push(timePolicy.id);\n                    }\n                    let userId = session.id;\n                    if (!userId) {\n                        const users = await sudo.query.User.findMany({\n                            where: {\n                                email: {\n                                    equals: session.email\n                                }\n                            },\n                            query: \"id\"\n                        });\n                        userId = users?.[0]?.id ?? null;\n                    }\n                    if (!userId) {\n                        throw new Error(\"Unable to locate user for onboarding.\");\n                    }\n                    const existingUserRecord = await sudo.query.User.findOne({\n                        where: {\n                            id: userId\n                        },\n                        query: \"id org { id } location { id }\"\n                    });\n                    const userUpdateData = {};\n                    if (!existingUserRecord?.org?.id) {\n                        userUpdateData.org = {\n                            connect: {\n                                id: organization.id\n                            }\n                        };\n                    }\n                    if (!existingUserRecord?.location?.id) {\n                        userUpdateData.location = {\n                            connect: {\n                                id: location.id\n                            }\n                        };\n                    }\n                    // Set role to ORG_OWNER for the user creating the organization\n                    userUpdateData.role = _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.UserRole.ORG_OWNER;\n                    if (Object.keys(userUpdateData).length > 0) {\n                        await sudo.db.User.updateOne({\n                            where: {\n                                id: userId\n                            },\n                            data: userUpdateData\n                        });\n                    }\n                    return {\n                        orgId: organization.id,\n                        locationId: location.id,\n                        timeTypeIds,\n                        policyIds\n                    };\n                }\n            })\n        }\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL09uYm9hcmRpbmcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ2dEO0FBRUU7QUFFSztBQU12RCxNQUFNSSxxQkFBcUIsSUFBSUMsSUFBWSw2REFBa0MsQ0FBQ0UsQ0FBQUEsU0FBVUEsT0FBT0MsV0FBVztBQUMxRyxNQUFNQyxxQkFBcUI7SUFBQztJQUFPO0lBQU87SUFBTztJQUFPO0NBQU07QUFFOUQsTUFBTUMscUJBQXFCO0lBQ3pCO1FBQ0VDLE1BQU07UUFDTkMsUUFBUTtZQUNOQyxXQUFXO1lBQ1hDLGdCQUFnQjtZQUNoQkMsZ0JBQWdCO1FBQ2xCO0lBQ0Y7SUFDQTtRQUNFSixNQUFNO1FBQ05DLFFBQVE7WUFDTkMsV0FBVztZQUNYQyxnQkFBZ0I7WUFDaEJDLGdCQUFnQjtRQUNsQjtJQUNGO0lBQ0E7UUFDRUosTUFBTTtRQUNOQyxRQUFRO1lBQ05DLFdBQVc7WUFDWEMsZ0JBQWdCO1lBQ2hCQyxnQkFBZ0I7UUFDbEI7SUFDRjtDQUNEO0FBRUQsTUFBTUMsZ0JBQWdCLENBQUNDO0lBQ3JCLElBQUksQ0FBQ0EsT0FBTyxPQUFPO0lBQ25CLE1BQU0sR0FBR1YsT0FBTyxHQUFHVSxNQUFNVCxXQUFXLEdBQUdVLEtBQUssQ0FBQztJQUM3QyxPQUFPWCxVQUFVO0FBQ25CO0FBRU8sTUFBTVksYUFBYSxDQUFDQztJQUN6QixNQUFNQyx3QkFBd0JwQixxREFBQ0EsQ0FBQ3FCLFdBQVcsQ0FBQztRQUMxQ1gsTUFBTTtRQUNOWSxRQUFRO1lBQ05DLFVBQVV2QixxREFBQ0EsQ0FBQ3dCLEdBQUcsQ0FBQztnQkFBRUMsTUFBTXpCLHFEQUFDQSxDQUFDMEIsT0FBTyxDQUFDMUIscURBQUNBLENBQUMyQixNQUFNO1lBQUU7WUFDNUNDLGNBQWM1QixxREFBQ0EsQ0FBQ3dCLEdBQUcsQ0FBQztnQkFBRUMsTUFBTXpCLHFEQUFDQSxDQUFDMEIsT0FBTyxDQUFDUCxLQUFLVSxJQUFJLENBQUM7WUFBNkI7WUFDN0VDLGFB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QW9CdEIsVUFBVUQsSUFBSTt3QkFDckN5QixlQUFleEIsUUFBUSxHQUFHOzRCQUFFRyxTQUFTO2dDQUFFSixJQUFJQyxTQUFTRCxFQUFFOzRCQUFDO3dCQUFFO29CQUMzRDtvQkFDQSwrREFBK0Q7b0JBQy9EeUIsZUFBZUMsSUFBSSxHQUFHaEcsNERBQVFBLENBQUNpRyxTQUFTO29CQUV4QyxJQUFJQyxPQUFPQyxJQUFJLENBQUNKLGdCQUFnQnBDLE1BQU0sR0FBRyxHQUFHO3dCQUMxQyxNQUFNSSxLQUFLRSxFQUFFLENBQUN3QixJQUFJLENBQUNXLFNBQVMsQ0FBQzs0QkFDM0JULE9BQU87Z0NBQUVyQixJQUFJaUI7NEJBQU87NEJBQ3BCbkIsTUFBTTJCO3dCQUNSO29CQUNGO29CQUVBLE9BQU87d0JBQ0x6RCxPQUFPMEIsYUFBYU0sRUFBRTt3QkFDdEI3QixZQUFZOEIsU0FBU0QsRUFBRTt3QkFDdkI1Qjt3QkFDQUM7b0JBQ0Y7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3NjaGVtYXMvZXh0ZW5zaW9ucy9PbmJvYXJkaW5nLnRzPzVlMjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBUeXBlSW5mbyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBncmFwaHFsIGFzIGcgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlJztcbmltcG9ydCB0eXBlIHsgQmFzZVNjaGVtYU1ldGEgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2Rpc3QvZGVjbGFyYXRpb25zL3NyYy90eXBlcy9zY2hlbWEvZ3JhcGhxbC10cy1zY2hlbWEnO1xuaW1wb3J0IGZyZWVFbWFpbERvbWFpbnMgZnJvbSAnZnJlZS1lbWFpbC1kb21haW5zJztcbmltcG9ydCB0eXBlIHsgU2Vzc2lvbiB9IGZyb20gJy4uLy4uL2F1dGgnO1xuaW1wb3J0IHsgVXNlclJvbGUgfSBmcm9tICcuLi8uLi9kb21haW5zL2F1dGgvdXNlclJvbGUnO1xuXG50eXBlIFVzZXJJdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ1VzZXInXVsnaXRlbSddO1xudHlwZSBPcmdhbml6YXRpb25JdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ09yZ2FuaXphdGlvbiddWydpdGVtJ107XG50eXBlIExvY2F0aW9uSXRlbSA9IFR5cGVJbmZvWydsaXN0cyddWydMb2NhdGlvbiddWydpdGVtJ107XG5cbmNvbnN0IGZyZWVFbWFpbERvbWFpblNldCA9IG5ldyBTZXQ8c3RyaW5nPigoZnJlZUVtYWlsRG9tYWlucyBhcyBzdHJpbmdbXSkubWFwKGRvbWFpbiA9PiBkb21haW4udG9Mb3dlckNhc2UoKSkpO1xuY29uc3QgZGVmYXVsdFdvcmtpbmdEYXlzID0gWydNT04nLCAnVFVFJywgJ1dFRCcsICdUSFUnLCAnRlJJJ107XG5cbmNvbnN0IHRpbWVUeXBlQmx1ZXByaW50cyA9IFtcbiAge1xuICAgIG5hbWU6ICdQYWlkIFRpbWUgT2ZmJyxcbiAgICBwb2xpY3k6IHtcbiAgICAgIGFsbG93YW5jZTogMjAsXG4gICAgICBjYXJyeW92ZXJMaW1pdDogMTAsXG4gICAgICBvdmVyZHJhZnRMaW1pdDogMFxuICAgIH1cbiAgfSxcbiAge1xuICAgIG5hbWU6ICdTaWNrIERheScsXG4gICAgcG9saWN5OiB7XG4gICAgICBhbGxvd2FuY2U6IDE4LFxuICAgICAgY2FycnlvdmVyTGltaXQ6IDAsXG4gICAgICBvdmVyZHJhZnRMaW1pdDogMFxuICAgIH1cbiAgfSxcbiAge1xuICAgIG5hbWU6ICdXb3JrIEZyb20gSG9tZScsXG4gICAgcG9saWN5OiB7XG4gICAgICBhbGxvd2FuY2U6IDEyMCxcbiAgICAgIGNhcnJ5b3ZlckxpbWl0OiAwLFxuICAgICAgb3ZlcmRyYWZ0TGltaXQ6IDBcbiAgICB9XG4gIH1cbl0gYXMgY29uc3Q7XG5cbmNvbnN0IGV4dHJhY3REb21haW4gPSAoZW1haWw/OiBzdHJpbmcgfCBudWxsKSA9PiB7XG4gIGlmICghZW1haWwpIHJldHVybiBudWxsO1xuICBjb25zdCBbLCBkb21haW5dID0gZW1haWwudG9Mb3dlckNhc2UoKS5zcGxpdCgnQCcpO1xuICByZXR1cm4gZG9tYWluIHx8IG51bGw7XG59O1xuXG5leHBvcnQgY29uc3QgT25ib2FyZGluZyA9IChiYXNlOiBCYXNlU2NoZW1hTWV0YSkgPT4ge1xuICBjb25zdCBMb2NhdGlvbkRlZmF1bHRzSW5wdXQgPSBnLmlucHV0T2JqZWN0KHtcbiAgICBuYW1lOiAnTG9jYXRpb25EZWZhdWx0c0lucHV0JyxcbiAgICBmaWVsZHM6IHtcbiAgICAgIHRpbWV6b25lOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLlN0cmluZykgfSksXG4gICAgICB3ZWVrU3RhcnREYXk6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGJhc2UuZW51bSgnTG9jYXRpb25XZWVrU3RhcnREYXlUeXBlJykpIH0pLFxuICAgICAgd29ya2luZ0RheXM6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcubGlzdChnLm5vbk51bGwoYmFzZS5lbnVtKCdMb2NhdGlvbldvcmtpbmdEYXlUeXBlJykpKSkgfSksXG4gICAgICBob2xpZGF5Q291bnRyeTogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5TdHJpbmcpIH0pXG4gICAgfVxuICB9KTtcblxuICBjb25zdCBDb21wbGV0ZU9uYm9hcmRpbmdJbnB1dCA9IGcuaW5wdXRPYmplY3Qoe1xuICAgIG5hbWU6ICdDb21wbGV0ZU9uYm9hcmRpbmdJbnB1dCcsXG4gICAgZmllbGRzOiB7XG4gICAgICBvcmdOYW1lOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLlN0cmluZykgfSksXG4gICAgICBhbGxvd0F1dG9qb2luRm9yRG9tYWluOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLkJvb2xlYW4pIH0pLFxuICAgICAgbG9jYXRpb25EZWZhdWx0czogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoTG9jYXRpb25EZWZhdWx0c0lucHV0KSB9KVxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgT25ib2FyZGluZ1Jlc3VsdCA9IGcub2JqZWN0PHtcbiAgICBvcmdJZDogc3RyaW5nO1xuICAgIGxvY2F0aW9uSWQ6IHN0cmluZztcbiAgICB0aW1lVHlwZUlkczogc3RyaW5nW107XG4gICAgcG9saWN5SWRzOiBzdHJpbmdbXTtcbiAgfT4oKSh7XG4gICAgbmFtZTogJ0NvbXBsZXRlT25ib2FyZGluZ1BheWxvYWQnLFxuICAgIGZpZWxkczoge1xuICAgICAgb3JnSWQ6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCkgfSksXG4gICAgICBsb2NhdGlvbklkOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcuSUQpIH0pLFxuICAgICAgdGltZVR5cGVJZHM6IGcuZmllbGQoeyB0eXBlOiBnLm5vbk51bGwoZy5saXN0KGcubm9uTnVsbChnLklEKSkpIH0pLFxuICAgICAgcG9saWN5SWRzOiBnLmZpZWxkKHsgdHlwZTogZy5ub25OdWxsKGcubGlzdChnLm5vbk51bGwoZy5JRCkpKSB9KVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBtdXRhdGlvbjoge1xuICAgICAgY29tcGxldGVPbmJvYXJkaW5nOiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogZy5ub25OdWxsKE9uYm9hcmRpbmdSZXN1bHQpLFxuICAgICAgICBhcmdzOiB7XG4gICAgICAgICAgaW5wdXQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKENvbXBsZXRlT25ib2FyZGluZ0lucHV0KSB9KVxuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXNvbHZlKF9yb290LCB7IGlucHV0IH0sIGNvbnRleHQpIHtcbiAgICAgICAgICBjb25zdCBzZXNzaW9uID0gY29udGV4dC5zZXNzaW9uIGFzIFNlc3Npb24gfCB1bmRlZmluZWQ7XG4gICAgICAgICAgaWYgKCFzZXNzaW9uPy5lbWFpbCkgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICAgICAgICBpZiAoc2Vzc2lvbi5vcmdJZCkgdGhyb3cgbmV3IEVycm9yKCdPbmJvYXJkaW5nIGFscmVhZHkgY29tcGxldGVkLicpO1xuXG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgb3JnTmFtZTogcmF3T3JnTmFtZSxcbiAgICAgICAgICAgIGFsbG93QXV0b2pvaW5Gb3JEb21haW4sXG4gICAgICAgICAgICBsb2NhdGlvbkRlZmF1bHRzOiByYXdMb2NhdGlvbkRlZmF1bHRzXG4gICAgICAgICAgfSA9IGlucHV0IGFzIHtcbiAgICAgICAgICAgIG9yZ05hbWU6IHN0cmluZztcbiAgICAgICAgICAgIGFsbG93QXV0b2pvaW5Gb3JEb21haW46IGJvb2xlYW47XG4gICAgICAgICAgICBsb2NhdGlvbkRlZmF1bHRzOiB7XG4gICAgICAgICAgICAgIHRpbWV6b25lOiBzdHJpbmc7XG4gICAgICAgICAgICAgIHdlZWtTdGFydERheTogc3RyaW5nO1xuICAgICAgICAgICAgICB3b3JraW5nRGF5czogc3RyaW5nW107XG4gICAgICAgICAgICAgIGhvbGlkYXlDb3VudHJ5OiBzdHJpbmc7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCBvcmdOYW1lID0gdHlwZW9mIHJhd09yZ05hbWUgPT09ICdzdHJpbmcnID8gcmF3T3JnTmFtZS50cmltKCkgOiAnJztcbiAgICAgICAgICBpZiAoIW9yZ05hbWUpIHRocm93IG5ldyBFcnJvcignT3JnYW5pemF0aW9uIG5hbWUgaXMgcmVxdWlyZWQuJyk7XG5cbiAgICAgICAgICBjb25zdCBsb2NhdGlvbkRlZmF1bHRzID0gcmF3TG9jYXRpb25EZWZhdWx0cyA/PyB7XG4gICAgICAgICAgICB0aW1lem9uZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgd2Vla1N0YXJ0RGF5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICB3b3JraW5nRGF5czogdW5kZWZpbmVkLFxuICAgICAgICAgICAgaG9saWRheUNvdW50cnk6IHVuZGVmaW5lZFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCB0aW1lem9uZSA9IGxvY2F0aW9uRGVmYXVsdHM/LnRpbWV6b25lIHx8ICdBbWVyaWNhL05ld19Zb3JrJztcbiAgICAgICAgICBjb25zdCB3ZWVrU3RhcnREYXkgPSBsb2NhdGlvbkRlZmF1bHRzPy53ZWVrU3RhcnREYXkgfHwgJ01PTic7XG4gICAgICAgICAgY29uc3Qgd29ya2luZ0RheXMgPVxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShsb2NhdGlvbkRlZmF1bHRzPy53b3JraW5nRGF5cykgJiYgbG9jYXRpb25EZWZhdWx0cy53b3JraW5nRGF5cy5sZW5ndGggPiAwXG4gICAgICAgICAgICAgID8gbG9jYXRpb25EZWZhdWx0cy53b3JraW5nRGF5c1xuICAgICAgICAgICAgICA6IGRlZmF1bHRXb3JraW5nRGF5cztcbiAgICAgICAgICBjb25zdCBob2xpZGF5Q291bnRyeSA9IGxvY2F0aW9uRGVmYXVsdHM/LmhvbGlkYXlDb3VudHJ5IHx8ICdVUyc7XG5cbiAgICAgICAgICBjb25zdCBkb21haW4gPSBleHRyYWN0RG9tYWluKHNlc3Npb24uZW1haWwpO1xuICAgICAgICAgIGNvbnN0IGFsbG93QXV0b2pvaW4gPSBCb29sZWFuKGFsbG93QXV0b2pvaW5Gb3JEb21haW4gJiYgZG9tYWluICYmICFmcmVlRW1haWxEb21haW5TZXQuaGFzKGRvbWFpbikpO1xuICAgICAgICAgIGNvbnN0IGF1dG9qb2luRG9tYWlucyA9IGFsbG93QXV0b2pvaW4gJiYgZG9tYWluID8gW2RvbWFpbl0gOiBbXTtcblxuICAgICAgICAgIGNvbnN0IHN1ZG8gPSBjb250ZXh0LnN1ZG8oKTtcblxuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbiA9IGF3YWl0IHN1ZG8uZGIuT3JnYW5pemF0aW9uLmNyZWF0ZU9uZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIG5hbWU6IG9yZ05hbWUsXG4gICAgICAgICAgICAgIGF1dG9qb2luRG9tYWluc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHF1ZXJ5OiAnaWQnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFvcmdhbml6YXRpb24/LmlkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgb3JnYW5pemF0aW9uLicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgc3Vkby5kYi5Mb2NhdGlvbi5jcmVhdGVPbmUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBuYW1lOiBgJHtvcmdOYW1lfSBQcmltYXJ5IExvY2F0aW9uYCxcbiAgICAgICAgICAgICAgb3JnOiB7IGNvbm5lY3Q6IHsgaWQ6IG9yZ2FuaXphdGlvbi5pZCB9IH0sXG4gICAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgICB3ZWVrU3RhcnREYXksXG4gICAgICAgICAgICAgIHdvcmtpbmdEYXlzLFxuICAgICAgICAgICAgICBob2xpZGF5Q291bnRyeVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHF1ZXJ5OiAnaWQnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFsb2NhdGlvbj8uaWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBsb2NhdGlvbi4nKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB0aW1lVHlwZUlkczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICBjb25zdCBwb2xpY3lJZHM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IGJsdWVwcmludCBvZiB0aW1lVHlwZUJsdWVwcmludHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVUeXBlID0gYXdhaXQgc3Vkby5kYi5UaW1lVHlwZS5jcmVhdGVPbmUoe1xuICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogYmx1ZXByaW50Lm5hbWUsXG4gICAgICAgICAgICAgICAgb3JnOiB7IGNvbm5lY3Q6IHsgaWQ6IG9yZ2FuaXphdGlvbi5pZCB9IH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgcXVlcnk6ICdpZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF0aW1lVHlwZT8uaWQpIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSB0aW1lIHR5cGUgJHtibHVlcHJpbnQubmFtZX0uYCk7XG4gICAgICAgICAgICB0aW1lVHlwZUlkcy5wdXNoKHRpbWVUeXBlLmlkKTtcblxuICAgICAgICAgICAgY29uc3QgdGltZVBvbGljeSA9IGF3YWl0IHN1ZG8uZGIuVGltZVBvbGljeS5jcmVhdGVPbmUoe1xuICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogYmx1ZXByaW50Lm5hbWUsXG4gICAgICAgICAgICAgICAgb3JnOiB7IGNvbm5lY3Q6IHsgaWQ6IG9yZ2FuaXphdGlvbi5pZCB9IH0sXG4gICAgICAgICAgICAgICAgdGltZVR5cGU6IHsgY29ubmVjdDogeyBpZDogdGltZVR5cGUuaWQgfSB9LFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uczogeyBjb25uZWN0OiBbeyBpZDogbG9jYXRpb24uaWQgfV0gfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBxdWVyeTogJ2lkJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXRpbWVQb2xpY3k/LmlkKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgdGltZSBwb2xpY3kgZm9yICR7Ymx1ZXByaW50Lm5hbWV9LmApO1xuICAgICAgICAgICAgYXdhaXQgc3Vkby5kYi5UaW1lUG9saWN5QWxsb2NhdGlvbi5jcmVhdGVPbmUoe1xuICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgdGltZVBvbGljeTogeyBjb25uZWN0OiB7IGlkOiB0aW1lUG9saWN5LmlkIH0gfSxcbiAgICAgICAgICAgICAgICBhbGxvY2F0aW9uOiBibHVlcHJpbnQucG9saWN5LmFsbG93YW5jZSxcbiAgICAgICAgICAgICAgICBjYXJyeW92ZXJMaW1pdDogYmx1ZXByaW50LnBvbGljeS5jYXJyeW92ZXJMaW1pdCxcbiAgICAgICAgICAgICAgICBvdmVyZHJhZnRMaW1pdDogYmx1ZXByaW50LnBvbGljeS5vdmVyZHJhZnRMaW1pdCxcbiAgICAgICAgICAgICAgICBlZmZlY3RpdmVBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcG9saWN5SWRzLnB1c2godGltZVBvbGljeS5pZCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IHVzZXJJZCA9IHNlc3Npb24uaWQ7XG4gICAgICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJzID0gKGF3YWl0IHN1ZG8ucXVlcnkuVXNlci5maW5kTWFueSh7XG4gICAgICAgICAgICAgIHdoZXJlOiB7IGVtYWlsOiB7IGVxdWFsczogc2Vzc2lvbi5lbWFpbCB9IH0sXG4gICAgICAgICAgICAgIHF1ZXJ5OiAnaWQnXG4gICAgICAgICAgICB9KSkgYXMgUGljazxVc2VySXRlbSwgJ2lkJz5bXTtcbiAgICAgICAgICAgIHVzZXJJZCA9IHVzZXJzPy5bMF0/LmlkID8/IG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGxvY2F0ZSB1c2VyIGZvciBvbmJvYXJkaW5nLicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlclJlY29yZCA9IChhd2FpdCBzdWRvLnF1ZXJ5LlVzZXIuZmluZE9uZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICAgICAgICBxdWVyeTogJ2lkIG9yZyB7IGlkIH0gbG9jYXRpb24geyBpZCB9J1xuICAgICAgICAgIH0pKSBhc1xuICAgICAgICAgICAgfCAoUGljazxVc2VySXRlbSwgJ2lkJz4gJiB7XG4gICAgICAgICAgICAgICAgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgICAgICAgICBsb2NhdGlvbjogUGljazxMb2NhdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHwgbnVsbDtcblxuICAgICAgICAgIGNvbnN0IHVzZXJVcGRhdGVEYXRhOiB7XG4gICAgICAgICAgICBvcmc/OiB7IGNvbm5lY3Q6IHsgaWQ6IHN0cmluZyB9IH07XG4gICAgICAgICAgICBsb2NhdGlvbj86IHsgY29ubmVjdDogeyBpZDogc3RyaW5nIH0gfTtcbiAgICAgICAgICAgIHJvbGU/OiBVc2VyUm9sZTtcbiAgICAgICAgICB9ID0ge307XG4gICAgICAgICAgaWYgKCFleGlzdGluZ1VzZXJSZWNvcmQ/Lm9yZz8uaWQpIHtcbiAgICAgICAgICAgIHVzZXJVcGRhdGVEYXRhLm9yZyA9IHsgY29ubmVjdDogeyBpZDogb3JnYW5pemF0aW9uLmlkIH0gfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFleGlzdGluZ1VzZXJSZWNvcmQ/LmxvY2F0aW9uPy5pZCkge1xuICAgICAgICAgICAgdXNlclVwZGF0ZURhdGEubG9jYXRpb24gPSB7IGNvbm5lY3Q6IHsgaWQ6IGxvY2F0aW9uLmlkIH0gfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gU2V0IHJvbGUgdG8gT1JHX09XTkVSIGZvciB0aGUgdXNlciBjcmVhdGluZyB0aGUgb3JnYW5pemF0aW9uXG4gICAgICAgICAgdXNlclVwZGF0ZURhdGEucm9sZSA9IFVzZXJSb2xlLk9SR19PV05FUjtcblxuICAgICAgICAgIGlmIChPYmplY3Qua2V5cyh1c2VyVXBkYXRlRGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgc3Vkby5kYi5Vc2VyLnVwZGF0ZU9uZSh7XG4gICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcbiAgICAgICAgICAgICAgZGF0YTogdXNlclVwZGF0ZURhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBvcmdJZDogb3JnYW5pemF0aW9uLmlkLFxuICAgICAgICAgICAgbG9jYXRpb25JZDogbG9jYXRpb24uaWQsXG4gICAgICAgICAgICB0aW1lVHlwZUlkcyxcbiAgICAgICAgICAgIHBvbGljeUlkc1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9O1xufTtcbiJdLCJuYW1lcyI6WyJncmFwaHFsIiwiZyIsImZyZWVFbWFpbERvbWFpbnMiLCJVc2VyUm9sZSIsImZyZWVFbWFpbERvbWFpblNldCIsIlNldCIsIm1hcCIsImRvbWFpbiIsInRvTG93ZXJDYXNlIiwiZGVmYXVsdFdvcmtpbmdEYXlzIiwidGltZVR5cGVCbHVlcHJpbnRzIiwibmFtZSIsInBvbGljeSIsImFsbG93YW5jZSIsImNhcnJ5b3ZlckxpbWl0Iiwib3ZlcmRyYWZ0TGltaXQiLCJleHRyYWN0RG9tYWluIiwiZW1haWwiLCJzcGxpdCIsIk9uYm9hcmRpbmciLCJiYXNlIiwiTG9jYXRpb25EZWZhdWx0c0lucHV0IiwiaW5wdXRPYmplY3QiLCJmaWVsZHMiLCJ0aW1lem9uZSIsImFyZyIsInR5cGUiLCJub25OdWxsIiwiU3RyaW5nIiwid2Vla1N0YXJ0RGF5IiwiZW51bSIsIndvcmtpbmdEYXlzIiwibGlzdCIsImhvbGlkYXlDb3VudHJ5IiwiQ29tcGxldGVPbmJvYXJkaW5nSW5wdXQiLCJvcmdOYW1lIiwiYWxsb3dBdXRvam9pbkZvckRvbWFpbiIsIkJvb2xlYW4iLCJsb2NhdGlvbkRlZmF1bHRzIiwiT25ib2FyZGluZ1Jlc3VsdCIsIm9iamVjdCIsIm9yZ0lkIiwiZmllbGQiLCJJRCIsImxvY2F0aW9uSWQiLCJ0aW1lVHlwZUlkcyIsInBvbGljeUlkcyIsIm11dGF0aW9uIiwiY29tcGxldGVPbmJvYXJkaW5nIiwiYXJncyIsImlucHV0IiwicmVzb2x2ZSIsIl9yb290IiwiY29udGV4dCIsInNlc3Npb24iLCJFcnJvciIsInJhd09yZ05hbWUiLCJyYXdMb2NhdGlvbkRlZmF1bHRzIiwidHJpbSIsInVuZGVmaW5lZCIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImFsbG93QXV0b2pvaW4iLCJoYXMiLCJhdXRvam9pbkRvbWFpbnMiLCJzdWRvIiwib3JnYW5pemF0aW9uIiwiZGIiLCJPcmdhbml6YXRpb24iLCJjcmVhdGVPbmUiLCJkYXRhIiwicXVlcnkiLCJpZCIsImxvY2F0aW9uIiwiTG9jYXRpb24iLCJvcmciLCJjb25uZWN0IiwiYmx1ZXByaW50IiwidGltZVR5cGUiLCJUaW1lVHlwZSIsInB1c2giLCJ0aW1lUG9saWN5IiwiVGltZVBvbGljeSIsImxvY2F0aW9ucyIsIlRpbWVQb2xpY3lBbGxvY2F0aW9uIiwiYWxsb2NhdGlvbiIsImVmZmVjdGl2ZUF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidXNlcklkIiwidXNlcnMiLCJVc2VyIiwiZmluZE1hbnkiLCJ3aGVyZSIsImVxdWFscyIsImV4aXN0aW5nVXNlclJlY29yZCIsImZpbmRPbmUiLCJ1c2VyVXBkYXRlRGF0YSIsInJvbGUiLCJPUkdfT1dORVIiLCJPYmplY3QiLCJrZXlzIiwidXBkYXRlT25lIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/Onboarding.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/Policies.ts":
/*!********************************************!*\
  !*** ../../schemas/extensions/Policies.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Policies: () => (/* binding */ Policies)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n\nconst Policies = (base)=>({\n        mutation: {\n            assignUserToPolicy: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean),\n                args: {\n                    userId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    policyId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    applyConfig: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean\n                    })\n                },\n                async resolve (source, { userId, policyId, applyConfig }, context) {\n                    const policy = await context.query.TimePolicy.findOne({\n                        where: {\n                            id: policyId\n                        },\n                        query: \"id locations { id } timeType { id } isAllocationManaged org { id }\"\n                    });\n                    if (!policy) return false;\n                    const policyLocations = policy.locations || [];\n                    if (policyLocations.length === 0) {\n                        throw new Error(\"Policy has no locations assigned\");\n                    }\n                    const user = await context.query.User.findOne({\n                        where: {\n                            id: userId\n                        },\n                        query: \"id location { id } org { id }\"\n                    });\n                    if (!user?.org?.id) {\n                        throw new Error(\"User must belong to an organization\");\n                    }\n                    const userLocationId = user.location?.id;\n                    const matchingPolicyLocation = policyLocations.find((loc)=>loc?.id === userLocationId);\n                    if (!matchingPolicyLocation && !applyConfig) {\n                        throw new Error(\"Policy does not cover the user's current location. Assign user to a matching location first.\");\n                    }\n                    if (!applyConfig) return true;\n                    const targetLocationId = matchingPolicyLocation?.id ?? policyLocations[0]?.id;\n                    if (!targetLocationId) {\n                        throw new Error(\"No location available from policy\");\n                    }\n                    const targetLocation = await context.query.Location.findOne({\n                        where: {\n                            id: targetLocationId\n                        },\n                        query: \"id org { id }\"\n                    });\n                    if (!targetLocation || targetLocation.org?.id !== user.org.id) {\n                        throw new Error(\"Policy location does not belong to user's organization\");\n                    }\n                    const updateData = {};\n                    if (userLocationId !== targetLocationId) {\n                        updateData.location = {\n                            connect: {\n                                id: targetLocationId\n                            }\n                        };\n                    }\n                    if (Object.keys(updateData).length > 0) {\n                        await context.db.User.updateOne({\n                            where: {\n                                id: userId\n                            },\n                            data: updateData\n                        });\n                    }\n                    return true;\n                }\n            })\n        }\n    });\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL1BvbGljaWVzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUNnRDtBQVN6QyxNQUFNRSxXQUFXLENBQUNDLE9BQTBCO1FBQ2pEQyxVQUFVO1lBQ1JDLG9CQUFvQkoscURBQUNBLENBQUNLLEtBQUssQ0FBQztnQkFDMUJDLE1BQU1OLHFEQUFDQSxDQUFDTyxPQUFPLENBQUNQLHFEQUFDQSxDQUFDUSxPQUFPO2dCQUN6QkMsTUFBTTtvQkFDSkMsUUFBUVYscURBQUNBLENBQUNXLEdBQUcsQ0FBQzt3QkFBRUwsTUFBTU4scURBQUNBLENBQUNPLE9BQU8sQ0FBQ1AscURBQUNBLENBQUNZLEVBQUU7b0JBQUU7b0JBQ3RDQyxVQUFVYixxREFBQ0EsQ0FBQ1csR0FBRyxDQUFDO3dCQUFFTCxNQUFNTixxREFBQ0EsQ0FBQ08sT0FBTyxDQUFDUCxxREFBQ0EsQ0FBQ1ksRUFBRTtvQkFBRTtvQkFDeENFLGFBQWFkLHFEQUFDQSxDQUFDVyxHQUFHLENBQUM7d0JBQUVMLE1BQU1OLHFEQUFDQSxDQUFDUSxPQUFPO29CQUFDO2dCQUN2QztnQkFDQSxNQUFNTyxTQUFRQyxNQUFNLEVBQUUsRUFBRU4sTUFBTSxFQUFFRyxRQUFRLEVBQUVDLFdBQVcsRUFBRSxFQUFFRyxPQUFPO29CQUM5RCxNQUFNQyxTQUFVLE1BQU1ELFFBQVFFLEtBQUssQ0FBQ0MsVUFBVSxDQUFDQyxPQUFPLENBQUM7d0JBQ3JEQyxPQUFPOzRCQUFFQyxJQUFJVjt3QkFBbUI7d0JBQ2hDTSxPQUFPO29CQUNUO29CQU9BLElBQUksQ0FBQ0QsUUFBUSxPQUFPO29CQUVwQixNQUFNTSxrQkFBa0JOLE9BQU9PLFNBQVMsSUFBSSxFQUFFO29CQUM5QyxJQUFJRCxnQkFBZ0JFLE1BQU0sS0FBSyxHQUFHO3dCQUNoQyxNQUFNLElBQUlDLE1BQU07b0JBQ2xCO29CQUVBLE1BQU1DLE9BQVEsTUFBTVgsUUFBUUUsS0FBSyxDQUFDVSxJQUFJLENBQUNSLE9BQU8sQ0FBQzt3QkFDN0NDLE9BQU87NEJBQUVDLElBQUliO3dCQUFpQjt3QkFDOUJTLE9BQU87b0JBQ1Q7b0JBTUEsSUFBSSxDQUFDUyxNQUFNRSxLQUFLUCxJQUFJO3dCQUNsQixNQUFNLElBQUlJLE1BQU07b0JBQ2xCO29CQUVBLE1BQU1JLGlCQUFpQkgsS0FBS0ksUUFBUSxFQUFFVDtvQkFDdEMsTUFBTVUseUJBQXlCVCxnQkFBZ0JVLElBQUksQ0FBQ0MsQ0FBQUEsTUFBT0EsS0FBS1osT0FBT1E7b0JBQ3ZFLElBQUksQ0FBQ0UsMEJBQTBCLENBQUNuQixhQUFhO3dCQUMzQyxNQUFNLElBQUlhLE1BQ1I7b0JBRUo7b0JBRUEsSUFBSSxDQUFDYixhQUFhLE9BQU87b0JBRXpCLE1BQU1zQixtQkFBbUJILHdCQUF3QlYsTUFBTUMsZUFBZSxDQUFDLEVBQUUsRUFBRUQ7b0JBQzNFLElBQUksQ0FBQ2Esa0JBQWtCO3dCQUNyQixNQUFNLElBQUlULE1BQU07b0JBQ2xCO29CQUVBLE1BQU1VLGlCQUFrQixNQUFNcEIsUUFBUUUsS0FBSyxDQUFDbUIsUUFBUSxDQUFDakIsT0FBTyxDQUFDO3dCQUMzREMsT0FBTzs0QkFBRUMsSUFBSWE7d0JBQTJCO3dCQUN4Q2pCLE9BQU87b0JBQ1Q7b0JBS0EsSUFBSSxDQUFDa0Isa0JBQWtCQSxlQUFlUCxHQUFHLEVBQUVQLE9BQU9LLEtBQUtFLEdBQUcsQ0FBQ1AsRUFBRSxFQUFFO3dCQUM3RCxNQUFNLElBQUlJLE1BQU07b0JBQ2xCO29CQUVBLE1BQU1ZLGFBRUYsQ0FBQztvQkFFTCxJQUFJUixtQkFBbUJLLGtCQUFrQjt3QkFDdkNHLFdBQVdQLFFBQVEsR0FBRzs0QkFBRVEsU0FBUztnQ0FBRWpCLElBQUlhOzRCQUFpQjt3QkFBRTtvQkFDNUQ7b0JBRUEsSUFBSUssT0FBT0MsSUFBSSxDQUFDSCxZQUFZYixNQUFNLEdBQUcsR0FBRzt3QkFDdEMsTUFBTVQsUUFBUTBCLEVBQUUsQ0FBQ2QsSUFBSSxDQUFDZSxTQUFTLENBQUM7NEJBQzlCdEIsT0FBTztnQ0FBRUMsSUFBSWI7NEJBQWlCOzRCQUM5Qm1DLE1BQU1OO3dCQUNSO29CQUNGO29CQUNBLE9BQU87Z0JBQ1Q7WUFDRjtRQUNGO0lBQ0YsR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL2V4dGVuc2lvbnMvUG9saWNpZXMudHM/NGIyMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFR5cGVJbmZvIH0gZnJvbSAnLmtleXN0b25lL3R5cGVzJztcbmltcG9ydCB7IGdyYXBocWwgYXMgZyB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUnO1xuaW1wb3J0IHR5cGUgeyBCYXNlU2NoZW1hTWV0YSB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUvZGlzdC9kZWNsYXJhdGlvbnMvc3JjL3R5cGVzL3NjaGVtYS9ncmFwaHFsLXRzLXNjaGVtYSc7XG5cbnR5cGUgVGltZVBvbGljeUl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVGltZVBvbGljeSddWydpdGVtJ107XG50eXBlIFVzZXJJdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ1VzZXInXVsnaXRlbSddO1xudHlwZSBMb2NhdGlvbkl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnTG9jYXRpb24nXVsnaXRlbSddO1xudHlwZSBUaW1lVHlwZUl0ZW0gPSBUeXBlSW5mb1snbGlzdHMnXVsnVGltZVR5cGUnXVsnaXRlbSddO1xudHlwZSBPcmdhbml6YXRpb25JdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ09yZ2FuaXphdGlvbiddWydpdGVtJ107XG5cbmV4cG9ydCBjb25zdCBQb2xpY2llcyA9IChiYXNlOiBCYXNlU2NoZW1hTWV0YSkgPT4gKHtcbiAgbXV0YXRpb246IHtcbiAgICBhc3NpZ25Vc2VyVG9Qb2xpY3k6IGcuZmllbGQoe1xuICAgICAgdHlwZTogZy5ub25OdWxsKGcuQm9vbGVhbiksXG4gICAgICBhcmdzOiB7XG4gICAgICAgIHVzZXJJZDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCkgfSksXG4gICAgICAgIHBvbGljeUlkOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLklEKSB9KSxcbiAgICAgICAgYXBwbHlDb25maWc6IGcuYXJnKHsgdHlwZTogZy5Cb29sZWFuIH0pXG4gICAgICB9LFxuICAgICAgYXN5bmMgcmVzb2x2ZShzb3VyY2UsIHsgdXNlcklkLCBwb2xpY3lJZCwgYXBwbHlDb25maWcgfSwgY29udGV4dCkge1xuICAgICAgICBjb25zdCBwb2xpY3kgPSAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUG9saWN5LmZpbmRPbmUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBwb2xpY3lJZCBhcyBzdHJpbmcgfSxcbiAgICAgICAgICBxdWVyeTogJ2lkIGxvY2F0aW9ucyB7IGlkIH0gdGltZVR5cGUgeyBpZCB9IGlzQWxsb2NhdGlvbk1hbmFnZWQgb3JnIHsgaWQgfSdcbiAgICAgICAgfSkpIGFzXG4gICAgICAgICAgfCAoUGljazxUaW1lUG9saWN5SXRlbSwgJ2lkJyB8ICdpc0FsbG9jYXRpb25NYW5hZ2VkJz4gJiB7XG4gICAgICAgICAgICAgIG9yZzogUGljazxPcmdhbml6YXRpb25JdGVtLCAnaWQnPiB8IG51bGw7XG4gICAgICAgICAgICAgIGxvY2F0aW9uczogUGljazxMb2NhdGlvbkl0ZW0sICdpZCc+W107XG4gICAgICAgICAgICAgIHRpbWVUeXBlOiBQaWNrPFRpbWVUeXBlSXRlbSwgJ2lkJz4gfCBudWxsO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB8IG51bGw7XG4gICAgICAgIGlmICghcG9saWN5KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgcG9saWN5TG9jYXRpb25zID0gcG9saWN5LmxvY2F0aW9ucyB8fCBbXTtcbiAgICAgICAgaWYgKHBvbGljeUxvY2F0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BvbGljeSBoYXMgbm8gbG9jYXRpb25zIGFzc2lnbmVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1c2VyID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVXNlci5maW5kT25lKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogdXNlcklkIGFzIHN0cmluZyB9LFxuICAgICAgICAgIHF1ZXJ5OiAnaWQgbG9jYXRpb24geyBpZCB9IG9yZyB7IGlkIH0nXG4gICAgICAgIH0pKSBhc1xuICAgICAgICAgIHwgKFBpY2s8VXNlckl0ZW0sICdpZCc+ICYge1xuICAgICAgICAgICAgICBsb2NhdGlvbjogUGljazxMb2NhdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgICAgICAgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfCBudWxsO1xuICAgICAgICBpZiAoIXVzZXI/Lm9yZz8uaWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbXVzdCBiZWxvbmcgdG8gYW4gb3JnYW5pemF0aW9uJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1c2VyTG9jYXRpb25JZCA9IHVzZXIubG9jYXRpb24/LmlkO1xuICAgICAgICBjb25zdCBtYXRjaGluZ1BvbGljeUxvY2F0aW9uID0gcG9saWN5TG9jYXRpb25zLmZpbmQobG9jID0+IGxvYz8uaWQgPT09IHVzZXJMb2NhdGlvbklkKTtcbiAgICAgICAgaWYgKCFtYXRjaGluZ1BvbGljeUxvY2F0aW9uICYmICFhcHBseUNvbmZpZykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiUG9saWN5IGRvZXMgbm90IGNvdmVyIHRoZSB1c2VyJ3MgY3VycmVudCBsb2NhdGlvbi4gQXNzaWduIHVzZXIgdG8gYSBtYXRjaGluZyBsb2NhdGlvbiBmaXJzdC5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWFwcGx5Q29uZmlnKSByZXR1cm4gdHJ1ZTtcblxuICAgICAgICBjb25zdCB0YXJnZXRMb2NhdGlvbklkID0gbWF0Y2hpbmdQb2xpY3lMb2NhdGlvbj8uaWQgPz8gcG9saWN5TG9jYXRpb25zWzBdPy5pZDtcbiAgICAgICAgaWYgKCF0YXJnZXRMb2NhdGlvbklkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBsb2NhdGlvbiBhdmFpbGFibGUgZnJvbSBwb2xpY3knKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRhcmdldExvY2F0aW9uID0gKGF3YWl0IGNvbnRleHQucXVlcnkuTG9jYXRpb24uZmluZE9uZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHRhcmdldExvY2F0aW9uSWQgYXMgc3RyaW5nIH0sXG4gICAgICAgICAgcXVlcnk6ICdpZCBvcmcgeyBpZCB9J1xuICAgICAgICB9KSkgYXNcbiAgICAgICAgICB8IChQaWNrPExvY2F0aW9uSXRlbSwgJ2lkJz4gJiB7XG4gICAgICAgICAgICAgIG9yZzogUGljazxPcmdhbml6YXRpb25JdGVtLCAnaWQnPiB8IG51bGw7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIHwgbnVsbDtcbiAgICAgICAgaWYgKCF0YXJnZXRMb2NhdGlvbiB8fCB0YXJnZXRMb2NhdGlvbi5vcmc/LmlkICE9PSB1c2VyLm9yZy5pZCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBvbGljeSBsb2NhdGlvbiBkb2VzIG5vdCBiZWxvbmcgdG8gdXNlcidzIG9yZ2FuaXphdGlvblwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IHtcbiAgICAgICAgICBsb2NhdGlvbj86IHsgY29ubmVjdDogeyBpZDogc3RyaW5nIH0gfTtcbiAgICAgICAgfSA9IHt9O1xuXG4gICAgICAgIGlmICh1c2VyTG9jYXRpb25JZCAhPT0gdGFyZ2V0TG9jYXRpb25JZCkge1xuICAgICAgICAgIHVwZGF0ZURhdGEubG9jYXRpb24gPSB7IGNvbm5lY3Q6IHsgaWQ6IHRhcmdldExvY2F0aW9uSWQgfSB9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHVwZGF0ZURhdGEpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhd2FpdCBjb250ZXh0LmRiLlVzZXIudXBkYXRlT25lKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgYXMgc3RyaW5nIH0sXG4gICAgICAgICAgICBkYXRhOiB1cGRhdGVEYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSlcbiAgfVxufSk7XG4iXSwibmFtZXMiOlsiZ3JhcGhxbCIsImciLCJQb2xpY2llcyIsImJhc2UiLCJtdXRhdGlvbiIsImFzc2lnblVzZXJUb1BvbGljeSIsImZpZWxkIiwidHlwZSIsIm5vbk51bGwiLCJCb29sZWFuIiwiYXJncyIsInVzZXJJZCIsImFyZyIsIklEIiwicG9saWN5SWQiLCJhcHBseUNvbmZpZyIsInJlc29sdmUiLCJzb3VyY2UiLCJjb250ZXh0IiwicG9saWN5IiwicXVlcnkiLCJUaW1lUG9saWN5IiwiZmluZE9uZSIsIndoZXJlIiwiaWQiLCJwb2xpY3lMb2NhdGlvbnMiLCJsb2NhdGlvbnMiLCJsZW5ndGgiLCJFcnJvciIsInVzZXIiLCJVc2VyIiwib3JnIiwidXNlckxvY2F0aW9uSWQiLCJsb2NhdGlvbiIsIm1hdGNoaW5nUG9saWN5TG9jYXRpb24iLCJmaW5kIiwibG9jIiwidGFyZ2V0TG9jYXRpb25JZCIsInRhcmdldExvY2F0aW9uIiwiTG9jYXRpb24iLCJ1cGRhdGVEYXRhIiwiY29ubmVjdCIsIk9iamVjdCIsImtleXMiLCJkYiIsInVwZGF0ZU9uZSIsImRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/Policies.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/TimePlanEntries.ts":
/*!***************************************************!*\
  !*** ../../schemas/extensions/TimePlanEntries.ts ***!
  \***************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TimePlanEntries: () => (/* binding */ TimePlanEntries)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n/* harmony import */ var _domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../domains/timePlan/directEntry */ \"(api)/../../domains/timePlan/directEntry.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__]);\n_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nconst normalizeDateInput = (value, label)=>{\n    if (!value) return null;\n    const date = new Date(value);\n    if (Number.isNaN(date.getTime())) throw new Error(`${label ?? \"Date\"} is invalid.`);\n    return date.toISOString();\n};\nconst ensureRepeatModeSupportsFields = ({ repeatMode, repeatDay })=>{\n    if (repeatMode === \"WEEKLY\" && (typeof repeatDay !== \"number\" || repeatDay < 0 || repeatDay > 6)) {\n        throw new Error(\"Weekly repeating entries require repeatDay between 0-6 (JS weekday).\");\n    }\n    if (repeatMode === \"MONTHLY_CALENDAR\" && (typeof repeatDay !== \"number\" || repeatDay <= 0)) {\n        throw new Error(\"Monthly calendar repeating entries require a positive repeatDay value.\");\n    }\n    if (repeatMode === \"MONTHLY_BUSINESS\" && (typeof repeatDay !== \"number\" || repeatDay === 0)) {\n        throw new Error(\"Monthly business repeating entries require a non-zero repeatDay value.\");\n    }\n};\nconst createRepeatTimePlanEntry = async ({ context, session, input })=>{\n    const { timeTypeId } = input;\n    const repeatMode = input.repeatMode;\n    if (!repeatMode || repeatMode === \"SINGLE\") {\n        throw new Error(\"repeatMode is required and must not be SINGLE when creating a repeating entry.\");\n    }\n    const sessionUser = await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.resolveSessionUser)({\n        context,\n        session\n    });\n    const policy = await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.findPolicyForTimeType)({\n        context,\n        timeTypeId,\n        orgId: sessionUser.orgId,\n        locationId: sessionUser.location?.id\n    });\n    if (!policy?.id) throw new Error(\"No policy configured for this time type and location.\");\n    const policyDetails = await context.query.TimePolicy.findOne({\n        where: {\n            id: policy.id\n        },\n        query: \"id isAllocationManaged isApprovable\"\n    });\n    if (policyDetails?.isAllocationManaged) {\n        throw new Error(\"Repeating time plans cannot be used with allocation-managed policies.\");\n    }\n    const startsOnIso = normalizeDateInput(input.startDateTime, \"startDateTime\");\n    if (!startsOnIso) throw new Error(\"startDateTime is required when creating a repeating entry.\");\n    const interval = input.repeatInterval && input.repeatInterval > 0 ? input.repeatInterval : 1;\n    ensureRepeatModeSupportsFields({\n        repeatMode,\n        repeatDay: input.repeatDay ?? null\n    });\n    const timePlan = await context.db.TimePlan.createOne({\n        data: {\n            org: {\n                connect: {\n                    id: sessionUser.orgId\n                }\n            },\n            user: {\n                connect: {\n                    id: sessionUser.userId\n                }\n            },\n            timeType: {\n                connect: {\n                    id: timeTypeId\n                }\n            },\n            timePolicy: {\n                connect: {\n                    id: policy.id\n                }\n            },\n            status: policyDetails?.isApprovable === false ? \"APPROVED\" : \"PENDING\",\n            repeatMode,\n            repeatInterval: interval,\n            repeatDay: typeof input.repeatDay === \"number\" ? input.repeatDay : null,\n            startAt: startsOnIso,\n            endAt: normalizeDateInput(input.repeatEndsOn, \"repeatEndsOn\"),\n            reason: typeof input.reason === \"string\" ? input.reason : \"\"\n        }\n    });\n    return timePlan;\n};\nconst TimePlanEntries = (base)=>{\n    const TimePlanEntryPayload = base.object(\"TimePlan\");\n    const PendingTimePlanApproval = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.object()({\n        name: \"PendingTimePlanApproval\",\n        fields: {\n            timePlan: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: base.object(\"TimePlan\"),\n                resolve: (item)=>item\n            }),\n            sortKey: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Float),\n                resolve: (item)=>item.sortKey\n            })\n        }\n    });\n    const TimePlanEntryInput = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.inputObject({\n        name: \"TimePlanEntryInput\",\n        fields: ()=>({\n                timeTypeId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                }),\n                startDateTime: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                endDateTime: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                isHalfDay: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean\n                }),\n                reason: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                repeatMode: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: base.enum(\"TimePlanRepeatModeType\")\n                }),\n                repeatInterval: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int\n                }),\n                repeatDay: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int\n                }),\n                repeatEndsOn: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                })\n            })\n    });\n    const TimePlanEntryUpdateInput = _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.inputObject({\n        name: \"TimePlanEntryUpdateInput\",\n        fields: ()=>({\n                id: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                }),\n                timeTypeId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID\n                }),\n                startDateTime: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                endDateTime: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                isHalfDay: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean\n                }),\n                reason: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                }),\n                repeatMode: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: base.enum(\"TimePlanRepeatModeType\")\n                }),\n                repeatInterval: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int\n                }),\n                repeatDay: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Int\n                }),\n                repeatEndsOn: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                    type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                })\n            })\n    });\n    const createPendingResult = (item)=>{\n        const rawSortKey = new Date(item.startAt ?? 0).getTime();\n        const sortKey = Number.isNaN(rawSortKey) ? Date.now() : rawSortKey;\n        return {\n            ...item,\n            sortKey\n        };\n    };\n    return {\n        mutation: {\n            createTimePlanEntry: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePlanEntryPayload),\n                args: {\n                    input: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePlanEntryInput)\n                    })\n                },\n                async resolve (_root, { input }, context) {\n                    const session = context.session;\n                    if (!session?.email) throw new Error(\"Unauthorized\");\n                    const isRepeating = input.repeatMode && input.repeatMode !== \"SINGLE\";\n                    if (isRepeating) {\n                        return await createRepeatTimePlanEntry({\n                            context,\n                            session,\n                            input: {\n                                timeTypeId: input.timeTypeId,\n                                startDateTime: input.startDateTime,\n                                reason: input.reason,\n                                repeatMode: input.repeatMode,\n                                repeatInterval: input.repeatInterval ?? null,\n                                repeatDay: typeof input.repeatDay === \"number\" ? input.repeatDay : null,\n                                repeatEndsOn: input.repeatEndsOn\n                            }\n                        });\n                    }\n                    if (!input.startDateTime || !input.endDateTime) {\n                        throw new Error(\"startDateTime and endDateTime are required for single time plan entries.\");\n                    }\n                    return await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.createDirectTimePlanEntry)({\n                        context,\n                        session,\n                        input: {\n                            timeTypeId: input.timeTypeId,\n                            startDateTime: input.startDateTime,\n                            endDateTime: input.endDateTime,\n                            isHalfDay: typeof input.isHalfDay === \"boolean\" ? input.isHalfDay : undefined,\n                            reason: typeof input.reason === \"string\" ? input.reason : undefined\n                        }\n                    });\n                }\n            }),\n            updateTimePlanEntry: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePlanEntryPayload),\n                args: {\n                    input: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(TimePlanEntryUpdateInput)\n                    })\n                },\n                async resolve (_root, { input }, context) {\n                    const session = context.session;\n                    if (!session?.email) throw new Error(\"Unauthorized\");\n                    const { id } = input;\n                    const existingTimePlan = await context.query.TimePlan.findOne({\n                        where: {\n                            id: id\n                        },\n                        query: \"id repeatMode user { id } status startAt endAt timePolicy { isApprovable }\"\n                    });\n                    if (!existingTimePlan) throw new Error(\"TimePlan not found\");\n                    const sessionUserId = await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.resolveSessionUser)({\n                        context,\n                        session\n                    }).then((u)=>u.userId);\n                    const isAdmin = (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_1__.isAnyAdmin)({\n                        session\n                    });\n                    if (!isAdmin && existingTimePlan.user?.id !== sessionUserId) {\n                        throw new Error(\"Forbidden\");\n                    }\n                    const referenceDateIso = existingTimePlan.endAt ?? existingTimePlan.startAt;\n                    if (referenceDateIso) {\n                        const referenceDate = new Date(referenceDateIso);\n                        const today = (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.toMidnightUtc)(new Date());\n                        if (referenceDate.getTime() < today.getTime()) throw new Error(\"Past time plans cannot be edited\");\n                    }\n                    const updateData = {};\n                    if (input.reason !== undefined) updateData.reason = input.reason;\n                    if (input.startDateTime) updateData.startAt = normalizeDateInput(input.startDateTime, \"startDateTime\");\n                    if (input.endDateTime || input.repeatEndsOn) {\n                        const endValue = input.endDateTime || input.repeatEndsOn;\n                        updateData.endAt = normalizeDateInput(endValue, \"end date\");\n                    }\n                    if (input.repeatMode) updateData.repeatMode = input.repeatMode;\n                    if (typeof input.repeatInterval === \"number\") updateData.repeatInterval = input.repeatInterval;\n                    if (typeof input.repeatDay === \"number\") updateData.repeatDay = input.repeatDay;\n                    if (input.timeTypeId) {\n                        const policy = await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.findPolicyForTimeType)({\n                            context,\n                            timeTypeId: input.timeTypeId,\n                            orgId: (await context.query.User.findOne({\n                                where: {\n                                    id: sessionUserId\n                                },\n                                query: \"org { id }\"\n                            }))?.org?.id,\n                            locationId: null\n                        });\n                        if (policy?.id) {\n                            updateData.timeType = {\n                                connect: {\n                                    id: input.timeTypeId\n                                }\n                            };\n                            updateData.timePolicy = {\n                                connect: {\n                                    id: policy.id\n                                }\n                            };\n                        }\n                    }\n                    const policyAllowsApproval = existingTimePlan.timePolicy?.isApprovable !== false;\n                    const shouldResetStatus = !isAdmin && policyAllowsApproval && existingTimePlan.status && existingTimePlan.status !== \"PENDING\";\n                    if (shouldResetStatus) {\n                        updateData.status = \"PENDING\";\n                        updateData.decidedAt = null;\n                        updateData.decidedBy = {\n                            disconnect: true\n                        };\n                    }\n                    return await context.db.TimePlan.updateOne({\n                        where: {\n                            id: id\n                        },\n                        data: updateData\n                    });\n                }\n            }),\n            deleteTimePlanEntry: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean),\n                args: {\n                    id: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    })\n                },\n                async resolve (_root, { id }, context) {\n                    const session = context.session;\n                    if (!session?.email) throw new Error(\"Unauthorized\");\n                    const timePlan = await context.query.TimePlan.findOne({\n                        where: {\n                            id: id\n                        },\n                        query: \"id user { id }\"\n                    });\n                    if (!timePlan) throw new Error(\"TimePlan not found\");\n                    const sessionUserId = await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.resolveSessionUser)({\n                        context,\n                        session\n                    }).then((u)=>u.userId);\n                    const isAdmin = (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_1__.isAnyAdmin)({\n                        session\n                    });\n                    if (!isAdmin && timePlan.user?.id !== sessionUserId) {\n                        throw new Error(\"Forbidden\");\n                    }\n                    await context.db.TimePlan.deleteOne({\n                        where: {\n                            id: id\n                        }\n                    });\n                    return true;\n                }\n            })\n        },\n        query: {\n            pendingTimePlanApprovals: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(PendingTimePlanApproval))),\n                async resolve (_root, _args, context) {\n                    const session = context.session;\n                    if (!session?.email) throw new Error(\"Unauthorized\");\n                    const isAdmin = (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_1__.isAnyAdmin)({\n                        session\n                    });\n                    if (!isAdmin) throw new Error(\"Forbidden\");\n                    const sessionUser = await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_2__.resolveSessionUser)({\n                        context,\n                        session\n                    });\n                    const timePlans = await context.db.TimePlan.findMany({\n                        where: {\n                            org: {\n                                id: {\n                                    equals: sessionUser.orgId\n                                }\n                            },\n                            status: {\n                                equals: \"PENDING\"\n                            }\n                        },\n                        orderBy: {\n                            startAt: \"asc\"\n                        }\n                    });\n                    return timePlans.map(createPendingResult);\n                }\n            })\n        }\n    };\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL1RpbWVQbGFuRW50cmllcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFnRDtBQUlTO0FBTWI7QUFTNUMsTUFBTU8scUJBQXFCLENBQUNDLE9BQXVCQztJQUNqRCxJQUFJLENBQUNELE9BQU8sT0FBTztJQUNuQixNQUFNRSxPQUFPLElBQUlDLEtBQUtIO0lBQ3RCLElBQUlJLE9BQU9DLEtBQUssQ0FBQ0gsS0FBS0ksT0FBTyxLQUFLLE1BQU0sSUFBSUMsTUFBTSxDQUFDLEVBQUVOLFNBQVMsT0FBTyxZQUFZLENBQUM7SUFDbEYsT0FBT0MsS0FBS00sV0FBVztBQUN6QjtBQUVBLE1BQU1DLGlDQUFpQyxDQUFDLEVBQ3RDQyxVQUFVLEVBQ1ZDLFNBQVMsRUFJVjtJQUNDLElBQUlELGVBQWUsWUFBYSxRQUFPQyxjQUFjLFlBQVlBLFlBQVksS0FBS0EsWUFBWSxJQUFJO1FBQ2hHLE1BQU0sSUFBSUosTUFBTTtJQUNsQjtJQUNBLElBQUlHLGVBQWUsc0JBQXVCLFFBQU9DLGNBQWMsWUFBWUEsYUFBYSxJQUFJO1FBQzFGLE1BQU0sSUFBSUosTUFBTTtJQUNsQjtJQUNBLElBQUlHLGVBQWUsc0JBQXVCLFFBQU9DLGNBQWMsWUFBWUEsY0FBYyxJQUFJO1FBQzNGLE1BQU0sSUFBSUosTUFBTTtJQUNsQjtBQUNGO0FBRUEsTUFBTUssNEJBQTRCLE9BQU8sRUFDdkNDLE9BQU8sRUFDUEMsT0FBTyxFQUNQQyxLQUFLLEVBYU47SUFDQyxNQUFNLEVBQUVDLFVBQVUsRUFBRSxHQUFHRDtJQUN2QixNQUFNTCxhQUFhSyxNQUFNTCxVQUFVO0lBQ25DLElBQUksQ0FBQ0EsY0FBY0EsZUFBZSxVQUFVO1FBQzFDLE1BQU0sSUFBSUgsTUFBTTtJQUNsQjtJQUVBLE1BQU1VLGNBQWMsTUFBTXBCLGlGQUFrQkEsQ0FBQztRQUFFZ0I7UUFBU0M7SUFBUTtJQUVoRSxNQUFNSSxTQUFTLE1BQU10QixvRkFBcUJBLENBQUM7UUFDekNp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QkFDTFcsS0FBSztnQ0FBRWhCLElBQUk7b0NBQUV3RixRQUFRN0YsWUFBWUUsS0FBSztnQ0FBQzs0QkFBRTs0QkFDekN5QixRQUFRO2dDQUFFa0UsUUFBUTs0QkFBVTt3QkFDOUI7d0JBQ0FDLFNBQVM7NEJBQUVqRSxTQUFTO3dCQUFNO29CQUM1QjtvQkFFQSxPQUFPOEQsVUFBVUksR0FBRyxDQUFDckM7Z0JBQ3ZCO1lBQ0Y7UUFDRjtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL2V4dGVuc2lvbnMvVGltZVBsYW5FbnRyaWVzLnRzPzI5MGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ3JhcGhxbCBhcyBnIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZSc7XG5pbXBvcnQgdHlwZSB7IEJhc2VTY2hlbWFNZXRhIH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS9kaXN0L2RlY2xhcmF0aW9ucy9zcmMvdHlwZXMvc2NoZW1hL2dyYXBocWwtdHMtc2NoZW1hJztcbmltcG9ydCB0eXBlIHsgS2V5c3RvbmVDb250ZXh0IH0gZnJvbSAnQGtleXN0b25lLTYvY29yZS90eXBlcyc7XG5pbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnYXV0aCc7XG5pbXBvcnQgeyBpc0FueUFkbWluIH0gZnJvbSAnLi4vLi4vZG9tYWlucy9hdXRoL3VzZXJSb2xlJztcbmltcG9ydCB7XG4gIGNyZWF0ZURpcmVjdFRpbWVQbGFuRW50cnksXG4gIGZpbmRQb2xpY3lGb3JUaW1lVHlwZSxcbiAgcmVzb2x2ZVNlc3Npb25Vc2VyLFxuICB0b01pZG5pZ2h0VXRjXG59IGZyb20gJy4uLy4uL2RvbWFpbnMvdGltZVBsYW4vZGlyZWN0RW50cnknO1xuXG50eXBlIFRpbWVQbGFuSXRlbSA9IGFueTsgLy8gVHlwZUluZm9bJ2xpc3RzJ11bJ1RpbWVQbGFuJ11bJ2l0ZW0nXSAtIHVzaW5nIGFueSBkdWUgdG8gc3RhbGUgZ2VuZXJhdGVkIHR5cGVzXG50eXBlIFRpbWVQb2xpY3lJdGVtID0gYW55OyAvLyBUeXBlSW5mb1snbGlzdHMnXVsnVGltZVBvbGljeSddWydpdGVtJ11cblxudHlwZSBQZW5kaW5nQXBwcm92YWxSZXN1bHQgPSBUaW1lUGxhbkl0ZW0gJiB7XG4gIHNvcnRLZXk6IG51bWJlcjtcbn07XG5cbmNvbnN0IG5vcm1hbGl6ZURhdGVJbnB1dCA9ICh2YWx1ZT86IHN0cmluZyB8IG51bGwsIGxhYmVsPzogc3RyaW5nKSA9PiB7XG4gIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpO1xuICBpZiAoTnVtYmVyLmlzTmFOKGRhdGUuZ2V0VGltZSgpKSkgdGhyb3cgbmV3IEVycm9yKGAke2xhYmVsID8/ICdEYXRlJ30gaXMgaW52YWxpZC5gKTtcbiAgcmV0dXJuIGRhdGUudG9JU09TdHJpbmcoKTtcbn07XG5cbmNvbnN0IGVuc3VyZVJlcGVhdE1vZGVTdXBwb3J0c0ZpZWxkcyA9ICh7XG4gIHJlcGVhdE1vZGUsXG4gIHJlcGVhdERheVxufToge1xuICByZXBlYXRNb2RlOiBzdHJpbmc7XG4gIHJlcGVhdERheT86IG51bWJlciB8IG51bGw7XG59KSA9PiB7XG4gIGlmIChyZXBlYXRNb2RlID09PSAnV0VFS0xZJyAmJiAodHlwZW9mIHJlcGVhdERheSAhPT0gJ251bWJlcicgfHwgcmVwZWF0RGF5IDwgMCB8fCByZXBlYXREYXkgPiA2KSkge1xuICAgIHRocm93IG5ldyBFcnJvcignV2Vla2x5IHJlcGVhdGluZyBlbnRyaWVzIHJlcXVpcmUgcmVwZWF0RGF5IGJldHdlZW4gMC02IChKUyB3ZWVrZGF5KS4nKTtcbiAgfVxuICBpZiAocmVwZWF0TW9kZSA9PT0gJ01PTlRITFlfQ0FMRU5EQVInICYmICh0eXBlb2YgcmVwZWF0RGF5ICE9PSAnbnVtYmVyJyB8fCByZXBlYXREYXkgPD0gMCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01vbnRobHkgY2FsZW5kYXIgcmVwZWF0aW5nIGVudHJpZXMgcmVxdWlyZSBhIHBvc2l0aXZlIHJlcGVhdERheSB2YWx1ZS4nKTtcbiAgfVxuICBpZiAocmVwZWF0TW9kZSA9PT0gJ01PTlRITFlfQlVTSU5FU1MnICYmICh0eXBlb2YgcmVwZWF0RGF5ICE9PSAnbnVtYmVyJyB8fCByZXBlYXREYXkgPT09IDApKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNb250aGx5IGJ1c2luZXNzIHJlcGVhdGluZyBlbnRyaWVzIHJlcXVpcmUgYSBub24temVybyByZXBlYXREYXkgdmFsdWUuJyk7XG4gIH1cbn07XG5cbmNvbnN0IGNyZWF0ZVJlcGVhdFRpbWVQbGFuRW50cnkgPSBhc3luYyAoe1xuICBjb250ZXh0LFxuICBzZXNzaW9uLFxuICBpbnB1dFxufToge1xuICBjb250ZXh0OiBLZXlzdG9uZUNvbnRleHQ7XG4gIHNlc3Npb246IFNlc3Npb24gfCBudWxsO1xuICBpbnB1dDoge1xuICAgIHRpbWVUeXBlSWQ6IHN0cmluZztcbiAgICBzdGFydERhdGVUaW1lPzogc3RyaW5nIHwgbnVsbDtcbiAgICByZWFzb24/OiBzdHJpbmcgfCBudWxsO1xuICAgIHJlcGVhdE1vZGU/OiBzdHJpbmcgfCBudWxsO1xuICAgIHJlcGVhdEludGVydmFsPzogbnVtYmVyIHwgbnVsbDtcbiAgICByZXBlYXREYXk/OiBudW1iZXIgfCBudWxsO1xuICAgIHJlcGVhdEVuZHNPbj86IHN0cmluZyB8IG51bGw7XG4gIH07XG59KSA9PiB7XG4gIGNvbnN0IHsgdGltZVR5cGVJZCB9ID0gaW5wdXQ7XG4gIGNvbnN0IHJlcGVhdE1vZGUgPSBpbnB1dC5yZXBlYXRNb2RlO1xuICBpZiAoIXJlcGVhdE1vZGUgfHwgcmVwZWF0TW9kZSA9PT0gJ1NJTkdMRScpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlcGVhdE1vZGUgaXMgcmVxdWlyZWQgYW5kIG11c3Qgbm90IGJlIFNJTkdMRSB3aGVuIGNyZWF0aW5nIGEgcmVwZWF0aW5nIGVudHJ5LicpO1xuICB9XG5cbiAgY29uc3Qgc2Vzc2lvblVzZXIgPSBhd2FpdCByZXNvbHZlU2Vzc2lvblVzZXIoeyBjb250ZXh0LCBzZXNzaW9uIH0pO1xuXG4gIGNvbnN0IHBvbGljeSA9IGF3YWl0IGZpbmRQb2xpY3lGb3JUaW1lVHlwZSh7XG4gICAgY29udGV4dCxcbiAgICB0aW1lVHlwZUlkLFxuICAgIG9yZ0lkOiBzZXNzaW9uVXNlci5vcmdJZCxcbiAgICBsb2NhdGlvbklkOiBzZXNzaW9uVXNlci5sb2NhdGlvbj8uaWRcbiAgfSk7XG4gIGlmICghcG9saWN5Py5pZCkgdGhyb3cgbmV3IEVycm9yKCdObyBwb2xpY3kgY29uZmlndXJlZCBmb3IgdGhpcyB0aW1lIHR5cGUgYW5kIGxvY2F0aW9uLicpO1xuXG4gIGNvbnN0IHBvbGljeURldGFpbHMgPSAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUG9saWN5LmZpbmRPbmUoe1xuICAgIHdoZXJlOiB7IGlkOiBwb2xpY3kuaWQgfSxcbiAgICBxdWVyeTogJ2lkIGlzQWxsb2NhdGlvbk1hbmFnZWQgaXNBcHByb3ZhYmxlJ1xuICB9KSkgYXMgUGljazxUaW1lUG9saWN5SXRlbSwgJ2lkJyB8ICdpc0FsbG9jYXRpb25NYW5hZ2VkJyB8ICdpc0FwcHJvdmFibGUnPiB8IG51bGw7XG5cbiAgaWYgKHBvbGljeURldGFpbHM/LmlzQWxsb2NhdGlvbk1hbmFnZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcGVhdGluZyB0aW1lIHBsYW5zIGNhbm5vdCBiZSB1c2VkIHdpdGggYWxsb2NhdGlvbi1tYW5hZ2VkIHBvbGljaWVzLicpO1xuICB9XG5cbiAgY29uc3Qgc3RhcnRzT25Jc28gPSBub3JtYWxpemVEYXRlSW5wdXQoaW5wdXQuc3RhcnREYXRlVGltZSwgJ3N0YXJ0RGF0ZVRpbWUnKTtcbiAgaWYgKCFzdGFydHNPbklzbykgdGhyb3cgbmV3IEVycm9yKCdzdGFydERhdGVUaW1lIGlzIHJlcXVpcmVkIHdoZW4gY3JlYXRpbmcgYSByZXBlYXRpbmcgZW50cnkuJyk7XG5cbiAgY29uc3QgaW50ZXJ2YWwgPSBpbnB1dC5yZXBlYXRJbnRlcnZhbCAmJiBpbnB1dC5yZXBlYXRJbnRlcnZhbCA+IDAgPyBpbnB1dC5yZXBlYXRJbnRlcnZhbCA6IDE7XG4gIGVuc3VyZVJlcGVhdE1vZGVTdXBwb3J0c0ZpZWxkcyh7XG4gICAgcmVwZWF0TW9kZSxcbiAgICByZXBlYXREYXk6IGlucHV0LnJlcGVhdERheSA/PyBudWxsXG4gIH0pO1xuXG4gIGNvbnN0IHRpbWVQbGFuID0gYXdhaXQgY29udGV4dC5kYi5UaW1lUGxhbi5jcmVhdGVPbmUoe1xuICAgIGRhdGE6IHtcbiAgICAgIG9yZzogeyBjb25uZWN0OiB7IGlkOiBzZXNzaW9uVXNlci5vcmdJZCB9IH0sXG4gICAgICB1c2VyOiB7IGNvbm5lY3Q6IHsgaWQ6IHNlc3Npb25Vc2VyLnVzZXJJZCB9IH0sXG4gICAgICB0aW1lVHlwZTogeyBjb25uZWN0OiB7IGlkOiB0aW1lVHlwZUlkIH0gfSxcbiAgICAgIHRpbWVQb2xpY3k6IHsgY29ubmVjdDogeyBpZDogcG9saWN5LmlkIH0gfSxcbiAgICAgIHN0YXR1czogcG9saWN5RGV0YWlscz8uaXNBcHByb3ZhYmxlID09PSBmYWxzZSA/ICdBUFBST1ZFRCcgOiAnUEVORElORycsXG4gICAgICByZXBlYXRNb2RlLFxuICAgICAgcmVwZWF0SW50ZXJ2YWw6IGludGVydmFsLFxuICAgICAgcmVwZWF0RGF5OiB0eXBlb2YgaW5wdXQucmVwZWF0RGF5ID09PSAnbnVtYmVyJyA/IGlucHV0LnJlcGVhdERheSA6IG51bGwsXG4gICAgICBzdGFydEF0OiBzdGFydHNPbklzbyxcbiAgICAgIGVuZEF0OiBub3JtYWxpemVEYXRlSW5wdXQoaW5wdXQucmVwZWF0RW5kc09uLCAncmVwZWF0RW5kc09uJyksXG4gICAgICByZWFzb246IHR5cGVvZiBpbnB1dC5yZWFzb24gPT09ICdzdHJpbmcnID8gaW5wdXQucmVhc29uIDogJydcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB0aW1lUGxhbiBhcyBUaW1lUGxhbkl0ZW07XG59O1xuXG5leHBvcnQgY29uc3QgVGltZVBsYW5FbnRyaWVzID0gKGJhc2U6IEJhc2VTY2hlbWFNZXRhKSA9PiB7XG4gIGNvbnN0IFRpbWVQbGFuRW50cnlQYXlsb2FkID0gYmFzZS5vYmplY3QoJ1RpbWVQbGFuJyk7XG5cbiAgY29uc3QgUGVuZGluZ1RpbWVQbGFuQXBwcm92YWwgPSBnLm9iamVjdDxQZW5kaW5nQXBwcm92YWxSZXN1bHQ+KCkoe1xuICAgIG5hbWU6ICdQZW5kaW5nVGltZVBsYW5BcHByb3ZhbCcsXG4gICAgZmllbGRzOiB7XG4gICAgICB0aW1lUGxhbjogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGJhc2Uub2JqZWN0KCdUaW1lUGxhbicpLFxuICAgICAgICByZXNvbHZlOiBpdGVtID0+IGl0ZW1cbiAgICAgIH0pLFxuICAgICAgc29ydEtleTogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcubm9uTnVsbChnLkZsb2F0KSxcbiAgICAgICAgcmVzb2x2ZTogaXRlbSA9PiBpdGVtLnNvcnRLZXlcbiAgICAgIH0pXG4gICAgfVxuICB9KTtcblxuICBjb25zdCBUaW1lUGxhbkVudHJ5SW5wdXQgPSBnLmlucHV0T2JqZWN0KHtcbiAgICBuYW1lOiAnVGltZVBsYW5FbnRyeUlucHV0JyxcbiAgICBmaWVsZHM6ICgpID0+ICh7XG4gICAgICB0aW1lVHlwZUlkOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLklEKSB9KSxcbiAgICAgIHN0YXJ0RGF0ZVRpbWU6IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSksXG4gICAgICBlbmREYXRlVGltZTogZy5hcmcoeyB0eXBlOiBnLlN0cmluZyB9KSxcbiAgICAgIGlzSGFsZkRheTogZy5hcmcoeyB0eXBlOiBnLkJvb2xlYW4gfSksXG4gICAgICByZWFzb246IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSksXG4gICAgICByZXBlYXRNb2RlOiBnLmFyZyh7IHR5cGU6IGJhc2UuZW51bSgnVGltZVBsYW5SZXBlYXRNb2RlVHlwZScpIH0pLFxuICAgICAgcmVwZWF0SW50ZXJ2YWw6IGcuYXJnKHsgdHlwZTogZy5JbnQgfSksXG4gICAgICByZXBlYXREYXk6IGcuYXJnKHsgdHlwZTogZy5JbnQgfSksXG4gICAgICByZXBlYXRFbmRzT246IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSlcbiAgICB9KVxuICB9KTtcblxuICBjb25zdCBUaW1lUGxhbkVudHJ5VXBkYXRlSW5wdXQgPSBnLmlucHV0T2JqZWN0KHtcbiAgICBuYW1lOiAnVGltZVBsYW5FbnRyeVVwZGF0ZUlucHV0JyxcbiAgICBmaWVsZHM6ICgpID0+ICh7XG4gICAgICBpZDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCkgfSksXG4gICAgICB0aW1lVHlwZUlkOiBnLmFyZyh7IHR5cGU6IGcuSUQgfSksXG4gICAgICBzdGFydERhdGVUaW1lOiBnLmFyZyh7IHR5cGU6IGcuU3RyaW5nIH0pLFxuICAgICAgZW5kRGF0ZVRpbWU6IGcuYXJnKHsgdHlwZTogZy5TdHJpbmcgfSksXG4gICAgICBpc0hhbGZEYXk6IGcuYXJnKHsgdHlwZTogZy5Cb29sZWFuIH0pLFxuICAgICAgcmVhc29uOiBnLmFyZyh7IHR5cGU6IGcuU3RyaW5nIH0pLFxuICAgICAgcmVwZWF0TW9kZTogZy5hcmcoeyB0eXBlOiBiYXNlLmVudW0oJ1RpbWVQbGFuUmVwZWF0TW9kZVR5cGUnKSB9KSxcbiAgICAgIHJlcGVhdEludGVydmFsOiBnLmFyZyh7IHR5cGU6IGcuSW50IH0pLFxuICAgICAgcmVwZWF0RGF5OiBnLmFyZyh7IHR5cGU6IGcuSW50IH0pLFxuICAgICAgcmVwZWF0RW5kc09uOiBnLmFyZyh7IHR5cGU6IGcuU3RyaW5nIH0pXG4gICAgfSlcbiAgfSk7XG5cbiAgY29uc3QgY3JlYXRlUGVuZGluZ1Jlc3VsdCA9IChpdGVtOiBUaW1lUGxhbkl0ZW0pID0+IHtcbiAgICBjb25zdCByYXdTb3J0S2V5ID0gbmV3IERhdGUoaXRlbS5zdGFydEF0ID8/IDApLmdldFRpbWUoKTtcbiAgICBjb25zdCBzb3J0S2V5ID0gTnVtYmVyLmlzTmFOKHJhd1NvcnRLZXkpID8gRGF0ZS5ub3coKSA6IHJhd1NvcnRLZXk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLml0ZW0sXG4gICAgICBzb3J0S2V5XG4gICAgfSBhcyBQZW5kaW5nQXBwcm92YWxSZXN1bHQ7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBtdXRhdGlvbjoge1xuICAgICAgY3JlYXRlVGltZVBsYW5FbnRyeTogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcubm9uTnVsbChUaW1lUGxhbkVudHJ5UGF5bG9hZCksXG4gICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICBpbnB1dDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoVGltZVBsYW5FbnRyeUlucHV0KSB9KVxuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXNvbHZlKF9yb290LCB7IGlucHV0IH0sIGNvbnRleHQpIHtcbiAgICAgICAgICBjb25zdCBzZXNzaW9uID0gY29udGV4dC5zZXNzaW9uIGFzIFNlc3Npb24gfCBudWxsO1xuICAgICAgICAgIGlmICghc2Vzc2lvbj8uZW1haWwpIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG5cbiAgICAgICAgICBjb25zdCBpc1JlcGVhdGluZyA9IGlucHV0LnJlcGVhdE1vZGUgJiYgaW5wdXQucmVwZWF0TW9kZSAhPT0gJ1NJTkdMRSc7XG4gICAgICAgICAgaWYgKGlzUmVwZWF0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgY3JlYXRlUmVwZWF0VGltZVBsYW5FbnRyeSh7XG4gICAgICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgICAgICAgdGltZVR5cGVJZDogaW5wdXQudGltZVR5cGVJZCBhcyBzdHJpbmcsXG4gICAgICAgICAgICAgICAgc3RhcnREYXRlVGltZTogaW5wdXQuc3RhcnREYXRlVGltZSBhcyBzdHJpbmcsXG4gICAgICAgICAgICAgICAgcmVhc29uOiBpbnB1dC5yZWFzb24gYXMgc3RyaW5nIHwgbnVsbCxcbiAgICAgICAgICAgICAgICByZXBlYXRNb2RlOiBpbnB1dC5yZXBlYXRNb2RlIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICByZXBlYXRJbnRlcnZhbDogaW5wdXQucmVwZWF0SW50ZXJ2YWwgPz8gbnVsbCxcbiAgICAgICAgICAgICAgICByZXBlYXREYXk6IHR5cGVvZiBpbnB1dC5yZXBlYXREYXkgPT09ICdudW1iZXInID8gaW5wdXQucmVwZWF0RGF5IDogbnVsbCxcbiAgICAgICAgICAgICAgICByZXBlYXRFbmRzT246IGlucHV0LnJlcGVhdEVuZHNPbiBhcyBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghaW5wdXQuc3RhcnREYXRlVGltZSB8fCAhaW5wdXQuZW5kRGF0ZVRpbWUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc3RhcnREYXRlVGltZSBhbmQgZW5kRGF0ZVRpbWUgYXJlIHJlcXVpcmVkIGZvciBzaW5nbGUgdGltZSBwbGFuIGVudHJpZXMuJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZURpcmVjdFRpbWVQbGFuRW50cnkoe1xuICAgICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICAgIHNlc3Npb24sXG4gICAgICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgICB0aW1lVHlwZUlkOiBpbnB1dC50aW1lVHlwZUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgc3RhcnREYXRlVGltZTogaW5wdXQuc3RhcnREYXRlVGltZSBhcyBzdHJpbmcsXG4gICAgICAgICAgICAgIGVuZERhdGVUaW1lOiBpbnB1dC5lbmREYXRlVGltZSBhcyBzdHJpbmcsXG4gICAgICAgICAgICAgIGlzSGFsZkRheTogdHlwZW9mIGlucHV0LmlzSGFsZkRheSA9PT0gJ2Jvb2xlYW4nID8gaW5wdXQuaXNIYWxmRGF5IDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICByZWFzb246IHR5cGVvZiBpbnB1dC5yZWFzb24gPT09ICdzdHJpbmcnID8gaW5wdXQucmVhc29uIDogdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgdXBkYXRlVGltZVBsYW5FbnRyeTogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcubm9uTnVsbChUaW1lUGxhbkVudHJ5UGF5bG9hZCksXG4gICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICBpbnB1dDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoVGltZVBsYW5FbnRyeVVwZGF0ZUlucHV0KSB9KVxuICAgICAgICB9LFxuICAgICAgICBhc3luYyByZXNvbHZlKF9yb290LCB7IGlucHV0IH0sIGNvbnRleHQpIHtcbiAgICAgICAgICBjb25zdCBzZXNzaW9uID0gY29udGV4dC5zZXNzaW9uIGFzIFNlc3Npb24gfCBudWxsO1xuICAgICAgICAgIGlmICghc2Vzc2lvbj8uZW1haWwpIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG5cbiAgICAgICAgICBjb25zdCB7IGlkIH0gPSBpbnB1dDtcbiAgICAgICAgICBjb25zdCBleGlzdGluZ1RpbWVQbGFuID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVGltZVBsYW4uZmluZE9uZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogaWQgYXMgc3RyaW5nIH0sXG4gICAgICAgICAgICBxdWVyeTogJ2lkIHJlcGVhdE1vZGUgdXNlciB7IGlkIH0gc3RhdHVzIHN0YXJ0QXQgZW5kQXQgdGltZVBvbGljeSB7IGlzQXBwcm92YWJsZSB9J1xuICAgICAgICAgIH0pKSBhc1xuICAgICAgICAgICAgfCAoUGljazxUaW1lUGxhbkl0ZW0sICdpZCcgfCAncmVwZWF0TW9kZScgfCAnc3RhdHVzJyB8ICdzdGFydEF0JyB8ICdlbmRBdCc+ICYge1xuICAgICAgICAgICAgICAgIHVzZXI6IHsgaWQ6IHN0cmluZyB9IHwgbnVsbDtcbiAgICAgICAgICAgICAgICB0aW1lUG9saWN5PzogeyBpc0FwcHJvdmFibGU/OiBib29sZWFuIHwgbnVsbCB9IHwgbnVsbDtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHwgbnVsbDtcblxuICAgICAgICAgIGlmICghZXhpc3RpbmdUaW1lUGxhbikgdGhyb3cgbmV3IEVycm9yKCdUaW1lUGxhbiBub3QgZm91bmQnKTtcblxuICAgICAgICAgIGNvbnN0IHNlc3Npb25Vc2VySWQgPSBhd2FpdCByZXNvbHZlU2Vzc2lvblVzZXIoeyBjb250ZXh0LCBzZXNzaW9uIH0pLnRoZW4odSA9PiB1LnVzZXJJZCk7XG4gICAgICAgICAgY29uc3QgaXNBZG1pbiA9IGlzQW55QWRtaW4oeyBzZXNzaW9uIH0pO1xuICAgICAgICAgIGlmICghaXNBZG1pbiAmJiBleGlzdGluZ1RpbWVQbGFuLnVzZXI/LmlkICE9PSBzZXNzaW9uVXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHJlZmVyZW5jZURhdGVJc28gPSBleGlzdGluZ1RpbWVQbGFuLmVuZEF0ID8/IGV4aXN0aW5nVGltZVBsYW4uc3RhcnRBdDtcbiAgICAgICAgICBpZiAocmVmZXJlbmNlRGF0ZUlzbykge1xuICAgICAgICAgICAgY29uc3QgcmVmZXJlbmNlRGF0ZSA9IG5ldyBEYXRlKHJlZmVyZW5jZURhdGVJc28gYXMgc3RyaW5nKTtcbiAgICAgICAgICAgIGNvbnN0IHRvZGF5ID0gdG9NaWRuaWdodFV0YyhuZXcgRGF0ZSgpKTtcbiAgICAgICAgICAgIGlmIChyZWZlcmVuY2VEYXRlLmdldFRpbWUoKSA8IHRvZGF5LmdldFRpbWUoKSkgdGhyb3cgbmV3IEVycm9yKCdQYXN0IHRpbWUgcGxhbnMgY2Fubm90IGJlIGVkaXRlZCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHt9O1xuICAgICAgICAgIGlmIChpbnB1dC5yZWFzb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5yZWFzb24gPSBpbnB1dC5yZWFzb247XG4gICAgICAgICAgaWYgKGlucHV0LnN0YXJ0RGF0ZVRpbWUpIHVwZGF0ZURhdGEuc3RhcnRBdCA9IG5vcm1hbGl6ZURhdGVJbnB1dChpbnB1dC5zdGFydERhdGVUaW1lLCAnc3RhcnREYXRlVGltZScpO1xuICAgICAgICAgIGlmIChpbnB1dC5lbmREYXRlVGltZSB8fCBpbnB1dC5yZXBlYXRFbmRzT24pIHtcbiAgICAgICAgICAgIGNvbnN0IGVuZFZhbHVlID0gaW5wdXQuZW5kRGF0ZVRpbWUgfHwgaW5wdXQucmVwZWF0RW5kc09uO1xuICAgICAgICAgICAgdXBkYXRlRGF0YS5lbmRBdCA9IG5vcm1hbGl6ZURhdGVJbnB1dChlbmRWYWx1ZSwgJ2VuZCBkYXRlJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpbnB1dC5yZXBlYXRNb2RlKSB1cGRhdGVEYXRhLnJlcGVhdE1vZGUgPSBpbnB1dC5yZXBlYXRNb2RlO1xuICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQucmVwZWF0SW50ZXJ2YWwgPT09ICdudW1iZXInKSB1cGRhdGVEYXRhLnJlcGVhdEludGVydmFsID0gaW5wdXQucmVwZWF0SW50ZXJ2YWw7XG4gICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dC5yZXBlYXREYXkgPT09ICdudW1iZXInKSB1cGRhdGVEYXRhLnJlcGVhdERheSA9IGlucHV0LnJlcGVhdERheTtcblxuICAgICAgICAgIGlmIChpbnB1dC50aW1lVHlwZUlkKSB7XG4gICAgICAgICAgICBjb25zdCBwb2xpY3kgPSBhd2FpdCBmaW5kUG9saWN5Rm9yVGltZVR5cGUoe1xuICAgICAgICAgICAgICBjb250ZXh0LFxuICAgICAgICAgICAgICB0aW1lVHlwZUlkOiBpbnB1dC50aW1lVHlwZUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgb3JnSWQ6ICgoYXdhaXQgY29udGV4dC5xdWVyeS5Vc2VyLmZpbmRPbmUoeyB3aGVyZTogeyBpZDogc2Vzc2lvblVzZXJJZCB9LCBxdWVyeTogJ29yZyB7IGlkIH0nIH0pKSBhcyBhbnkpXG4gICAgICAgICAgICAgICAgPy5vcmc/LmlkLFxuICAgICAgICAgICAgICBsb2NhdGlvbklkOiBudWxsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChwb2xpY3k/LmlkKSB7XG4gICAgICAgICAgICAgIHVwZGF0ZURhdGEudGltZVR5cGUgPSB7IGNvbm5lY3Q6IHsgaWQ6IGlucHV0LnRpbWVUeXBlSWQgYXMgc3RyaW5nIH0gfTtcbiAgICAgICAgICAgICAgdXBkYXRlRGF0YS50aW1lUG9saWN5ID0geyBjb25uZWN0OiB7IGlkOiBwb2xpY3kuaWQgfSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHBvbGljeUFsbG93c0FwcHJvdmFsID0gZXhpc3RpbmdUaW1lUGxhbi50aW1lUG9saWN5Py5pc0FwcHJvdmFibGUgIT09IGZhbHNlO1xuICAgICAgICAgIGNvbnN0IHNob3VsZFJlc2V0U3RhdHVzID1cbiAgICAgICAgICAgICFpc0FkbWluICYmIHBvbGljeUFsbG93c0FwcHJvdmFsICYmIGV4aXN0aW5nVGltZVBsYW4uc3RhdHVzICYmIGV4aXN0aW5nVGltZVBsYW4uc3RhdHVzICE9PSAnUEVORElORyc7XG4gICAgICAgICAgaWYgKHNob3VsZFJlc2V0U3RhdHVzKSB7XG4gICAgICAgICAgICB1cGRhdGVEYXRhLnN0YXR1cyA9ICdQRU5ESU5HJztcbiAgICAgICAgICAgIHVwZGF0ZURhdGEuZGVjaWRlZEF0ID0gbnVsbDtcbiAgICAgICAgICAgIHVwZGF0ZURhdGEuZGVjaWRlZEJ5ID0geyBkaXNjb25uZWN0OiB0cnVlIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IGNvbnRleHQuZGIuVGltZVBsYW4udXBkYXRlT25lKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBpZCBhcyBzdHJpbmcgfSxcbiAgICAgICAgICAgIGRhdGE6IHVwZGF0ZURhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgICBkZWxldGVUaW1lUGxhbkVudHJ5OiBnLmZpZWxkKHtcbiAgICAgICAgdHlwZTogZy5ub25OdWxsKGcuQm9vbGVhbiksXG4gICAgICAgIGFyZ3M6IHtcbiAgICAgICAgICBpZDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCkgfSlcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgcmVzb2x2ZShfcm9vdCwgeyBpZCB9LCBjb250ZXh0KSB7XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGNvbnRleHQuc2Vzc2lvbiBhcyBTZXNzaW9uIHwgbnVsbDtcbiAgICAgICAgICBpZiAoIXNlc3Npb24/LmVtYWlsKSB0aHJvdyBuZXcgRXJyb3IoJ1VuYXV0aG9yaXplZCcpO1xuXG4gICAgICAgICAgY29uc3QgdGltZVBsYW4gPSAoYXdhaXQgY29udGV4dC5xdWVyeS5UaW1lUGxhbi5maW5kT25lKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBpZCBhcyBzdHJpbmcgfSxcbiAgICAgICAgICAgIHF1ZXJ5OiAnaWQgdXNlciB7IGlkIH0nXG4gICAgICAgICAgfSkpIGFzIChQaWNrPFRpbWVQbGFuSXRlbSwgJ2lkJz4gJiB7IHVzZXI6IHsgaWQ6IHN0cmluZyB9IHwgbnVsbCB9KSB8IG51bGw7XG5cbiAgICAgICAgICBpZiAoIXRpbWVQbGFuKSB0aHJvdyBuZXcgRXJyb3IoJ1RpbWVQbGFuIG5vdCBmb3VuZCcpO1xuXG4gICAgICAgICAgY29uc3Qgc2Vzc2lvblVzZXJJZCA9IGF3YWl0IHJlc29sdmVTZXNzaW9uVXNlcih7IGNvbnRleHQsIHNlc3Npb24gfSkudGhlbih1ID0+IHUudXNlcklkKTtcbiAgICAgICAgICBjb25zdCBpc0FkbWluID0gaXNBbnlBZG1pbih7IHNlc3Npb24gfSk7XG4gICAgICAgICAgaWYgKCFpc0FkbWluICYmIHRpbWVQbGFuLnVzZXI/LmlkICE9PSBzZXNzaW9uVXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGF3YWl0IGNvbnRleHQuZGIuVGltZVBsYW4uZGVsZXRlT25lKHsgd2hlcmU6IHsgaWQ6IGlkIGFzIHN0cmluZyB9IH0pO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gICAgcXVlcnk6IHtcbiAgICAgIHBlbmRpbmdUaW1lUGxhbkFwcHJvdmFsczogZy5maWVsZCh7XG4gICAgICAgIHR5cGU6IGcubm9uTnVsbChnLmxpc3QoZy5ub25OdWxsKFBlbmRpbmdUaW1lUGxhbkFwcHJvdmFsKSkpLFxuICAgICAgICBhc3luYyByZXNvbHZlKF9yb290LCBfYXJncywgY29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBjb250ZXh0LnNlc3Npb24gYXMgU2Vzc2lvbiB8IG51bGw7XG4gICAgICAgICAgaWYgKCFzZXNzaW9uPy5lbWFpbCkgdGhyb3cgbmV3IEVycm9yKCdVbmF1dGhvcml6ZWQnKTtcbiAgICAgICAgICBjb25zdCBpc0FkbWluID0gaXNBbnlBZG1pbih7IHNlc3Npb24gfSk7XG4gICAgICAgICAgaWYgKCFpc0FkbWluKSB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuXG4gICAgICAgICAgY29uc3Qgc2Vzc2lvblVzZXIgPSBhd2FpdCByZXNvbHZlU2Vzc2lvblVzZXIoeyBjb250ZXh0LCBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgY29uc3QgdGltZVBsYW5zID0gKGF3YWl0IGNvbnRleHQuZGIuVGltZVBsYW4uZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgb3JnOiB7IGlkOiB7IGVxdWFsczogc2Vzc2lvblVzZXIub3JnSWQgfSB9LFxuICAgICAgICAgICAgICBzdGF0dXM6IHsgZXF1YWxzOiAnUEVORElORycgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc3RhcnRBdDogJ2FzYycgfVxuICAgICAgICAgIH0pKSBhcyBUaW1lUGxhbkl0ZW1bXTtcblxuICAgICAgICAgIHJldHVybiB0aW1lUGxhbnMubWFwKGNyZWF0ZVBlbmRpbmdSZXN1bHQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfTtcbn07XG4iXSwibmFtZXMiOlsiZ3JhcGhxbCIsImciLCJpc0FueUFkbWluIiwiY3JlYXRlRGlyZWN0VGltZVBsYW5FbnRyeSIsImZpbmRQb2xpY3lGb3JUaW1lVHlwZSIsInJlc29sdmVTZXNzaW9uVXNlciIsInRvTWlkbmlnaHRVdGMiLCJub3JtYWxpemVEYXRlSW5wdXQiLCJ2YWx1ZSIsImxhYmVsIiwiZGF0ZSIsIkRhdGUiLCJOdW1iZXIiLCJpc05hTiIsImdldFRpbWUiLCJFcnJvciIsInRvSVNPU3RyaW5nIiwiZW5zdXJlUmVwZWF0TW9kZVN1cHBvcnRzRmllbGRzIiwicmVwZWF0TW9kZSIsInJlcGVhdERheSIsImNyZWF0ZVJlcGVhdFRpbWVQbGFuRW50cnkiLCJjb250ZXh0Iiwic2Vzc2lvbiIsImlucHV0IiwidGltZVR5cGVJZCIsInNlc3Npb25Vc2VyIiwicG9saWN5Iiwib3JnSWQiLCJsb2NhdGlvbklkIiwibG9jYXRpb24iLCJpZCIsInBvbGljeURldGFpbHMiLCJxdWVyeSIsIlRpbWVQb2xpY3kiLCJmaW5kT25lIiwid2hlcmUiLCJpc0FsbG9jYXRpb25NYW5hZ2VkIiwic3RhcnRzT25Jc28iLCJzdGFydERhdGVUaW1lIiwiaW50ZXJ2YWwiLCJyZXBlYXRJbnRlcnZhbCIsInRpbWVQbGFuIiwiZGIiLCJUaW1lUGxhbiIsImNyZWF0ZU9uZSIsImRhdGEiLCJvcmciLCJjb25uZWN0IiwidXNlciIsInVzZXJJZCIsInRpbWVUeXBlIiwidGltZVBvbGljeSIsInN0YXR1cyIsImlzQXBwcm92YWJsZSIsInN0YXJ0QXQiLCJlbmRBdCIsInJlcGVhdEVuZHNPbiIsInJlYXNvbiIsIlRpbWVQbGFuRW50cmllcyIsImJhc2UiLCJUaW1lUGxhbkVudHJ5UGF5bG9hZCIsIm9iamVjdCIsIlBlbmRpbmdUaW1lUGxhbkFwcHJvdmFsIiwibmFtZSIsImZpZWxkcyIsImZpZWxkIiwidHlwZSIsInJlc29sdmUiLCJpdGVtIiwic29ydEtleSIsIm5vbk51bGwiLCJGbG9hdCIsIlRpbWVQbGFuRW50cnlJbnB1dCIsImlucHV0T2JqZWN0IiwiYXJnIiwiSUQiLCJTdHJpbmciLCJlbmREYXRlVGltZSIsImlzSGFsZkRheSIsIkJvb2xlYW4iLCJlbnVtIiwiSW50IiwiVGltZVBsYW5FbnRyeVVwZGF0ZUlucHV0IiwiY3JlYXRlUGVuZGluZ1Jlc3VsdCIsInJhd1NvcnRLZXkiLCJub3ciLCJtdXRhdGlvbiIsImNyZWF0ZVRpbWVQbGFuRW50cnkiLCJhcmdzIiwiX3Jvb3QiLCJlbWFpbCIsImlzUmVwZWF0aW5nIiwidW5kZWZpbmVkIiwidXBkYXRlVGltZVBsYW5FbnRyeSIsImV4aXN0aW5nVGltZVBsYW4iLCJzZXNzaW9uVXNlcklkIiwidGhlbiIsInUiLCJpc0FkbWluIiwicmVmZXJlbmNlRGF0ZUlzbyIsInJlZmVyZW5jZURhdGUiLCJ0b2RheSIsInVwZGF0ZURhdGEiLCJlbmRWYWx1ZSIsIlVzZXIiLCJwb2xpY3lBbGxvd3NBcHByb3ZhbCIsInNob3VsZFJlc2V0U3RhdHVzIiwiZGVjaWRlZEF0IiwiZGVjaWRlZEJ5IiwiZGlzY29ubmVjdCIsInVwZGF0ZU9uZSIsImRlbGV0ZVRpbWVQbGFuRW50cnkiLCJkZWxldGVPbmUiLCJwZW5kaW5nVGltZVBsYW5BcHByb3ZhbHMiLCJsaXN0IiwiX2FyZ3MiLCJ0aW1lUGxhbnMiLCJmaW5kTWFueSIsImVxdWFscyIsIm9yZGVyQnkiLCJtYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/TimePlanEntries.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/TimePlans.ts":
/*!*********************************************!*\
  !*** ../../schemas/extensions/TimePlans.ts ***!
  \*********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TimePlans: () => (/* binding */ TimePlans)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var rrule__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rrule */ \"rrule\");\n/* harmony import */ var rrule__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(rrule__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../domains/auth/userRole */ \"(api)/../../domains/auth/userRole.ts\");\n/* harmony import */ var _domains_timePlan_rrule__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../domains/timePlan/rrule */ \"(api)/../../domains/timePlan/rrule.ts\");\n/* harmony import */ var _domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../domains/timePlan/directEntry */ \"(api)/../../domains/timePlan/directEntry.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_4__]);\n_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\nconst isoFromValue = (value)=>{\n    if (!value) return null;\n    const maybeDate = typeof value === \"string\" ? new Date(value) : value;\n    if (Number.isNaN(maybeDate.getTime())) return null;\n    return maybeDate.toISOString();\n};\nconst buildOccurrenceId = (item, fallback)=>{\n    if (typeof item?.occurrenceId === \"string\") return item.occurrenceId;\n    if (typeof item?.startAt === \"string\") return item.startAt;\n    if (fallback) return fallback;\n    return item?.id ?? \"\";\n};\nconst mapDirectTimePlan = (timePlan)=>({\n        ...timePlan,\n        occurrenceId: buildOccurrenceId(timePlan),\n        seriesId: timePlan.seriesId ?? timePlan.repeatOrigin?.id ?? null,\n        isRecurringInstance: Boolean(timePlan.isRecurringInstance)\n    });\nconst mapOverrideTimePlan = (timePlan)=>({\n        ...timePlan,\n        occurrenceId: timePlan.replacedStartAt ?? buildOccurrenceId(timePlan),\n        seriesId: timePlan.repeatOrigin?.id ?? null,\n        isRecurringInstance: true\n    });\nconst groupOverridesBySeries = (plans)=>{\n    const map = new Map();\n    plans.forEach((plan)=>{\n        const seriesId = plan.repeatOrigin?.id;\n        if (!seriesId) return;\n        const existing = map.get(seriesId) ?? [];\n        existing.push(plan);\n        map.set(seriesId, existing);\n    });\n    return map;\n};\nconst expandRecurringTimePlan = (plan, rangeStart, rangeEnd, overrides)=>{\n    const ruleSource = plan.rrule ?? (0,_domains_timePlan_rrule__WEBPACK_IMPORTED_MODULE_3__.buildTimePlanRRule)(plan);\n    if (!ruleSource) return [];\n    let rule;\n    try {\n        rule = rrule__WEBPACK_IMPORTED_MODULE_1__.RRule.fromString(ruleSource);\n    } catch  {\n        return [];\n    }\n    const skipped = new Set((overrides ?? []).map((exception)=>isoFromValue(exception.replacedStartAt ?? exception.startAt)).filter(Boolean));\n    return rule.between(rangeStart, rangeEnd, true).filter((occurrence)=>!skipped.has(occurrence.toISOString())).map((occurrence)=>{\n        const occurrenceId = occurrence.toISOString();\n        return {\n            ...plan,\n            id: `${plan.id}:${occurrenceId}`,\n            startAt: occurrenceId,\n            endAt: occurrenceId,\n            occurrenceId,\n            seriesId: plan.id,\n            isRecurringInstance: true\n        };\n    });\n};\nconst TimePlans = (base)=>({\n        query: {\n            getTimePlans: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.list(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(base.object(\"TimePlan\"))),\n                args: {\n                    start: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    }),\n                    end: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    })\n                },\n                async resolve (source, { start, end }, context) {\n                    const session = context.session;\n                    if (!session?.email) return [];\n                    const users = await context.query.User.findMany({\n                        where: {\n                            email: {\n                                equals: session.email\n                            }\n                        },\n                        query: \"id role org { id }\"\n                    });\n                    const user = users?.[0];\n                    if (!user?.org?.id) return [];\n                    const startDate = new Date(start);\n                    const endDate = new Date(end);\n                    const timePlans = await context.query.TimePlan.findMany({\n                        where: {\n                            org: {\n                                id: {\n                                    equals: user.org.id\n                                }\n                            },\n                            startAt: {\n                                lte: endDate.toISOString()\n                            },\n                            OR: [\n                                {\n                                    endAt: {\n                                        gte: startDate.toISOString()\n                                    }\n                                },\n                                {\n                                    endAt: {\n                                        equals: null\n                                    }\n                                }\n                            ]\n                        },\n                        query: `\n            id\n            startAt\n            endAt\n            repeatMode\n            repeatInterval\n            repeatDay\n            origin\n            status\n            reason\n            isAllDay\n            timeType {\n              id\n              name\n              color\n            }\n            user {\n              id\n              displayName\n              avatarUrl\n              location {\n                id\n              }\n            }\n            repeatOrigin {\n              id\n            }\n            replacedStartAt\n            rrule\n            occurrenceId\n            isRecurringInstance\n          `\n                    });\n                    const startRange = startDate;\n                    const endRange = endDate;\n                    const overridePlans = timePlans.filter((plan)=>Boolean(plan.repeatOrigin?.id));\n                    const basePlans = timePlans.filter((plan)=>!plan.repeatOrigin?.id && plan.repeatMode && plan.repeatMode !== \"SINGLE\");\n                    const singlePlans = timePlans.filter((plan)=>!plan.repeatOrigin?.id && (!plan.repeatMode || plan.repeatMode === \"SINGLE\"));\n                    const overridesBySeries = groupOverridesBySeries(overridePlans);\n                    const recurringInstances = basePlans.flatMap((plan)=>expandRecurringTimePlan(plan, startRange, endRange, overridesBySeries.get(plan.id)));\n                    const mappedOverrides = overridePlans.map(mapOverrideTimePlan);\n                    const mappedSingles = singlePlans.map(mapDirectTimePlan);\n                    return [\n                        ...mappedSingles,\n                        ...recurringInstances,\n                        ...mappedOverrides\n                    ].sort((a, b)=>{\n                        const aStart = new Date(a.startAt ?? 0).getTime();\n                        const bStart = new Date(b.startAt ?? 0).getTime();\n                        return aStart - bStart;\n                    });\n                }\n            })\n        },\n        mutation: {\n            requestTimePlan: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: base.object(\"TimePlan\"),\n                args: {\n                    timeTypeId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    startDateTime: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    }),\n                    endDateTime: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String)\n                    }),\n                    isHalfDay: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.Boolean\n                    }),\n                    reason: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.String\n                    })\n                },\n                async resolve (source, { timeTypeId, startDateTime, endDateTime, isHalfDay, reason }, context) {\n                    return await (0,_domains_timePlan_directEntry__WEBPACK_IMPORTED_MODULE_4__.createDirectTimePlanEntry)({\n                        context,\n                        session: context.session,\n                        input: {\n                            timeTypeId: timeTypeId,\n                            startDateTime: startDateTime,\n                            endDateTime: endDateTime,\n                            isHalfDay: typeof isHalfDay === \"boolean\" ? isHalfDay : undefined,\n                            reason: typeof reason === \"string\" ? reason : undefined\n                        }\n                    });\n                }\n            }),\n            decideTimePlan: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.field({\n                type: base.object(\"TimePlan\"),\n                args: {\n                    timePlanId: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.ID)\n                    }),\n                    decision: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.arg({\n                        type: _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.nonNull(base.enum(\"TimePlanStatusType\"))\n                    })\n                },\n                async resolve (source, { timePlanId, decision }, context) {\n                    const session = context.session;\n                    if (!session?.email) throw new Error(\"Unauthorized\");\n                    const users = await context.query.User.findMany({\n                        where: {\n                            email: {\n                                equals: session.email\n                            }\n                        },\n                        query: \"id role org { id }\"\n                    });\n                    const me = users?.[0];\n                    const canDecideTimePlan = (0,_domains_auth_userRole__WEBPACK_IMPORTED_MODULE_2__.isAnyAdmin)({\n                        session\n                    });\n                    if (!canDecideTimePlan || !me?.org?.id) throw new Error(\"Forbidden\");\n                    const leave = await context.query.TimePlan.findOne({\n                        where: {\n                            id: timePlanId\n                        },\n                        query: \"id org { id } status\"\n                    });\n                    if (!leave || leave.org?.id !== me.org.id) throw new Error(\"TimePlan not found\");\n                    if (decision === \"PENDING\") throw new Error(\"Cannot set status back to pending\");\n                    return await context.db.TimePlan.updateOne({\n                        where: {\n                            id: timePlanId\n                        },\n                        data: {\n                            status: decision,\n                            decidedBy: {\n                                connect: {\n                                    id: me.id\n                                }\n                            },\n                            decidedAt: new Date().toISOString()\n                        }\n                    });\n                }\n            })\n        }\n    });\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL1RpbWVQbGFucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUNnRDtBQUdsQjtBQUMyQjtBQUNTO0FBQ2E7QUFNL0UsTUFBTU0sZUFBZSxDQUFDQztJQUNwQixJQUFJLENBQUNBLE9BQU8sT0FBTztJQUNuQixNQUFNQyxZQUFZLE9BQU9ELFVBQVUsV0FBVyxJQUFJRSxLQUFLRixTQUFTQTtJQUNoRSxJQUFJRyxPQUFPQyxLQUFLLENBQUNILFVBQVVJLE9BQU8sS0FBSyxPQUFPO0lBQzlDLE9BQU9KLFVBQVVLLFdBQVc7QUFDOUI7QUFFQSxNQUFNQyxvQkFBb0IsQ0FBQ0MsTUFBV0M7SUFDcEMsSUFBSSxPQUFPRCxNQUFNRSxpQkFBaUIsVUFBVSxPQUFPRixLQUFLRSxZQUFZO0lBQ3BFLElBQUksT0FBT0YsTUFBTUcsWUFBWSxVQUFVLE9BQU9ILEtBQUtHLE9BQU87SUFDMUQsSUFBSUYsVUFBVSxPQUFPQTtJQUNyQixPQUFPRCxNQUFNSSxNQUFNO0FBQ3JCO0FBRUEsTUFBTUMsb0JBQW9CLENBQUNDLFdBQW1CO1FBQzVDLEdBQUdBLFFBQVE7UUFDWEosY0FBY0gsa0JBQWtCTztRQUNoQ0MsVUFBVUQsU0FBU0MsUUFBUSxJQUFJRCxTQUFTRSxZQUFZLEVBQUVKLE1BQU07UUFDNURLLHFCQUFxQkMsUUFBUUosU0FBU0csbUJBQW1CO0lBQzNEO0FBRUEsTUFBTUUsc0JBQXNCLENBQUNMLFdBQW1CO1FBQzlDLEdBQUdBLFFBQVE7UUFDWEosY0FBY0ksU0FBU00sZUFBZSxJQUFJYixrQkFBa0JPO1FBQzVEQyxVQUFVRCxTQUFTRSxZQUFZLEVBQUVKLE1BQU07UUFDdkNLLHFCQUFxQjtJQUN2QjtBQUVBLE1BQU1JLHlCQUF5QixDQUFDQztJQUM5QixNQUFNQyxNQUFNLElBQUlDO0lBQ2hCRixNQUFNRyxPQUFPLENBQUNDLENBQUFBO1FBQ1osTUFBTVgsV0FBV1csS0FBS1YsWUFBWSxFQUFFSjtRQUNwQyxJ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QVEsQ0FBQ3NDLE9BQU8sQ0FBQzt3QkFDbEQ3QyxPQUFPOzRCQUFFekQsSUFBSStGO3dCQUFxQjt3QkFDbEMxRCxPQUFPO29CQUNUO29CQUNBLElBQUksQ0FBQ2dFLFNBQVNBLE1BQU16QyxHQUFHLEVBQUU1RCxPQUFPbUcsR0FBR3ZDLEdBQUcsQ0FBQzVELEVBQUUsRUFBRSxNQUFNLElBQUlrRyxNQUFNO29CQUMzRCxJQUFJRixhQUFhLFdBQVcsTUFBTSxJQUFJRSxNQUFNO29CQUM1QyxPQUFPLE1BQU0vQyxRQUFRb0QsRUFBRSxDQUFDdkMsUUFBUSxDQUFDd0MsU0FBUyxDQUFDO3dCQUN6Qy9DLE9BQU87NEJBQUV6RCxJQUFJK0Y7d0JBQXFCO3dCQUNsQ1UsTUFBTTs0QkFDSkMsUUFBUVY7NEJBQ1JXLFdBQVc7Z0NBQUVDLFNBQVM7b0NBQUU1RyxJQUFJbUcsR0FBR25HLEVBQUU7Z0NBQUM7NEJBQUU7NEJBQ3BDNkcsV0FBVyxJQUFJdkgsT0FBT0ksV0FBVzt3QkFDbkM7b0JBQ0Y7Z0JBQ0Y7WUFDRjtRQUNGO0lBQ0YsR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL2V4dGVuc2lvbnMvVGltZVBsYW5zLnRzP2E1ODIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBUeXBlSW5mbyB9IGZyb20gJy5rZXlzdG9uZS90eXBlcyc7XG5pbXBvcnQgeyBncmFwaHFsIGFzIGcgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlJztcbmltcG9ydCB0eXBlIHsgQmFzZVNjaGVtYU1ldGEgfSBmcm9tICdAa2V5c3RvbmUtNi9jb3JlL2Rpc3QvZGVjbGFyYXRpb25zL3NyYy90eXBlcy9zY2hlbWEvZ3JhcGhxbC10cy1zY2hlbWEnO1xuaW1wb3J0IHsgU2Vzc2lvbiB9IGZyb20gJ2F1dGgnO1xuaW1wb3J0IHsgUlJ1bGUgfSBmcm9tICdycnVsZSc7XG5pbXBvcnQgeyBpc0FueUFkbWluIH0gZnJvbSAnLi4vLi4vZG9tYWlucy9hdXRoL3VzZXJSb2xlJztcbmltcG9ydCB7IGJ1aWxkVGltZVBsYW5SUnVsZSB9IGZyb20gJy4uLy4uL2RvbWFpbnMvdGltZVBsYW4vcnJ1bGUnO1xuaW1wb3J0IHsgY3JlYXRlRGlyZWN0VGltZVBsYW5FbnRyeSB9IGZyb20gJy4uLy4uL2RvbWFpbnMvdGltZVBsYW4vZGlyZWN0RW50cnknO1xuXG50eXBlIFVzZXJJdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ1VzZXInXVsnaXRlbSddO1xudHlwZSBUaW1lUGxhbkl0ZW0gPSBhbnk7IC8vIFR5cGVJbmZvWydsaXN0cyddWydUaW1lUGxhbiddWydpdGVtJ10gLSB1c2luZyBhbnkgZHVlIHRvIHN0YWxlIGdlbmVyYXRlZCB0eXBlc1xudHlwZSBPcmdhbml6YXRpb25JdGVtID0gVHlwZUluZm9bJ2xpc3RzJ11bJ09yZ2FuaXphdGlvbiddWydpdGVtJ107XG5cbmNvbnN0IGlzb0Zyb21WYWx1ZSA9ICh2YWx1ZT86IHN0cmluZyB8IERhdGUgfCBudWxsKSA9PiB7XG4gIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xuICBjb25zdCBtYXliZURhdGUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gbmV3IERhdGUodmFsdWUpIDogdmFsdWU7XG4gIGlmIChOdW1iZXIuaXNOYU4obWF5YmVEYXRlLmdldFRpbWUoKSkpIHJldHVybiBudWxsO1xuICByZXR1cm4gbWF5YmVEYXRlLnRvSVNPU3RyaW5nKCk7XG59O1xuXG5jb25zdCBidWlsZE9jY3VycmVuY2VJZCA9IChpdGVtOiBhbnksIGZhbGxiYWNrPzogc3RyaW5nKSA9PiB7XG4gIGlmICh0eXBlb2YgaXRlbT8ub2NjdXJyZW5jZUlkID09PSAnc3RyaW5nJykgcmV0dXJuIGl0ZW0ub2NjdXJyZW5jZUlkO1xuICBpZiAodHlwZW9mIGl0ZW0/LnN0YXJ0QXQgPT09ICdzdHJpbmcnKSByZXR1cm4gaXRlbS5zdGFydEF0O1xuICBpZiAoZmFsbGJhY2spIHJldHVybiBmYWxsYmFjaztcbiAgcmV0dXJuIGl0ZW0/LmlkID8/ICcnO1xufTtcblxuY29uc3QgbWFwRGlyZWN0VGltZVBsYW4gPSAodGltZVBsYW46IGFueSkgPT4gKHtcbiAgLi4udGltZVBsYW4sXG4gIG9jY3VycmVuY2VJZDogYnVpbGRPY2N1cnJlbmNlSWQodGltZVBsYW4pLFxuICBzZXJpZXNJZDogdGltZVBsYW4uc2VyaWVzSWQgPz8gdGltZVBsYW4ucmVwZWF0T3JpZ2luPy5pZCA/PyBudWxsLFxuICBpc1JlY3VycmluZ0luc3RhbmNlOiBCb29sZWFuKHRpbWVQbGFuLmlzUmVjdXJyaW5nSW5zdGFuY2UpXG59KTtcblxuY29uc3QgbWFwT3ZlcnJpZGVUaW1lUGxhbiA9ICh0aW1lUGxhbjogYW55KSA9PiAoe1xuICAuLi50aW1lUGxhbixcbiAgb2NjdXJyZW5jZUlkOiB0aW1lUGxhbi5yZXBsYWNlZFN0YXJ0QXQgPz8gYnVpbGRPY2N1cnJlbmNlSWQodGltZVBsYW4pLFxuICBzZXJpZXNJZDogdGltZVBsYW4ucmVwZWF0T3JpZ2luPy5pZCA/PyBudWxsLFxuICBpc1JlY3VycmluZ0luc3RhbmNlOiB0cnVlXG59KTtcblxuY29uc3QgZ3JvdXBPdmVycmlkZXNCeVNlcmllcyA9IChwbGFuczogYW55W10pID0+IHtcbiAgY29uc3QgbWFwID0gbmV3IE1hcDxzdHJpbmcsIGFueVtdPigpO1xuICBwbGFucy5mb3JFYWNoKHBsYW4gPT4ge1xuICAgIGNvbnN0IHNlcmllc0lkID0gcGxhbi5yZXBlYXRPcmlnaW4/LmlkO1xuICAgIGlmICghc2VyaWVzSWQpIHJldHVybjtcbiAgICBjb25zdCBleGlzdGluZyA9IG1hcC5nZXQoc2VyaWVzSWQpID8/IFtdO1xuICAgIGV4aXN0aW5nLnB1c2gocGxhbik7XG4gICAgbWFwLnNldChzZXJpZXNJZCwgZXhpc3RpbmcpO1xuICB9KTtcbiAgcmV0dXJuIG1hcDtcbn07XG5cbmNvbnN0IGV4cGFuZFJlY3VycmluZ1RpbWVQbGFuID0gKHBsYW46IGFueSwgcmFuZ2VTdGFydDogRGF0ZSwgcmFuZ2VFbmQ6IERhdGUsIG92ZXJyaWRlcz86IGFueVtdKSA9PiB7XG4gIGNvbnN0IHJ1bGVTb3VyY2UgPSBwbGFuLnJydWxlID8/IGJ1aWxkVGltZVBsYW5SUnVsZShwbGFuKTtcbiAgaWYgKCFydWxlU291cmNlKSByZXR1cm4gW107XG4gIGxldCBydWxlOiBSUnVsZTtcbiAgdHJ5IHtcbiAgICBydWxlID0gUlJ1bGUuZnJvbVN0cmluZyhydWxlU291cmNlKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgY29uc3Qgc2tpcHBlZCA9IG5ldyBTZXQoXG4gICAgKG92ZXJyaWRlcyA/PyBbXSlcbiAgICAgIC5tYXAoZXhjZXB0aW9uID0+IGlzb0Zyb21WYWx1ZShleGNlcHRpb24ucmVwbGFjZWRTdGFydEF0ID8/IGV4Y2VwdGlvbi5zdGFydEF0KSlcbiAgICAgIC5maWx0ZXIoQm9vbGVhbikgYXMgc3RyaW5nW11cbiAgKTtcblxuICByZXR1cm4gcnVsZVxuICAgIC5iZXR3ZWVuKHJhbmdlU3RhcnQsIHJhbmdlRW5kLCB0cnVlKVxuICAgIC5maWx0ZXIob2NjdXJyZW5jZSA9PiAhc2tpcHBlZC5oYXMob2NjdXJyZW5jZS50b0lTT1N0cmluZygpKSlcbiAgICAubWFwKG9jY3VycmVuY2UgPT4ge1xuICAgICAgY29uc3Qgb2NjdXJyZW5jZUlkID0gb2NjdXJyZW5jZS50b0lTT1N0cmluZygpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucGxhbixcbiAgICAgICAgaWQ6IGAke3BsYW4uaWR9OiR7b2NjdXJyZW5jZUlkfWAsXG4gICAgICAgIHN0YXJ0QXQ6IG9jY3VycmVuY2VJZCxcbiAgICAgICAgZW5kQXQ6IG9jY3VycmVuY2VJZCxcbiAgICAgICAgb2NjdXJyZW5jZUlkLFxuICAgICAgICBzZXJpZXNJZDogcGxhbi5pZCxcbiAgICAgICAgaXNSZWN1cnJpbmdJbnN0YW5jZTogdHJ1ZVxuICAgICAgfTtcbiAgICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBUaW1lUGxhbnMgPSAoYmFzZTogQmFzZVNjaGVtYU1ldGEpID0+ICh7XG4gIHF1ZXJ5OiB7XG4gICAgZ2V0VGltZVBsYW5zOiBnLmZpZWxkKHtcbiAgICAgIHR5cGU6IGcubGlzdChnLm5vbk51bGwoYmFzZS5vYmplY3QoJ1RpbWVQbGFuJykpKSxcbiAgICAgIGFyZ3M6IHtcbiAgICAgICAgc3RhcnQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuU3RyaW5nKSB9KSxcbiAgICAgICAgZW5kOiBnLmFyZyh7IHR5cGU6IGcubm9uTnVsbChnLlN0cmluZykgfSlcbiAgICAgIH0sXG4gICAgICBhc3luYyByZXNvbHZlKHNvdXJjZSwgeyBzdGFydCwgZW5kIH0sIGNvbnRleHQpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGNvbnRleHQuc2Vzc2lvbiBhcyBTZXNzaW9uIHwgbnVsbDtcbiAgICAgICAgaWYgKCFzZXNzaW9uPy5lbWFpbCkgcmV0dXJuIFtdO1xuICAgICAgICBjb25zdCB1c2VycyA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlVzZXIuZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB7IGVtYWlsOiB7IGVxdWFsczogc2Vzc2lvbi5lbWFpbCB9IH0sXG4gICAgICAgICAgcXVlcnk6ICdpZCByb2xlIG9yZyB7IGlkIH0nXG4gICAgICAgIH0pKSBhcyAoUGljazxVc2VySXRlbSwgJ2lkJyB8ICdyb2xlJz4gJiB7IG9yZzogUGljazxPcmdhbml6YXRpb25JdGVtLCAnaWQnPiB8IG51bGwgfSlbXTtcbiAgICAgICAgY29uc3QgdXNlciA9IHVzZXJzPy5bMF07XG4gICAgICAgIGlmICghdXNlcj8ub3JnPy5pZCkgcmV0dXJuIFtdO1xuICAgICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZShzdGFydCBhcyBzdHJpbmcpO1xuICAgICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoZW5kIGFzIHN0cmluZyk7XG5cbiAgICAgICAgY29uc3QgdGltZVBsYW5zID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVGltZVBsYW4uZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBvcmc6IHsgaWQ6IHsgZXF1YWxzOiB1c2VyLm9yZy5pZCB9IH0sXG4gICAgICAgICAgICBzdGFydEF0OiB7IGx0ZTogZW5kRGF0ZS50b0lTT1N0cmluZygpIH0sXG4gICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICB7IGVuZEF0OiB7IGd0ZTogc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkgfSB9LFxuICAgICAgICAgICAgICB7IGVuZEF0OiB7IGVxdWFsczogbnVsbCB9IH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHF1ZXJ5OiBgXG4gICAgICAgICAgICBpZFxuICAgICAgICAgICAgc3RhcnRBdFxuICAgICAgICAgICAgZW5kQXRcbiAgICAgICAgICAgIHJlcGVhdE1vZGVcbiAgICAgICAgICAgIHJlcGVhdEludGVydmFsXG4gICAgICAgICAgICByZXBlYXREYXlcbiAgICAgICAgICAgIG9yaWdpblxuICAgICAgICAgICAgc3RhdHVzXG4gICAgICAgICAgICByZWFzb25cbiAgICAgICAgICAgIGlzQWxsRGF5XG4gICAgICAgICAgICB0aW1lVHlwZSB7XG4gICAgICAgICAgICAgIGlkXG4gICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICAgY29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVzZXIge1xuICAgICAgICAgICAgICBpZFxuICAgICAgICAgICAgICBkaXNwbGF5TmFtZVxuICAgICAgICAgICAgICBhdmF0YXJVcmxcbiAgICAgICAgICAgICAgbG9jYXRpb24ge1xuICAgICAgICAgICAgICAgIGlkXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcGVhdE9yaWdpbiB7XG4gICAgICAgICAgICAgIGlkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXBsYWNlZFN0YXJ0QXRcbiAgICAgICAgICAgIHJydWxlXG4gICAgICAgICAgICBvY2N1cnJlbmNlSWRcbiAgICAgICAgICAgIGlzUmVjdXJyaW5nSW5zdGFuY2VcbiAgICAgICAgICBgXG4gICAgICAgIH0pKSBhcyBUaW1lUGxhbkl0ZW1bXTtcblxuICAgICAgICBjb25zdCBzdGFydFJhbmdlID0gc3RhcnREYXRlO1xuICAgICAgICBjb25zdCBlbmRSYW5nZSA9IGVuZERhdGU7XG5cbiAgICAgICAgY29uc3Qgb3ZlcnJpZGVQbGFucyA9IHRpbWVQbGFucy5maWx0ZXIocGxhbiA9PiBCb29sZWFuKHBsYW4ucmVwZWF0T3JpZ2luPy5pZCkpO1xuICAgICAgICBjb25zdCBiYXNlUGxhbnMgPSB0aW1lUGxhbnMuZmlsdGVyKHBsYW4gPT4gIXBsYW4ucmVwZWF0T3JpZ2luPy5pZCAmJiBwbGFuLnJlcGVhdE1vZGUgJiYgcGxhbi5yZXBlYXRNb2RlICE9PSAnU0lOR0xFJyk7XG4gICAgICAgIGNvbnN0IHNpbmdsZVBsYW5zID0gdGltZVBsYW5zLmZpbHRlcihwbGFuID0+ICFwbGFuLnJlcGVhdE9yaWdpbj8uaWQgJiYgKCFwbGFuLnJlcGVhdE1vZGUgfHwgcGxhbi5yZXBlYXRNb2RlID09PSAnU0lOR0xFJykpO1xuXG4gICAgICAgIGNvbnN0IG92ZXJyaWRlc0J5U2VyaWVzID0gZ3JvdXBPdmVycmlkZXNCeVNlcmllcyhvdmVycmlkZVBsYW5zKTtcblxuICAgICAgICBjb25zdCByZWN1cnJpbmdJbnN0YW5jZXMgPSBiYXNlUGxhbnMuZmxhdE1hcChwbGFuID0+XG4gICAgICAgICAgZXhwYW5kUmVjdXJyaW5nVGltZVBsYW4ocGxhbiwgc3RhcnRSYW5nZSwgZW5kUmFuZ2UsIG92ZXJyaWRlc0J5U2VyaWVzLmdldChwbGFuLmlkKSlcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBtYXBwZWRPdmVycmlkZXMgPSBvdmVycmlkZVBsYW5zLm1hcChtYXBPdmVycmlkZVRpbWVQbGFuKTtcbiAgICAgICAgY29uc3QgbWFwcGVkU2luZ2xlcyA9IHNpbmdsZVBsYW5zLm1hcChtYXBEaXJlY3RUaW1lUGxhbik7XG5cbiAgICAgICAgcmV0dXJuIFsuLi5tYXBwZWRTaW5nbGVzLCAuLi5yZWN1cnJpbmdJbnN0YW5jZXMsIC4uLm1hcHBlZE92ZXJyaWRlc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgIGNvbnN0IGFTdGFydCA9IG5ldyBEYXRlKGEuc3RhcnRBdCA/PyAwKS5nZXRUaW1lKCk7XG4gICAgICAgICAgY29uc3QgYlN0YXJ0ID0gbmV3IERhdGUoYi5zdGFydEF0ID8/IDApLmdldFRpbWUoKTtcbiAgICAgICAgICByZXR1cm4gYVN0YXJ0IC0gYlN0YXJ0O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBtdXRhdGlvbjoge1xuICAgIHJlcXVlc3RUaW1lUGxhbjogZy5maWVsZCh7XG4gICAgICB0eXBlOiBiYXNlLm9iamVjdCgnVGltZVBsYW4nKSxcbiAgICAgIGFyZ3M6IHtcbiAgICAgICAgdGltZVR5cGVJZDogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoZy5JRCkgfSksXG4gICAgICAgIHN0YXJ0RGF0ZVRpbWU6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuU3RyaW5nKSB9KSxcbiAgICAgICAgZW5kRGF0ZVRpbWU6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuU3RyaW5nKSB9KSxcbiAgICAgICAgaXNIYWxmRGF5OiBnLmFyZyh7IHR5cGU6IGcuQm9vbGVhbiB9KSxcbiAgICAgICAgcmVhc29uOiBnLmFyZyh7IHR5cGU6IGcuU3RyaW5nIH0pXG4gICAgICB9LFxuICAgICAgYXN5bmMgcmVzb2x2ZShzb3VyY2UsIHsgdGltZVR5cGVJZCwgc3RhcnREYXRlVGltZSwgZW5kRGF0ZVRpbWUsIGlzSGFsZkRheSwgcmVhc29uIH0sIGNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZURpcmVjdFRpbWVQbGFuRW50cnkoe1xuICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgc2Vzc2lvbjogY29udGV4dC5zZXNzaW9uIGFzIFNlc3Npb24gfCBudWxsLFxuICAgICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgICB0aW1lVHlwZUlkOiB0aW1lVHlwZUlkIGFzIHN0cmluZyxcbiAgICAgICAgICAgIHN0YXJ0RGF0ZVRpbWU6IHN0YXJ0RGF0ZVRpbWUgYXMgc3RyaW5nLFxuICAgICAgICAgICAgZW5kRGF0ZVRpbWU6IGVuZERhdGVUaW1lIGFzIHN0cmluZyxcbiAgICAgICAgICAgIGlzSGFsZkRheTogdHlwZW9mIGlzSGFsZkRheSA9PT0gJ2Jvb2xlYW4nID8gaXNIYWxmRGF5IDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcmVhc29uOiB0eXBlb2YgcmVhc29uID09PSAnc3RyaW5nJyA/IHJlYXNvbiA6IHVuZGVmaW5lZFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSksXG4gICAgZGVjaWRlVGltZVBsYW46IGcuZmllbGQoe1xuICAgICAgdHlwZTogYmFzZS5vYmplY3QoJ1RpbWVQbGFuJyksXG4gICAgICBhcmdzOiB7XG4gICAgICAgIHRpbWVQbGFuSWQ6IGcuYXJnKHsgdHlwZTogZy5ub25OdWxsKGcuSUQpIH0pLFxuICAgICAgICBkZWNpc2lvbjogZy5hcmcoeyB0eXBlOiBnLm5vbk51bGwoYmFzZS5lbnVtKCdUaW1lUGxhblN0YXR1c1R5cGUnKSkgfSlcbiAgICAgIH0sXG4gICAgICBhc3luYyByZXNvbHZlKHNvdXJjZSwgeyB0aW1lUGxhbklkLCBkZWNpc2lvbiB9LCBjb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBjb250ZXh0LnNlc3Npb24gYXMgU2Vzc2lvbiB8IG51bGw7XG4gICAgICAgIGlmICghc2Vzc2lvbj8uZW1haWwpIHRocm93IG5ldyBFcnJvcignVW5hdXRob3JpemVkJyk7XG4gICAgICAgIGNvbnN0IHVzZXJzID0gKGF3YWl0IGNvbnRleHQucXVlcnkuVXNlci5maW5kTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHsgZW1haWw6IHsgZXF1YWxzOiBzZXNzaW9uLmVtYWlsIH0gfSxcbiAgICAgICAgICBxdWVyeTogJ2lkIHJvbGUgb3JnIHsgaWQgfSdcbiAgICAgICAgfSkpIGFzIChQaWNrPFVzZXJJdGVtLCAnaWQnIHwgJ3JvbGUnPiAmIHsgb3JnOiBQaWNrPE9yZ2FuaXphdGlvbkl0ZW0sICdpZCc+IHwgbnVsbCB9KVtdO1xuICAgICAgICBjb25zdCBtZSA9IHVzZXJzPy5bMF07XG4gICAgICAgIGNvbnN0IGNhbkRlY2lkZVRpbWVQbGFuID0gaXNBbnlBZG1pbih7IHNlc3Npb24gfSk7XG4gICAgICAgIGlmICghY2FuRGVjaWRlVGltZVBsYW4gfHwgIW1lPy5vcmc/LmlkKSB0aHJvdyBuZXcgRXJyb3IoJ0ZvcmJpZGRlbicpO1xuICAgICAgICBjb25zdCBsZWF2ZSA9IChhd2FpdCBjb250ZXh0LnF1ZXJ5LlRpbWVQbGFuLmZpbmRPbmUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiB0aW1lUGxhbklkIGFzIHN0cmluZyB9LFxuICAgICAgICAgIHF1ZXJ5OiAnaWQgb3JnIHsgaWQgfSBzdGF0dXMnXG4gICAgICAgIH0pKSBhcyAoUGljazxUaW1lUGxhbkl0ZW0sICdpZCcgfCAnc3RhdHVzJz4gJiB7IG9yZzogUGljazxPcmdhbml6YXRpb25JdGVtLCAnaWQnPiB8IG51bGwgfSkgfCBudWxsO1xuICAgICAgICBpZiAoIWxlYXZlIHx8IGxlYXZlLm9yZz8uaWQgIT09IG1lLm9yZy5pZCkgdGhyb3cgbmV3IEVycm9yKCdUaW1lUGxhbiBub3QgZm91bmQnKTtcbiAgICAgICAgaWYgKGRlY2lzaW9uID09PSAnUEVORElORycpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNldCBzdGF0dXMgYmFjayB0byBwZW5kaW5nJyk7XG4gICAgICAgIHJldHVybiBhd2FpdCBjb250ZXh0LmRiLlRpbWVQbGFuLnVwZGF0ZU9uZSh7XG4gICAgICAgICAgd2hlcmU6IHsgaWQ6IHRpbWVQbGFuSWQgYXMgc3RyaW5nIH0sXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgc3RhdHVzOiBkZWNpc2lvbiBhcyBzdHJpbmcsXG4gICAgICAgICAgICBkZWNpZGVkQnk6IHsgY29ubmVjdDogeyBpZDogbWUuaWQgfSB9LFxuICAgICAgICAgICAgZGVjaWRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pXG4gIH1cbn0pO1xuIl0sIm5hbWVzIjpbImdyYXBocWwiLCJnIiwiUlJ1bGUiLCJpc0FueUFkbWluIiwiYnVpbGRUaW1lUGxhblJSdWxlIiwiY3JlYXRlRGlyZWN0VGltZVBsYW5FbnRyeSIsImlzb0Zyb21WYWx1ZSIsInZhbHVlIiwibWF5YmVEYXRlIiwiRGF0ZSIsIk51bWJlciIsImlzTmFOIiwiZ2V0VGltZSIsInRvSVNPU3RyaW5nIiwiYnVpbGRPY2N1cnJlbmNlSWQiLCJpdGVtIiwiZmFsbGJhY2siLCJvY2N1cnJlbmNlSWQiLCJzdGFydEF0IiwiaWQiLCJtYXBEaXJlY3RUaW1lUGxhbiIsInRpbWVQbGFuIiwic2VyaWVzSWQiLCJyZXBlYXRPcmlnaW4iLCJpc1JlY3VycmluZ0luc3RhbmNlIiwiQm9vbGVhbiIsIm1hcE92ZXJyaWRlVGltZVBsYW4iLCJyZXBsYWNlZFN0YXJ0QXQiLCJncm91cE92ZXJyaWRlc0J5U2VyaWVzIiwicGxhbnMiLCJtYXAiLCJNYXAiLCJmb3JFYWNoIiwicGxhbiIsImV4aXN0aW5nIiwiZ2V0IiwicHVzaCIsInNldCIsImV4cGFuZFJlY3VycmluZ1RpbWVQbGFuIiwicmFuZ2VTdGFydCIsInJhbmdlRW5kIiwib3ZlcnJpZGVzIiwicnVsZVNvdXJjZSIsInJydWxlIiwicnVsZSIsImZyb21TdHJpbmciLCJza2lwcGVkIiwiU2V0IiwiZXhjZXB0aW9uIiwiZmlsdGVyIiwiYmV0d2VlbiIsIm9jY3VycmVuY2UiLCJoYXMiLCJlbmRBdCIsIlRpbWVQbGFucyIsImJhc2UiLCJxdWVyeSIsImdldFRpbWVQbGFucyIsImZpZWxkIiwidHlwZSIsImxpc3QiLCJub25OdWxsIiwib2JqZWN0IiwiYXJncyIsInN0YXJ0IiwiYXJnIiwiU3RyaW5nIiwiZW5kIiwicmVzb2x2ZSIsInNvdXJjZSIsImNvbnRleHQiLCJzZXNzaW9uIiwiZW1haWwiLCJ1c2VycyIsIlVzZXIiLCJmaW5kTWFueSIsIndoZXJlIiwiZXF1YWxzIiwidXNlciIsIm9yZyIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ0aW1lUGxhbnMiLCJUaW1lUGxhbiIsImx0ZSIsIk9SIiwiZ3RlIiwic3RhcnRSYW5nZSIsImVuZFJhbmdlIiwib3ZlcnJpZGVQbGFucyIsImJhc2VQbGFucyIsInJlcGVhdE1vZGUiLCJzaW5nbGVQbGFucyIsIm92ZXJyaWRlc0J5U2VyaWVzIiwicmVjdXJyaW5nSW5zdGFuY2VzIiwiZmxhdE1hcCIsIm1hcHBlZE92ZXJyaWRlcyIsIm1hcHBlZFNpbmdsZXMiLCJzb3J0IiwiYSIsImIiLCJhU3RhcnQiLCJiU3RhcnQiLCJtdXRhdGlvbiIsInJlcXVlc3RUaW1lUGxhbiIsInRpbWVUeXBlSWQiLCJJRCIsInN0YXJ0RGF0ZVRpbWUiLCJlbmREYXRlVGltZSIsImlzSGFsZkRheSIsInJlYXNvbiIsImlucHV0IiwidW5kZWZpbmVkIiwiZGVjaWRlVGltZVBsYW4iLCJ0aW1lUGxhbklkIiwiZGVjaXNpb24iLCJlbnVtIiwiRXJyb3IiLCJtZSIsImNhbkRlY2lkZVRpbWVQbGFuIiwibGVhdmUiLCJmaW5kT25lIiwiZGIiLCJ1cGRhdGVPbmUiLCJkYXRhIiwic3RhdHVzIiwiZGVjaWRlZEJ5IiwiY29ubmVjdCIsImRlY2lkZWRBdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/TimePlans.ts\n");

/***/ }),

/***/ "(api)/../../schemas/extensions/index.ts":
/*!*****************************************!*\
  !*** ../../schemas/extensions/index.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Allocations: () => (/* reexport safe */ _Allocations__WEBPACK_IMPORTED_MODULE_0__.Allocations),\n/* harmony export */   Holidays: () => (/* reexport safe */ _Holidays__WEBPACK_IMPORTED_MODULE_1__.Holidays),\n/* harmony export */   Onboarding: () => (/* reexport safe */ _Onboarding__WEBPACK_IMPORTED_MODULE_2__.Onboarding),\n/* harmony export */   Policies: () => (/* reexport safe */ _Policies__WEBPACK_IMPORTED_MODULE_3__.Policies),\n/* harmony export */   SCHEMA_EXTENSIONS: () => (/* binding */ SCHEMA_EXTENSIONS),\n/* harmony export */   TimePlanEntries: () => (/* reexport safe */ _TimePlanEntries__WEBPACK_IMPORTED_MODULE_4__.TimePlanEntries),\n/* harmony export */   TimePlans: () => (/* reexport safe */ _TimePlans__WEBPACK_IMPORTED_MODULE_5__.TimePlans)\n/* harmony export */ });\n/* harmony import */ var _Allocations__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Allocations */ \"(api)/../../schemas/extensions/Allocations.ts\");\n/* harmony import */ var _Holidays__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Holidays */ \"(api)/../../schemas/extensions/Holidays.ts\");\n/* harmony import */ var _Onboarding__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Onboarding */ \"(api)/../../schemas/extensions/Onboarding.ts\");\n/* harmony import */ var _Policies__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Policies */ \"(api)/../../schemas/extensions/Policies.ts\");\n/* harmony import */ var _TimePlanEntries__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./TimePlanEntries */ \"(api)/../../schemas/extensions/TimePlanEntries.ts\");\n/* harmony import */ var _TimePlans__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./TimePlans */ \"(api)/../../schemas/extensions/TimePlans.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Holidays__WEBPACK_IMPORTED_MODULE_1__, _TimePlanEntries__WEBPACK_IMPORTED_MODULE_4__, _TimePlans__WEBPACK_IMPORTED_MODULE_5__]);\n([_Holidays__WEBPACK_IMPORTED_MODULE_1__, _TimePlanEntries__WEBPACK_IMPORTED_MODULE_4__, _TimePlans__WEBPACK_IMPORTED_MODULE_5__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\nconst SCHEMA_EXTENSIONS = [\n    _Holidays__WEBPACK_IMPORTED_MODULE_1__.Holidays,\n    _TimePlans__WEBPACK_IMPORTED_MODULE_5__.TimePlans,\n    _Policies__WEBPACK_IMPORTED_MODULE_3__.Policies,\n    _Onboarding__WEBPACK_IMPORTED_MODULE_2__.Onboarding,\n    _Allocations__WEBPACK_IMPORTED_MODULE_0__.Allocations,\n    _TimePlanEntries__WEBPACK_IMPORTED_MODULE_4__.TimePlanEntries\n];\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBNEM7QUFDTjtBQUNJO0FBQ0o7QUFDYztBQUNaO0FBRWpDLE1BQU1NLG9CQUFvQjtJQUFDTCwrQ0FBUUE7SUFBRUksaURBQVNBO0lBQUVGLCtDQUFRQTtJQUFFRCxtREFBVUE7SUFBRUYscURBQVdBO0lBQUVJLDZEQUFlQTtDQUFDLENBQUM7QUFFeEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vc2NoZW1hcy9leHRlbnNpb25zL2luZGV4LnRzPzkyMGUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWxsb2NhdGlvbnMgfSBmcm9tICcuL0FsbG9jYXRpb25zJztcbmltcG9ydCB7IEhvbGlkYXlzIH0gZnJvbSAnLi9Ib2xpZGF5cyc7XG5pbXBvcnQgeyBPbmJvYXJkaW5nIH0gZnJvbSAnLi9PbmJvYXJkaW5nJztcbmltcG9ydCB7IFBvbGljaWVzIH0gZnJvbSAnLi9Qb2xpY2llcyc7XG5pbXBvcnQgeyBUaW1lUGxhbkVudHJpZXMgfSBmcm9tICcuL1RpbWVQbGFuRW50cmllcyc7XG5pbXBvcnQgeyBUaW1lUGxhbnMgfSBmcm9tICcuL1RpbWVQbGFucyc7XG5cbmV4cG9ydCBjb25zdCBTQ0hFTUFfRVhURU5TSU9OUyA9IFtIb2xpZGF5cywgVGltZVBsYW5zLCBQb2xpY2llcywgT25ib2FyZGluZywgQWxsb2NhdGlvbnMsIFRpbWVQbGFuRW50cmllc107XG5cbmV4cG9ydCB7IEFsbG9jYXRpb25zLCBIb2xpZGF5cywgT25ib2FyZGluZywgUG9saWNpZXMsIFRpbWVQbGFuRW50cmllcywgVGltZVBsYW5zIH07XG4iXSwibmFtZXMiOlsiQWxsb2NhdGlvbnMiLCJIb2xpZGF5cyIsIk9uYm9hcmRpbmciLCJQb2xpY2llcyIsIlRpbWVQbGFuRW50cmllcyIsIlRpbWVQbGFucyIsIlNDSEVNQV9FWFRFTlNJT05TIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/extensions/index.ts\n");

/***/ }),

/***/ "(api)/../../schemas/graphqlExtensions.ts":
/*!******************************************!*\
  !*** ../../schemas/graphqlExtensions.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @keystone-6/core */ \"@keystone-6/core\");\n/* harmony import */ var _keystone_6_core__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _extensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./extensions */ \"(api)/../../schemas/extensions/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_extensions__WEBPACK_IMPORTED_MODULE_1__]);\n_extensions__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_keystone_6_core__WEBPACK_IMPORTED_MODULE_0__.graphql.extend((base)=>_extensions__WEBPACK_IMPORTED_MODULE_1__.SCHEMA_EXTENSIONS.map((item)=>item(base))));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9ncmFwaHFsRXh0ZW5zaW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQTJDO0FBQ007QUFFakQsaUVBQWVBLHFEQUFPQSxDQUFDRSxNQUFNLENBQUNDLENBQUFBLE9BQVEsMkRBQTJCQyxHQUFHLENBQUMsQ0FBQ0MsT0FBY0EsS0FBS0YsT0FBT0EsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL2dyYXBocWxFeHRlbnNpb25zLnRzP2ZiNGIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ3JhcGhxbCB9IGZyb20gJ0BrZXlzdG9uZS02L2NvcmUnO1xuaW1wb3J0IHsgU0NIRU1BX0VYVEVOU0lPTlMgfSBmcm9tICcuL2V4dGVuc2lvbnMnO1xuXG5leHBvcnQgZGVmYXVsdCBncmFwaHFsLmV4dGVuZChiYXNlID0+IChTQ0hFTUFfRVhURU5TSU9OUyBhcyBhbnkpLm1hcCgoaXRlbTogYW55KSA9PiBpdGVtKGJhc2UpKSk7XG4iXSwibmFtZXMiOlsiZ3JhcGhxbCIsIlNDSEVNQV9FWFRFTlNJT05TIiwiZXh0ZW5kIiwiYmFzZSIsIm1hcCIsIml0ZW0iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../schemas/graphqlExtensions.ts\n");

/***/ }),

/***/ "(api)/../../schemas/index.ts":
/*!******************************!*\
  !*** ../../schemas/index.ts ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* reexport safe */ _schemas__WEBPACK_IMPORTED_MODULE_0__[\"default\"]),\n/* harmony export */   extendGraphqlSchema: () => (/* reexport safe */ _graphqlExtensions__WEBPACK_IMPORTED_MODULE_1__[\"default\"])\n/* harmony export */ });\n/* harmony import */ var _schemas__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./schemas */ \"(api)/../../schemas/schemas.ts\");\n/* harmony import */ var _graphqlExtensions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./graphqlExtensions */ \"(api)/../../schemas/graphqlExtensions.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_schemas__WEBPACK_IMPORTED_MODULE_0__, _graphqlExtensions__WEBPACK_IMPORTED_MODULE_1__]);\n([_schemas__WEBPACK_IMPORTED_MODULE_0__, _graphqlExtensions__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQW9DO0FBQ2lDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uL3NjaGVtYXMvaW5kZXgudHM/MzgxNyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgeyBkZWZhdWx0IH0gZnJvbSAnLi9zY2hlbWFzJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZXh0ZW5kR3JhcGhxbFNjaGVtYSB9IGZyb20gJy4vZ3JhcGhxbEV4dGVuc2lvbnMnO1xuIl0sIm5hbWVzIjpbImRlZmF1bHQiLCJleHRlbmRHcmFwaHFsU2NoZW1hIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/index.ts\n");

/***/ }),

/***/ "(api)/../../schemas/schemas.ts":
/*!********************************!*\
  !*** ../../schemas/schemas.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _UserAllocation__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./UserAllocation */ \"(api)/../../schemas/UserAllocation.ts\");\n/* harmony import */ var _TimePlan__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./TimePlan */ \"(api)/../../schemas/TimePlan.ts\");\n/* harmony import */ var _TimeType__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./TimeType */ \"(api)/../../schemas/TimeType.ts\");\n/* harmony import */ var _Location__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Location */ \"(api)/../../schemas/Location.ts\");\n/* harmony import */ var _Organization__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Organization */ \"(api)/../../schemas/Organization.ts\");\n/* harmony import */ var _TimePolicy__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./TimePolicy */ \"(api)/../../schemas/TimePolicy.ts\");\n/* harmony import */ var _TimePolicyAllocation__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./TimePolicyAllocation */ \"(api)/../../schemas/TimePolicyAllocation.ts\");\n/* harmony import */ var _User__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./User */ \"(api)/../../schemas/User.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_Location__WEBPACK_IMPORTED_MODULE_3__]);\n_Location__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n\nconst lists = {\n    Organization: _Organization__WEBPACK_IMPORTED_MODULE_4__[\"default\"],\n    TimePolicy: _TimePolicy__WEBPACK_IMPORTED_MODULE_5__[\"default\"],\n    TimePolicyAllocation: _TimePolicyAllocation__WEBPACK_IMPORTED_MODULE_6__[\"default\"],\n    UserAllocation: _UserAllocation__WEBPACK_IMPORTED_MODULE_0__[\"default\"],\n    TimeType: _TimeType__WEBPACK_IMPORTED_MODULE_2__[\"default\"],\n    Location: _Location__WEBPACK_IMPORTED_MODULE_3__[\"default\"],\n    TimePlan: _TimePlan__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n    User: _User__WEBPACK_IMPORTED_MODULE_7__[\"default\"]\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (lists);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vc2NoZW1hcy9zY2hlbWFzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUE4QztBQUNaO0FBQ0E7QUFDQTtBQUNRO0FBQ0o7QUFDb0I7QUFDaEM7QUFFMUIsTUFBTVEsUUFBUTtJQUNaSixZQUFZQSx1REFBQUE7SUFDWkMsVUFBVUEscURBQUFBO0lBQ1ZDLG9CQUFvQkEsK0RBQUFBO0lBQ3BCTixjQUFjQSx5REFBQUE7SUFDZEUsUUFBUUEsbURBQUFBO0lBQ1JDLFFBQVFBLG1EQUFBQTtJQUNSRixRQUFRQSxtREFBQUE7SUFDUk0sSUFBSUEsK0NBQUFBO0FBQ047QUFFQSxpRUFBZUMsS0FBS0EsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi9zY2hlbWFzL3NjaGVtYXMudHM/MjFlNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVXNlckFsbG9jYXRpb24gZnJvbSAnLi9Vc2VyQWxsb2NhdGlvbic7XG5pbXBvcnQgVGltZVBsYW4gZnJvbSAnLi9UaW1lUGxhbic7XG5pbXBvcnQgVGltZVR5cGUgZnJvbSAnLi9UaW1lVHlwZSc7XG5pbXBvcnQgTG9jYXRpb24gZnJvbSAnLi9Mb2NhdGlvbic7XG5pbXBvcnQgT3JnYW5pemF0aW9uIGZyb20gJy4vT3JnYW5pemF0aW9uJztcbmltcG9ydCBUaW1lUG9saWN5IGZyb20gJy4vVGltZVBvbGljeSc7XG5pbXBvcnQgVGltZVBvbGljeUFsbG9jYXRpb24gZnJvbSAnLi9UaW1lUG9saWN5QWxsb2NhdGlvbic7XG5pbXBvcnQgVXNlciBmcm9tICcuL1VzZXInO1xuXG5jb25zdCBsaXN0cyA9IHtcbiAgT3JnYW5pemF0aW9uLFxuICBUaW1lUG9saWN5LFxuICBUaW1lUG9saWN5QWxsb2NhdGlvbixcbiAgVXNlckFsbG9jYXRpb24sXG4gIFRpbWVUeXBlLFxuICBMb2NhdGlvbixcbiAgVGltZVBsYW4sXG4gIFVzZXJcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGxpc3RzO1xuIl0sIm5hbWVzIjpbIlVzZXJBbGxvY2F0aW9uIiwiVGltZVBsYW4iLCJUaW1lVHlwZSIsIkxvY2F0aW9uIiwiT3JnYW5pemF0aW9uIiwiVGltZVBvbGljeSIsIlRpbWVQb2xpY3lBbGxvY2F0aW9uIiwiVXNlciIsImxpc3RzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../schemas/schemas.ts\n");

/***/ })

};
;