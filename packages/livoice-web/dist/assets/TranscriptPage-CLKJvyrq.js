import{j as e,u as k,b as C,r as c,L as D,t as S}from"./index-B5zT1MZw.js";import{c as I}from"./cn-C0Y9tLwQ.js";import{a as M,b as L,c as P,d as A,C as d}from"./card-CU2BOY4R.js";const p=({variant:s="primary",size:t="default",className:r,...l})=>e.jsx("button",{className:I("inline-flex items-center justify-center rounded-2xl text-sm font-semibold transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-500/80",s==="ghost"?"border border-slate-200 bg-white text-slate-900 hover:bg-slate-50":"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-xl shadow-indigo-500/20 hover:from-violet-700 hover:to-indigo-700",t==="sm"?"px-4 py-2":"px-5 py-2.5",r),...l}),Q=s=>s?new Date(s*1e3).toISOString().substr(11,8):"",E=({chunks:s})=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Timeline"}),e.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-700",children:s.map(t=>e.jsxs("li",{className:"rounded-xl border border-slate-100 bg-slate-50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsx("span",{children:t.speaker??"Speaker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.durationSeconds?`${t.durationSeconds.toFixed(1)}s`:"—"}),e.jsx("span",{children:Q(t.absoluteTimestamp)})]})]}),e.jsx("p",{className:"mt-1 text-sm text-slate-700",children:t.text})]},t.id))})]}),G=()=>{const{t:s}=k("common"),{transcriptId:t=""}=C(),r=M(t,{}),l=L(t,{}),h=P(),b=A(),[i,x]=c.useState(""),[m,f]=c.useState([]),g=l.data??[],j=r.isLoading||l.isLoading,N=c.useMemo(()=>r.data?new Date(r.data.transcriptDate).toLocaleDateString():"",[r.data]),n=r.data,w=async a=>{a.preventDefault(),!(!t||!i.trim())&&(await h.mutateAsync({id:t,body:{text:i}}),x(""))},y=async a=>{if(a.preventDefault(),!t||!a.currentTarget.elements.namedItem("chatMessage"))return;const o=new FormData(a.currentTarget).get("chatMessage")??"";if(!o.trim())return;const v=await b.mutateAsync({id:t,body:{userMessage:o}});f(T=>[...T,{role:"user",text:o},{role:"assistant",text:v.answer}]),a.currentTarget.reset()};return j?e.jsx(d,{children:s("status.loading")}):r.isError||!n?e.jsx(d,{children:s("status.error")}):e.jsx(d,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs(D,{to:S(),className:"text-sm font-semibold text-slate-500",children:["← ",s("buttons.back")]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:n.title}),e.jsx("p",{className:"text-sm text-slate-500",children:n.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs uppercase tracking-[0.3em] text-slate-400",children:[e.jsxs("span",{children:[s("fields.date"),": ",N]}),e.jsxs("span",{children:[s("fields.interviewee"),": ",n.intervieweeName??"—"]}),e.jsxs("span",{children:[s("fields.chunks"),": ",n.chunkCount??0]})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.5fr,1fr]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:w,className:"space-y-3 rounded-2xl border border-slate-200 bg-slate-50 p-6",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Upload transcript"}),e.jsx("textarea",{name:"transcriptText",className:"w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm focus:border-slate-400 focus:outline-none",rows:4,placeholder:"Paste transcript text here",value:i,onChange:a=>x(a.target.value)}),e.jsx(p,{type:"submit",className:"w-full",children:s("buttons.uploadText")})]}),e.jsx(E,{chunks:g})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:y,className:"space-y-3 rounded-2xl border border-slate-200 bg-slate-50 p-6",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500",children:s("buttons.sendQuestion")}),e.jsx("textarea",{name:"chatMessage",className:"w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm focus:border-slate-400 focus:outline-none",rows:3,placeholder:"Ask about this interview"}),e.jsx(p,{type:"submit",className:"w-full",children:s("buttons.sendQuestion")})]}),e.jsxs("div",{className:"space-y-2 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-500",children:"Chat history"}),m.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No chat yet."}):m.map((a,u)=>e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 p-3 text-sm text-slate-700",children:[e.jsx("strong",{className:"block text-xs uppercase tracking-[0.3em] text-slate-500",children:a.role==="user"?"You":"Assistant"}),e.jsx("p",{children:a.text})]},`${a.role}-${u}`))]})]})]})]})})};export{G as default};
