query ChatProjectHistory($projectId: ID!, $chatId: ID) {
  chatProjectHistory(projectId: $projectId, chatId: $chatId) {
    chatId
    title
    systemPrompt
    resolvedSystemPrompt
    config {
      systemPrompt
      openai {
        model
        temperature
        maxOutputTokens
      }
      context {
        maxInputTokens
        reservedTokens
        historyTokenBudget
      }
      segments {
        tokenBudget
        maxCount
      }
    }
    messages {
      id
      role
      content
      createdAt
      debugData {
        config {
          systemPrompt
          openai {
            model
            temperature
            maxOutputTokens
          }
          context {
            maxInputTokens
            reservedTokens
            historyTokenBudget
          }
          segments {
            tokenBudget
            maxCount
          }
        }
        resolvedSystemPrompt
        userMessageWithContext
        history {
          messagesIncluded
          tokensUsed
          tokenBudget
          messages {
            role
            content
            tokens
          }
        }
        segments {
          id
          text
          transcriptTitle
          speaker
          startMs
          endMs
          similarityScore
          estimatedTokens
        }
        segmentTokensUsed
        openaiResponse {
          model
          promptTokens
          completionTokens
          totalTokens
        }
        timing {
          startedAt
          completedAt
        }
      }
    }
  }
}

